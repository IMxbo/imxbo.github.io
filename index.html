<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  
  <title>xbo&#39;s Blog</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta property="og:type" content="website">
<meta property="og:title" content="xbo&#39;s Blog">
<meta property="og:url" content="http://example.com/index.html">
<meta property="og:site_name" content="xbo&#39;s Blog">
<meta property="og:locale">
<meta property="article:author" content="xbo">
<meta name="twitter:card" content="summary">
  
    <link rel="alternate" href="/atom.xml" title="xbo's Blog" type="application/atom+xml">
  
  
    <link rel="shortcut icon" href="/favicon.png">
  
  
    
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/typeface-source-code-pro@0.0.71/index.min.css">

  
  
<link rel="stylesheet" href="/css/style.css">

  
    
<link rel="stylesheet" href="/fancybox/jquery.fancybox.min.css">

  
<meta name="generator" content="Hexo 5.4.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">xbo&#39;s Blog</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Suche"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Suche"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://example.com"></form>
      </div>
    </div>
  </div>
</header>

      <div class="outer">
        <section id="main">
  
    <article id="post-Python Cheatsheet" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2021/03/24/Python%20Cheatsheet/" class="article-date">
  <time class="dt-published" datetime="2021-03-24T06:02:27.937Z" itemprop="datePublished">2021-03-24</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="Comprehensive-Python-Cheatsheet"><a href="#Comprehensive-Python-Cheatsheet" class="headerlink" title="Comprehensive Python Cheatsheet"></a>Comprehensive Python Cheatsheet</h1><p><sup><a target="_blank" rel="noopener" href="https://raw.githubusercontent.com/gto76/python-cheatsheet/master/README.md">Download text file</a>, <a target="_blank" rel="noopener" href="https://github.com/gto76/python-cheatsheet">Fork me on GitHub</a> or <a target="_blank" rel="noopener" href="https://github.com/gto76/python-cheatsheet/wiki/Frequently-Asked-Questions">Check out FAQ</a>.<br></sup></p>
<h2 id="Contents"><a href="#Contents" class="headerlink" title="Contents"></a>Contents</h2><p><strong>&nbsp;&nbsp;&nbsp;</strong> <strong>1. Collections:</strong> <strong>&nbsp;</strong> <strong><a href="#list"><code>List</code></a></strong><strong>,</strong> <strong><a href="#dictionary"><code>Dictionary </code></a></strong><strong>,</strong> <strong><a href="#set"><code>Set</code></a></strong><strong>,</strong> <strong><a href="#tuple"><code>Tuple</code></a></strong><strong>,</strong> <strong><a href="#range"><code>Range</code></a></strong><strong>,</strong> <strong><a href="#enumerate"><code>Enumerate</code></a></strong><strong>,</strong> <strong><a href="#iterator"><code>Iterator</code></a></strong><strong>,</strong> <strong><a href="#generator"><code>Generator</code></a></strong><strong>.</strong><br><strong>&nbsp;&nbsp;&nbsp;</strong> <strong>2. Types:</strong> <strong>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</strong>  <strong><a href="#type"><code>Type</code></a></strong><strong>,</strong> <strong><a href="#string"><code>String</code></a></strong><strong>,</strong> <strong><a href="#regex"><code>Regular_Exp</code></a></strong><strong>,</strong> <strong><a href="#format"><code>Format</code></a></strong><strong>,</strong> <strong><a href="#numbers"><code>Numbers</code></a></strong><strong>,</strong> <strong><a href="#combinatorics"><code>Combinatorics</code></a></strong><strong>,</strong> <strong><a href="#datetime"><code>Datetime</code></a></strong><strong>.</strong><br><strong>&nbsp;&nbsp;&nbsp;</strong> <strong>3. Syntax:</strong> <strong>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</strong>  <strong><a href="#arguments"><code>Args</code></a></strong><strong>,</strong> <strong><a href="#inline"><code>Inline</code></a></strong><strong>,</strong> <strong><a href="#closure"><code>Closure</code></a></strong><strong>,</strong> <strong><a href="#decorator"><code>Decorator</code></a></strong><strong>,</strong> <strong><a href="#class"><code>Class</code></a></strong><strong>,</strong> <strong><a href="#duck-types"><code>Duck_Types</code></a></strong><strong>,</strong> <strong><a href="#enum"><code>Enum</code></a></strong><strong>,</strong> <strong><a href="#exceptions"><code>Exceptions</code></a></strong><strong>.</strong><br><strong>&nbsp;&nbsp;&nbsp;</strong> <strong>4. System:</strong> <strong>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</strong>  <strong><a href="#print"><code>Print</code></a></strong><strong>,</strong> <strong><a href="#input"><code>Input</code></a></strong><strong>,</strong> <strong><a href="#command-line-arguments"><code>Command_Line_Arguments</code></a></strong><strong>,</strong> <strong><a href="#open"><code>Open</code></a></strong><strong>,</strong> <strong><a href="#path"><code>Path</code></a></strong><strong>,</strong> <strong><a href="#command-execution"><code>Command_Execution</code></a></strong><strong>.</strong><br><strong>&nbsp;&nbsp;&nbsp;</strong> <strong>5. Data:</strong> <strong>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</strong>  <strong><a href="#csv"><code>CSV</code></a></strong><strong>,</strong> <strong><a href="#json"><code>JSON</code></a></strong><strong>,</strong> <strong><a href="#pickle"><code>Pickle</code></a></strong><strong>,</strong> <strong><a href="#sqlite"><code>SQLite</code></a></strong><strong>,</strong> <strong><a href="#bytes"><code>Bytes</code></a></strong><strong>,</strong> <strong><a href="#struct"><code>Struct</code></a></strong><strong>,</strong> <strong><a href="#array"><code>Array</code></a></strong><strong>,</strong> <strong><a href="#memory-view"><code>MemoryView</code></a></strong><strong>,</strong> <strong><a href="#deque"><code>Deque</code></a></strong><strong>.</strong><br><strong>&nbsp;&nbsp;&nbsp;</strong> <strong>6. Advanced:</strong> <strong>&nbsp;&nbsp;&nbsp;</strong>  <strong><a href="#threading"><code>Threading</code></a></strong><strong>,</strong> <strong><a href="#introspection"><code>Introspection</code></a></strong><strong>,</strong> <strong><a href="#metaprograming"><code>Metaprograming</code></a></strong><strong>,</strong> <strong><a href="#operator"><code>Operator</code></a></strong><strong>,</strong> <strong><a href="#eval"><code>Eval</code></a></strong><strong>,</strong> <strong><a href="#coroutine"><code>Coroutine</code></a></strong><strong>.</strong><br><strong>&nbsp;&nbsp;&nbsp;</strong> <strong>7. Libraries:</strong> <strong>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</strong>  <strong><a href="#progress-bar"><code>Progress_Bar</code></a></strong><strong>,</strong> <strong><a href="#plot"><code>Plot</code></a></strong><strong>,</strong> <strong><a href="#table"><code>Table</code></a></strong><strong>,</strong> <strong><a href="#curses"><code>Curses</code></a></strong><strong>,</strong> <strong><a href="#logging"><code>Logging</code></a></strong><strong>,</strong> <strong><a href="#scraping"><code>Scraping</code></a></strong><strong>,</strong> <strong><a href="#web"><code>Web</code></a></strong><strong>,</strong> <strong><a href="#profile"><code>Profile</code></a></strong><strong>,</strong><br><strong>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</strong> <strong><a href="#numpy"><code>NumPy</code></a></strong><strong>,</strong> <strong><a href="#image"><code>Image</code></a></strong><strong>,</strong> <strong><a href="#audio"><code>Audio</code></a></strong><strong>.</strong></p>
<h2 id="Main"><a href="#Main" class="headerlink" title="Main"></a>Main</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:     <span class="comment"># Runs main() if file wasn&#x27;t imported.</span></span><br><span class="line">    main()</span><br></pre></td></tr></table></figure>


<h2 id="List"><a href="#List" class="headerlink" title="List"></a>List</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;<span class="built_in">list</span>&gt; = &lt;<span class="built_in">list</span>&gt;[from_inclusive : to_exclusive : ±step_size]</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;<span class="built_in">list</span>&gt;.append(&lt;el&gt;)            <span class="comment"># Or: &lt;list&gt; += [&lt;el&gt;]</span></span><br><span class="line">&lt;<span class="built_in">list</span>&gt;.extend(&lt;collection&gt;)    <span class="comment"># Or: &lt;list&gt; += &lt;collection&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;<span class="built_in">list</span>&gt;.sort()</span><br><span class="line">&lt;<span class="built_in">list</span>&gt;.reverse()</span><br><span class="line">&lt;<span class="built_in">list</span>&gt; = <span class="built_in">sorted</span>(&lt;collection&gt;)</span><br><span class="line">&lt;<span class="built_in">iter</span>&gt; = <span class="built_in">reversed</span>(&lt;<span class="built_in">list</span>&gt;)</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">sum_of_elements  = <span class="built_in">sum</span>(&lt;collection&gt;)</span><br><span class="line">elementwise_sum  = [<span class="built_in">sum</span>(pair) <span class="keyword">for</span> pair <span class="keyword">in</span> <span class="built_in">zip</span>(list_a, list_b)]</span><br><span class="line">sorted_by_second = <span class="built_in">sorted</span>(&lt;collection&gt;, key=<span class="keyword">lambda</span> el: el[<span class="number">1</span>])</span><br><span class="line">sorted_by_both   = <span class="built_in">sorted</span>(&lt;collection&gt;, key=<span class="keyword">lambda</span> el: (el[<span class="number">1</span>], el[<span class="number">0</span>]))</span><br><span class="line">flatter_list     = <span class="built_in">list</span>(itertools.chain.from_iterable(&lt;<span class="built_in">list</span>&gt;))</span><br><span class="line">product_of_elems = functools.reduce(<span class="keyword">lambda</span> out, x: out * x, &lt;collection&gt;)</span><br><span class="line">list_of_chars    = <span class="built_in">list</span>(&lt;<span class="built_in">str</span>&gt;)</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">index = &lt;<span class="built_in">list</span>&gt;.index(&lt;el&gt;)     <span class="comment"># Returns index of first occurrence or raises ValueError.</span></span><br><span class="line">&lt;<span class="built_in">list</span>&gt;.insert(index, &lt;el&gt;)     <span class="comment"># Inserts item at index and moves the rest to the right.</span></span><br><span class="line">&lt;el&gt; = &lt;<span class="built_in">list</span>&gt;.pop([index])     <span class="comment"># Removes and returns item at index or from the end.</span></span><br><span class="line">&lt;<span class="built_in">list</span>&gt;.remove(&lt;el&gt;)            <span class="comment"># Removes first occurrence of item or raises ValueError.</span></span><br><span class="line">&lt;<span class="built_in">list</span>&gt;.clear()                 <span class="comment"># Removes all items. Also works on dict and set.</span></span><br></pre></td></tr></table></figure>


<h2 id="Dictionary"><a href="#Dictionary" class="headerlink" title="Dictionary"></a>Dictionary</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;view&gt; = &lt;<span class="built_in">dict</span>&gt;.keys()                          <span class="comment"># Coll. of keys that reflects changes.</span></span><br><span class="line">&lt;view&gt; = &lt;<span class="built_in">dict</span>&gt;.values()                        <span class="comment"># Coll. of values that reflects changes.</span></span><br><span class="line">&lt;view&gt; = &lt;<span class="built_in">dict</span>&gt;.items()                         <span class="comment"># Coll. of key-value tuples.</span></span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">value  = &lt;<span class="built_in">dict</span>&gt;.get(key, default=<span class="literal">None</span>)          <span class="comment"># Returns default if key does not exist.</span></span><br><span class="line">value  = &lt;<span class="built_in">dict</span>&gt;.setdefault(key, default=<span class="literal">None</span>)   <span class="comment"># Same, but also adds default to dict.</span></span><br><span class="line">&lt;<span class="built_in">dict</span>&gt; = collections.defaultdict(&lt;<span class="built_in">type</span>&gt;)        <span class="comment"># Creates a dict with default value of type.</span></span><br><span class="line">&lt;<span class="built_in">dict</span>&gt; = collections.defaultdict(<span class="keyword">lambda</span>: <span class="number">1</span>)     <span class="comment"># Creates a dict with default value 1.</span></span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;<span class="built_in">dict</span>&gt;.update(&lt;<span class="built_in">dict</span>&gt;)</span><br><span class="line">&lt;<span class="built_in">dict</span>&gt; = <span class="built_in">dict</span>(&lt;collection&gt;)                     <span class="comment"># Creates a dict from coll. of key-value pairs.</span></span><br><span class="line">&lt;<span class="built_in">dict</span>&gt; = <span class="built_in">dict</span>(<span class="built_in">zip</span>(keys, values))                <span class="comment"># Creates a dict from two collections.</span></span><br><span class="line">&lt;<span class="built_in">dict</span>&gt; = <span class="built_in">dict</span>.fromkeys(keys [, value])          <span class="comment"># Creates a dict from collection of keys.</span></span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">value = &lt;<span class="built_in">dict</span>&gt;.pop(key)                         <span class="comment"># Removes item from dictionary.</span></span><br><span class="line">&#123;k: v <span class="keyword">for</span> k, v <span class="keyword">in</span> &lt;<span class="built_in">dict</span>&gt;.items() <span class="keyword">if</span> k <span class="keyword">in</span> keys&#125;  <span class="comment"># Filters dictionary by keys.</span></span><br></pre></td></tr></table></figure>

<h3 id="Counter"><a href="#Counter" class="headerlink" title="Counter"></a>Counter</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> collections <span class="keyword">import</span> Counter</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>colors = [<span class="string">&#x27;red&#x27;</span>, <span class="string">&#x27;blue&#x27;</span>, <span class="string">&#x27;yellow&#x27;</span>, <span class="string">&#x27;blue&#x27;</span>, <span class="string">&#x27;red&#x27;</span>, <span class="string">&#x27;blue&#x27;</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>counter = Counter(colors)</span><br><span class="line">Counter(&#123;<span class="string">&#x27;blue&#x27;</span>: <span class="number">3</span>, <span class="string">&#x27;red&#x27;</span>: <span class="number">2</span>, <span class="string">&#x27;yellow&#x27;</span>: <span class="number">1</span>&#125;)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>counter.most_common()[<span class="number">0</span>]</span><br><span class="line">(<span class="string">&#x27;blue&#x27;</span>, <span class="number">3</span>)</span><br></pre></td></tr></table></figure>


<h2 id="Set"><a href="#Set" class="headerlink" title="Set"></a>Set</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;<span class="built_in">set</span>&gt; = <span class="built_in">set</span>()</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;<span class="built_in">set</span>&gt;.add(&lt;el&gt;)                               <span class="comment"># Or: &lt;set&gt; |= &#123;&lt;el&gt;&#125;</span></span><br><span class="line">&lt;<span class="built_in">set</span>&gt;.update(&lt;collection&gt;)                    <span class="comment"># Or: &lt;set&gt; |= &lt;set&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;<span class="built_in">set</span>&gt;  = &lt;<span class="built_in">set</span>&gt;.union(&lt;coll.&gt;)                 <span class="comment"># Or: &lt;set&gt; | &lt;set&gt;</span></span><br><span class="line">&lt;<span class="built_in">set</span>&gt;  = &lt;<span class="built_in">set</span>&gt;.intersection(&lt;coll.&gt;)          <span class="comment"># Or: &lt;set&gt; &amp; &lt;set&gt;</span></span><br><span class="line">&lt;<span class="built_in">set</span>&gt;  = &lt;<span class="built_in">set</span>&gt;.difference(&lt;coll.&gt;)            <span class="comment"># Or: &lt;set&gt; - &lt;set&gt;</span></span><br><span class="line">&lt;<span class="built_in">set</span>&gt;  = &lt;<span class="built_in">set</span>&gt;.symmetric_difference(&lt;coll.&gt;)  <span class="comment"># Or: &lt;set&gt; ^ &lt;set&gt;</span></span><br><span class="line">&lt;<span class="built_in">bool</span>&gt; = &lt;<span class="built_in">set</span>&gt;.issubset(&lt;coll.&gt;)              <span class="comment"># Or: &lt;set&gt; &lt;= &lt;set&gt;</span></span><br><span class="line">&lt;<span class="built_in">bool</span>&gt; = &lt;<span class="built_in">set</span>&gt;.issuperset(&lt;coll.&gt;)            <span class="comment"># Or: &lt;set&gt; &gt;= &lt;set&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;<span class="built_in">set</span>&gt;.remove(&lt;el&gt;)                            <span class="comment"># Raises KeyError.</span></span><br><span class="line">&lt;<span class="built_in">set</span>&gt;.discard(&lt;el&gt;)                           <span class="comment"># Doesn&#x27;t raise an error.</span></span><br></pre></td></tr></table></figure>

<h3 id="Frozen-Set"><a href="#Frozen-Set" class="headerlink" title="Frozen Set"></a>Frozen Set</h3><ul>
<li><strong>Is immutable and hashable.</strong></li>
<li><strong>That means it can be used as a key in a dictionary or as an element in a set.</strong><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;<span class="built_in">frozenset</span>&gt; = <span class="built_in">frozenset</span>(&lt;collection&gt;)</span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="Tuple"><a href="#Tuple" class="headerlink" title="Tuple"></a>Tuple</h2><p><strong>Tuple is an immutable and hashable list.</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;<span class="built_in">tuple</span>&gt; = ()</span><br><span class="line">&lt;<span class="built_in">tuple</span>&gt; = (&lt;el&gt;, )</span><br><span class="line">&lt;<span class="built_in">tuple</span>&gt; = (&lt;el_1&gt;, &lt;el_2&gt;, ...)</span><br></pre></td></tr></table></figure>

<h3 id="Named-Tuple"><a href="#Named-Tuple" class="headerlink" title="Named Tuple"></a>Named Tuple</h3><p><strong>Tuple’s subclass with named elements.</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> collections <span class="keyword">import</span> namedtuple</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>Point = namedtuple(<span class="string">&#x27;Point&#x27;</span>, <span class="string">&#x27;x y&#x27;</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>p = Point(<span class="number">1</span>, y=<span class="number">2</span>)</span><br><span class="line">Point(x=<span class="number">1</span>, y=<span class="number">2</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>p[<span class="number">0</span>]</span><br><span class="line"><span class="number">1</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>p.x</span><br><span class="line"><span class="number">1</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">getattr</span>(p, <span class="string">&#x27;y&#x27;</span>)</span><br><span class="line"><span class="number">2</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>p._fields  <span class="comment"># Or: Point._fields</span></span><br><span class="line">(<span class="string">&#x27;x&#x27;</span>, <span class="string">&#x27;y&#x27;</span>)</span><br></pre></td></tr></table></figure>


<h2 id="Range"><a href="#Range" class="headerlink" title="Range"></a>Range</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;<span class="built_in">range</span>&gt; = <span class="built_in">range</span>(to_exclusive)</span><br><span class="line">&lt;<span class="built_in">range</span>&gt; = <span class="built_in">range</span>(from_inclusive, to_exclusive)</span><br><span class="line">&lt;<span class="built_in">range</span>&gt; = <span class="built_in">range</span>(from_inclusive, to_exclusive, ±step_size)</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">from_inclusive = &lt;<span class="built_in">range</span>&gt;.start</span><br><span class="line">to_exclusive   = &lt;<span class="built_in">range</span>&gt;.stop</span><br></pre></td></tr></table></figure>


<h2 id="Enumerate"><a href="#Enumerate" class="headerlink" title="Enumerate"></a>Enumerate</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> i, el <span class="keyword">in</span> <span class="built_in">enumerate</span>(&lt;collection&gt; [, i_start]):</span><br><span class="line">    ...</span><br></pre></td></tr></table></figure>


<h2 id="Iterator"><a href="#Iterator" class="headerlink" title="Iterator"></a>Iterator</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;<span class="built_in">iter</span>&gt; = <span class="built_in">iter</span>(&lt;collection&gt;)                 <span class="comment"># Calling `iter(&lt;iter&gt;)` returns unmodified iterator.</span></span><br><span class="line">&lt;<span class="built_in">iter</span>&gt; = <span class="built_in">iter</span>(&lt;function&gt;, to_exclusive)     <span class="comment"># Sequence of return values until &#x27;to_exclusive&#x27;.</span></span><br><span class="line">&lt;el&gt;   = <span class="built_in">next</span>(&lt;<span class="built_in">iter</span>&gt; [, default])           <span class="comment"># Raises StopIteration or returns &#x27;default&#x27; on end.</span></span><br></pre></td></tr></table></figure>

<h3 id="Itertools"><a href="#Itertools" class="headerlink" title="Itertools"></a>Itertools</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> itertools <span class="keyword">import</span> count, repeat, cycle, chain, islice</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;<span class="built_in">iter</span>&gt; = count(start=<span class="number">0</span>, step=<span class="number">1</span>)             <span class="comment"># Returns incremented value endlessly.</span></span><br><span class="line">&lt;<span class="built_in">iter</span>&gt; = repeat(&lt;el&gt; [, times])             <span class="comment"># Returns element endlessly or &#x27;times&#x27; times.</span></span><br><span class="line">&lt;<span class="built_in">iter</span>&gt; = cycle(&lt;collection&gt;)                <span class="comment"># Repeats the sequence indefinitely.</span></span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;<span class="built_in">iter</span>&gt; = chain(&lt;coll.&gt;, &lt;coll.&gt; [, ...])    <span class="comment"># Empties collections in order.</span></span><br><span class="line">&lt;<span class="built_in">iter</span>&gt; = chain.from_iterable(&lt;collection&gt;)  <span class="comment"># Empties collections inside a collection in order.</span></span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;<span class="built_in">iter</span>&gt; = islice(&lt;collection&gt;, to_exclusive)</span><br><span class="line">&lt;<span class="built_in">iter</span>&gt; = islice(&lt;collection&gt;, from_inclusive, to_exclusive)</span><br><span class="line">&lt;<span class="built_in">iter</span>&gt; = islice(&lt;collection&gt;, from_inclusive, to_exclusive, +step_size)</span><br></pre></td></tr></table></figure>


<h2 id="Generator"><a href="#Generator" class="headerlink" title="Generator"></a>Generator</h2><ul>
<li><strong>Convenient way to implement the iterator protocol.</strong></li>
<li><strong>Any function that contains a yield statement returns a generator object.</strong></li>
<li><strong>Generators and iterators are interchangeable.</strong></li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">count</span>(<span class="params">start, step</span>):</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        <span class="keyword">yield</span> start</span><br><span class="line">        start += step</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>counter = count(<span class="number">10</span>, <span class="number">2</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">next</span>(counter), <span class="built_in">next</span>(counter), <span class="built_in">next</span>(counter)</span><br><span class="line">(<span class="number">10</span>, <span class="number">12</span>, <span class="number">14</span>)</span><br></pre></td></tr></table></figure>


<h2 id="Type"><a href="#Type" class="headerlink" title="Type"></a>Type</h2><ul>
<li><strong>Everything is an object.</strong></li>
<li><strong>Every object has a type.</strong></li>
<li><strong>Type and class are synonymous.</strong></li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;<span class="built_in">type</span>&gt; = <span class="built_in">type</span>(&lt;el&gt;)                <span class="comment"># Or: &lt;el&gt;.__class__</span></span><br><span class="line">&lt;<span class="built_in">bool</span>&gt; = <span class="built_in">isinstance</span>(&lt;el&gt;, &lt;<span class="built_in">type</span>&gt;)  <span class="comment"># Or: issubclass(type(&lt;el&gt;), &lt;type&gt;)</span></span><br></pre></td></tr></table></figure>

<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">type</span>(<span class="string">&#x27;a&#x27;</span>), <span class="string">&#x27;a&#x27;</span>.__class__, <span class="built_in">str</span></span><br><span class="line">(&lt;class &#x27;str&#x27;&gt;, &lt;class &#x27;str&#x27;&gt;, &lt;class &#x27;str&#x27;&gt;)</span><br></pre></td></tr></table></figure>

<h4 id="Some-types-do-not-have-builtin-names-so-they-must-be-imported"><a href="#Some-types-do-not-have-builtin-names-so-they-must-be-imported" class="headerlink" title="Some types do not have builtin names, so they must be imported:"></a>Some types do not have builtin names, so they must be imported:</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> types <span class="keyword">import</span> FunctionType, MethodType, LambdaType, GeneratorType</span><br></pre></td></tr></table></figure>

<h3 id="ABC"><a href="#ABC" class="headerlink" title="ABC"></a>ABC</h3><p><strong>An abstract base class introduces virtual subclasses, that don’t inherit from it but are still recognized by isinstance() and issubclass().</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> collections.abc <span class="keyword">import</span> <span class="type">Sequence</span>, Collection, Iterable</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">isinstance</span>([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>], Iterable)</span><br><span class="line"><span class="literal">True</span></span><br></pre></td></tr></table></figure>

<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">+------------------+----------+------------+----------+</span><br><span class="line">|                  | Sequence | Collection | Iterable |</span><br><span class="line">+------------------+----------+------------+----------+</span><br><span class="line">| list, range, str |   yes    |    yes     |   yes    |</span><br><span class="line">| dict, set        |          |    yes     |   yes    |</span><br><span class="line">| iter             |          |            |   yes    |</span><br><span class="line">+------------------+----------+------------+----------+</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> numbers <span class="keyword">import</span> Integral, Rational, Real, Complex, Number</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">isinstance</span>(<span class="number">123</span>, Number)</span><br><span class="line"><span class="literal">True</span></span><br></pre></td></tr></table></figure>

<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">+--------------------+----------+----------+------+---------+--------+</span><br><span class="line">|                    | Integral | Rational | Real | Complex | Number |</span><br><span class="line">+--------------------+----------+----------+------+---------+--------+</span><br><span class="line">| int                |   yes    |   yes    | yes  |   yes   |  yes   |</span><br><span class="line">| fractions.Fraction |          |   yes    | yes  |   yes   |  yes   |</span><br><span class="line">| float              |          |          | yes  |   yes   |  yes   |</span><br><span class="line">| complex            |          |          |      |   yes   |  yes   |</span><br><span class="line">+--------------------+----------+----------+------+---------+--------+</span><br></pre></td></tr></table></figure>


<h2 id="String"><a href="#String" class="headerlink" title="String"></a>String</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;<span class="built_in">str</span>&gt;  = &lt;<span class="built_in">str</span>&gt;.strip()                       <span class="comment"># Strips all whitespace characters from both ends.</span></span><br><span class="line">&lt;<span class="built_in">str</span>&gt;  = &lt;<span class="built_in">str</span>&gt;.strip(<span class="string">&#x27;&lt;chars&gt;&#x27;</span>)              <span class="comment"># Strips all passed characters from both ends.</span></span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;<span class="built_in">list</span>&gt; = &lt;<span class="built_in">str</span>&gt;.split()                       <span class="comment"># Splits on one or more whitespace characters.</span></span><br><span class="line">&lt;<span class="built_in">list</span>&gt; = &lt;<span class="built_in">str</span>&gt;.split(sep=<span class="literal">None</span>, maxsplit=-<span class="number">1</span>)  <span class="comment"># Splits on &#x27;sep&#x27; str at most &#x27;maxsplit&#x27; times.</span></span><br><span class="line">&lt;<span class="built_in">list</span>&gt; = &lt;<span class="built_in">str</span>&gt;.splitlines(keepends=<span class="literal">False</span>)    <span class="comment"># Splits on line breaks. Keeps them if &#x27;keepends&#x27;.</span></span><br><span class="line">&lt;<span class="built_in">str</span>&gt;  = &lt;<span class="built_in">str</span>&gt;.join(&lt;coll_of_strings&gt;)       <span class="comment"># Joins elements using string as separator.</span></span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;<span class="built_in">bool</span>&gt; = &lt;sub_str&gt; <span class="keyword">in</span> &lt;<span class="built_in">str</span>&gt;                  <span class="comment"># Checks if string contains a substring.</span></span><br><span class="line">&lt;<span class="built_in">bool</span>&gt; = &lt;<span class="built_in">str</span>&gt;.startswith(&lt;sub_str&gt;)         <span class="comment"># Pass tuple of strings for multiple options.</span></span><br><span class="line">&lt;<span class="built_in">bool</span>&gt; = &lt;<span class="built_in">str</span>&gt;.endswith(&lt;sub_str&gt;)           <span class="comment"># Pass tuple of strings for multiple options.</span></span><br><span class="line">&lt;<span class="built_in">int</span>&gt;  = &lt;<span class="built_in">str</span>&gt;.find(&lt;sub_str&gt;)               <span class="comment"># Returns start index of first match or -1.</span></span><br><span class="line">&lt;<span class="built_in">int</span>&gt;  = &lt;<span class="built_in">str</span>&gt;.index(&lt;sub_str&gt;)              <span class="comment"># Same but raises ValueError.</span></span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;<span class="built_in">str</span>&gt;  = &lt;<span class="built_in">str</span>&gt;.replace(old, new [, count])   <span class="comment"># Replaces &#x27;old&#x27; with &#x27;new&#x27; at most &#x27;count&#x27; times.</span></span><br><span class="line">&lt;<span class="built_in">bool</span>&gt; = &lt;<span class="built_in">str</span>&gt;.isnumeric()                   <span class="comment"># True if str contains only numeric characters.</span></span><br><span class="line">&lt;<span class="built_in">list</span>&gt; = textwrap.wrap(&lt;<span class="built_in">str</span>&gt;, width)         <span class="comment"># Nicely breaks string into lines.</span></span><br></pre></td></tr></table></figure>

<ul>
<li><strong>Also: <code>&#39;lstrip()&#39;</code>, <code>&#39;rstrip()&#39;</code>.</strong></li>
<li><strong>Also: <code>&#39;lower()&#39;</code>, <code>&#39;upper()&#39;</code>, <code>&#39;capitalize()&#39;</code> and <code>&#39;title()&#39;</code>.</strong></li>
</ul>
<h3 id="Char"><a href="#Char" class="headerlink" title="Char"></a>Char</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;<span class="built_in">str</span>&gt; = <span class="built_in">chr</span>(&lt;<span class="built_in">int</span>&gt;)  <span class="comment"># Converts int to unicode char.</span></span><br><span class="line">&lt;<span class="built_in">int</span>&gt; = <span class="built_in">ord</span>(&lt;<span class="built_in">str</span>&gt;)  <span class="comment"># Converts unicode char to int.</span></span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">ord</span>(<span class="string">&#x27;0&#x27;</span>), <span class="built_in">ord</span>(<span class="string">&#x27;9&#x27;</span>)</span><br><span class="line">(<span class="number">48</span>, <span class="number">57</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">ord</span>(<span class="string">&#x27;A&#x27;</span>), <span class="built_in">ord</span>(<span class="string">&#x27;Z&#x27;</span>)</span><br><span class="line">(<span class="number">65</span>, <span class="number">90</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">ord</span>(<span class="string">&#x27;a&#x27;</span>), <span class="built_in">ord</span>(<span class="string">&#x27;z&#x27;</span>)</span><br><span class="line">(<span class="number">97</span>, <span class="number">122</span>)</span><br></pre></td></tr></table></figure>


<h2 id="Regex"><a href="#Regex" class="headerlink" title="Regex"></a>Regex</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> re</span><br><span class="line">&lt;<span class="built_in">str</span>&gt;   = re.sub(&lt;regex&gt;, new, text, count=<span class="number">0</span>)  <span class="comment"># Substitutes all occurrences.</span></span><br><span class="line">&lt;<span class="built_in">list</span>&gt;  = re.findall(&lt;regex&gt;, text)            <span class="comment"># Returns all occurrences.</span></span><br><span class="line">&lt;<span class="built_in">list</span>&gt;  = re.split(&lt;regex&gt;, text, maxsplit=<span class="number">0</span>)  <span class="comment"># Use brackets in regex to keep the matches.</span></span><br><span class="line">&lt;Match&gt; = re.search(&lt;regex&gt;, text)             <span class="comment"># Searches for first occurrence of pattern.</span></span><br><span class="line">&lt;Match&gt; = re.match(&lt;regex&gt;, text)              <span class="comment"># Searches only at the beginning of the text.</span></span><br><span class="line">&lt;<span class="built_in">iter</span>&gt;  = re.finditer(&lt;regex&gt;, text)           <span class="comment"># Returns all occurrences as match objects.</span></span><br></pre></td></tr></table></figure>

<ul>
<li><strong>Argument <code>&#39;flags=re.IGNORECASE&#39;</code> can be used with all functions.</strong></li>
<li><strong>Argument <code>&#39;flags=re.MULTILINE&#39;</code> makes <code>&#39;^&#39;</code> and <code>&#39;$&#39;</code> match the start/end of each line.</strong></li>
<li><strong>Argument <code>&#39;flags=re.DOTALL&#39;</code> makes dot also accept newline.</strong></li>
<li><strong>Use <code>r&#39;\1&#39;</code> or <code>&#39;\\1&#39;</code> for backreference.</strong></li>
<li><strong>Use <code>&#39;?&#39;</code> to make an operator non-greedy.</strong></li>
</ul>
<h3 id="Match-Object"><a href="#Match-Object" class="headerlink" title="Match Object"></a>Match Object</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;<span class="built_in">str</span>&gt;   = &lt;Match&gt;.group()   <span class="comment"># Whole match. Also group(0).</span></span><br><span class="line">&lt;<span class="built_in">str</span>&gt;   = &lt;Match&gt;.group(<span class="number">1</span>)  <span class="comment"># Part in first bracket.</span></span><br><span class="line">&lt;<span class="built_in">tuple</span>&gt; = &lt;Match&gt;.groups()  <span class="comment"># All bracketed parts.</span></span><br><span class="line">&lt;<span class="built_in">int</span>&gt;   = &lt;Match&gt;.start()   <span class="comment"># Start index of a match.</span></span><br><span class="line">&lt;<span class="built_in">int</span>&gt;   = &lt;Match&gt;.end()     <span class="comment"># Exclusive end index of a match.</span></span><br></pre></td></tr></table></figure>

<h3 id="Special-Sequences"><a href="#Special-Sequences" class="headerlink" title="Special Sequences"></a>Special Sequences</h3><ul>
<li><strong>By default digits, whitespaces and alphanumerics from all alphabets are matched, unless <code>&#39;flags=re.ASCII&#39;</code> argument is used.</strong></li>
<li><strong>Use capital letters for negation.</strong><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27;\d&#x27;</span> == <span class="string">&#x27;[0-9]&#x27;</span>             <span class="comment"># Digit</span></span><br><span class="line"><span class="string">&#x27;\s&#x27;</span> == <span class="string">&#x27;[ \t\n\r\f\v]&#x27;</span>     <span class="comment"># Whitespace</span></span><br><span class="line"><span class="string">&#x27;\w&#x27;</span> == <span class="string">&#x27;[a-zA-Z0-9_]&#x27;</span>      <span class="comment"># Alphanumeric</span></span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="Format"><a href="#Format" class="headerlink" title="Format"></a>Format</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;<span class="built_in">str</span>&gt; = <span class="string">f&#x27;<span class="subst">&#123;&lt;el_1&gt;&#125;</span>, <span class="subst">&#123;&lt;el_2&gt;&#125;</span>&#x27;</span></span><br><span class="line">&lt;<span class="built_in">str</span>&gt; = <span class="string">&#x27;&#123;&#125;, &#123;&#125;&#x27;</span>.<span class="built_in">format</span>(&lt;el_1&gt;, &lt;el_2&gt;)</span><br></pre></td></tr></table></figure>

<h3 id="Attributes"><a href="#Attributes" class="headerlink" title="Attributes"></a>Attributes</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> collections <span class="keyword">import</span> namedtuple</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>Person = namedtuple(<span class="string">&#x27;Person&#x27;</span>, <span class="string">&#x27;name height&#x27;</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>person = Person(<span class="string">&#x27;Jean-Luc&#x27;</span>, <span class="number">187</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="string">f&#x27;<span class="subst">&#123;person.height&#125;</span>&#x27;</span></span><br><span class="line"><span class="string">&#x27;187&#x27;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="string">&#x27;&#123;p.height&#125;&#x27;</span>.<span class="built_in">format</span>(p=person)</span><br><span class="line"><span class="string">&#x27;187&#x27;</span></span><br></pre></td></tr></table></figure>

<h3 id="General-Options"><a href="#General-Options" class="headerlink" title="General Options"></a>General Options</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;&lt;el&gt;:&lt;<span class="number">10</span>&#125;       <span class="comment"># &#x27;&lt;el&gt;      &#x27;</span></span><br><span class="line">&#123;&lt;el&gt;:^<span class="number">10</span>&#125;       <span class="comment"># &#x27;   &lt;el&gt;   &#x27;</span></span><br><span class="line">&#123;&lt;el&gt;:&gt;<span class="number">10</span>&#125;       <span class="comment"># &#x27;      &lt;el&gt;&#x27;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#123;&lt;el&gt;:.&lt;<span class="number">10</span>&#125;      <span class="comment"># &#x27;&lt;el&gt;......&#x27;</span></span><br><span class="line">&#123;&lt;el&gt;:&gt;<span class="number">0</span>&#125;        <span class="comment"># &#x27;&lt;el&gt;&#x27;</span></span><br></pre></td></tr></table></figure>

<h3 id="Strings"><a href="#Strings" class="headerlink" title="Strings"></a>Strings</h3><p><strong><code>&#39;!r&#39;</code> calls object’s repr() method, instead of str(), to get a string.</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="string">&#x27;abcde&#x27;</span>!r:&lt;<span class="number">10</span>&#125;  <span class="comment"># &quot;&#x27;abcde&#x27;   &quot;</span></span><br><span class="line">&#123;<span class="string">&#x27;abcde&#x27;</span>:<span class="number">.3</span>&#125;     <span class="comment"># &#x27;abc&#x27;</span></span><br><span class="line">&#123;<span class="string">&#x27;abcde&#x27;</span>:<span class="number">10.3</span>&#125;   <span class="comment"># &#x27;abc       &#x27;</span></span><br></pre></td></tr></table></figure>

<h3 id="Numbers"><a href="#Numbers" class="headerlink" title="Numbers"></a>Numbers</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#123; <span class="number">123456</span>:<span class="number">10</span>,&#125;    <span class="comment"># &#x27;   123,456&#x27;</span></span><br><span class="line">&#123; <span class="number">123456</span>:10_&#125;    <span class="comment"># &#x27;   123_456&#x27;</span></span><br><span class="line">&#123; <span class="number">123456</span>:+<span class="number">10</span>&#125;    <span class="comment"># &#x27;   +123456&#x27;</span></span><br><span class="line">&#123;-<span class="number">123456</span>:=<span class="number">10</span>&#125;    <span class="comment"># &#x27;-   123456&#x27;</span></span><br><span class="line">&#123; <span class="number">123456</span>: &#125;      <span class="comment"># &#x27; 123456&#x27;</span></span><br><span class="line">&#123;-<span class="number">123456</span>: &#125;      <span class="comment"># &#x27;-123456&#x27;</span></span><br></pre></td></tr></table></figure>

<h3 id="Floats"><a href="#Floats" class="headerlink" title="Floats"></a>Floats</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="number">1.23456</span>:<span class="number">10.3</span>&#125;   <span class="comment"># &#x27;      1.23&#x27;</span></span><br><span class="line">&#123;<span class="number">1.23456</span>:<span class="number">10.3</span>f&#125;  <span class="comment"># &#x27;     1.235&#x27;</span></span><br><span class="line">&#123;<span class="number">1.23456</span>:<span class="number">10.3</span>e&#125;  <span class="comment"># &#x27; 1.235e+00&#x27;</span></span><br><span class="line">&#123;<span class="number">1.23456</span>:<span class="number">10.3</span>%&#125;  <span class="comment"># &#x27;  123.456%&#x27;</span></span><br></pre></td></tr></table></figure>

<h4 id="Comparison-of-float-presentation-types"><a href="#Comparison-of-float-presentation-types" class="headerlink" title="Comparison of float presentation types:"></a>Comparison of float presentation types:</h4><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">+----------------+----------------+---------------+----------------+-----------------+</span><br><span class="line">|                |    &#123;&lt;float&gt;&#125;   |  &#123;&lt;float&gt;:f&#125;  |   &#123;&lt;float&gt;:e&#125;  |   &#123;&lt;float&gt;:%&#125;   |</span><br><span class="line">+----------------+----------------+---------------+----------------+-----------------+</span><br><span class="line">|    0.000056789 |   &#x27;5.6789e-05&#x27; |    &#x27;0.000057&#x27; | &#x27;5.678900e-05&#x27; |     &#x27;0.005679%&#x27; |</span><br><span class="line">|    0.00056789  |   &#x27;0.00056789&#x27; |    &#x27;0.000568&#x27; | &#x27;5.678900e-04&#x27; |     &#x27;0.056789%&#x27; |</span><br><span class="line">|    0.0056789   |   &#x27;0.0056789&#x27;  |    &#x27;0.005679&#x27; | &#x27;5.678900e-03&#x27; |     &#x27;0.567890%&#x27; |</span><br><span class="line">|    0.056789    |   &#x27;0.056789&#x27;   |    &#x27;0.056789&#x27; | &#x27;5.678900e-02&#x27; |     &#x27;5.678900%&#x27; |</span><br><span class="line">|    0.56789     |   &#x27;0.56789&#x27;    |    &#x27;0.567890&#x27; | &#x27;5.678900e-01&#x27; |    &#x27;56.789000%&#x27; |</span><br><span class="line">|    5.6789      |   &#x27;5.6789&#x27;     |    &#x27;5.678900&#x27; | &#x27;5.678900e+00&#x27; |   &#x27;567.890000%&#x27; |</span><br><span class="line">|   56.789       |  &#x27;56.789&#x27;      |   &#x27;56.789000&#x27; | &#x27;5.678900e+01&#x27; |  &#x27;5678.900000%&#x27; |</span><br><span class="line">|  567.89        | &#x27;567.89&#x27;       |  &#x27;567.890000&#x27; | &#x27;5.678900e+02&#x27; | &#x27;56789.000000%&#x27; |</span><br><span class="line">+----------------+----------------+---------------+----------------+-----------------+</span><br></pre></td></tr></table></figure>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">+----------------+----------------+---------------+----------------+-----------------+</span><br><span class="line">|                |  &#123;&lt;float&gt;:.2&#125;  | &#123;&lt;float&gt;:.2f&#125; |  &#123;&lt;float&gt;:.2e&#125; |  &#123;&lt;float&gt;:.2%&#125;  |</span><br><span class="line">+----------------+----------------+---------------+----------------+-----------------+</span><br><span class="line">|    0.000056789 |   &#x27;5.7e-05&#x27;    |      &#x27;0.00&#x27;   |   &#x27;5.68e-05&#x27;   |       &#x27;0.01%&#x27;   |</span><br><span class="line">|    0.00056789  |   &#x27;0.00057&#x27;    |      &#x27;0.00&#x27;   |   &#x27;5.68e-04&#x27;   |       &#x27;0.06%&#x27;   |</span><br><span class="line">|    0.0056789   |   &#x27;0.0057&#x27;     |      &#x27;0.01&#x27;   |   &#x27;5.68e-03&#x27;   |       &#x27;0.57%&#x27;   |</span><br><span class="line">|    0.056789    |   &#x27;0.057&#x27;      |      &#x27;0.06&#x27;   |   &#x27;5.68e-02&#x27;   |       &#x27;5.68%&#x27;   |</span><br><span class="line">|    0.56789     |   &#x27;0.57&#x27;       |      &#x27;0.57&#x27;   |   &#x27;5.68e-01&#x27;   |      &#x27;56.79%&#x27;   |</span><br><span class="line">|    5.6789      |   &#x27;5.7&#x27;        |      &#x27;5.68&#x27;   |   &#x27;5.68e+00&#x27;   |     &#x27;567.89%&#x27;   |</span><br><span class="line">|   56.789       |   &#x27;5.7e+01&#x27;    |     &#x27;56.79&#x27;   |   &#x27;5.68e+01&#x27;   |    &#x27;5678.90%&#x27;   |</span><br><span class="line">|  567.89        |   &#x27;5.7e+02&#x27;    |    &#x27;567.89&#x27;   |   &#x27;5.68e+02&#x27;   |   &#x27;56789.00%&#x27;   |</span><br><span class="line">+----------------+----------------+---------------+----------------+-----------------+</span><br></pre></td></tr></table></figure>

<h3 id="Ints"><a href="#Ints" class="headerlink" title="Ints"></a>Ints</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="number">90</span>:c&#125;           <span class="comment"># &#x27;Z&#x27;</span></span><br><span class="line">&#123;<span class="number">90</span>:X&#125;           <span class="comment"># &#x27;5A&#x27;</span></span><br><span class="line">&#123;<span class="number">90</span>:b&#125;           <span class="comment"># &#x27;1011010&#x27;</span></span><br></pre></td></tr></table></figure>


<h2 id="Numbers-1"><a href="#Numbers-1" class="headerlink" title="Numbers"></a>Numbers</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;<span class="built_in">int</span>&gt;      = <span class="built_in">int</span>(&lt;<span class="built_in">float</span>/<span class="built_in">str</span>/<span class="built_in">bool</span>&gt;)    <span class="comment"># Or: math.floor(&lt;float&gt;)</span></span><br><span class="line">&lt;<span class="built_in">float</span>&gt;    = <span class="built_in">float</span>(&lt;<span class="built_in">int</span>/<span class="built_in">str</span>/<span class="built_in">bool</span>&gt;)</span><br><span class="line">&lt;<span class="built_in">complex</span>&gt;  = <span class="built_in">complex</span>(real=<span class="number">0</span>, imag=<span class="number">0</span>)  <span class="comment"># Or: &lt;real&gt; + &lt;real&gt;j</span></span><br><span class="line">&lt;Fraction&gt; = fractions.Fraction(numerator=<span class="number">0</span>, denominator=<span class="number">1</span>)</span><br></pre></td></tr></table></figure>
<ul>
<li><strong><code>&#39;int(&lt;str&gt;)&#39;</code> and <code>&#39;float(&lt;str&gt;)&#39;</code> raise ‘ValueError’ on malformed strings.</strong></li>
</ul>
<h3 id="Basic-Functions"><a href="#Basic-Functions" class="headerlink" title="Basic Functions"></a>Basic Functions</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;num&gt;  = <span class="built_in">pow</span>(&lt;num&gt;, &lt;num&gt;)            <span class="comment"># Or: &lt;num&gt; ** &lt;num&gt;</span></span><br><span class="line">&lt;real&gt; = <span class="built_in">abs</span>(&lt;num&gt;)</span><br><span class="line">&lt;<span class="built_in">int</span>&gt;  = <span class="built_in">round</span>(&lt;real&gt;)</span><br><span class="line">&lt;real&gt; = <span class="built_in">round</span>(&lt;real&gt;, ±ndigits)      <span class="comment"># `round(126, -1) == 130`</span></span><br></pre></td></tr></table></figure>

<h3 id="Math"><a href="#Math" class="headerlink" title="Math"></a>Math</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> math <span class="keyword">import</span> e, pi, inf, nan</span><br><span class="line"><span class="keyword">from</span> math <span class="keyword">import</span> cos, acos, sin, asin, tan, atan, degrees, radians</span><br><span class="line"><span class="keyword">from</span> math <span class="keyword">import</span> log, log10, log2</span><br></pre></td></tr></table></figure>

<h3 id="Statistics"><a href="#Statistics" class="headerlink" title="Statistics"></a>Statistics</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> statistics <span class="keyword">import</span> mean, median, variance, pvariance, pstdev</span><br></pre></td></tr></table></figure>

<h3 id="Random"><a href="#Random" class="headerlink" title="Random"></a>Random</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> random <span class="keyword">import</span> random, randint, choice, shuffle</span><br><span class="line">&lt;<span class="built_in">float</span>&gt; = random()</span><br><span class="line">&lt;<span class="built_in">int</span>&gt;   = randint(from_inclusive, to_inclusive)</span><br><span class="line">&lt;el&gt;    = choice(&lt;<span class="built_in">list</span>&gt;)</span><br><span class="line">shuffle(&lt;<span class="built_in">list</span>&gt;)</span><br></pre></td></tr></table></figure>

<h3 id="Bin-Hex"><a href="#Bin-Hex" class="headerlink" title="Bin, Hex"></a>Bin, Hex</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;<span class="built_in">int</span>&gt;     = 0b&lt;<span class="built_in">bin</span>&gt;            <span class="comment"># Or: 0x&lt;hex&gt;</span></span><br><span class="line">&lt;<span class="built_in">int</span>&gt;     = <span class="built_in">int</span>(<span class="string">&#x27;0b&lt;bin&gt;&#x27;</span>, <span class="number">0</span>)  <span class="comment"># Or: int(&#x27;0x&lt;hex&gt;&#x27;, 0)</span></span><br><span class="line">&lt;<span class="built_in">int</span>&gt;     = <span class="built_in">int</span>(<span class="string">&#x27;&lt;bin&gt;&#x27;</span>, <span class="number">2</span>)    <span class="comment"># Or: int(&#x27;&lt;hex&gt;&#x27;, 16)</span></span><br><span class="line"><span class="string">&#x27;0b&lt;bin&gt;&#x27;</span> = <span class="built_in">bin</span>(&lt;<span class="built_in">int</span>&gt;)         <span class="comment"># Or: &#x27;0x&lt;hex&gt;&#x27; = hex(&lt;int&gt;)</span></span><br></pre></td></tr></table></figure>

<h3 id="Bitwise-Operators"><a href="#Bitwise-Operators" class="headerlink" title="Bitwise Operators"></a>Bitwise Operators</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;<span class="built_in">int</span>&gt;     = &lt;<span class="built_in">int</span>&gt; &amp; &lt;<span class="built_in">int</span>&gt;      <span class="comment"># And</span></span><br><span class="line">&lt;<span class="built_in">int</span>&gt;     = &lt;<span class="built_in">int</span>&gt; | &lt;<span class="built_in">int</span>&gt;      <span class="comment"># Or</span></span><br><span class="line">&lt;<span class="built_in">int</span>&gt;     = &lt;<span class="built_in">int</span>&gt; ^ &lt;<span class="built_in">int</span>&gt;      <span class="comment"># Xor (0 if both bits equal)</span></span><br><span class="line">&lt;<span class="built_in">int</span>&gt;     = &lt;<span class="built_in">int</span>&gt; &lt;&lt; n_bits    <span class="comment"># Shift left</span></span><br><span class="line">&lt;<span class="built_in">int</span>&gt;     = &lt;<span class="built_in">int</span>&gt; &gt;&gt; n_bits    <span class="comment"># Shift right</span></span><br><span class="line">&lt;<span class="built_in">int</span>&gt;     = ~&lt;<span class="built_in">int</span>&gt;             <span class="comment"># Compliment (flips bits)</span></span><br></pre></td></tr></table></figure>


<h2 id="Combinatorics"><a href="#Combinatorics" class="headerlink" title="Combinatorics"></a>Combinatorics</h2><ul>
<li><strong>Every function returns an iterator.</strong></li>
<li><strong>If you want to print the iterator, you need to pass it to the list() function!</strong></li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> itertools <span class="keyword">import</span> product, combinations, combinations_with_replacement, permutations</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>product([<span class="number">0</span>, <span class="number">1</span>], repeat=<span class="number">3</span>)</span><br><span class="line">[(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>), (<span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>), (<span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>), (<span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>),</span><br><span class="line"> (<span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>), (<span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>), (<span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>), (<span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>)]</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>product(<span class="string">&#x27;ab&#x27;</span>, <span class="string">&#x27;12&#x27;</span>)</span><br><span class="line">[(<span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;1&#x27;</span>), (<span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;2&#x27;</span>),</span><br><span class="line"> (<span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;1&#x27;</span>), (<span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;2&#x27;</span>)]</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>combinations(<span class="string">&#x27;abc&#x27;</span>, <span class="number">2</span>)</span><br><span class="line">[(<span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;b&#x27;</span>), (<span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;c&#x27;</span>), (<span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;c&#x27;</span>)]</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>combinations_with_replacement(<span class="string">&#x27;abc&#x27;</span>, <span class="number">2</span>)</span><br><span class="line">[(<span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;a&#x27;</span>), (<span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;b&#x27;</span>), (<span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;c&#x27;</span>),</span><br><span class="line"> (<span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;b&#x27;</span>), (<span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;c&#x27;</span>),</span><br><span class="line"> (<span class="string">&#x27;c&#x27;</span>, <span class="string">&#x27;c&#x27;</span>)]</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>permutations(<span class="string">&#x27;abc&#x27;</span>, <span class="number">2</span>)</span><br><span class="line">[(<span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;b&#x27;</span>), (<span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;c&#x27;</span>),</span><br><span class="line"> (<span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;a&#x27;</span>), (<span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;c&#x27;</span>),</span><br><span class="line"> (<span class="string">&#x27;c&#x27;</span>, <span class="string">&#x27;a&#x27;</span>), (<span class="string">&#x27;c&#x27;</span>, <span class="string">&#x27;b&#x27;</span>)]</span><br></pre></td></tr></table></figure>


<h2 id="Datetime"><a href="#Datetime" class="headerlink" title="Datetime"></a>Datetime</h2><ul>
<li><strong>Module ‘datetime’ provides ‘date’ <code>&lt;D&gt;</code>, ‘time’ <code>&lt;T&gt;</code>, ‘datetime’ <code>&lt;DT&gt;</code> and ‘timedelta’ <code>&lt;TD&gt;</code> classes. All are immutable and hashable.</strong></li>
<li><strong>Time and datetime can be ‘aware’ <code>&lt;a&gt;</code>, meaning they have defined timezone, or ‘naive’ <code>&lt;n&gt;</code>, meaning they don’t.</strong></li>
<li><strong>If object is naive it is presumed to be in system’s timezone.</strong></li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> datetime <span class="keyword">import</span> date, time, datetime, timedelta</span><br><span class="line"><span class="keyword">from</span> dateutil.tz <span class="keyword">import</span> UTC, tzlocal, gettz</span><br></pre></td></tr></table></figure>

<h3 id="Constructors"><a href="#Constructors" class="headerlink" title="Constructors"></a>Constructors</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;D&gt;  = date(year, month, day)</span><br><span class="line">&lt;T&gt;  = time(hour=<span class="number">0</span>, minute=<span class="number">0</span>, second=<span class="number">0</span>, microsecond=<span class="number">0</span>, tzinfo=<span class="literal">None</span>, fold=<span class="number">0</span>)</span><br><span class="line">&lt;DT&gt; = datetime(year, month, day, hour=<span class="number">0</span>, minute=<span class="number">0</span>, second=<span class="number">0</span>, ...)</span><br><span class="line">&lt;TD&gt; = timedelta(days=<span class="number">0</span>, seconds=<span class="number">0</span>, microseconds=<span class="number">0</span>, milliseconds=<span class="number">0</span>,</span><br><span class="line">                 minutes=<span class="number">0</span>, hours=<span class="number">0</span>, weeks=<span class="number">0</span>)</span><br></pre></td></tr></table></figure>
<ul>
<li><strong>Use <code>&#39;&lt;D/DT&gt;.weekday()&#39;</code> to get the day of the week (Mon == 0).</strong></li>
<li><strong><code>&#39;fold=1&#39;</code> means second pass in case of time jumping back for one hour.</strong></li>
</ul>
<h3 id="Now"><a href="#Now" class="headerlink" title="Now"></a>Now</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;D/DTn&gt;  = D/DT.today()                     <span class="comment"># Current local date or naive datetime.</span></span><br><span class="line">&lt;DTn&gt;    = DT.utcnow()                      <span class="comment"># Naive datetime from current UTC time.</span></span><br><span class="line">&lt;DTa&gt;    = DT.now(&lt;tzinfo&gt;)                 <span class="comment"># Aware datetime from current tz time.</span></span><br></pre></td></tr></table></figure>
<ul>
<li><strong>To extract time use <code>&#39;&lt;DTn&gt;.time()&#39;</code>, <code>&#39;&lt;DTa&gt;.time()&#39;</code> or <code>&#39;&lt;DTa&gt;.timetz()&#39;</code>.</strong></li>
</ul>
<h3 id="Timezone"><a href="#Timezone" class="headerlink" title="Timezone"></a>Timezone</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;tzinfo&gt; = UTC                              <span class="comment"># UTC timezone. London without DST.</span></span><br><span class="line">&lt;tzinfo&gt; = tzlocal()                        <span class="comment"># Local timezone. Also gettz().</span></span><br><span class="line">&lt;tzinfo&gt; = gettz(<span class="string">&#x27;&lt;Cont.&gt;/&lt;City&gt;&#x27;</span>)          <span class="comment"># Timezone from &#x27;Continent/City_Name&#x27; str.</span></span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;DTa&gt;    = &lt;DT&gt;.astimezone(&lt;tzinfo&gt;)        <span class="comment"># Datetime, converted to passed timezone.</span></span><br><span class="line">&lt;Ta/DTa&gt; = &lt;T/DT&gt;.replace(tzinfo=&lt;tzinfo&gt;)  <span class="comment"># Unconverted object with new timezone.</span></span><br></pre></td></tr></table></figure>

<h3 id="Encode"><a href="#Encode" class="headerlink" title="Encode"></a>Encode</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;D/T/DT&gt; = D/T/DT.fromisoformat(<span class="string">&#x27;&lt;iso&gt;&#x27;</span>)    <span class="comment"># Object from ISO string.</span></span><br><span class="line">&lt;DT&gt;     = DT.strptime(&lt;<span class="built_in">str</span>&gt;, <span class="string">&#x27;&lt;format&gt;&#x27;</span>)   <span class="comment"># Datetime from str, according to format.</span></span><br><span class="line">&lt;D/DTn&gt;  = D/DT.fromordinal(&lt;<span class="built_in">int</span>&gt;)          <span class="comment"># D/DTn from days since Christ, at midnight.</span></span><br><span class="line">&lt;DTn&gt;    = DT.fromtimestamp(&lt;real&gt;)         <span class="comment"># Local time DTn from seconds since Epoch.</span></span><br><span class="line">&lt;DTa&gt;    = DT.fromtimestamp(&lt;real&gt;, &lt;tz.&gt;)  <span class="comment"># Aware datetime from seconds since Epoch.</span></span><br></pre></td></tr></table></figure>
<ul>
<li><strong>ISO strings come in following forms: <code>&#39;YYYY-MM-DD&#39;</code>, <code>&#39;HH:MM:SS.ffffff[±&lt;offset&gt;]&#39;</code>, or both separated by <code>&#39;T&#39;</code>. Offset is formatted as: <code>&#39;HH:MM&#39;</code>.</strong></li>
<li><strong>On Unix systems Epoch is <code>&#39;1970-01-01 00:00 UTC&#39;</code>, <code>&#39;1970-01-01 01:00 CET&#39;</code>, …</strong></li>
</ul>
<h3 id="Decode"><a href="#Decode" class="headerlink" title="Decode"></a>Decode</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;<span class="built_in">str</span>&gt;    = &lt;D/T/DT&gt;.isoformat()             <span class="comment"># ISO string representation.</span></span><br><span class="line">&lt;<span class="built_in">str</span>&gt;    = &lt;D/T/DT&gt;.strftime(<span class="string">&#x27;&lt;format&gt;&#x27;</span>)    <span class="comment"># Custom string representation.</span></span><br><span class="line">&lt;<span class="built_in">int</span>&gt;    = &lt;D/DT&gt;.toordinal()               <span class="comment"># Days since Christ, ignoring time and tz.</span></span><br><span class="line">&lt;<span class="built_in">float</span>&gt;  = &lt;DTn&gt;.timestamp()                <span class="comment"># Seconds since Epoch from DTn in local time.</span></span><br><span class="line">&lt;<span class="built_in">float</span>&gt;  = &lt;DTa&gt;.timestamp()                <span class="comment"># Seconds since Epoch from DTa.</span></span><br></pre></td></tr></table></figure>

<h3 id="Format-1"><a href="#Format-1" class="headerlink" title="Format"></a>Format</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> datetime <span class="keyword">import</span> datetime</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>dt = datetime.strptime(<span class="string">&#x27;2015-05-14 23:39:00.00 +0200&#x27;</span>, <span class="string">&#x27;%Y-%m-%d %H:%M:%S.%f %z&#x27;</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>dt.strftime(<span class="string">&quot;%A, %dth of %B &#x27;%y, %I:%M%p %Z&quot;</span>)</span><br><span class="line"><span class="string">&quot;Thursday, 14th of May &#x27;15, 11:39PM UTC+02:00&quot;</span></span><br></pre></td></tr></table></figure>
<ul>
<li><strong>For abbreviated weekday and month use <code>&#39;%a&#39;</code> and <code>&#39;%b&#39;</code>.</strong></li>
<li><strong>When parsing, <code>&#39;%z&#39;</code> also accepts <code>&#39;±HH:MM&#39;</code>.</strong></li>
</ul>
<h3 id="Arithmetics"><a href="#Arithmetics" class="headerlink" title="Arithmetics"></a>Arithmetics</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;D/DT&gt;   = &lt;D/DT&gt; ±  &lt;TD&gt;</span><br><span class="line">&lt;TD&gt;     = &lt;TD&gt;   ±  &lt;TD&gt;</span><br><span class="line">&lt;TD&gt;     = &lt;TD&gt;   */ &lt;real&gt;</span><br><span class="line">&lt;<span class="built_in">float</span>&gt;  = &lt;TD&gt;   /  &lt;TD&gt;</span><br></pre></td></tr></table></figure>


<h2 id="Arguments"><a href="#Arguments" class="headerlink" title="Arguments"></a>Arguments</h2><h3 id="Inside-Function-Call"><a href="#Inside-Function-Call" class="headerlink" title="Inside Function Call"></a>Inside Function Call</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;function&gt;(&lt;positional_args&gt;)                  <span class="comment"># f(0, 0)</span></span><br><span class="line">&lt;function&gt;(&lt;keyword_args&gt;)                     <span class="comment"># f(x=0, y=0)</span></span><br><span class="line">&lt;function&gt;(&lt;positional_args&gt;, &lt;keyword_args&gt;)  <span class="comment"># f(0, y=0)</span></span><br></pre></td></tr></table></figure>

<h3 id="Inside-Function-Definition"><a href="#Inside-Function-Definition" class="headerlink" title="Inside Function Definition"></a>Inside Function Definition</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">f</span>(<span class="params">&lt;nondefault_args&gt;</span>):</span>                      <span class="comment"># def f(x, y):</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">f</span>(<span class="params">&lt;default_args&gt;</span>):</span>                         <span class="comment"># def f(x=0, y=0):</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">f</span>(<span class="params">&lt;nondefault_args&gt;, &lt;default_args&gt;</span>):</span>      <span class="comment"># def f(x, y=0):</span></span><br></pre></td></tr></table></figure>


<h2 id="Splat-Operator"><a href="#Splat-Operator" class="headerlink" title="Splat Operator"></a>Splat Operator</h2><h3 id="Inside-Function-Call-1"><a href="#Inside-Function-Call-1" class="headerlink" title="Inside Function Call"></a>Inside Function Call</h3><p><strong>Splat expands a collection into positional arguments, while splatty-splat expands a dictionary into keyword arguments.</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">args   = (<span class="number">1</span>, <span class="number">2</span>)</span><br><span class="line">kwargs = &#123;<span class="string">&#x27;x&#x27;</span>: <span class="number">3</span>, <span class="string">&#x27;y&#x27;</span>: <span class="number">4</span>, <span class="string">&#x27;z&#x27;</span>: <span class="number">5</span>&#125;</span><br><span class="line">func(*args, **kwargs)</span><br></pre></td></tr></table></figure>

<h4 id="Is-the-same-as"><a href="#Is-the-same-as" class="headerlink" title="Is the same as:"></a>Is the same as:</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">func(<span class="number">1</span>, <span class="number">2</span>, x=<span class="number">3</span>, y=<span class="number">4</span>, z=<span class="number">5</span>)</span><br></pre></td></tr></table></figure>

<h3 id="Inside-Function-Definition-1"><a href="#Inside-Function-Definition-1" class="headerlink" title="Inside Function Definition"></a>Inside Function Definition</h3><p><strong>Splat combines zero or more positional arguments into a tuple, while splatty-splat combines zero or more keyword arguments into a dictionary.</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add</span>(<span class="params">*a</span>):</span></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">sum</span>(a)</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>add(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>)</span><br><span class="line"><span class="number">6</span></span><br></pre></td></tr></table></figure>

<h4 id="Legal-argument-combinations"><a href="#Legal-argument-combinations" class="headerlink" title="Legal argument combinations:"></a>Legal argument combinations:</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">f</span>(<span class="params">x, y, z</span>):</span>                <span class="comment"># f(x=1, y=2, z=3) | f(1, y=2, z=3) | f(1, 2, z=3) | f(1, 2, 3)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">f</span>(<span class="params">*, x, y, z</span>):</span>             <span class="comment"># f(x=1, y=2, z=3)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">f</span>(<span class="params">x, *, y, z</span>):</span>             <span class="comment"># f(x=1, y=2, z=3) | f(1, y=2, z=3)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">f</span>(<span class="params">x, y, *, z</span>):</span>             <span class="comment"># f(x=1, y=2, z=3) | f(1, y=2, z=3) | f(1, 2, z=3)</span></span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">f</span>(<span class="params">*args</span>):</span>                  <span class="comment"># f(1, 2, 3)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">f</span>(<span class="params">x, *args</span>):</span>               <span class="comment"># f(1, 2, 3)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">f</span>(<span class="params">*args, z</span>):</span>               <span class="comment"># f(1, 2, z=3)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">f</span>(<span class="params">x, *args, z</span>):</span>            <span class="comment"># f(1, 2, z=3)</span></span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">f</span>(<span class="params">**kwargs</span>):</span>               <span class="comment"># f(x=1, y=2, z=3)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">f</span>(<span class="params">x, **kwargs</span>):</span>            <span class="comment"># f(x=1, y=2, z=3) | f(1, y=2, z=3)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">f</span>(<span class="params">*, x, **kwargs</span>):</span>         <span class="comment"># f(x=1, y=2, z=3)</span></span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">f</span>(<span class="params">*args, **kwargs</span>):</span>        <span class="comment"># f(x=1, y=2, z=3) | f(1, y=2, z=3) | f(1, 2, z=3) | f(1, 2, 3)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">f</span>(<span class="params">x, *args, **kwargs</span>):</span>     <span class="comment"># f(x=1, y=2, z=3) | f(1, y=2, z=3) | f(1, 2, z=3) | f(1, 2, 3)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">f</span>(<span class="params">*args, y, **kwargs</span>):</span>     <span class="comment"># f(x=1, y=2, z=3) | f(1, y=2, z=3)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">f</span>(<span class="params">x, *args, z, **kwargs</span>):</span>  <span class="comment"># f(x=1, y=2, z=3) | f(1, y=2, z=3) | f(1, 2, z=3)</span></span><br></pre></td></tr></table></figure>

<h3 id="Other-Uses"><a href="#Other-Uses" class="headerlink" title="Other Uses"></a>Other Uses</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;<span class="built_in">list</span>&gt;  = [*&lt;collection&gt; [, ...]]</span><br><span class="line">&lt;<span class="built_in">set</span>&gt;   = &#123;*&lt;collection&gt; [, ...]&#125;</span><br><span class="line">&lt;<span class="built_in">tuple</span>&gt; = (*&lt;collection&gt;, [...])</span><br><span class="line">&lt;<span class="built_in">dict</span>&gt;  = &#123;**&lt;<span class="built_in">dict</span>&gt; [, ...]&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">head, *body, tail = &lt;collection&gt;</span><br></pre></td></tr></table></figure>


<h2 id="Inline"><a href="#Inline" class="headerlink" title="Inline"></a>Inline</h2><h3 id="Lambda"><a href="#Lambda" class="headerlink" title="Lambda"></a>Lambda</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;function&gt; = <span class="keyword">lambda</span>: &lt;return_value&gt;</span><br><span class="line">&lt;function&gt; = <span class="keyword">lambda</span> &lt;argument_1&gt;, &lt;argument_2&gt;: &lt;return_value&gt;</span><br></pre></td></tr></table></figure>

<h3 id="Comprehension"><a href="#Comprehension" class="headerlink" title="Comprehension"></a>Comprehension</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;<span class="built_in">list</span>&gt; = [i+<span class="number">1</span> <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10</span>)]                   <span class="comment"># [1, 2, ..., 10]</span></span><br><span class="line">&lt;<span class="built_in">set</span>&gt;  = &#123;i <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10</span>) <span class="keyword">if</span> i &gt; <span class="number">5</span>&#125;            <span class="comment"># &#123;6, 7, 8, 9&#125;</span></span><br><span class="line">&lt;<span class="built_in">iter</span>&gt; = (i+<span class="number">5</span> <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10</span>))                   <span class="comment"># (5, 6, ..., 14)</span></span><br><span class="line">&lt;<span class="built_in">dict</span>&gt; = &#123;i: i*<span class="number">2</span> <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10</span>)&#125;                <span class="comment"># &#123;0: 0, 1: 2, ..., 9: 18&#125;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">out = [i+j <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10</span>) <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10</span>)]</span><br></pre></td></tr></table></figure>

<h4 id="Is-the-same-as-1"><a href="#Is-the-same-as-1" class="headerlink" title="Is the same as:"></a>Is the same as:</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">out = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10</span>):</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10</span>):</span><br><span class="line">        out.append(i+j)</span><br></pre></td></tr></table></figure>

<h3 id="Map-Filter-Reduce"><a href="#Map-Filter-Reduce" class="headerlink" title="Map, Filter, Reduce"></a>Map, Filter, Reduce</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> functools <span class="keyword">import</span> reduce</span><br><span class="line">&lt;<span class="built_in">iter</span>&gt; = <span class="built_in">map</span>(<span class="keyword">lambda</span> x: x + <span class="number">1</span>, <span class="built_in">range</span>(<span class="number">10</span>))            <span class="comment"># (1, 2, ..., 10)</span></span><br><span class="line">&lt;<span class="built_in">iter</span>&gt; = <span class="built_in">filter</span>(<span class="keyword">lambda</span> x: x &gt; <span class="number">5</span>, <span class="built_in">range</span>(<span class="number">10</span>))         <span class="comment"># (6, 7, 8, 9)</span></span><br><span class="line">&lt;<span class="built_in">int</span>&gt;  = reduce(<span class="keyword">lambda</span> out, x: out + x, <span class="built_in">range</span>(<span class="number">10</span>))  <span class="comment"># 45</span></span><br></pre></td></tr></table></figure>

<h3 id="Any-All"><a href="#Any-All" class="headerlink" title="Any, All"></a>Any, All</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;<span class="built_in">bool</span>&gt; = <span class="built_in">any</span>(&lt;collection&gt;)                          <span class="comment"># False if empty.</span></span><br><span class="line">&lt;<span class="built_in">bool</span>&gt; = <span class="built_in">all</span>(el[<span class="number">1</span>] <span class="keyword">for</span> el <span class="keyword">in</span> &lt;collection&gt;)          <span class="comment"># True if empty.</span></span><br></pre></td></tr></table></figure>

<h3 id="If-Else"><a href="#If-Else" class="headerlink" title="If - Else"></a>If - Else</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;expression_if_true&gt; <span class="keyword">if</span> &lt;condition&gt; <span class="keyword">else</span> &lt;expression_if_false&gt;</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>[a <span class="keyword">if</span> a <span class="keyword">else</span> <span class="string">&#x27;zero&#x27;</span> <span class="keyword">for</span> a <span class="keyword">in</span> (<span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">3</span>)]</span><br><span class="line">[<span class="string">&#x27;zero&#x27;</span>, <span class="number">1</span>, <span class="string">&#x27;zero&#x27;</span>, <span class="number">3</span>]</span><br></pre></td></tr></table></figure>

<h3 id="Namedtuple-Enum-Dataclass"><a href="#Namedtuple-Enum-Dataclass" class="headerlink" title="Namedtuple, Enum, Dataclass"></a>Namedtuple, Enum, Dataclass</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> collections <span class="keyword">import</span> namedtuple</span><br><span class="line">Point     = namedtuple(<span class="string">&#x27;Point&#x27;</span>, <span class="string">&#x27;x y&#x27;</span>)</span><br><span class="line">point     = Point(<span class="number">0</span>, <span class="number">0</span>)</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> enum <span class="keyword">import</span> Enum</span><br><span class="line">Direction = Enum(<span class="string">&#x27;Direction&#x27;</span>, <span class="string">&#x27;n e s w&#x27;</span>)</span><br><span class="line">direction = Direction.n</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> dataclasses <span class="keyword">import</span> make_dataclass</span><br><span class="line">Creature  = make_dataclass(<span class="string">&#x27;Creature&#x27;</span>, [<span class="string">&#x27;location&#x27;</span>, <span class="string">&#x27;direction&#x27;</span>])</span><br><span class="line">creature  = Creature(Point(<span class="number">0</span>, <span class="number">0</span>), Direction.n)</span><br></pre></td></tr></table></figure>


<h2 id="Closure"><a href="#Closure" class="headerlink" title="Closure"></a>Closure</h2><p><strong>We have a closure in Python when:</strong></p>
<ul>
<li><strong>A nested function references a value of its enclosing function and then</strong></li>
<li><strong>the enclosing function returns the nested function.</strong></li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_multiplier</span>(<span class="params">a</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">out</span>(<span class="params">b</span>):</span></span><br><span class="line">        <span class="keyword">return</span> a * b</span><br><span class="line">    <span class="keyword">return</span> out</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>multiply_by_3 = get_multiplier(<span class="number">3</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>multiply_by_3(<span class="number">10</span>)</span><br><span class="line"><span class="number">30</span></span><br></pre></td></tr></table></figure>

<ul>
<li><strong>If multiple nested functions within enclosing function reference the same value, that value gets shared.</strong></li>
<li><strong>To dynamically access function’s first free variable use <code>&#39;&lt;function&gt;.__closure__[0].cell_contents&#39;</code>.</strong></li>
</ul>
<h3 id="Partial"><a href="#Partial" class="headerlink" title="Partial"></a>Partial</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> functools <span class="keyword">import</span> partial</span><br><span class="line">&lt;function&gt; = partial(&lt;function&gt; [, &lt;arg_1&gt;, &lt;arg_2&gt;, ...])</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">import</span> operator <span class="keyword">as</span> op</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>multiply_by_3 = partial(op.mul, <span class="number">3</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>multiply_by_3(<span class="number">10</span>)</span><br><span class="line"><span class="number">30</span></span><br></pre></td></tr></table></figure>
<ul>
<li><strong>Partial is also useful in cases when a function needs to be passed as an argument, because it enables us to set its arguments beforehand.</strong></li>
<li><strong>A few examples being <code>&#39;defaultdict(&lt;function&gt;)&#39;</code>, <code>&#39;iter(&lt;function&gt;, to_exclusive)&#39;</code> and dataclass’s <code>&#39;field(default_factory=&lt;function&gt;)&#39;</code>.</strong></li>
</ul>
<h3 id="Nonlocal"><a href="#Nonlocal" class="headerlink" title="Nonlocal"></a>Nonlocal</h3><p><strong>If variable is being assigned to anywhere in the scope, it is regarded as a local variable, unless it is declared as a ‘global’ or a ‘nonlocal’.</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_counter</span>():</span></span><br><span class="line">    i = <span class="number">0</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">out</span>():</span></span><br><span class="line">        <span class="keyword">nonlocal</span> i</span><br><span class="line">        i += <span class="number">1</span></span><br><span class="line">        <span class="keyword">return</span> i</span><br><span class="line">    <span class="keyword">return</span> out</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>counter = get_counter()</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>counter(), counter(), counter()</span><br><span class="line">(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>)</span><br></pre></td></tr></table></figure>


<h2 id="Decorator"><a href="#Decorator" class="headerlink" title="Decorator"></a>Decorator</h2><p><strong>A decorator takes a function, adds some functionality and returns it.</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@decorator_name</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">function_that_gets_passed_to_decorator</span>():</span></span><br><span class="line">    ...</span><br></pre></td></tr></table></figure>

<h3 id="Debugger-Example"><a href="#Debugger-Example" class="headerlink" title="Debugger Example"></a>Debugger Example</h3><p><strong>Decorator that prints function’s name every time it gets called.</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> functools <span class="keyword">import</span> wraps</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">debug</span>(<span class="params">func</span>):</span></span><br><span class="line"><span class="meta">    @wraps(<span class="params">func</span>)</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">out</span>(<span class="params">*args, **kwargs</span>):</span></span><br><span class="line">        <span class="built_in">print</span>(func.__name__)</span><br><span class="line">        <span class="keyword">return</span> func(*args, **kwargs)</span><br><span class="line">    <span class="keyword">return</span> out</span><br><span class="line"></span><br><span class="line"><span class="meta">@debug</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add</span>(<span class="params">x, y</span>):</span></span><br><span class="line">    <span class="keyword">return</span> x + y</span><br></pre></td></tr></table></figure>
<ul>
<li><strong>Wraps is a helper decorator that copies metadata of function add() to function out().</strong></li>
<li><strong>Without it <code>&#39;add.__name__&#39;</code> would return <code>&#39;out&#39;</code>.</strong></li>
</ul>
<h3 id="LRU-Cache"><a href="#LRU-Cache" class="headerlink" title="LRU Cache"></a>LRU Cache</h3><p><strong>Decorator that caches function’s return values. All function’s arguments must be hashable.</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> functools <span class="keyword">import</span> lru_cache</span><br><span class="line"></span><br><span class="line"><span class="meta">@lru_cache(<span class="params">maxsize=<span class="literal">None</span></span>)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">fib</span>(<span class="params">n</span>):</span></span><br><span class="line">    <span class="keyword">return</span> n <span class="keyword">if</span> n &lt; <span class="number">2</span> <span class="keyword">else</span> fib(n-<span class="number">2</span>) + fib(n-<span class="number">1</span>)</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>Recursion depth is limited to 1000 by default. To increase it use <code>&#39;sys.setrecursionlimit(&lt;depth&gt;)&#39;</code>.</strong></li>
</ul>
<h3 id="Parametrized-Decorator"><a href="#Parametrized-Decorator" class="headerlink" title="Parametrized Decorator"></a>Parametrized Decorator</h3><p><strong>A decorator that accepts arguments and returns a normal decorator that accepts a function.</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> functools <span class="keyword">import</span> wraps</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">debug</span>(<span class="params">print_result=<span class="literal">False</span></span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">decorator</span>(<span class="params">func</span>):</span></span><br><span class="line"><span class="meta">        @wraps(<span class="params">func</span>)</span></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">out</span>(<span class="params">*args, **kwargs</span>):</span></span><br><span class="line">            result = func(*args, **kwargs)</span><br><span class="line">            <span class="built_in">print</span>(func.__name__, result <span class="keyword">if</span> print_result <span class="keyword">else</span> <span class="string">&#x27;&#x27;</span>)</span><br><span class="line">            <span class="keyword">return</span> result</span><br><span class="line">        <span class="keyword">return</span> out</span><br><span class="line">    <span class="keyword">return</span> decorator</span><br><span class="line"></span><br><span class="line"><span class="meta">@debug(<span class="params">print_result=<span class="literal">True</span></span>)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add</span>(<span class="params">x, y</span>):</span></span><br><span class="line">    <span class="keyword">return</span> x + y</span><br></pre></td></tr></table></figure>


<h2 id="Class"><a href="#Class" class="headerlink" title="Class"></a>Class</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> &lt;<span class="title">name</span>&gt;:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, a</span>):</span></span><br><span class="line">        self.a = a</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__repr__</span>(<span class="params">self</span>):</span></span><br><span class="line">        class_name = self.__class__.__name__</span><br><span class="line">        <span class="keyword">return</span> <span class="string">f&#x27;<span class="subst">&#123;class_name&#125;</span>(<span class="subst">&#123;self.a!r&#125;</span>)&#x27;</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__str__</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">str</span>(self.a)</span><br><span class="line"></span><br><span class="line"><span class="meta">    @classmethod</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_class_name</span>(<span class="params">cls</span>):</span></span><br><span class="line">        <span class="keyword">return</span> cls.__name__</span><br></pre></td></tr></table></figure>
<ul>
<li><strong>Return value of repr() should be unambiguous and of str() readable.</strong></li>
<li><strong>If only repr() is defined, it will be also used for str().</strong></li>
</ul>
<h4 id="Str-use-cases"><a href="#Str-use-cases" class="headerlink" title="Str() use cases:"></a>Str() use cases:</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">print</span>(&lt;el&gt;)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;<span class="subst">&#123;&lt;el&gt;&#125;</span>&#x27;</span>)</span><br><span class="line"><span class="keyword">raise</span> Exception(&lt;el&gt;)</span><br><span class="line">logging.debug(&lt;el&gt;)</span><br><span class="line">csv.writer(&lt;file&gt;).writerow([&lt;el&gt;])</span><br></pre></td></tr></table></figure>

<h4 id="Repr-use-cases"><a href="#Repr-use-cases" class="headerlink" title="Repr() use cases:"></a>Repr() use cases:</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">print</span>([&lt;el&gt;])</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;<span class="subst">&#123;&lt;el&gt;!r&#125;</span>&#x27;</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>&lt;el&gt;</span><br><span class="line">loguru.logger.exception()</span><br><span class="line">Z = dataclasses.make_dataclass(<span class="string">&#x27;Z&#x27;</span>, [<span class="string">&#x27;a&#x27;</span>]); <span class="built_in">print</span>(Z(&lt;el&gt;))</span><br></pre></td></tr></table></figure>

<h3 id="Constructor-Overloading"><a href="#Constructor-Overloading" class="headerlink" title="Constructor Overloading"></a>Constructor Overloading</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> &lt;<span class="title">name</span>&gt;:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, a=<span class="literal">None</span></span>):</span></span><br><span class="line">        self.a = a</span><br></pre></td></tr></table></figure>

<h3 id="Inheritance"><a href="#Inheritance" class="headerlink" title="Inheritance"></a>Inheritance</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, name, age</span>):</span></span><br><span class="line">        self.name = name</span><br><span class="line">        self.age  = age</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Employee</span>(<span class="params">Person</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, name, age, staff_num</span>):</span></span><br><span class="line">        <span class="built_in">super</span>().__init__(name, age)</span><br><span class="line">        self.staff_num = staff_num</span><br></pre></td></tr></table></figure>

<h3 id="Multiple-Inheritance"><a href="#Multiple-Inheritance" class="headerlink" title="Multiple Inheritance"></a>Multiple Inheritance</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span>:</span> <span class="keyword">pass</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">B</span>:</span> <span class="keyword">pass</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">C</span>(<span class="params">A, B</span>):</span> <span class="keyword">pass</span></span><br></pre></td></tr></table></figure>

<p><strong>MRO determines the order in which parent classes are traversed when searching for a method:</strong></p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>C.mro()</span><br><span class="line">[&lt;class &#x27;C&#x27;&gt;, &lt;class &#x27;A&#x27;&gt;, &lt;class &#x27;B&#x27;&gt;, &lt;class &#x27;object&#x27;&gt;]</span><br></pre></td></tr></table></figure>

<h3 id="Property"><a href="#Property" class="headerlink" title="Property"></a>Property</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyClass</span>:</span></span><br><span class="line"><span class="meta">    @property</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">a</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">return</span> self._a</span><br><span class="line"></span><br><span class="line"><span class="meta">    @a.setter</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">a</span>(<span class="params">self, value</span>):</span></span><br><span class="line">        self._a = value</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>el = MyClass()</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>el.a = <span class="number">123</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>el.a</span><br><span class="line"><span class="number">123</span></span><br></pre></td></tr></table></figure>

<h3 id="Dataclass"><a href="#Dataclass" class="headerlink" title="Dataclass"></a>Dataclass</h3><p><strong>Decorator that automatically generates init(), repr() and eq() special methods.</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> dataclasses <span class="keyword">import</span> dataclass, field</span><br><span class="line"></span><br><span class="line"><span class="meta">@dataclass(<span class="params">order=<span class="literal">False</span>, frozen=<span class="literal">False</span></span>)</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> &lt;<span class="title">class_name</span>&gt;:</span></span><br><span class="line">    &lt;attr_name_1&gt;: &lt;<span class="built_in">type</span>&gt;</span><br><span class="line">    &lt;attr_name_2&gt;: &lt;<span class="built_in">type</span>&gt; = &lt;default_value&gt;</span><br><span class="line">    &lt;attr_name_3&gt;: <span class="built_in">list</span>/<span class="built_in">dict</span>/<span class="built_in">set</span> = field(default_factory=<span class="built_in">list</span>/<span class="built_in">dict</span>/<span class="built_in">set</span>)</span><br></pre></td></tr></table></figure>
<ul>
<li><strong>An object can be made sortable with <code>&#39;order=True&#39;</code> or immutable with <code>&#39;frozen=True&#39;</code>.</strong></li>
<li><strong>Function field() is needed because <code>&#39;&lt;attr_name&gt;: list = []&#39;</code> would make a list that is shared among all instances.</strong></li>
<li><strong>Default_factory can be any callable.</strong></li>
</ul>
<h3 id="Slots"><a href="#Slots" class="headerlink" title="Slots"></a>Slots</h3><p><strong>Mechanism that restricts objects to attributes listed in ‘slots’ and significantly reduces their memory footprint.</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyClassWithSlots</span>:</span></span><br><span class="line">    __slots__ = [<span class="string">&#x27;a&#x27;</span>]</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self</span>):</span></span><br><span class="line">        self.a = <span class="number">1</span></span><br></pre></td></tr></table></figure>

<h3 id="Copy"><a href="#Copy" class="headerlink" title="Copy"></a>Copy</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> copy <span class="keyword">import</span> copy, deepcopy</span><br><span class="line">&lt;<span class="built_in">object</span>&gt; = copy(&lt;<span class="built_in">object</span>&gt;)</span><br><span class="line">&lt;<span class="built_in">object</span>&gt; = deepcopy(&lt;<span class="built_in">object</span>&gt;)</span><br></pre></td></tr></table></figure>


<h2 id="Duck-Types"><a href="#Duck-Types" class="headerlink" title="Duck Types"></a>Duck Types</h2><p><strong>A duck type is an implicit type that prescribes a set of special methods. Any object that has those methods defined is considered a member of that duck type.</strong></p>
<h3 id="Comparable"><a href="#Comparable" class="headerlink" title="Comparable"></a>Comparable</h3><ul>
<li><strong>If eq() method is not overridden, it returns <code>&#39;id(self) == id(other)&#39;</code>, which is the same as <code>&#39;self is other&#39;</code>.</strong></li>
<li><strong>That means all objects compare not equal by default.</strong></li>
<li><strong>Only left side object has eq() method called, unless it returns ‘NotImplemented’, in which case the right object is consulted.</strong></li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyComparable</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, a</span>):</span></span><br><span class="line">        self.a = a</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__eq__</span>(<span class="params">self, other</span>):</span></span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">isinstance</span>(other, <span class="built_in">type</span>(self)):</span><br><span class="line">            <span class="keyword">return</span> self.a == other.a</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">NotImplemented</span></span><br></pre></td></tr></table></figure>

<h3 id="Hashable"><a href="#Hashable" class="headerlink" title="Hashable"></a>Hashable</h3><ul>
<li><strong>Hashable object needs both hash() and eq() methods and its hash value should never change.</strong></li>
<li><strong>Hashable objects that compare equal must have the same hash value, meaning default hash() that returns <code>&#39;id(self)&#39;</code> will not do.</strong></li>
<li><strong>That is why Python automatically makes classes unhashable if you only implement eq().</strong></li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyHashable</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, a</span>):</span></span><br><span class="line">        self._a = copy.deepcopy(a)</span><br><span class="line"><span class="meta">    @property</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">a</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">return</span> self._a</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__eq__</span>(<span class="params">self, other</span>):</span></span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">isinstance</span>(other, <span class="built_in">type</span>(self)):</span><br><span class="line">            <span class="keyword">return</span> self.a == other.a</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">NotImplemented</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__hash__</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">hash</span>(self.a)</span><br></pre></td></tr></table></figure>

<h3 id="Sortable"><a href="#Sortable" class="headerlink" title="Sortable"></a>Sortable</h3><ul>
<li><strong>With ‘total_ordering’ decorator you only need to provide eq() and one of lt(), gt(), le() or ge() special methods.</strong><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> functools <span class="keyword">import</span> total_ordering</span><br><span class="line"></span><br><span class="line"><span class="meta">@total_ordering</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MySortable</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, a</span>):</span></span><br><span class="line">        self.a = a</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__eq__</span>(<span class="params">self, other</span>):</span></span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">isinstance</span>(other, <span class="built_in">type</span>(self)):</span><br><span class="line">            <span class="keyword">return</span> self.a == other.a</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">NotImplemented</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__lt__</span>(<span class="params">self, other</span>):</span></span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">isinstance</span>(other, <span class="built_in">type</span>(self)):</span><br><span class="line">            <span class="keyword">return</span> self.a &lt; other.a</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">NotImplemented</span></span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="Iterator-1"><a href="#Iterator-1" class="headerlink" title="Iterator"></a>Iterator</h3><ul>
<li><strong>Next() should return next item or raise ‘StopIteration’.</strong></li>
<li><strong>Iter() should return ‘self’.</strong><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Counter</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self</span>):</span></span><br><span class="line">        self.i = <span class="number">0</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__next__</span>(<span class="params">self</span>):</span></span><br><span class="line">        self.i += <span class="number">1</span></span><br><span class="line">        <span class="keyword">return</span> self.i</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__iter__</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">return</span> self</span><br></pre></td></tr></table></figure></li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>counter = Counter()</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">next</span>(counter), <span class="built_in">next</span>(counter), <span class="built_in">next</span>(counter)</span><br><span class="line">(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>)</span><br></pre></td></tr></table></figure>

<h3 id="Callable"><a href="#Callable" class="headerlink" title="Callable"></a>Callable</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Counter</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self</span>):</span></span><br><span class="line">        self.i = <span class="number">0</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__call__</span>(<span class="params">self</span>):</span></span><br><span class="line">        self.i += <span class="number">1</span></span><br><span class="line">        <span class="keyword">return</span> self.i</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>counter = Counter()</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>counter(), counter(), counter()</span><br><span class="line">(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>)</span><br></pre></td></tr></table></figure>

<h3 id="Context-Manager"><a href="#Context-Manager" class="headerlink" title="Context Manager"></a>Context Manager</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyOpen</span>():</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, filename</span>):</span></span><br><span class="line">        self.filename = filename</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__enter__</span>(<span class="params">self</span>):</span></span><br><span class="line">        self.file = <span class="built_in">open</span>(self.filename)</span><br><span class="line">        <span class="keyword">return</span> self.file</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__exit__</span>(<span class="params">self, *args</span>):</span></span><br><span class="line">        self.file.close()</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;test.txt&#x27;</span>, <span class="string">&#x27;w&#x27;</span>) <span class="keyword">as</span> file:</span><br><span class="line"><span class="meta">... </span>    file.write(<span class="string">&#x27;Hello World!&#x27;</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">with</span> MyOpen(<span class="string">&#x27;test.txt&#x27;</span>) <span class="keyword">as</span> file:</span><br><span class="line"><span class="meta">... </span>    <span class="built_in">print</span>(file.read())</span><br><span class="line">Hello World!</span><br></pre></td></tr></table></figure>

<h4 id="List-of-existing-context-managers"><a href="#List-of-existing-context-managers" class="headerlink" title="List of existing context managers:"></a>List of existing context managers:</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;&lt;path&gt;&#x27;</span>, ...) <span class="keyword">as</span> file: ...</span><br><span class="line"><span class="keyword">with</span> wave.<span class="built_in">open</span>(<span class="string">&#x27;&lt;path&gt;&#x27;</span>, ...) <span class="keyword">as</span> wave_file: ...</span><br><span class="line"><span class="keyword">with</span> <span class="built_in">memoryview</span>(&lt;<span class="built_in">bytes</span>/<span class="built_in">bytearray</span>/array&gt;) <span class="keyword">as</span> view: ...</span><br><span class="line">db = sqlite3.connect(<span class="string">&#x27;&lt;path&gt;&#x27;</span>); <span class="keyword">with</span> db: db.execute(<span class="string">&#x27;&lt;insert_query&gt;&#x27;</span>)</span><br><span class="line">lock = threading.RLock(); <span class="keyword">with</span> lock: ...</span><br></pre></td></tr></table></figure>


<h2 id="Iterable-Duck-Types"><a href="#Iterable-Duck-Types" class="headerlink" title="Iterable Duck Types"></a>Iterable Duck Types</h2><h3 id="Iterable"><a href="#Iterable" class="headerlink" title="Iterable"></a>Iterable</h3><ul>
<li><strong>Only required method is iter(). It should return an iterator of object’s items.</strong></li>
<li><strong>Contains() automatically works on any object that has iter() defined.</strong><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyIterable</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, a</span>):</span></span><br><span class="line">        self.a = a</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__iter__</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">for</span> el <span class="keyword">in</span> self.a:</span><br><span class="line">            <span class="keyword">yield</span> el</span><br></pre></td></tr></table></figure></li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>a = MyIterable([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>])</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">iter</span>(a)</span><br><span class="line">&lt;generator <span class="built_in">object</span> MyIterable.__iter__ at <span class="number">0x1026c18b8</span>&gt;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="number">1</span> <span class="keyword">in</span> a</span><br><span class="line"><span class="literal">True</span></span><br></pre></td></tr></table></figure>

<h3 id="Collection"><a href="#Collection" class="headerlink" title="Collection"></a>Collection</h3><ul>
<li><strong>Only required methods are iter() and len().</strong></li>
<li><strong>This cheatsheet actually means <code>&#39;&lt;iterable&gt;&#39;</code> when it uses <code>&#39;&lt;collection&gt;&#39;</code>.</strong></li>
<li><strong>I chose not to use the name ‘iterable’ because it sounds scarier and more vague than ‘collection’.</strong><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyCollection</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, a</span>):</span></span><br><span class="line">        self.a = a</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__iter__</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">for</span> el <span class="keyword">in</span> self.a:</span><br><span class="line">            <span class="keyword">yield</span> el</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__contains__</span>(<span class="params">self, el</span>):</span></span><br><span class="line">        <span class="keyword">return</span> el <span class="keyword">in</span> self.a</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__len__</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">len</span>(self.a)</span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="Sequence"><a href="#Sequence" class="headerlink" title="Sequence"></a>Sequence</h3><ul>
<li><strong>Only required methods are len() and getitem(), that should return an item at index or raise ‘IndexError’.</strong></li>
<li><strong>Iter() and contains() automatically work on any object that has getitem() defined.</strong></li>
<li><strong>Reversed() automatically works on any object that has getitem() and len() defined.</strong><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MySequence</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, a</span>):</span></span><br><span class="line">        self.a = a</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__iter__</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">for</span> el <span class="keyword">in</span> self.a:</span><br><span class="line">            <span class="keyword">yield</span> el</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__contains__</span>(<span class="params">self, el</span>):</span></span><br><span class="line">        <span class="keyword">return</span> el <span class="keyword">in</span> self.a</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__len__</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">len</span>(self.a)</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__getitem__</span>(<span class="params">self, i</span>):</span></span><br><span class="line">        <span class="keyword">return</span> self.a[i]</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__reversed__</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">reversed</span>(self.a)</span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="Collections-abc-Sequence"><a href="#Collections-abc-Sequence" class="headerlink" title="Collections.abc.Sequence"></a>Collections.abc.Sequence</h3><ul>
<li><strong>It’s a richer interface than the basic sequence.</strong></li>
<li><strong>Extending it generates iter(), contains(), reversed(), index(), and count().</strong></li>
<li><strong>Unlike <code>&#39;abc.Iterable&#39;</code> and <code>&#39;abc.Collection&#39;</code>, it is not a duck type. That is why <code>&#39;issubclass(MySequence, collections.abc.Sequence)&#39;</code> would return ‘False’ even if it had all the methods defined.</strong></li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyAbcSequence</span>(<span class="params">collections.abc.<span class="type">Sequence</span></span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, a</span>):</span></span><br><span class="line">        self.a = a</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__len__</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">len</span>(self.a)</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__getitem__</span>(<span class="params">self, i</span>):</span></span><br><span class="line">        <span class="keyword">return</span> self.a[i]</span><br></pre></td></tr></table></figure>

<h4 id="Table-of-required-and-available-special-methods"><a href="#Table-of-required-and-available-special-methods" class="headerlink" title="Table of required and available special methods:"></a>Table of required and available special methods:</h4><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">+------------+----------+------------+----------+--------------+</span><br><span class="line">|            | Iterable | Collection | Sequence | abc.Sequence |</span><br><span class="line">+------------+----------+------------+----------+--------------+</span><br><span class="line">| iter()     |   REQ    |    REQ     |   yes    |     yes      |</span><br><span class="line">| contains() |   yes    |    yes     |   yes    |     yes      |</span><br><span class="line">| len()      |          |    REQ     |   REQ    |     REQ      |</span><br><span class="line">| getitem()  |          |            |   REQ    |     REQ      |</span><br><span class="line">| reversed() |          |            |   yes    |     yes      |</span><br><span class="line">| index()    |          |            |          |     yes      |</span><br><span class="line">| count()    |          |            |          |     yes      |</span><br><span class="line">+------------+----------+------------+----------+--------------+</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>Other useful ABCs that automatically generate missing methods are: MutableSequence, Set, MutableSet, Mapping and MutableMapping.</strong></li>
</ul>
<h2 id="Enum"><a href="#Enum" class="headerlink" title="Enum"></a>Enum</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> enum <span class="keyword">import</span> Enum, auto</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> &lt;<span class="title">enum_name</span>&gt;(<span class="params">Enum</span>):</span></span><br><span class="line">    &lt;member_name_1&gt; = &lt;value_1&gt;</span><br><span class="line">    &lt;member_name_2&gt; = &lt;value_2_a&gt;, &lt;value_2_b&gt;</span><br><span class="line">    &lt;member_name_3&gt; = auto()</span><br><span class="line"></span><br><span class="line"><span class="meta">    @classmethod</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_member_names</span>(<span class="params">cls</span>):</span></span><br><span class="line">        <span class="keyword">return</span> [a.name <span class="keyword">for</span> a <span class="keyword">in</span> cls.__members__.values()]</span><br></pre></td></tr></table></figure>
<ul>
<li><strong>If there are no numeric values before auto(), it returns 1.</strong></li>
<li><strong>Otherwise it returns an increment of last numeric value.</strong></li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;member&gt; = &lt;enum&gt;.&lt;member_name&gt;</span><br><span class="line">&lt;member&gt; = &lt;enum&gt;[<span class="string">&#x27;&lt;member_name&gt;&#x27;</span>]</span><br><span class="line">&lt;member&gt; = &lt;enum&gt;(&lt;value&gt;)</span><br><span class="line">name     = &lt;member&gt;.name</span><br><span class="line">value    = &lt;member&gt;.value</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">list_of_members = <span class="built_in">list</span>(&lt;enum&gt;)</span><br><span class="line">member_names    = [a.name <span class="keyword">for</span> a <span class="keyword">in</span> &lt;enum&gt;]</span><br><span class="line">member_values   = [a.value <span class="keyword">for</span> a <span class="keyword">in</span> &lt;enum&gt;]</span><br><span class="line">random_member   = random.choice(<span class="built_in">list</span>(&lt;enum&gt;))</span><br></pre></td></tr></table></figure>

<h3 id="Inline-1"><a href="#Inline-1" class="headerlink" title="Inline"></a>Inline</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Cutlery = Enum(<span class="string">&#x27;Cutlery&#x27;</span>, [<span class="string">&#x27;fork&#x27;</span>, <span class="string">&#x27;knife&#x27;</span>, <span class="string">&#x27;spoon&#x27;</span>])</span><br><span class="line">Cutlery = Enum(<span class="string">&#x27;Cutlery&#x27;</span>, <span class="string">&#x27;fork knife spoon&#x27;</span>)</span><br><span class="line">Cutlery = Enum(<span class="string">&#x27;Cutlery&#x27;</span>, &#123;<span class="string">&#x27;fork&#x27;</span>: <span class="number">1</span>, <span class="string">&#x27;knife&#x27;</span>: <span class="number">2</span>, <span class="string">&#x27;spoon&#x27;</span>: <span class="number">3</span>&#125;)</span><br></pre></td></tr></table></figure>

<h4 id="Functions-can-not-be-values-so-they-must-be-wrapped"><a href="#Functions-can-not-be-values-so-they-must-be-wrapped" class="headerlink" title="Functions can not be values, so they must be wrapped:"></a>Functions can not be values, so they must be wrapped:</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> functools <span class="keyword">import</span> partial</span><br><span class="line">LogicOp = Enum(<span class="string">&#x27;LogicOp&#x27;</span>, &#123;<span class="string">&#x27;AND&#x27;</span>: partial(<span class="keyword">lambda</span> l, r: l <span class="keyword">and</span> r),</span><br><span class="line">                           <span class="string">&#x27;OR&#x27;</span> : partial(<span class="keyword">lambda</span> l, r: l <span class="keyword">or</span> r)&#125;)</span><br></pre></td></tr></table></figure>
<ul>
<li><strong>Another solution in this particular case, is to use <code>&#39;and_&#39;</code> and <code>&#39;or_&#39;</code> functions from module <a href="#operator">Operator</a>.</strong></li>
</ul>
<h2 id="Exceptions"><a href="#Exceptions" class="headerlink" title="Exceptions"></a>Exceptions</h2><h3 id="Basic-Example"><a href="#Basic-Example" class="headerlink" title="Basic Example"></a>Basic Example</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    &lt;code&gt;</span><br><span class="line"><span class="keyword">except</span> &lt;exception&gt;:</span><br><span class="line">    &lt;code&gt;</span><br></pre></td></tr></table></figure>

<h3 id="Complex-Example"><a href="#Complex-Example" class="headerlink" title="Complex Example"></a>Complex Example</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    &lt;code_1&gt;</span><br><span class="line"><span class="keyword">except</span> &lt;exception_a&gt;:</span><br><span class="line">    &lt;code_2_a&gt;</span><br><span class="line"><span class="keyword">except</span> &lt;exception_b&gt;:</span><br><span class="line">    &lt;code_2_b&gt;</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    &lt;code_2_c&gt;</span><br><span class="line"><span class="keyword">finally</span>:</span><br><span class="line">    &lt;code_3&gt;</span><br></pre></td></tr></table></figure>

<h3 id="Catching-Exceptions"><a href="#Catching-Exceptions" class="headerlink" title="Catching Exceptions"></a>Catching Exceptions</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">except</span> &lt;exception&gt;:</span><br><span class="line"><span class="keyword">except</span> &lt;exception&gt; <span class="keyword">as</span> &lt;name&gt;:</span><br><span class="line"><span class="keyword">except</span> (&lt;exception_1&gt;, &lt;exception_2&gt;, ...):</span><br><span class="line"><span class="keyword">except</span> (&lt;exception_1&gt;, &lt;exception_2&gt;, ...) <span class="keyword">as</span> &lt;name&gt;:</span><br></pre></td></tr></table></figure>
<ul>
<li><strong>Also catches subclasses of the exception.</strong></li>
</ul>
<h3 id="Raising-Exceptions"><a href="#Raising-Exceptions" class="headerlink" title="Raising Exceptions"></a>Raising Exceptions</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">raise</span> &lt;exception&gt;</span><br><span class="line"><span class="keyword">raise</span> &lt;exception&gt;()</span><br><span class="line"><span class="keyword">raise</span> &lt;exception&gt;(&lt;el&gt;)</span><br><span class="line"><span class="keyword">raise</span> &lt;exception&gt;(&lt;el_1&gt;, &lt;el_2&gt;, ...)</span><br></pre></td></tr></table></figure>

<h4 id="Useful-built-in-exceptions"><a href="#Useful-built-in-exceptions" class="headerlink" title="Useful built-in exceptions:"></a>Useful built-in exceptions:</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">raise</span> ValueError(<span class="string">&#x27;Argument is of right type but inappropriate value!&#x27;</span>)</span><br><span class="line"><span class="keyword">raise</span> TypeError(<span class="string">&#x27;Argument is of wrong type!&#x27;</span>)</span><br><span class="line"><span class="keyword">raise</span> RuntimeError(<span class="string">&#x27;None of above!&#x27;</span>)</span><br></pre></td></tr></table></figure>

<h4 id="Re-raising-caught-exception"><a href="#Re-raising-caught-exception" class="headerlink" title="Re-raising caught exception:"></a>Re-raising caught exception:</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">except</span> &lt;exception&gt;:</span><br><span class="line">    &lt;code&gt;</span><br><span class="line">    <span class="keyword">raise</span></span><br></pre></td></tr></table></figure>

<h3 id="Common-Built-in-Exceptions"><a href="#Common-Built-in-Exceptions" class="headerlink" title="Common Built-in Exceptions"></a>Common Built-in Exceptions</h3><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">BaseException</span><br><span class="line"> +-- SystemExit                   # Raised by the sys.exit() function.</span><br><span class="line"> +-- KeyboardInterrupt            # Raised when the user hits the interrupt key.</span><br><span class="line"> +-- Exception                    # User-defined exceptions should be derived from this class.</span><br><span class="line">      +-- StopIteration           # Raised by next() when run on an empty iterator.</span><br><span class="line">      +-- ArithmeticError         # Base class for arithmetic errors.</span><br><span class="line">      |    +-- ZeroDivisionError  # Raised when dividing by zero.</span><br><span class="line">      +-- AttributeError          # Raised when an attribute is missing.</span><br><span class="line">      +-- EOFError                # Raised by input() when it hits end-of-file condition.</span><br><span class="line">      +-- LookupError             # Raised when a look-up on sequence or dict fails.</span><br><span class="line">      |    +-- IndexError         # Raised when a sequence index is out of range.</span><br><span class="line">      |    +-- KeyError           # Raised when a dictionary key is not found.</span><br><span class="line">      +-- NameError               # Raised when a variable name is not found.</span><br><span class="line">      +-- OSError                 # Failures such as “file not found” or “disk full”.</span><br><span class="line">      |    +-- FileNotFoundError  # When a file or directory is requested but doesn&#x27;t exist.</span><br><span class="line">      +-- RuntimeError            # Raised by errors that don&#x27;t fall in other categories.</span><br><span class="line">      |    +-- RecursionError     # Raised when the the maximum recursion depth is exceeded.</span><br><span class="line">      +-- TypeError               # Raised when an argument is of wrong type.</span><br><span class="line">      +-- ValueError              # When an argument is of right type but inappropriate value.</span><br><span class="line">           +-- UnicodeError       # Raised when encoding/decoding strings from/to bytes fails. </span><br></pre></td></tr></table></figure>

<h3 id="User-defined-Exceptions"><a href="#User-defined-Exceptions" class="headerlink" title="User-defined Exceptions"></a>User-defined Exceptions</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyError</span>(<span class="params">Exception</span>):</span></span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyInputError</span>(<span class="params">MyError</span>):</span></span><br><span class="line">    <span class="keyword">pass</span></span><br></pre></td></tr></table></figure>


<h2 id="Print"><a href="#Print" class="headerlink" title="Print"></a>Print</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">print</span>(&lt;el_1&gt;, ..., sep=<span class="string">&#x27; &#x27;</span>, end=<span class="string">&#x27;\n&#x27;</span>, file=sys.stdout, flush=<span class="literal">False</span>)</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>Use <code>&#39;file=sys.stderr&#39;</code> for errors.</strong></li>
<li><strong>Use <code>&#39;flush=True&#39;</code> to forcibly flush the stream.</strong></li>
</ul>
<h3 id="Pretty-Print"><a href="#Pretty-Print" class="headerlink" title="Pretty Print"></a>Pretty Print</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> pprint <span class="keyword">import</span> pprint</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>pprint(<span class="built_in">dir</span>())</span><br><span class="line">[<span class="string">&#x27;__annotations__&#x27;</span>,</span><br><span class="line"> <span class="string">&#x27;__builtins__&#x27;</span>,</span><br><span class="line"> <span class="string">&#x27;__doc__&#x27;</span>, ...]</span><br></pre></td></tr></table></figure>


<h2 id="Input"><a href="#Input" class="headerlink" title="Input"></a>Input</h2><ul>
<li><strong>Reads a line from user input or pipe if present.</strong></li>
<li><strong>Trailing newline gets stripped.</strong></li>
<li><strong>Prompt string is printed to the standard output before reading input.</strong></li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;<span class="built_in">str</span>&gt; = <span class="built_in">input</span>(prompt=<span class="literal">None</span>)</span><br></pre></td></tr></table></figure>

<h4 id="Prints-lines-until-EOF"><a href="#Prints-lines-until-EOF" class="headerlink" title="Prints lines until EOF:"></a>Prints lines until EOF:</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="built_in">input</span>())</span><br><span class="line">    <span class="keyword">except</span> EOFError:</span><br><span class="line">        <span class="keyword">break</span></span><br></pre></td></tr></table></figure>


<h2 id="Command-Line-Arguments"><a href="#Command-Line-Arguments" class="headerlink" title="Command Line Arguments"></a>Command Line Arguments</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> sys</span><br><span class="line">script_name = sys.argv[<span class="number">0</span>]</span><br><span class="line">arguments   = sys.argv[<span class="number">1</span>:]</span><br></pre></td></tr></table></figure>

<h3 id="Argparse"><a href="#Argparse" class="headerlink" title="Argparse"></a>Argparse</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> argparse <span class="keyword">import</span> ArgumentParser, FileType</span><br><span class="line">p = ArgumentParser(description=&lt;<span class="built_in">str</span>&gt;)</span><br><span class="line">p.add_argument(<span class="string">&#x27;-&lt;short_name&gt;&#x27;</span>, <span class="string">&#x27;--&lt;name&gt;&#x27;</span>, action=<span class="string">&#x27;store_true&#x27;</span>)  <span class="comment"># Flag</span></span><br><span class="line">p.add_argument(<span class="string">&#x27;-&lt;short_name&gt;&#x27;</span>, <span class="string">&#x27;--&lt;name&gt;&#x27;</span>, <span class="built_in">type</span>=&lt;<span class="built_in">type</span>&gt;)          <span class="comment"># Option</span></span><br><span class="line">p.add_argument(<span class="string">&#x27;&lt;name&gt;&#x27;</span>, <span class="built_in">type</span>=&lt;<span class="built_in">type</span>&gt;, nargs=<span class="number">1</span>)                    <span class="comment"># Argument</span></span><br><span class="line">p.add_argument(<span class="string">&#x27;&lt;name&gt;&#x27;</span>, <span class="built_in">type</span>=&lt;<span class="built_in">type</span>&gt;, nargs=<span class="string">&#x27;+&#x27;</span>)                  <span class="comment"># Arguments</span></span><br><span class="line">args  = p.parse_args()</span><br><span class="line">value = args.&lt;name&gt;</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>Use <code>&#39;help=&lt;str&gt;&#39;</code> for argument description.</strong></li>
<li><strong>Use <code>&#39;type=FileType(&lt;mode&gt;)&#39;</code> for files.</strong></li>
</ul>
<h2 id="Open"><a href="#Open" class="headerlink" title="Open"></a>Open</h2><p><strong>Opens a file and returns a corresponding file object.</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;file&gt; = <span class="built_in">open</span>(<span class="string">&#x27;&lt;path&gt;&#x27;</span>, mode=<span class="string">&#x27;r&#x27;</span>, encoding=<span class="literal">None</span>, newline=<span class="literal">None</span>)</span><br></pre></td></tr></table></figure>
<ul>
<li><strong><code>&#39;encoding=None&#39;</code> means default encoding is used, which is platform dependent. Best practice is to use <code>&#39;encoding=&quot;utf-8&quot;&#39;</code> whenever possible.</strong></li>
<li><strong><code>&#39;newline=None&#39;</code> means all different end of line combinations are converted to ‘\n’ on read, while on write all ‘\n’ characters are converted to system’s default line separator.</strong></li>
<li><strong><code>&#39;newline=&quot;&quot;&#39;</code> means no conversions take place, but lines are still broken by readline() on either ‘\n’, ‘\r’ or ‘\r\n’.</strong></li>
</ul>
<h3 id="Modes"><a href="#Modes" class="headerlink" title="Modes"></a>Modes</h3><ul>
<li><strong><code>&#39;r&#39;</code>  - Read (default).</strong></li>
<li><strong><code>&#39;w&#39;</code>  - Write (truncate).</strong></li>
<li><strong><code>&#39;x&#39;</code>  - Write or fail if the file already exists.</strong></li>
<li><strong><code>&#39;a&#39;</code>  - Append.</strong></li>
<li><strong><code>&#39;w+&#39;</code> - Read and write (truncate).</strong></li>
<li><strong><code>&#39;r+&#39;</code> - Read and write from the start.</strong></li>
<li><strong><code>&#39;a+&#39;</code> - Read and write from the end.</strong></li>
<li><strong><code>&#39;t&#39;</code>  - Text mode (default).</strong></li>
<li><strong><code>&#39;b&#39;</code>  - Binary mode.</strong></li>
</ul>
<h3 id="Exceptions-1"><a href="#Exceptions-1" class="headerlink" title="Exceptions"></a>Exceptions</h3><ul>
<li><strong><code>&#39;FileNotFoundError&#39;</code> can be risen when reading with <code>&#39;r&#39;</code> or <code>&#39;r+&#39;</code>.</strong>  </li>
<li><strong><code>&#39;FileExistsError&#39;</code> can be risen when writing with <code>&#39;x&#39;</code>.</strong></li>
<li><strong><code>&#39;IsADirectoryError&#39;</code> and <code>&#39;PermissionError&#39;</code> can be risen by any.</strong></li>
<li><strong><code>&#39;OSError&#39;</code> is the parent class of all listed exceptions.</strong></li>
</ul>
<h3 id="File"><a href="#File" class="headerlink" title="File"></a>File</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;file&gt;.seek(<span class="number">0</span>)                      <span class="comment"># Moves to the start of the file.</span></span><br><span class="line">&lt;file&gt;.seek(offset)                 <span class="comment"># Moves &#x27;offset&#x27; chars/bytes from the start.</span></span><br><span class="line">&lt;file&gt;.seek(<span class="number">0</span>, <span class="number">2</span>)                   <span class="comment"># Moves to the end of the file.</span></span><br><span class="line">&lt;bin_file&gt;.seek(±offset, &lt;anchor&gt;)  <span class="comment"># Anchor: 0 start, 1 current pos., 2 end.</span></span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;<span class="built_in">str</span>/<span class="built_in">bytes</span>&gt; = &lt;file&gt;.read(size=-<span class="number">1</span>)  <span class="comment"># Reads &#x27;size&#x27; chars/bytes or until EOF.</span></span><br><span class="line">&lt;<span class="built_in">str</span>/<span class="built_in">bytes</span>&gt; = &lt;file&gt;.readline()     <span class="comment"># Returns a line or empty string on EOF.</span></span><br><span class="line">&lt;<span class="built_in">list</span>&gt;      = &lt;file&gt;.readlines()    <span class="comment"># Returns a list of lines or empty list.</span></span><br><span class="line">&lt;<span class="built_in">str</span>/<span class="built_in">bytes</span>&gt; = <span class="built_in">next</span>(&lt;file&gt;)          <span class="comment"># Returns a line using buffer. Do not mix.</span></span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;file&gt;.write(&lt;<span class="built_in">str</span>/<span class="built_in">bytes</span>&gt;)           <span class="comment"># Writes a string or bytes object.</span></span><br><span class="line">&lt;file&gt;.writelines(&lt;coll.&gt;)          <span class="comment"># Writes a coll. of strings or bytes objects.</span></span><br><span class="line">&lt;file&gt;.flush()                      <span class="comment"># Flushes write buffer.</span></span><br></pre></td></tr></table></figure>
<ul>
<li><strong>Methods do not add or strip trailing newlines, even writelines().</strong></li>
</ul>
<h3 id="Read-Text-from-File"><a href="#Read-Text-from-File" class="headerlink" title="Read Text from File"></a>Read Text from File</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">read_file</span>(<span class="params">filename</span>):</span></span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(filename, encoding=<span class="string">&#x27;utf-8&#x27;</span>) <span class="keyword">as</span> file:</span><br><span class="line">        <span class="keyword">return</span> file.readlines()</span><br></pre></td></tr></table></figure>

<h3 id="Write-Text-to-File"><a href="#Write-Text-to-File" class="headerlink" title="Write Text to File"></a>Write Text to File</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">write_to_file</span>(<span class="params">filename, text</span>):</span></span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(filename, <span class="string">&#x27;w&#x27;</span>, encoding=<span class="string">&#x27;utf-8&#x27;</span>) <span class="keyword">as</span> file:</span><br><span class="line">        file.write(text)</span><br></pre></td></tr></table></figure>


<h2 id="Path"><a href="#Path" class="headerlink" title="Path"></a>Path</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> os <span class="keyword">import</span> path, listdir</span><br><span class="line"><span class="keyword">from</span> glob <span class="keyword">import</span> glob</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;<span class="built_in">bool</span>&gt; = path.exists(<span class="string">&#x27;&lt;path&gt;&#x27;</span>)</span><br><span class="line">&lt;<span class="built_in">bool</span>&gt; = path.isfile(<span class="string">&#x27;&lt;path&gt;&#x27;</span>)</span><br><span class="line">&lt;<span class="built_in">bool</span>&gt; = path.isdir(<span class="string">&#x27;&lt;path&gt;&#x27;</span>)</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;<span class="built_in">list</span>&gt; = listdir(<span class="string">&#x27;&lt;path&gt;&#x27;</span>)         <span class="comment"># List of filenames located at &#x27;path&#x27;. </span></span><br><span class="line">&lt;<span class="built_in">list</span>&gt; = glob(<span class="string">&#x27;&lt;pattern&gt;&#x27;</span>)         <span class="comment"># Filenames matching the wildcard pattern.</span></span><br></pre></td></tr></table></figure>

<h3 id="Pathlib"><a href="#Pathlib" class="headerlink" title="Pathlib"></a>Pathlib</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pathlib <span class="keyword">import</span> Path</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cwd    = Path()</span><br><span class="line">&lt;Path&gt; = Path(<span class="string">&#x27;&lt;path&gt;&#x27;</span> [, <span class="string">&#x27;&lt;path&gt;&#x27;</span>, &lt;Path&gt;, ...])</span><br><span class="line">&lt;Path&gt; = &lt;Path&gt; / <span class="string">&#x27;&lt;dir&gt;&#x27;</span> / <span class="string">&#x27;&lt;file&gt;&#x27;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;<span class="built_in">bool</span>&gt; = &lt;Path&gt;.exists()</span><br><span class="line">&lt;<span class="built_in">bool</span>&gt; = &lt;Path&gt;.is_file()</span><br><span class="line">&lt;<span class="built_in">bool</span>&gt; = &lt;Path&gt;.is_dir()</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;<span class="built_in">iter</span>&gt; = &lt;Path&gt;.iterdir()          <span class="comment"># Iterator of filenames located at path.</span></span><br><span class="line">&lt;<span class="built_in">iter</span>&gt; = &lt;Path&gt;.glob(<span class="string">&#x27;&lt;pattern&gt;&#x27;</span>)  <span class="comment"># Filenames matching the wildcard pattern.</span></span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;<span class="built_in">str</span>&gt;  = <span class="built_in">str</span>(&lt;Path&gt;)               <span class="comment"># Returns path as a string.</span></span><br><span class="line">&lt;tup.&gt; = &lt;Path&gt;.parts              <span class="comment"># Returns all components as strings.</span></span><br><span class="line">&lt;Path&gt; = &lt;Path&gt;.resolve()          <span class="comment"># Returns absolute Path without symlinks.</span></span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;<span class="built_in">str</span>&gt;  = &lt;Path&gt;.name               <span class="comment"># Final component.</span></span><br><span class="line">&lt;<span class="built_in">str</span>&gt;  = &lt;Path&gt;.stem               <span class="comment"># Final component without extension.</span></span><br><span class="line">&lt;<span class="built_in">str</span>&gt;  = &lt;Path&gt;.suffix             <span class="comment"># Final component&#x27;s extension.</span></span><br><span class="line">&lt;Path&gt; = &lt;Path&gt;.parent             <span class="comment"># Path without final component.</span></span><br></pre></td></tr></table></figure>


<h2 id="Command-Execution"><a href="#Command-Execution" class="headerlink" title="Command Execution"></a>Command Execution</h2><h3 id="Files-and-Directories-Commands"><a href="#Files-and-Directories-Commands" class="headerlink" title="Files and Directories Commands"></a>Files and Directories Commands</h3><ul>
<li><strong>Paths can be either strings or Path objects.</strong></li>
<li><strong>All exceptions are either ‘OSError’ or its subclasses.</strong></li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line">os.chdir(&lt;path&gt;)                  <span class="comment"># Changes the current working directory.</span></span><br><span class="line">&lt;<span class="built_in">str</span>&gt; = os.getcwd()               <span class="comment"># Returns current working directory.</span></span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">os.remove(&lt;path&gt;)                 <span class="comment"># Deletes the file.</span></span><br><span class="line">os.rmdir(&lt;path&gt;)                  <span class="comment"># Deletes empty directory.</span></span><br><span class="line">shutil.rmtree(&lt;path&gt;)             <span class="comment"># Deletes an entire directory tree.</span></span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">os.rename(<span class="keyword">from</span>, to)               <span class="comment"># Renames the file or directory.</span></span><br><span class="line">os.replace(<span class="keyword">from</span>, to)              <span class="comment"># Same, but overwrites &#x27;to&#x27; if it exists.</span></span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">os.mkdir(&lt;path&gt;, mode=<span class="number">0o777</span>)      <span class="comment"># Creates a directory.</span></span><br><span class="line">&lt;<span class="built_in">iter</span>&gt; = os.scandir(path=<span class="string">&#x27;.&#x27;</span>)     <span class="comment"># Returns os.DirEntry objects located at path.</span></span><br></pre></td></tr></table></figure>

<h4 id="DirEntry"><a href="#DirEntry" class="headerlink" title="DirEntry:"></a>DirEntry:</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;<span class="built_in">str</span>&gt;  = &lt;DirEntry&gt;.name          <span class="comment"># Final component of the path.</span></span><br><span class="line">&lt;<span class="built_in">str</span>&gt;  = &lt;DirEntry&gt;.path          <span class="comment"># Path with final component.</span></span><br><span class="line">&lt;Path&gt; = Path(&lt;DirEntry&gt;)         <span class="comment"># Path object.</span></span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;<span class="built_in">bool</span>&gt; = &lt;DirEntry&gt;.is_file()</span><br><span class="line">&lt;<span class="built_in">bool</span>&gt; = &lt;DirEntry&gt;.is_dir()</span><br><span class="line">&lt;<span class="built_in">bool</span>&gt; = &lt;DirEntry&gt;.is_symlink()</span><br></pre></td></tr></table></figure>

<h3 id="Shell-Commands"><a href="#Shell-Commands" class="headerlink" title="Shell Commands"></a>Shell Commands</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line">&lt;<span class="built_in">str</span>&gt; = os.popen(<span class="string">&#x27;&lt;shell_command&gt;&#x27;</span>).read()</span><br></pre></td></tr></table></figure>

<h4 id="Using-subprocess"><a href="#Using-subprocess" class="headerlink" title="Using subprocess:"></a>Using subprocess:</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">import</span> subprocess, shlex</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>a = subprocess.run(shlex.split(<span class="string">&#x27;ls -a&#x27;</span>), stdout=subprocess.PIPE)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>a.stdout</span><br><span class="line"><span class="string">b&#x27;.\n..\nfile1.txt\nfile2.txt\n&#x27;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>a.returncode</span><br><span class="line"><span class="number">0</span></span><br></pre></td></tr></table></figure>


<h2 id="CSV"><a href="#CSV" class="headerlink" title="CSV"></a>CSV</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> csv</span><br><span class="line">&lt;reader&gt; = csv.reader(&lt;file&gt;, dialect=<span class="string">&#x27;excel&#x27;</span>, delimiter=<span class="string">&#x27;,&#x27;</span>)</span><br><span class="line">&lt;<span class="built_in">list</span>&gt;   = <span class="built_in">next</span>(&lt;reader&gt;)  <span class="comment"># Returns a row as list of strings.</span></span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;writer&gt; = csv.writer(&lt;file&gt;, dialect=<span class="string">&#x27;excel&#x27;</span>, delimiter=<span class="string">&#x27;,&#x27;</span>)</span><br><span class="line">&lt;writer&gt;.writerow(&lt;collection&gt;)</span><br><span class="line">&lt;writer&gt;.writerows(&lt;coll_of_coll&gt;)</span><br></pre></td></tr></table></figure>

<h3 id="Parameters"><a href="#Parameters" class="headerlink" title="Parameters"></a>Parameters</h3><ul>
<li><strong><code>&#39;dialect&#39;</code> - Master parameter that sets the default values.</strong></li>
<li><strong><code>&#39;delimiter&#39;</code> - A one-character string used to separate fields.</strong></li>
<li><strong><code>&#39;quotechar&#39;</code> - Character for quoting fields that contain special characters.</strong></li>
<li><strong><code>&#39;doublequote&#39;</code> - Whether quotechars inside fields get doubled or escaped.</strong></li>
<li><strong><code>&#39;skipinitialspace&#39;</code> - Whether whitespace after delimiter gets stripped.</strong></li>
<li><strong><code>&#39;lineterminator&#39;</code> - How does writer terminate lines.</strong></li>
<li><strong><code>&#39;quoting&#39;</code> - Controls the amount of quoting: 0 - as necessary, 1 - all.</strong></li>
<li><strong><code>&#39;escapechar&#39;</code> - Character for escaping quotechar if doublequote is false.</strong></li>
</ul>
<h3 id="Dialects"><a href="#Dialects" class="headerlink" title="Dialects"></a>Dialects</h3><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">+------------------+-----------+-----------+--------------+</span><br><span class="line">|                  |   excel   | excel_tab | unix_dialect |</span><br><span class="line">+------------------+-----------+-----------+--------------+</span><br><span class="line">| delimiter        |      &#x27;,&#x27;  |     &#x27;\t&#x27;  |       &#x27;,&#x27;    |</span><br><span class="line">| quotechar        |      &#x27;&quot;&#x27;  |      &#x27;&quot;&#x27;  |       &#x27;&quot;&#x27;    |</span><br><span class="line">| doublequote      |     True  |     True  |      True    |</span><br><span class="line">| skipinitialspace |    False  |    False  |     False    |</span><br><span class="line">| lineterminator   |   &#x27;\r\n&#x27;  |   &#x27;\r\n&#x27;  |      &#x27;\n&#x27;    |</span><br><span class="line">| quoting          |        0  |        0  |         1    |</span><br><span class="line">| escapechar       |     None  |     None  |      None    |</span><br><span class="line">+------------------+-----------+-----------+--------------+</span><br></pre></td></tr></table></figure>

<h3 id="Read-Rows-from-CSV-File"><a href="#Read-Rows-from-CSV-File" class="headerlink" title="Read Rows from CSV File"></a>Read Rows from CSV File</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">read_csv_file</span>(<span class="params">filename</span>):</span></span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(filename, encoding=<span class="string">&#x27;utf-8&#x27;</span>, newline=<span class="string">&#x27;&#x27;</span>) <span class="keyword">as</span> file:</span><br><span class="line">        <span class="keyword">return</span> csv.reader(file)</span><br></pre></td></tr></table></figure>
<ul>
<li><strong>If <code>&#39;newline=&quot;&quot;&#39;</code> is not specified, then newlines embedded inside quoted fields will not be interpreted correctly.</strong></li>
</ul>
<h3 id="Write-Rows-to-CSV-File"><a href="#Write-Rows-to-CSV-File" class="headerlink" title="Write Rows to CSV File"></a>Write Rows to CSV File</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">write_to_csv_file</span>(<span class="params">filename, rows</span>):</span></span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(filename, <span class="string">&#x27;w&#x27;</span>, encoding=<span class="string">&#x27;utf-8&#x27;</span>, newline=<span class="string">&#x27;&#x27;</span>) <span class="keyword">as</span> file:</span><br><span class="line">        writer = csv.writer(file)</span><br><span class="line">        writer.writerows(rows)</span><br></pre></td></tr></table></figure>


<h2 id="JSON"><a href="#JSON" class="headerlink" title="JSON"></a>JSON</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> json</span><br><span class="line">&lt;<span class="built_in">str</span>&gt;    = json.dumps(&lt;<span class="built_in">object</span>&gt;, ensure_ascii=<span class="literal">True</span>, indent=<span class="literal">None</span>)</span><br><span class="line">&lt;<span class="built_in">object</span>&gt; = json.loads(&lt;<span class="built_in">str</span>&gt;)</span><br></pre></td></tr></table></figure>

<h3 id="Read-Object-from-JSON-File"><a href="#Read-Object-from-JSON-File" class="headerlink" title="Read Object from JSON File"></a>Read Object from JSON File</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">read_json_file</span>(<span class="params">filename</span>):</span></span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(filename, encoding=<span class="string">&#x27;utf-8&#x27;</span>) <span class="keyword">as</span> file:</span><br><span class="line">        <span class="keyword">return</span> json.load(file)</span><br></pre></td></tr></table></figure>

<h3 id="Write-Object-to-JSON-File"><a href="#Write-Object-to-JSON-File" class="headerlink" title="Write Object to JSON File"></a>Write Object to JSON File</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">write_to_json_file</span>(<span class="params">filename, an_object</span>):</span></span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(filename, <span class="string">&#x27;w&#x27;</span>, encoding=<span class="string">&#x27;utf-8&#x27;</span>) <span class="keyword">as</span> file:</span><br><span class="line">        json.dump(an_object, file, ensure_ascii=<span class="literal">False</span>, indent=<span class="number">2</span>)</span><br></pre></td></tr></table></figure>


<h2 id="Pickle"><a href="#Pickle" class="headerlink" title="Pickle"></a>Pickle</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pickle</span><br><span class="line">&lt;<span class="built_in">bytes</span>&gt;  = pickle.dumps(&lt;<span class="built_in">object</span>&gt;)</span><br><span class="line">&lt;<span class="built_in">object</span>&gt; = pickle.loads(&lt;<span class="built_in">bytes</span>&gt;)</span><br></pre></td></tr></table></figure>

<h3 id="Read-Object-from-File"><a href="#Read-Object-from-File" class="headerlink" title="Read Object from File"></a>Read Object from File</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">read_pickle_file</span>(<span class="params">filename</span>):</span></span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(filename, <span class="string">&#x27;rb&#x27;</span>) <span class="keyword">as</span> file:</span><br><span class="line">        <span class="keyword">return</span> pickle.load(file)</span><br></pre></td></tr></table></figure>

<h3 id="Write-Object-to-File"><a href="#Write-Object-to-File" class="headerlink" title="Write Object to File"></a>Write Object to File</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">write_to_pickle_file</span>(<span class="params">filename, an_object</span>):</span></span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(filename, <span class="string">&#x27;wb&#x27;</span>) <span class="keyword">as</span> file:</span><br><span class="line">        pickle.dump(an_object, file)</span><br></pre></td></tr></table></figure>


<h2 id="SQLite"><a href="#SQLite" class="headerlink" title="SQLite"></a>SQLite</h2><p><strong>Server-less database engine that stores each database into separate file.</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> sqlite3</span><br><span class="line">db = sqlite3.connect(<span class="string">&#x27;&lt;path&gt;&#x27;</span>)                <span class="comment"># Also &#x27;:memory:&#x27;.</span></span><br><span class="line">...</span><br><span class="line">db.close()</span><br></pre></td></tr></table></figure>
<ul>
<li><strong>New database will be created if path doesn’t exist.</strong></li>
</ul>
<h3 id="Read"><a href="#Read" class="headerlink" title="Read"></a>Read</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">cursor = db.execute(<span class="string">&#x27;&lt;query&gt;&#x27;</span>)</span><br><span class="line"><span class="keyword">if</span> cursor:</span><br><span class="line">    &lt;<span class="built_in">tuple</span>&gt; = cursor.fetchone()               <span class="comment"># First row.</span></span><br><span class="line">    &lt;<span class="built_in">list</span>&gt;  = cursor.fetchall()               <span class="comment"># Remaining rows.</span></span><br></pre></td></tr></table></figure>
<ul>
<li><strong>Returned values can be of type str, int, float, bytes or None.</strong></li>
</ul>
<h3 id="Write"><a href="#Write" class="headerlink" title="Write"></a>Write</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">db.execute(<span class="string">&#x27;&lt;query&gt;&#x27;</span>)</span><br><span class="line">db.commit()</span><br></pre></td></tr></table></figure>

<h3 id="Placeholders"><a href="#Placeholders" class="headerlink" title="Placeholders"></a>Placeholders</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">db.execute(<span class="string">&#x27;&lt;query&gt;&#x27;</span>, &lt;<span class="built_in">list</span>/<span class="built_in">tuple</span>&gt;)           <span class="comment"># Replaces &#x27;?&#x27;s in query with values.</span></span><br><span class="line">db.execute(<span class="string">&#x27;&lt;query&gt;&#x27;</span>, &lt;<span class="built_in">dict</span>/namedtuple&gt;)      <span class="comment"># Replaces &#x27;:&lt;key&gt;&#x27;s with values.</span></span><br><span class="line">db.executemany(<span class="string">&#x27;&lt;query&gt;&#x27;</span>, &lt;coll_of_above&gt;)    <span class="comment"># Runs execute() many times.</span></span><br></pre></td></tr></table></figure>
<ul>
<li><strong>Passed values can be of type str, int, float, bytes, None, bool, datetime.date or datetime.datetme.</strong></li>
</ul>
<h3 id="MySQL"><a href="#MySQL" class="headerlink" title="MySQL"></a>MySQL</h3><p><strong>Has a very similar interface, with differences listed below.</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># $ pip3 install mysql-connector</span></span><br><span class="line"><span class="keyword">from</span> mysql <span class="keyword">import</span> connector</span><br><span class="line">db = connector.connect(host=&lt;<span class="built_in">str</span>&gt;, user=&lt;<span class="built_in">str</span>&gt;, password=&lt;<span class="built_in">str</span>&gt;, database=&lt;<span class="built_in">str</span>&gt;)</span><br><span class="line">cursor = db.cursor()</span><br><span class="line">cursor.execute(<span class="string">&#x27;&lt;query&gt;&#x27;</span>)                     <span class="comment"># Connector doesn&#x27;t have execute method.</span></span><br><span class="line">cursor.execute(<span class="string">&#x27;&lt;query&gt;&#x27;</span>, &lt;<span class="built_in">list</span>/<span class="built_in">tuple</span>&gt;)       <span class="comment"># Replaces &#x27;%s&#x27;s in query with values.</span></span><br><span class="line">cursor.execute(<span class="string">&#x27;&lt;query&gt;&#x27;</span>, &lt;<span class="built_in">dict</span>/namedtuple&gt;)  <span class="comment"># Replaces &#x27;%(&lt;key&gt;)s&#x27;s with values.</span></span><br></pre></td></tr></table></figure>


<h2 id="Bytes"><a href="#Bytes" class="headerlink" title="Bytes"></a>Bytes</h2><p><strong>Bytes object is an immutable sequence of single bytes. Mutable version is called ‘bytearray’.</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;<span class="built_in">bytes</span>&gt; = <span class="string">b&#x27;&lt;str&gt;&#x27;</span>                       <span class="comment"># Only accepts ASCII characters and \x00 - \xff.</span></span><br><span class="line">&lt;<span class="built_in">int</span>&gt;   = &lt;<span class="built_in">bytes</span>&gt;[&lt;index&gt;]               <span class="comment"># Returns int in range from 0 to 255.</span></span><br><span class="line">&lt;<span class="built_in">bytes</span>&gt; = &lt;<span class="built_in">bytes</span>&gt;[&lt;<span class="built_in">slice</span>&gt;]               <span class="comment"># Returns bytes even if it has only one element.</span></span><br><span class="line">&lt;<span class="built_in">bytes</span>&gt; = &lt;<span class="built_in">bytes</span>&gt;.join(&lt;coll_of_bytes&gt;)  <span class="comment"># Joins elements using bytes object as separator. </span></span><br></pre></td></tr></table></figure>

<h3 id="Encode-1"><a href="#Encode-1" class="headerlink" title="Encode"></a>Encode</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;<span class="built_in">bytes</span>&gt; = &lt;<span class="built_in">str</span>&gt;.encode(<span class="string">&#x27;utf-8&#x27;</span>)          <span class="comment"># Or: bytes(&lt;str&gt;, &#x27;utf-8&#x27;)</span></span><br><span class="line">&lt;<span class="built_in">bytes</span>&gt; = <span class="built_in">bytes</span>(&lt;coll_of_ints&gt;)          <span class="comment"># Ints must be in range from 0 to 255.</span></span><br><span class="line">&lt;<span class="built_in">bytes</span>&gt; = &lt;<span class="built_in">int</span>&gt;.to_bytes(&lt;length&gt;, byteorder=<span class="string">&#x27;big|little&#x27;</span>, signed=<span class="literal">False</span>)</span><br><span class="line">&lt;<span class="built_in">bytes</span>&gt; = <span class="built_in">bytes</span>.fromhex(<span class="string">&#x27;&lt;hex&gt;&#x27;</span>)</span><br></pre></td></tr></table></figure>

<h3 id="Decode-1"><a href="#Decode-1" class="headerlink" title="Decode"></a>Decode</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;<span class="built_in">str</span>&gt;   = &lt;<span class="built_in">bytes</span>&gt;.decode(<span class="string">&#x27;utf-8&#x27;</span>)        <span class="comment"># Or: str(&lt;bytes&gt;, &#x27;utf-8&#x27;)</span></span><br><span class="line">&lt;<span class="built_in">list</span>&gt;  = <span class="built_in">list</span>(&lt;<span class="built_in">bytes</span>&gt;)                  <span class="comment"># Returns ints in range from 0 to 255.</span></span><br><span class="line">&lt;<span class="built_in">int</span>&gt;   = <span class="built_in">int</span>.from_bytes(&lt;<span class="built_in">bytes</span>&gt;, byteorder=<span class="string">&#x27;big|little&#x27;</span>, signed=<span class="literal">False</span>)</span><br><span class="line"><span class="string">&#x27;&lt;hex&gt;&#x27;</span> = &lt;<span class="built_in">bytes</span>&gt;.<span class="built_in">hex</span>()</span><br></pre></td></tr></table></figure>

<h3 id="Read-Bytes-from-File"><a href="#Read-Bytes-from-File" class="headerlink" title="Read Bytes from File"></a>Read Bytes from File</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">read_bytes</span>(<span class="params">filename</span>):</span></span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(filename, <span class="string">&#x27;rb&#x27;</span>) <span class="keyword">as</span> file:</span><br><span class="line">        <span class="keyword">return</span> file.read()</span><br></pre></td></tr></table></figure>

<h3 id="Write-Bytes-to-File"><a href="#Write-Bytes-to-File" class="headerlink" title="Write Bytes to File"></a>Write Bytes to File</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">write_bytes</span>(<span class="params">filename, bytes_obj</span>):</span></span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(filename, <span class="string">&#x27;wb&#x27;</span>) <span class="keyword">as</span> file:</span><br><span class="line">        file.write(bytes_obj)</span><br></pre></td></tr></table></figure>


<h2 id="Struct"><a href="#Struct" class="headerlink" title="Struct"></a>Struct</h2><ul>
<li><strong>Module that performs conversions between a sequence of numbers and a C struct, represented as a Python bytes object.</strong></li>
<li><strong>Machine’s native type sizes and byte order are used by default.</strong></li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> struct <span class="keyword">import</span> pack, unpack, iter_unpack, calcsize</span><br><span class="line">&lt;<span class="built_in">bytes</span>&gt;  = pack(<span class="string">&#x27;&lt;format&gt;&#x27;</span>, &lt;num_1&gt; [, &lt;num_2&gt;, ...])</span><br><span class="line">&lt;<span class="built_in">tuple</span>&gt;  = unpack(<span class="string">&#x27;&lt;format&gt;&#x27;</span>, &lt;<span class="built_in">bytes</span>&gt;)</span><br><span class="line">&lt;tuples&gt; = iter_unpack(<span class="string">&#x27;&lt;format&gt;&#x27;</span>, &lt;<span class="built_in">bytes</span>&gt;)</span><br></pre></td></tr></table></figure>

<h3 id="Example"><a href="#Example" class="headerlink" title="Example"></a>Example</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>pack(<span class="string">&#x27;&gt;hhl&#x27;</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>)</span><br><span class="line"><span class="string">b&#x27;\x00\x01\x00\x02\x00\x00\x00\x03&#x27;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>unpack(<span class="string">&#x27;&gt;hhl&#x27;</span>, <span class="string">b&#x27;\x00\x01\x00\x02\x00\x00\x00\x03&#x27;</span>)</span><br><span class="line">(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>calcsize(<span class="string">&#x27;&gt;hhl&#x27;</span>)</span><br><span class="line"><span class="number">8</span></span><br></pre></td></tr></table></figure>

<h3 id="Format-2"><a href="#Format-2" class="headerlink" title="Format"></a>Format</h3><h4 id="For-standard-sizes-start-format-string-with"><a href="#For-standard-sizes-start-format-string-with" class="headerlink" title="For standard sizes start format string with:"></a>For standard sizes start format string with:</h4><ul>
<li><strong><code>&#39;=&#39;</code> - native byte order</strong></li>
<li><strong><code>&#39;&lt;&#39;</code> - little-endian</strong></li>
<li><strong><code>&#39;&gt;&#39;</code> - big-endian</strong></li>
</ul>
<h4 id="Integer-types-Use-capital-letter-for-unsigned-type-Standard-sizes-are-in-brackets"><a href="#Integer-types-Use-capital-letter-for-unsigned-type-Standard-sizes-are-in-brackets" class="headerlink" title="Integer types. Use capital letter for unsigned type. Standard sizes are in brackets:"></a>Integer types. Use capital letter for unsigned type. Standard sizes are in brackets:</h4><ul>
<li><strong><code>&#39;x&#39;</code> - pad byte</strong></li>
<li><strong><code>&#39;b&#39;</code> - char (1)</strong></li>
<li><strong><code>&#39;h&#39;</code> - short (2)</strong></li>
<li><strong><code>&#39;i&#39;</code> - int (4)</strong></li>
<li><strong><code>&#39;l&#39;</code> - long (4)</strong></li>
<li><strong><code>&#39;q&#39;</code> - long long (8)</strong></li>
</ul>
<h4 id="Floating-point-types"><a href="#Floating-point-types" class="headerlink" title="Floating point types:"></a>Floating point types:</h4><ul>
<li><strong><code>&#39;f&#39;</code> - float (4)</strong></li>
<li><strong><code>&#39;d&#39;</code> - double (8)</strong></li>
</ul>
<h2 id="Array"><a href="#Array" class="headerlink" title="Array"></a>Array</h2><p><strong>List that can only hold numbers of predefined type. Available types and their sizes in bytes are listed above.</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> array <span class="keyword">import</span> array</span><br><span class="line">&lt;array&gt; = array(<span class="string">&#x27;&lt;typecode&gt;&#x27;</span> [, &lt;collection&gt;])</span><br></pre></td></tr></table></figure>


<h2 id="Memory-View"><a href="#Memory-View" class="headerlink" title="Memory View"></a>Memory View</h2><p><strong>Used for accessing the internal data of an object that supports the buffer protocol.</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;<span class="built_in">memoryview</span>&gt; = <span class="built_in">memoryview</span>(&lt;<span class="built_in">bytes</span>&gt; / &lt;<span class="built_in">bytearray</span>&gt; / &lt;array&gt;)</span><br><span class="line">&lt;<span class="built_in">memoryview</span>&gt;.release()</span><br></pre></td></tr></table></figure>


<h2 id="Deque"><a href="#Deque" class="headerlink" title="Deque"></a>Deque</h2><p><strong>A thread-safe list with efficient appends and pops from either side. Pronounced “deck”.</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> collections <span class="keyword">import</span> deque</span><br><span class="line">&lt;deque&gt; = deque(&lt;collection&gt;, maxlen=<span class="literal">None</span>)</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;deque&gt;.appendleft(&lt;el&gt;)</span><br><span class="line">&lt;el&gt; = &lt;deque&gt;.popleft()</span><br><span class="line">&lt;deque&gt;.extendleft(&lt;collection&gt;)            <span class="comment"># Collection gets reversed.</span></span><br><span class="line">&lt;deque&gt;.rotate(n=<span class="number">1</span>)                         <span class="comment"># Rotates elements to the right.</span></span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>a = deque([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>], maxlen=<span class="number">3</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>a.append(<span class="number">4</span>)</span><br><span class="line">[<span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>a.appendleft(<span class="number">5</span>)</span><br><span class="line">[<span class="number">5</span>, <span class="number">2</span>, <span class="number">3</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>a.insert(<span class="number">1</span>, <span class="number">6</span>)</span><br><span class="line">IndexError: deque already at its maximum size</span><br></pre></td></tr></table></figure>


<h2 id="Threading"><a href="#Threading" class="headerlink" title="Threading"></a>Threading</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> threading <span class="keyword">import</span> Thread, RLock</span><br></pre></td></tr></table></figure>

<h3 id="Thread"><a href="#Thread" class="headerlink" title="Thread"></a>Thread</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">thread = Thread(target=&lt;function&gt;, args=(&lt;first_arg&gt;, ))</span><br><span class="line">thread.start()</span><br><span class="line">...</span><br><span class="line">thread.join()</span><br></pre></td></tr></table></figure>

<h3 id="Lock"><a href="#Lock" class="headerlink" title="Lock"></a>Lock</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">lock = RLock()</span><br><span class="line">lock.acquire()</span><br><span class="line">...</span><br><span class="line">lock.release()</span><br></pre></td></tr></table></figure>

<h4 id="Or"><a href="#Or" class="headerlink" title="Or:"></a>Or:</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">lock = RLock()</span><br><span class="line"><span class="keyword">with</span> lock:</span><br><span class="line">    ...</span><br></pre></td></tr></table></figure>


<h2 id="Introspection"><a href="#Introspection" class="headerlink" title="Introspection"></a>Introspection</h2><p><strong>Inspecting code at runtime.</strong></p>
<h3 id="Variables"><a href="#Variables" class="headerlink" title="Variables"></a>Variables</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;<span class="built_in">list</span>&gt; = <span class="built_in">dir</span>()      <span class="comment"># Names of variables in current scope.</span></span><br><span class="line">&lt;<span class="built_in">dict</span>&gt; = <span class="built_in">locals</span>()   <span class="comment"># Dict of local variables. Also vars().</span></span><br><span class="line">&lt;<span class="built_in">dict</span>&gt; = <span class="built_in">globals</span>()  <span class="comment"># Dict of global variables.</span></span><br></pre></td></tr></table></figure>

<h3 id="Attributes-1"><a href="#Attributes-1" class="headerlink" title="Attributes"></a>Attributes</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;<span class="built_in">dict</span>&gt; = <span class="built_in">vars</span>(&lt;<span class="built_in">object</span>&gt;)</span><br><span class="line">&lt;<span class="built_in">bool</span>&gt; = <span class="built_in">hasattr</span>(&lt;<span class="built_in">object</span>&gt;, <span class="string">&#x27;&lt;attr_name&gt;&#x27;</span>)</span><br><span class="line">value  = <span class="built_in">getattr</span>(&lt;<span class="built_in">object</span>&gt;, <span class="string">&#x27;&lt;attr_name&gt;&#x27;</span>)</span><br><span class="line"><span class="built_in">setattr</span>(&lt;<span class="built_in">object</span>&gt;, <span class="string">&#x27;&lt;attr_name&gt;&#x27;</span>, value)</span><br></pre></td></tr></table></figure>

<h3 id="Parameters-1"><a href="#Parameters-1" class="headerlink" title="Parameters"></a>Parameters</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> inspect <span class="keyword">import</span> signature</span><br><span class="line">&lt;sig&gt;        = signature(&lt;function&gt;)</span><br><span class="line">no_of_params = <span class="built_in">len</span>(&lt;sig&gt;.parameters)</span><br><span class="line">param_names  = <span class="built_in">list</span>(&lt;sig&gt;.parameters.keys())</span><br></pre></td></tr></table></figure>


<h2 id="Metaprograming"><a href="#Metaprograming" class="headerlink" title="Metaprograming"></a>Metaprograming</h2><p><strong>Code that generates code.</strong></p>
<h3 id="Type-1"><a href="#Type-1" class="headerlink" title="Type"></a>Type</h3><p><strong>Type is the root class. If only passed an object it returns its type (class). Otherwise it creates a new class.</strong></p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;class&gt; = type(&lt;class_name&gt;, &lt;parents_tuple&gt;, &lt;attributes_dict&gt;)</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>Z = <span class="built_in">type</span>(<span class="string">&#x27;Z&#x27;</span>, (), &#123;<span class="string">&#x27;a&#x27;</span>: <span class="string">&#x27;abcde&#x27;</span>, <span class="string">&#x27;b&#x27;</span>: <span class="number">12345</span>&#125;)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>z = Z()</span><br></pre></td></tr></table></figure>

<h3 id="Meta-Class"><a href="#Meta-Class" class="headerlink" title="Meta Class"></a>Meta Class</h3><p><strong>Class that creates class.</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">my_meta_class</span>(<span class="params">name, parents, attrs</span>):</span></span><br><span class="line">    attrs[<span class="string">&#x27;a&#x27;</span>] = <span class="string">&#x27;abcde&#x27;</span></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">type</span>(name, parents, attrs)</span><br></pre></td></tr></table></figure>

<h4 id="Or-1"><a href="#Or-1" class="headerlink" title="Or:"></a>Or:</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyMetaClass</span>(<span class="params"><span class="built_in">type</span></span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__new__</span>(<span class="params">cls, name, parents, attrs</span>):</span></span><br><span class="line">        attrs[<span class="string">&#x27;a&#x27;</span>] = <span class="string">&#x27;abcde&#x27;</span></span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">type</span>.__new__(cls, name, parents, attrs)</span><br></pre></td></tr></table></figure>
<ul>
<li><strong>New() is a class method that gets called before init(). If it returns an instance of its class, then that instance gets passed to init() as a ‘self’ argument.</strong></li>
<li><strong>It receives the same arguments as init(), except for the first one that specifies the desired class of returned instance (</strong><code>&#39;MyMetaClass&#39;</code> <strong>in our case).</strong></li>
<li><strong>New() can also be called directly, usually from a new() method of a child class (</strong><code>def __new__(cls): return super().__new__(cls)</code><strong>), in which case init() is not called.</strong></li>
</ul>
<h3 id="Metaclass-Attribute"><a href="#Metaclass-Attribute" class="headerlink" title="Metaclass Attribute"></a>Metaclass Attribute</h3><p><strong>Right before a class is created it checks if it has metaclass defined. If not, it recursively checks if any of his parents has it defined and eventually comes to type().</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyClass</span>(<span class="params">metaclass=MyMetaClass</span>):</span></span><br><span class="line">    b = <span class="number">12345</span></span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>MyClass.a, MyClass.b</span><br><span class="line">(<span class="string">&#x27;abcde&#x27;</span>, <span class="number">12345</span>)</span><br></pre></td></tr></table></figure>

<h3 id="Type-Diagram"><a href="#Type-Diagram" class="headerlink" title="Type Diagram"></a>Type Diagram</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">type</span>(MyClass)     == MyMetaClass  <span class="comment"># MyClass is an instance of MyMetaClass.</span></span><br><span class="line"><span class="built_in">type</span>(MyMetaClass) == <span class="built_in">type</span>         <span class="comment"># MyMetaClass is an instance of type.</span></span><br></pre></td></tr></table></figure>

<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">+---------+-------------+</span><br><span class="line">| Classes | Metaclasses |</span><br><span class="line">+---------+-------------|</span><br><span class="line">| MyClass &gt; MyMetaClass |</span><br><span class="line">|         |     v       |</span><br><span class="line">|  object ---&gt; type &lt;+  |</span><br><span class="line">|         |    ^ +---+  |</span><br><span class="line">|   str -------+        |</span><br><span class="line">+---------+-------------+</span><br></pre></td></tr></table></figure>

<h3 id="Inheritance-Diagram"><a href="#Inheritance-Diagram" class="headerlink" title="Inheritance Diagram"></a>Inheritance Diagram</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">MyClass.__base__     == <span class="built_in">object</span>    <span class="comment"># MyClass is a subclass of object.</span></span><br><span class="line">MyMetaClass.__base__ == <span class="built_in">type</span>      <span class="comment"># MyMetaClass is a subclass of type.</span></span><br></pre></td></tr></table></figure>

<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">+---------+-------------+</span><br><span class="line">| Classes | Metaclasses |</span><br><span class="line">+---------+-------------|</span><br><span class="line">| MyClass | MyMetaClass |</span><br><span class="line">|    v    |     v       |</span><br><span class="line">|  object &lt;--- type     |</span><br><span class="line">|    ^    |             |</span><br><span class="line">|   str   |             |</span><br><span class="line">+---------+-------------+</span><br></pre></td></tr></table></figure>


<h2 id="Operator"><a href="#Operator" class="headerlink" title="Operator"></a>Operator</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> operator <span class="keyword">import</span> add, sub, mul, truediv, floordiv, mod, <span class="built_in">pow</span>, neg, <span class="built_in">abs</span></span><br><span class="line"><span class="keyword">from</span> operator <span class="keyword">import</span> eq, ne, lt, le, gt, ge</span><br><span class="line"><span class="keyword">from</span> operator <span class="keyword">import</span> and_, or_, not_</span><br><span class="line"><span class="keyword">from</span> operator <span class="keyword">import</span> itemgetter, attrgetter, methodcaller</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> operator <span class="keyword">as</span> op</span><br><span class="line">sorted_by_second = <span class="built_in">sorted</span>(&lt;collection&gt;, key=op.itemgetter(<span class="number">1</span>))</span><br><span class="line">sorted_by_both   = <span class="built_in">sorted</span>(&lt;collection&gt;, key=op.itemgetter(<span class="number">1</span>, <span class="number">0</span>))</span><br><span class="line">product_of_elems = functools.reduce(op.mul, &lt;collection&gt;)</span><br><span class="line">LogicOp          = enum.Enum(<span class="string">&#x27;LogicOp&#x27;</span>, &#123;<span class="string">&#x27;AND&#x27;</span>: op.and_, <span class="string">&#x27;OR&#x27;</span> : op.or_&#125;)</span><br><span class="line">last_el          = op.methodcaller(<span class="string">&#x27;pop&#x27;</span>)(&lt;<span class="built_in">list</span>&gt;)</span><br></pre></td></tr></table></figure>


<h2 id="Eval"><a href="#Eval" class="headerlink" title="Eval"></a>Eval</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> ast <span class="keyword">import</span> literal_eval</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>literal_eval(<span class="string">&#x27;1 + 2&#x27;</span>)</span><br><span class="line"><span class="number">3</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>literal_eval(<span class="string">&#x27;[1, 2, 3]&#x27;</span>)</span><br><span class="line">[<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>literal_eval(<span class="string">&#x27;abs(1)&#x27;</span>)</span><br><span class="line">ValueError: malformed node <span class="keyword">or</span> string</span><br></pre></td></tr></table></figure>


<h2 id="Coroutine"><a href="#Coroutine" class="headerlink" title="Coroutine"></a>Coroutine</h2><ul>
<li><strong>Similar to generator, but generator pulls data through the pipe with iteration, while coroutine pushes data into the pipeline with send().</strong></li>
<li><strong>Coroutines provide more powerful data routing possibilities than iterators.</strong></li>
<li><strong>If you build a collection of simple data processing components, you can glue them together into complex arrangements of pipes, branches, merging, etc.</strong></li>
</ul>
<h3 id="Helper-Decorator"><a href="#Helper-Decorator" class="headerlink" title="Helper Decorator"></a>Helper Decorator</h3><ul>
<li><strong>All coroutines must be “primed” by first calling next().</strong></li>
<li><strong>Remembering to call next() is easy to forget.</strong></li>
<li><strong>Solved by wrapping coroutines with a decorator:</strong></li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">coroutine</span>(<span class="params">func</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">out</span>(<span class="params">*args, **kwargs</span>):</span></span><br><span class="line">        cr = func(*args, **kwargs)</span><br><span class="line">        <span class="built_in">next</span>(cr)</span><br><span class="line">        <span class="keyword">return</span> cr</span><br><span class="line">    <span class="keyword">return</span> out</span><br></pre></td></tr></table></figure>

<h3 id="Pipeline-Example"><a href="#Pipeline-Example" class="headerlink" title="Pipeline Example"></a>Pipeline Example</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">reader</span>(<span class="params">target</span>):</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10</span>):</span><br><span class="line">        target.send(i)</span><br><span class="line">    target.close()</span><br><span class="line"></span><br><span class="line"><span class="meta">@coroutine</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">adder</span>(<span class="params">target</span>):</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        value = (<span class="keyword">yield</span>)</span><br><span class="line">        target.send(value + <span class="number">100</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">@coroutine</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">printer</span>():</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        value = (<span class="keyword">yield</span>)</span><br><span class="line">        <span class="built_in">print</span>(value)</span><br><span class="line"></span><br><span class="line">reader(adder(printer()))  <span class="comment"># 100, 101, ..., 109</span></span><br></pre></td></tr></table></figure>

<p><br><br></p>
<h1 id="Libraries"><a href="#Libraries" class="headerlink" title="Libraries"></a>Libraries</h1><h2 id="Progress-Bar"><a href="#Progress-Bar" class="headerlink" title="Progress Bar"></a>Progress Bar</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># $ pip3 install tqdm</span></span><br><span class="line"><span class="keyword">from</span> tqdm <span class="keyword">import</span> tqdm</span><br><span class="line"><span class="keyword">from</span> time <span class="keyword">import</span> sleep</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> tqdm([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]):</span><br><span class="line">    sleep(<span class="number">0.2</span>)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> tqdm(<span class="built_in">range</span>(<span class="number">100</span>)):</span><br><span class="line">    sleep(<span class="number">0.02</span>)</span><br></pre></td></tr></table></figure>


<h2 id="Plot"><a href="#Plot" class="headerlink" title="Plot"></a>Plot</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># $ pip3 install matplotlib</span></span><br><span class="line"><span class="keyword">from</span> matplotlib <span class="keyword">import</span> pyplot</span><br><span class="line">pyplot.plot(&lt;data_1&gt; [, &lt;data_2&gt;, ...])  <span class="comment"># Or: hist(&lt;data&gt;).</span></span><br><span class="line">pyplot.savefig(&lt;filename&gt;)</span><br><span class="line">pyplot.show()</span><br><span class="line">pyplot.clf()                             <span class="comment"># Clears figure.</span></span><br></pre></td></tr></table></figure>


<h2 id="Table"><a href="#Table" class="headerlink" title="Table"></a>Table</h2><h4 id="Prints-a-CSV-file-as-an-ASCII-table"><a href="#Prints-a-CSV-file-as-an-ASCII-table" class="headerlink" title="Prints a CSV file as an ASCII table:"></a>Prints a CSV file as an ASCII table:</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># $ pip3 install tabulate</span></span><br><span class="line"><span class="keyword">from</span> tabulate <span class="keyword">import</span> tabulate</span><br><span class="line"><span class="keyword">import</span> csv</span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(&lt;filename&gt;, encoding=<span class="string">&#x27;utf-8&#x27;</span>, newline=<span class="string">&#x27;&#x27;</span>) <span class="keyword">as</span> file:</span><br><span class="line">    lines   = csv.reader(file)</span><br><span class="line">    headers = [header.title() <span class="keyword">for</span> header <span class="keyword">in</span> <span class="built_in">next</span>(lines)]</span><br><span class="line">    table   = tabulate(lines, headers)</span><br><span class="line">    <span class="built_in">print</span>(table)</span><br></pre></td></tr></table></figure>


<h2 id="Curses"><a href="#Curses" class="headerlink" title="Curses"></a>Curses</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> curses <span class="keyword">import</span> wrapper, <span class="built_in">ascii</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span>():</span></span><br><span class="line">    wrapper(draw)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">draw</span>(<span class="params">screen</span>):</span></span><br><span class="line">    screen.clear()</span><br><span class="line">    screen.addstr(<span class="number">0</span>, <span class="number">0</span>, <span class="string">&#x27;Press ESC to quit.&#x27;</span>)</span><br><span class="line">    <span class="keyword">while</span> screen.getch() != <span class="built_in">ascii</span>.ESC:</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_border</span>(<span class="params">screen</span>):</span></span><br><span class="line">    <span class="keyword">from</span> collections <span class="keyword">import</span> namedtuple</span><br><span class="line">    P = namedtuple(<span class="string">&#x27;P&#x27;</span>, <span class="string">&#x27;y x&#x27;</span>)</span><br><span class="line">    height, width = screen.getmaxyx()</span><br><span class="line">    <span class="keyword">return</span> P(height-<span class="number">1</span>, width-<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure>


<h2 id="Logging"><a href="#Logging" class="headerlink" title="Logging"></a>Logging</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># $ pip3 install loguru</span></span><br><span class="line"><span class="keyword">from</span> loguru <span class="keyword">import</span> logger</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">logger.add(<span class="string">&#x27;debug_&#123;time&#125;.log&#x27;</span>, colorize=<span class="literal">True</span>)  <span class="comment"># Connects a log file.</span></span><br><span class="line">logger.add(<span class="string">&#x27;error_&#123;time&#125;.log&#x27;</span>, level=<span class="string">&#x27;ERROR&#x27;</span>)  <span class="comment"># Another file for errors or higher.</span></span><br><span class="line">logger.&lt;level&gt;(<span class="string">&#x27;A logging message.&#x27;</span>)</span><br></pre></td></tr></table></figure>
<ul>
<li><strong>Levels: <code>&#39;debug&#39;</code>, <code>&#39;info&#39;</code>, <code>&#39;success&#39;</code>, <code>&#39;warning&#39;</code>, <code>&#39;error&#39;</code>, <code>&#39;critical&#39;</code>.</strong></li>
</ul>
<h3 id="Exceptions-2"><a href="#Exceptions-2" class="headerlink" title="Exceptions"></a>Exceptions</h3><p><strong>Error description, stack trace and values of variables are appended automatically.</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    ...</span><br><span class="line"><span class="keyword">except</span> &lt;exception&gt;:</span><br><span class="line">    logger.exception(<span class="string">&#x27;An error happened.&#x27;</span>)</span><br></pre></td></tr></table></figure>

<h3 id="Rotation"><a href="#Rotation" class="headerlink" title="Rotation"></a>Rotation</h3><p><strong>Argument that sets a condition when a new log file is created.</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rotation=&lt;<span class="built_in">int</span>&gt;|&lt;datetime.timedelta&gt;|&lt;datetime.time&gt;|&lt;<span class="built_in">str</span>&gt;</span><br></pre></td></tr></table></figure>
<ul>
<li><strong><code>&#39;&lt;int&gt;&#39;</code> - Max file size in bytes.</strong></li>
<li><strong><code>&#39;&lt;timedelta&gt;&#39;</code> - Max age of a file.</strong></li>
<li><strong><code>&#39;&lt;time&gt;&#39;</code> - Time of day.</strong></li>
<li><strong><code>&#39;&lt;str&gt;&#39;</code> - Any of above as a string: <code>&#39;100 MB&#39;</code>, <code>&#39;1 month&#39;</code>, <code>&#39;monday at 12:00&#39;</code>, …</strong></li>
</ul>
<h3 id="Retention"><a href="#Retention" class="headerlink" title="Retention"></a>Retention</h3><p><strong>Sets a condition which old log files are deleted.</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">retention=&lt;<span class="built_in">int</span>&gt;|&lt;datetime.timedelta&gt;|&lt;<span class="built_in">str</span>&gt;</span><br></pre></td></tr></table></figure>
<ul>
<li><strong><code>&#39;&lt;int&gt;&#39;</code> - Max number of files.</strong></li>
<li><strong><code>&#39;&lt;timedelta&gt;&#39;</code> - Max age of a file.</strong></li>
<li><strong><code>&#39;&lt;str&gt;&#39;</code> - Max age as a string: <code>&#39;1 week, 3 days&#39;</code>, <code>&#39;2 months&#39;</code>, …</strong></li>
</ul>
<h2 id="Scraping"><a href="#Scraping" class="headerlink" title="Scraping"></a>Scraping</h2><h4 id="Scrapes-and-prints-Python’s-URL-and-version-number-from-Wikipedia"><a href="#Scrapes-and-prints-Python’s-URL-and-version-number-from-Wikipedia" class="headerlink" title="Scrapes and prints Python’s URL and version number from Wikipedia:"></a>Scrapes and prints Python’s URL and version number from Wikipedia:</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># $ pip3 install requests beautifulsoup4</span></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> bs4 <span class="keyword">import</span> BeautifulSoup</span><br><span class="line">url   = <span class="string">&#x27;https://en.wikipedia.org/wiki/Python_(programming_language)&#x27;</span></span><br><span class="line">page  = requests.get(url)</span><br><span class="line">doc   = BeautifulSoup(page.text, <span class="string">&#x27;html.parser&#x27;</span>)</span><br><span class="line">table = doc.find(<span class="string">&#x27;table&#x27;</span>, class_=<span class="string">&#x27;infobox vevent&#x27;</span>)</span><br><span class="line">rows  = table.find_all(<span class="string">&#x27;tr&#x27;</span>)</span><br><span class="line">link  = rows[<span class="number">11</span>].find(<span class="string">&#x27;a&#x27;</span>)[<span class="string">&#x27;href&#x27;</span>]</span><br><span class="line">ver   = rows[<span class="number">6</span>].find(<span class="string">&#x27;div&#x27;</span>).text.split()[<span class="number">0</span>]</span><br><span class="line"><span class="built_in">print</span>(link, ver)</span><br></pre></td></tr></table></figure>


<h2 id="Web"><a href="#Web" class="headerlink" title="Web"></a>Web</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># $ pip3 install bottle</span></span><br><span class="line"><span class="keyword">from</span> bottle <span class="keyword">import</span> run, route, post, template, request, response</span><br><span class="line"><span class="keyword">import</span> json</span><br></pre></td></tr></table></figure>

<h3 id="Run"><a href="#Run" class="headerlink" title="Run"></a>Run</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">run(host=<span class="string">&#x27;localhost&#x27;</span>, port=<span class="number">8080</span>)</span><br><span class="line">run(host=<span class="string">&#x27;0.0.0.0&#x27;</span>, port=<span class="number">80</span>, server=<span class="string">&#x27;cherrypy&#x27;</span>)</span><br></pre></td></tr></table></figure>

<h3 id="Static-Request"><a href="#Static-Request" class="headerlink" title="Static Request"></a>Static Request</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@route(<span class="params"><span class="string">&#x27;/img/&lt;image&gt;&#x27;</span></span>)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">send_image</span>(<span class="params">image</span>):</span></span><br><span class="line">    <span class="keyword">return</span> static_file(image, <span class="string">&#x27;images/&#x27;</span>, mimetype=<span class="string">&#x27;image/png&#x27;</span>)</span><br></pre></td></tr></table></figure>

<h3 id="Dynamic-Request"><a href="#Dynamic-Request" class="headerlink" title="Dynamic Request"></a>Dynamic Request</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@route(<span class="params"><span class="string">&#x27;/&lt;sport&gt;&#x27;</span></span>)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">send_page</span>(<span class="params">sport</span>):</span></span><br><span class="line">    <span class="keyword">return</span> template(<span class="string">&#x27;&lt;h1&gt;&#123;&#123;title&#125;&#125;&lt;/h1&gt;&#x27;</span>, title=sport)</span><br></pre></td></tr></table></figure>

<h3 id="REST-Request"><a href="#REST-Request" class="headerlink" title="REST Request"></a>REST Request</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@post(<span class="params"><span class="string">&#x27;/odds/&lt;sport&gt;&#x27;</span></span>)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">odds_handler</span>(<span class="params">sport</span>):</span></span><br><span class="line">    team = request.forms.get(<span class="string">&#x27;team&#x27;</span>)</span><br><span class="line">    home_odds, away_odds = <span class="number">2.44</span>, <span class="number">3.29</span></span><br><span class="line">    response.headers[<span class="string">&#x27;Content-Type&#x27;</span>] = <span class="string">&#x27;application/json&#x27;</span></span><br><span class="line">    response.headers[<span class="string">&#x27;Cache-Control&#x27;</span>] = <span class="string">&#x27;no-cache&#x27;</span></span><br><span class="line">    <span class="keyword">return</span> json.dumps([team, home_odds, away_odds])</span><br></pre></td></tr></table></figure>

<h4 id="Test"><a href="#Test" class="headerlink" title="Test:"></a>Test:</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># $ pip3 install requests</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">import</span> requests</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>url  = <span class="string">&#x27;http://localhost:8080/odds/football&#x27;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>data = &#123;<span class="string">&#x27;team&#x27;</span>: <span class="string">&#x27;arsenal f.c.&#x27;</span>&#125;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>response = requests.post(url, data=data)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>response.json()</span><br><span class="line">[<span class="string">&#x27;arsenal f.c.&#x27;</span>, <span class="number">2.44</span>, <span class="number">3.29</span>]</span><br></pre></td></tr></table></figure>


<h2 id="Profile"><a href="#Profile" class="headerlink" title="Profile"></a>Profile</h2><h3 id="Basic"><a href="#Basic" class="headerlink" title="Basic"></a>Basic</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> time <span class="keyword">import</span> time</span><br><span class="line">start_time = time()                  <span class="comment"># Seconds since Epoch.</span></span><br><span class="line">...</span><br><span class="line">duration = time() - start_time</span><br></pre></td></tr></table></figure>

<h3 id="High-Performance"><a href="#High-Performance" class="headerlink" title="High Performance"></a>High Performance</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> time <span class="keyword">import</span> perf_counter <span class="keyword">as</span> pc</span><br><span class="line">start_time = pc()                    <span class="comment"># Seconds since restart.</span></span><br><span class="line">...</span><br><span class="line">duration = pc() - start_time</span><br></pre></td></tr></table></figure>

<h3 id="Timing-a-Snippet"><a href="#Timing-a-Snippet" class="headerlink" title="Timing a Snippet"></a>Timing a Snippet</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> timeit <span class="keyword">import</span> timeit</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>timeit(<span class="string">&#x27;&quot;-&quot;.join(str(a) for a in range(100))&#x27;</span>,</span><br><span class="line"><span class="meta">... </span>       number=<span class="number">10000</span>, <span class="built_in">globals</span>=<span class="built_in">globals</span>(), setup=<span class="string">&#x27;pass&#x27;</span>)</span><br><span class="line"><span class="number">0.34986</span></span><br></pre></td></tr></table></figure>

<h3 id="Line-Profiler"><a href="#Line-Profiler" class="headerlink" title="Line Profiler"></a>Line Profiler</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># $ pip3 install line_profiler</span></span><br><span class="line"><span class="meta">@profile</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span>():</span></span><br><span class="line">    a = [*<span class="built_in">range</span>(<span class="number">10000</span>)]</span><br><span class="line">    b = &#123;*<span class="built_in">range</span>(<span class="number">10000</span>)&#125;</span><br><span class="line">main()</span><br></pre></td></tr></table></figure>

<h4 id="Usage"><a href="#Usage" class="headerlink" title="Usage:"></a>Usage:</h4><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ kernprof -lv test.py</span><br><span class="line">Line #      Hits         Time  Per Hit   % Time  Line Contents</span><br><span class="line">==============================================================</span><br><span class="line">     1                                           @profile</span><br><span class="line">     2                                           def main():</span><br><span class="line">     3         1       1128.0   1128.0     27.4      a = [*range(10000)]</span><br><span class="line">     4         1       2994.0   2994.0     72.6      b = &#123;*range(10000)&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Call-Graph"><a href="#Call-Graph" class="headerlink" title="Call Graph"></a>Call Graph</h3><h4 id="Generates-a-PNG-image-of-a-call-graph-with-highlighted-bottlenecks"><a href="#Generates-a-PNG-image-of-a-call-graph-with-highlighted-bottlenecks" class="headerlink" title="Generates a PNG image of a call graph with highlighted bottlenecks:"></a>Generates a PNG image of a call graph with highlighted bottlenecks:</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># $ pip3 install pycallgraph</span></span><br><span class="line"><span class="keyword">from</span> pycallgraph <span class="keyword">import</span> output, PyCallGraph</span><br><span class="line"><span class="keyword">from</span> datetime <span class="keyword">import</span> datetime</span><br><span class="line">time_str = datetime.now().strftime(<span class="string">&#x27;%Y%m%d%H%M%S&#x27;</span>)</span><br><span class="line">filename = <span class="string">f&#x27;profile-<span class="subst">&#123;time_str&#125;</span>.png&#x27;</span></span><br><span class="line">drawer = output.GraphvizOutput(output_file=filename)</span><br><span class="line"><span class="keyword">with</span> PyCallGraph(drawer):</span><br><span class="line">    &lt;code_to_be_profiled&gt;</span><br></pre></td></tr></table></figure>


<h2 id="NumPy"><a href="#NumPy" class="headerlink" title="NumPy"></a>NumPy</h2><p><strong>Array manipulation mini language. Can run up to one hundred times faster than equivalent Python code.</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># $ pip3 install numpy</span></span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;array&gt; = np.array(&lt;<span class="built_in">list</span>&gt;)</span><br><span class="line">&lt;array&gt; = np.arange(from_inclusive, to_exclusive, ±step_size)</span><br><span class="line">&lt;array&gt; = np.ones(&lt;shape&gt;)</span><br><span class="line">&lt;array&gt; = np.random.randint(from_inclusive, to_exclusive, &lt;shape&gt;)</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;array&gt;.shape = &lt;shape&gt;</span><br><span class="line">&lt;view&gt;  = &lt;array&gt;.reshape(&lt;shape&gt;)</span><br><span class="line">&lt;view&gt;  = np.broadcast_to(&lt;array&gt;, &lt;shape&gt;)</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;array&gt; = &lt;array&gt;.<span class="built_in">sum</span>(axis)</span><br><span class="line">indexes = &lt;array&gt;.argmin(axis)</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>Shape is a tuple of dimension sizes.</strong></li>
<li><strong>Axis is an index of dimension that gets collapsed. Leftmost dimension has index 0.</strong></li>
</ul>
<h3 id="Indexing"><a href="#Indexing" class="headerlink" title="Indexing"></a>Indexing</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;el&gt;       = &lt;2d_array&gt;[0, 0]        <span class="comment"># First element.</span></span><br><span class="line">&lt;1d_view&gt;  = &lt;2d_array&gt;[0]           <span class="comment"># First row.</span></span><br><span class="line">&lt;1d_view&gt;  = &lt;2d_array&gt;[:, 0]        <span class="comment"># First column. Also [..., 0].</span></span><br><span class="line">&lt;3d_view&gt;  = &lt;2d_array&gt;[None, :, :]  <span class="comment"># Expanded by dimension of size 1.</span></span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;1d_array&gt; = &lt;2d_array&gt;[&lt;1d_row_indexes&gt;, &lt;1d_column_indexes&gt;]</span><br><span class="line">&lt;2d_array&gt; = &lt;2d_array&gt;[&lt;2d_row_indexes&gt;, &lt;2d_column_indexes&gt;]</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;2d_bools&gt; = &lt;2d_array&gt; &gt; 0</span><br><span class="line">&lt;1d_array&gt; = &lt;2d_array&gt;[&lt;2d_bools&gt;]</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>If row and column indexes differ in shape, they are combined with broadcasting.</strong></li>
</ul>
<h3 id="Broadcasting"><a href="#Broadcasting" class="headerlink" title="Broadcasting"></a>Broadcasting</h3><p><strong>Broadcasting is a set of rules by which NumPy functions operate on arrays of different sizes and/or dimensions.</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">left  = [[<span class="number">0.1</span>], [<span class="number">0.6</span>], [<span class="number">0.8</span>]]  <span class="comment"># Shape: (3, 1)</span></span><br><span class="line">right = [ <span class="number">0.1</span> ,  <span class="number">0.6</span> ,  <span class="number">0.8</span> ]  <span class="comment"># Shape: (3)</span></span><br></pre></td></tr></table></figure>

<h4 id="1-If-array-shapes-differ-in-length-left-pad-the-shorter-shape-with-ones"><a href="#1-If-array-shapes-differ-in-length-left-pad-the-shorter-shape-with-ones" class="headerlink" title="1. If array shapes differ in length, left-pad the shorter shape with ones:"></a>1. If array shapes differ in length, left-pad the shorter shape with ones:</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">left  = [[<span class="number">0.1</span>], [<span class="number">0.6</span>], [<span class="number">0.8</span>]]  <span class="comment"># Shape: (3, 1)</span></span><br><span class="line">right = [[<span class="number">0.1</span> ,  <span class="number">0.6</span> ,  <span class="number">0.8</span>]]  <span class="comment"># Shape: (1, 3) &lt;- !</span></span><br></pre></td></tr></table></figure>

<h4 id="2-If-any-dimensions-differ-in-size-expand-the-ones-that-have-size-1-by-duplicating-their-elements"><a href="#2-If-any-dimensions-differ-in-size-expand-the-ones-that-have-size-1-by-duplicating-their-elements" class="headerlink" title="2. If any dimensions differ in size, expand the ones that have size 1 by duplicating their elements:"></a>2. If any dimensions differ in size, expand the ones that have size 1 by duplicating their elements:</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">left  = [[<span class="number">0.1</span>, <span class="number">0.1</span>, <span class="number">0.1</span>], [<span class="number">0.6</span>, <span class="number">0.6</span>, <span class="number">0.6</span>], [<span class="number">0.8</span>, <span class="number">0.8</span>, <span class="number">0.8</span>]]  <span class="comment"># Shape: (3, 3) &lt;- !</span></span><br><span class="line">right = [[<span class="number">0.1</span>, <span class="number">0.6</span>, <span class="number">0.8</span>], [<span class="number">0.1</span>, <span class="number">0.6</span>, <span class="number">0.8</span>], [<span class="number">0.1</span>, <span class="number">0.6</span>, <span class="number">0.8</span>]]  <span class="comment"># Shape: (3, 3) &lt;- !</span></span><br></pre></td></tr></table></figure>

<h4 id="3-If-neither-non-matching-dimension-has-size-1-rise-an-error"><a href="#3-If-neither-non-matching-dimension-has-size-1-rise-an-error" class="headerlink" title="3. If neither non-matching dimension has size 1, rise an error."></a>3. If neither non-matching dimension has size 1, rise an error.</h4><h3 id="Example-1"><a href="#Example-1" class="headerlink" title="Example"></a>Example</h3><h4 id="For-each-point-returns-index-of-its-nearest-point-0-1-0-6-0-8-gt-1-2-1"><a href="#For-each-point-returns-index-of-its-nearest-point-0-1-0-6-0-8-gt-1-2-1" class="headerlink" title="For each point returns index of its nearest point ([0.1, 0.6, 0.8] =&gt; [1, 2, 1]):"></a>For each point returns index of its nearest point (<code>[0.1, 0.6, 0.8] =&gt; [1, 2, 1]</code>):</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>points = np.array([<span class="number">0.1</span>, <span class="number">0.6</span>, <span class="number">0.8</span>])</span><br><span class="line">[ <span class="number">0.1</span>,  <span class="number">0.6</span>,  <span class="number">0.8</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>wrapped_points = points.reshape(<span class="number">3</span>, <span class="number">1</span>)</span><br><span class="line">[[ <span class="number">0.1</span>],</span><br><span class="line"> [ <span class="number">0.6</span>],</span><br><span class="line"> [ <span class="number">0.8</span>]]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>distances = wrapped_points - points</span><br><span class="line">[[ <span class="number">0.</span> , -<span class="number">0.5</span>, -<span class="number">0.7</span>],</span><br><span class="line"> [ <span class="number">0.5</span>,  <span class="number">0.</span> , -<span class="number">0.2</span>],</span><br><span class="line"> [ <span class="number">0.7</span>,  <span class="number">0.2</span>,  <span class="number">0.</span> ]]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>distances = np.<span class="built_in">abs</span>(distances)</span><br><span class="line">[[ <span class="number">0.</span> ,  <span class="number">0.5</span>,  <span class="number">0.7</span>],</span><br><span class="line"> [ <span class="number">0.5</span>,  <span class="number">0.</span> ,  <span class="number">0.2</span>],</span><br><span class="line"> [ <span class="number">0.7</span>,  <span class="number">0.2</span>,  <span class="number">0.</span> ]]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>i = np.arange(<span class="number">3</span>)</span><br><span class="line">[<span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>distances[i, i] = np.inf</span><br><span class="line">[[ inf,  <span class="number">0.5</span>,  <span class="number">0.7</span>],</span><br><span class="line"> [ <span class="number">0.5</span>,  inf,  <span class="number">0.2</span>],</span><br><span class="line"> [ <span class="number">0.7</span>,  <span class="number">0.2</span>,  inf]]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>distances.argmin(<span class="number">1</span>)</span><br><span class="line">[<span class="number">1</span>, <span class="number">2</span>, <span class="number">1</span>]</span><br></pre></td></tr></table></figure>


<h2 id="Image"><a href="#Image" class="headerlink" title="Image"></a>Image</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># $ pip3 install pillow</span></span><br><span class="line"><span class="keyword">from</span> PIL <span class="keyword">import</span> Image</span><br></pre></td></tr></table></figure>

<h4 id="Creates-a-PNG-image-of-a-rainbow-gradient"><a href="#Creates-a-PNG-image-of-a-rainbow-gradient" class="headerlink" title="Creates a PNG image of a rainbow gradient:"></a>Creates a PNG image of a rainbow gradient:</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">width  = <span class="number">100</span></span><br><span class="line">height = <span class="number">100</span></span><br><span class="line">size   = width * height</span><br><span class="line">pixels = [<span class="number">255</span> * i/size <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(size)]</span><br><span class="line"></span><br><span class="line">img = Image.new(<span class="string">&#x27;HSV&#x27;</span>, (width, height))</span><br><span class="line">img.putdata([(<span class="built_in">int</span>(a), <span class="number">255</span>, <span class="number">255</span>) <span class="keyword">for</span> a <span class="keyword">in</span> pixels])</span><br><span class="line">img.convert(mode=<span class="string">&#x27;RGB&#x27;</span>).save(<span class="string">&#x27;test.png&#x27;</span>)</span><br></pre></td></tr></table></figure>

<h4 id="Adds-noise-to-a-PNG-image"><a href="#Adds-noise-to-a-PNG-image" class="headerlink" title="Adds noise to a PNG image:"></a>Adds noise to a PNG image:</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> random <span class="keyword">import</span> randint</span><br><span class="line">add_noise = <span class="keyword">lambda</span> value: <span class="built_in">max</span>(<span class="number">0</span>, <span class="built_in">min</span>(<span class="number">255</span>, value + randint(-<span class="number">20</span>, <span class="number">20</span>)))</span><br><span class="line">img = Image.<span class="built_in">open</span>(<span class="string">&#x27;test.png&#x27;</span>).convert(mode=<span class="string">&#x27;HSV&#x27;</span>)</span><br><span class="line">img.putdata([(add_noise(h), s, v) <span class="keyword">for</span> h, s, v <span class="keyword">in</span> img.getdata()])</span><br><span class="line">img.convert(mode=<span class="string">&#x27;RGB&#x27;</span>).save(<span class="string">&#x27;test.png&#x27;</span>)</span><br></pre></td></tr></table></figure>

<h3 id="Modes-1"><a href="#Modes-1" class="headerlink" title="Modes"></a>Modes</h3><ul>
<li><strong><code>&#39;1&#39;</code> - 1-bit pixels, black and white, stored with one pixel per byte.</strong></li>
<li><strong><code>&#39;L&#39;</code> - 8-bit pixels, greyscale.</strong></li>
<li><strong><code>&#39;RGB&#39;</code> - 3x8-bit pixels, true color.</strong></li>
<li><strong><code>&#39;RGBA&#39;</code> - 4x8-bit pixels, true color with transparency mask.</strong></li>
<li><strong><code>&#39;HSV&#39;</code> - 3x8-bit pixels, Hue, Saturation, Value color space.</strong></li>
</ul>
<h2 id="Audio"><a href="#Audio" class="headerlink" title="Audio"></a>Audio</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> wave</span><br><span class="line"><span class="keyword">from</span> struct <span class="keyword">import</span> pack, iter_unpack</span><br></pre></td></tr></table></figure>

<h3 id="Read-Frames-from-WAV-File"><a href="#Read-Frames-from-WAV-File" class="headerlink" title="Read Frames from WAV File"></a>Read Frames from WAV File</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">read_wav_file</span>(<span class="params">filename</span>):</span></span><br><span class="line">    <span class="keyword">with</span> wave.<span class="built_in">open</span>(filename, <span class="string">&#x27;rb&#x27;</span>) <span class="keyword">as</span> wf:</span><br><span class="line">        frames = wf.readframes(wf.getnframes())</span><br><span class="line">        <span class="keyword">return</span> [a[<span class="number">0</span>] <span class="keyword">for</span> a <span class="keyword">in</span> iter_unpack(<span class="string">&#x27;&lt;h&#x27;</span>, frames)]</span><br></pre></td></tr></table></figure>

<h3 id="Write-Frames-to-WAV-File"><a href="#Write-Frames-to-WAV-File" class="headerlink" title="Write Frames to WAV File"></a>Write Frames to WAV File</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">write_to_wav_file</span>(<span class="params">filename, frames_int, mono=<span class="literal">True</span></span>):</span></span><br><span class="line">    frames_short = (pack(<span class="string">&#x27;&lt;h&#x27;</span>, a) <span class="keyword">for</span> a <span class="keyword">in</span> frames_int)</span><br><span class="line">    <span class="keyword">with</span> wave.<span class="built_in">open</span>(filename, <span class="string">&#x27;wb&#x27;</span>) <span class="keyword">as</span> wf:</span><br><span class="line">        wf.setnchannels(<span class="number">1</span> <span class="keyword">if</span> mono <span class="keyword">else</span> <span class="number">2</span>)</span><br><span class="line">        wf.setsampwidth(<span class="number">2</span>)</span><br><span class="line">        wf.setframerate(<span class="number">44100</span>)</span><br><span class="line">        wf.writeframes(<span class="string">b&#x27;&#x27;</span>.join(frames_short))</span><br></pre></td></tr></table></figure>

<h3 id="Examples"><a href="#Examples" class="headerlink" title="Examples"></a>Examples</h3><h4 id="Saves-a-sine-wave-to-a-mono-WAV-file"><a href="#Saves-a-sine-wave-to-a-mono-WAV-file" class="headerlink" title="Saves a sine wave to a mono WAV file:"></a>Saves a sine wave to a mono WAV file:</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> math <span class="keyword">import</span> pi, sin</span><br><span class="line">frames_f = (sin(i * <span class="number">2</span> * pi * <span class="number">440</span> / <span class="number">44100</span>) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">100000</span>))</span><br><span class="line">frames_i = (<span class="built_in">int</span>(a * <span class="number">30000</span>) <span class="keyword">for</span> a <span class="keyword">in</span> frames_f)</span><br><span class="line">write_to_wav_file(<span class="string">&#x27;test.wav&#x27;</span>, frames_i)</span><br></pre></td></tr></table></figure>

<h4 id="Adds-noise-to-a-mono-WAV-file"><a href="#Adds-noise-to-a-mono-WAV-file" class="headerlink" title="Adds noise to a mono WAV file:"></a>Adds noise to a mono WAV file:</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> random <span class="keyword">import</span> randint</span><br><span class="line">add_noise = <span class="keyword">lambda</span> value: <span class="built_in">max</span>(-<span class="number">32768</span>, <span class="built_in">min</span>(<span class="number">32767</span>, value + randint(-<span class="number">500</span>, <span class="number">500</span>)))</span><br><span class="line">frames_i  = (add_noise(a) <span class="keyword">for</span> a <span class="keyword">in</span> read_wav_file(<span class="string">&#x27;test.wav&#x27;</span>))</span><br><span class="line">write_to_wav_file(<span class="string">&#x27;test.wav&#x27;</span>, frames_i)</span><br></pre></td></tr></table></figure>

<h3 id="Synthesizer"><a href="#Synthesizer" class="headerlink" title="Synthesizer"></a>Synthesizer</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># $ pip3 install simpleaudio</span></span><br><span class="line"><span class="keyword">import</span> simpleaudio, math, struct</span><br><span class="line"><span class="keyword">from</span> itertools <span class="keyword">import</span> chain, repeat</span><br><span class="line">F  = <span class="number">44100</span></span><br><span class="line">P1 = <span class="string">&#x27;71♪,69,,71♪,66,,62♪,66,,59♪,,,&#x27;</span></span><br><span class="line">P2 = <span class="string">&#x27;71♪,73,,74♪,73,,74,,71,,73♪,71,,73,,69,,71♪,69,,71,,67,,71♪,,,&#x27;</span></span><br><span class="line">get_pause  = <span class="keyword">lambda</span> seconds: repeat(<span class="number">0</span>, <span class="built_in">int</span>(seconds * F))</span><br><span class="line">sin_f      = <span class="keyword">lambda</span> i, hz: math.sin(i * <span class="number">2</span> * math.pi * hz / F)</span><br><span class="line">get_wave   = <span class="keyword">lambda</span> hz, seconds: (sin_f(i, hz) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">int</span>(seconds * F)))</span><br><span class="line">get_hz     = <span class="keyword">lambda</span> key: <span class="number">8.176</span> * <span class="number">2</span> ** (<span class="built_in">int</span>(key) / <span class="number">12</span>)</span><br><span class="line">parse_note = <span class="keyword">lambda</span> note: (get_hz(note[:<span class="number">2</span>]), <span class="number">0.25</span> <span class="keyword">if</span> <span class="string">&#x27;♪&#x27;</span> <span class="keyword">in</span> note <span class="keyword">else</span> <span class="number">0.125</span>)</span><br><span class="line">get_frames = <span class="keyword">lambda</span> note: get_wave(*parse_note(note)) <span class="keyword">if</span> note <span class="keyword">else</span> get_pause(<span class="number">0.125</span>)</span><br><span class="line">frames_f   = chain.from_iterable(get_frames(n) <span class="keyword">for</span> n <span class="keyword">in</span> <span class="string">f&#x27;<span class="subst">&#123;P1&#125;</span><span class="subst">&#123;P1&#125;</span><span class="subst">&#123;P2&#125;</span>&#x27;</span>.split(<span class="string">&#x27;,&#x27;</span>))</span><br><span class="line">frames_b   = <span class="string">b&#x27;&#x27;</span>.join(struct.pack(<span class="string">&#x27;&lt;h&#x27;</span>, <span class="built_in">int</span>(f * <span class="number">30000</span>)) <span class="keyword">for</span> f <span class="keyword">in</span> frames_f)</span><br><span class="line">simpleaudio.play_buffer(frames_b, <span class="number">1</span>, <span class="number">2</span>, F)</span><br></pre></td></tr></table></figure>


<h2 id="Basic-Script-Template"><a href="#Basic-Script-Template" class="headerlink" title="Basic Script Template"></a>Basic Script Template</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># Usage: .py</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> collections <span class="keyword">import</span> namedtuple</span><br><span class="line"><span class="keyword">from</span> dataclasses <span class="keyword">import</span> make_dataclass</span><br><span class="line"><span class="keyword">from</span> enum <span class="keyword">import</span> Enum</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span>():</span></span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">###</span></span><br><span class="line"><span class="comment">##  UTIL</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">read_file</span>(<span class="params">filename</span>):</span></span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(filename, encoding=<span class="string">&#x27;utf-8&#x27;</span>) <span class="keyword">as</span> file:</span><br><span class="line">        <span class="keyword">return</span> file.readlines()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    main()</span><br><span class="line"></span><br></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2021/03/24/Python%20Cheatsheet/" data-id="ckmn1li2c000pn8a8644g4ziy" data-title="" class="article-share-link">Teilen</a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-Python自定义包和模块" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2021/03/24/Python%E8%87%AA%E5%AE%9A%E4%B9%89%E5%8C%85%E5%92%8C%E6%A8%A1%E5%9D%97/" class="article-date">
  <time class="dt-published" datetime="2021-03-24T06:02:27.924Z" itemprop="datePublished">2021-03-24</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="Python自定义包和模块"><a href="#Python自定义包和模块" class="headerlink" title="Python自定义包和模块"></a>Python自定义包和模块</h1><p>Date：2019-07-26</p>
<p>在site-packages路径下新建一个文件名任意的.pth文件，在该pth文件中添加每行添加一个包搜索路径。</p>
<p>在Windows下，该文件路径为：</p>
<p>D:\Program Files\Python37\Lib\site-packages\path.pth</p>
<p>例如有文件组织结构如下：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">E:\Desktop\Learn\</span><br><span class="line">	app.py</span><br><span class="line">	tools.py</span><br><span class="line">		get_file()</span><br><span class="line">	python_tools\</span><br><span class="line">		__init.py__</span><br><span class="line">		tools.py</span><br><span class="line">			get_file()</span><br></pre></td></tr></table></figure>

<p>需要在app.py中使用tools.py中的get_file()函数，有两个方法：</p>
<ol>
<li><p>直接引用。</p>
<p>在app.py的当前目录下新建tools.py文件，在该文件中编写get_file()函数，在app.py文件中使用<code>import tools.py</code>引用该包后使用<code>tools.get_file()</code> 调用函数。</p>
</li>
<li><p>以第三方包的方式引用。</p>
<ul>
<li>在任意位置新建以包名命名的文件夹，例如本处的<code>python_tools</code>，将该位置添加至上文所述的.pth文件中。在该文件夹内新建<code>__init.py__</code>文件，文件内容可为空白，Python解释器会将该目录当成包目录而非普通目录。在该文件夹内新建<code>tools.py</code>文件，在该文件中编写get_file()函数。在<code>app.py</code>中使用<code>from python_tools import tools </code>引用该包后使用<code>tools.get_file()</code>调用函数。</li>
</ul>
</li>
</ol>
<ul>
<li>在上述<code>__init.py__</code>（该文件会在首次引用该包时执行）中使用<code>from .tools import *</code>引入  <code>tools.py</code>中的全部函数，在<code>app.py</code>中使用<code>import python_tools </code>引用该包后使用<code>python_tools.get_file()</code>调用函数。</li>
</ul>
<p>Python 包组织结构</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">packages</span><br><span class="line">	sub_package1</span><br><span class="line">		__init.py__</span><br><span class="line">		module1.py</span><br><span class="line">		...</span><br><span class="line">	sub_package2</span><br><span class="line">		__init.py__</span><br><span class="line">		module1.py</span><br><span class="line">		...</span><br></pre></td></tr></table></figure>

<p>使用<code>from packages.sub_package1 import module1</code>或者<code>import packages.sub_package1.module1</code></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2021/03/24/Python%E8%87%AA%E5%AE%9A%E4%B9%89%E5%8C%85%E5%92%8C%E6%A8%A1%E5%9D%97/" data-id="ckmn1lhzj0003n8a89rhp4b98" data-title="" class="article-share-link">Teilen</a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-tofino-command" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2021/03/24/tofino-command/" class="article-date">
  <time class="dt-published" datetime="2021-03-24T06:02:27.917Z" itemprop="datePublished">2021-03-24</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>8.9.1_SDE_Release_Notes.pdf Page9</p>
<p><img src="tofino-mirror/1563588664596.png" alt="1563588664596"></p>
<p><img src="tofino-mirror/1563588690029.png" alt="1563588690029"></p>
<p>P416 Tofino and Tofino2 Native Architecture.pdf page41</p>
<p><img src="tofino-mirror/1563588826648.png" alt="1563588826648"></p>
<p><img src="tofino-mirror/1563588845103.png" alt="1563588845103"></p>
<p><img src="tofino-mirror/1563588860409.png" alt="1563588860409"></p>
<p><img src="tofino-mirror/1563588924547.png" alt="1563588924547"></p>
<p><img src="tofino-mirror/1563588938814.png" alt="1563588938814"></p>
<p><img src="tofino-mirror/1563588961934.png" alt="1563588961934"></p>
<p><img src="tofino-mirror/1563597589848.png" alt="1563597589848"></p>
<p><img src="tofino-mirror/1563597604375.png" alt="1563597604375"></p>
<p><img src="tofino-mirror/1563597621504.png" alt="1563597621504"></p>
<p><img src="tofino-mirror/1563597642136.png" alt="1563597642136"></p>
<p><img src="tofino-mirror/1563597655844.png" alt="1563597655844"></p>
<p><img src="tofino-mirror/1563597688107.png" alt="1563597688107"></p>
<p><img src="tofino-mirror/1563597697403.png" alt="1563597697403"></p>
<p>COMMAND</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash">SDE/pkgsrc/p4-build/configure --prefix=<span class="variable">$SDE_INSTALL</span> enable_thrift=yes --with-tofino --with-p4c --with-bf-runtime P4_VERSION=p4-16 P4_ARCHITECTURE=tna P4_NAME=int_tna P4_PATH=<span class="variable">$SDE</span>/int-tna/int-tna.p4 P4JOBS=7</span></span><br><span class="line"></span><br><span class="line">make;make install;$SDE/run_switchd.sh -p int_tna</span><br><span class="line"></span><br><span class="line">bfrt_python</span><br><span class="line">bfrt.int_tna.SwitchIngress.tbl_forward.add_with_forward(src_addr=&quot;10.0.0.1&quot;,dst_addr=&quot;10.0.0.2&quot;,resubmit_flag=0,port=129,flag=1)</span><br><span class="line"></span><br><span class="line">bfrt.int_tna.SwitchIngress.tbl_forward.add_with_submit_a(src_addr=&quot;10.0.0.1&quot;,dst_addr=&quot;10.0.0.2&quot;,resubmit_flag=1,port=128)</span><br><span class="line"></span><br><span class="line">bfrt.int_tna.SwitchIngress.int_action.add_with_source_set(int_flag=1)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">ucli</span><br><span class="line">pm port-add 1/- 10G NONE</span><br><span class="line">pm port-enb 1/-</span><br><span class="line">pm show</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>Tofino</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">配置</span><br><span class="line"><span class="meta">$</span><span class="bash">SDE/pkgsrc/p4-build/configure --prefix=<span class="variable">$SDE_INSTALL</span> enable_thrift=yes --with-tofino --with-p4c --with-bf-runtime P4_VERSION=p4-16 P4_ARCHITECTURE=tna P4_NAME=int_tna P4_PATH=/root/int-tna/int-tna.p4 P4JOBS=7</span></span><br><span class="line">编译与安装</span><br><span class="line">make</span><br><span class="line">make install·</span><br><span class="line">运行</span><br><span class="line"><span class="meta">$</span><span class="bash">SDE/run_switchd.sh -p int_tna</span></span><br><span class="line">下发流表</span><br><span class="line">bfrt_python</span><br><span class="line">bfrt.int_tna.SwitchIngress.tbl_forward.add_with_forward(src_addr=&quot;10.0.0.1&quot;,dst_addr=&quot;10.0.0.2&quot;,protocol=6,port=129,flag=1)</span><br><span class="line">bfrt.int_tna.SwitchIngress.tbl_forward.add_with_submit_a(src_addr=&quot;10.0.0.1&quot;,dst_addr=&quot;10.0.0.2&quot;,protocol=17,port=129,flag=1)</span><br><span class="line">bfrt.int_tna.SwitchIngress.source_init.add_with_source_set(int_flag=1)</span><br><span class="line">启用端口</span><br><span class="line">ucli</span><br><span class="line">pm port-add 1/- 10G NONE</span><br><span class="line">pm port-enb 1/-</span><br><span class="line">pm show</span><br><span class="line">发包</span><br><span class="line">sudo python3 send.py ens38 10.0.0.2 &quot;test&quot; 10 0.1</span><br><span class="line">收包</span><br><span class="line">sudo python receive.py</span><br></pre></td></tr></table></figure>

<p>Tofino-Model</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">配置</span><br><span class="line"><span class="meta">$</span><span class="bash">SDE/pkgsrc/p4-build/configure --prefix=<span class="variable">$SDE_INSTALL</span> enable_thrift=yes --with-tofino --with-p4c --with-bf-runtime P4_VERSION=p4-16 P4_ARCHITECTURE=tna P4_NAME=int_tna P4_PATH=/home/xbo-p4/P4/int/int.p4 P4JOBS=7</span></span><br><span class="line">编译与安装</span><br><span class="line">make</span><br><span class="line">make install</span><br><span class="line">启动端口</span><br><span class="line">sudo ~/P4/p4train/tools/veth_setup.sh</span><br><span class="line">启动Tofino-model</span><br><span class="line"><span class="meta">$</span><span class="bash">SDE/run_tofino_model.sh -p int_tna</span></span><br><span class="line">启动bfshell</span><br><span class="line"><span class="meta">$</span><span class="bash">SDE/run_switchd.sh -p int_tna</span></span><br><span class="line">下发流表</span><br><span class="line">bfrt.int_tna.SwitchIngress.tbl_forward.add_with_forward(dst_addr=0x0A000002,src_addr=0x0A000001,protocol=6,flag=1,port=1)</span><br><span class="line">bfrt.int_tna.SwitchIngress.tbl_forward.add_with_forward(dst_addr=0x0A000002,src_addr=0x0A000001,protocol=17,flag=1,port=1)</span><br><span class="line">bfrt.int_tna.SwitchIngress.source_init.add_with_source_set(int_flag=1)</span><br><span class="line">启动接收脚本</span><br><span class="line">sudo python ~/Desktop/INT/receive-eth.py </span><br><span class="line">启动发送脚本</span><br><span class="line">sudo python ~/Desktop/INT/send-eth.py 10.0.0.2 &quot;test&quot; 1 0.1 veth1</span><br></pre></td></tr></table></figure>


      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2021/03/24/tofino-command/" data-id="ckmn1lhzn000an8a8bemdbgs5" data-title="" class="article-share-link">Teilen</a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-安装mininet和tofino-model" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2021/03/24/%E5%AE%89%E8%A3%85mininet%E5%92%8Ctofino-model/" class="article-date">
  <time class="dt-published" datetime="2021-03-24T06:02:27.907Z" itemprop="datePublished">2021-03-24</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> ubuntu 16.04 安装BMv2</span></span><br><span class="line">sudo reboot now</span><br><span class="line">mkdir mininet-install</span><br><span class="line">sudo apt install openssh-server</span><br><span class="line"><span class="meta">#</span><span class="bash"> 更改apt source.list</span></span><br><span class="line">sudo apt update</span><br><span class="line">sudo apt upgrade</span><br><span class="line">cd mininet-install/tutorials/vm/</span><br><span class="line">chmod u+x root-bootstrap.sh </span><br><span class="line">chmod u+x user-bootstrap.sh </span><br><span class="line">sudo ./root-bootstrap.sh # 注意windows下换行符是CRLF,UNIX下是LF；apt install 中不能用#屏蔽不能安装的软件包，需要直接删除。</span><br><span class="line">mkdir ~/.pip/</span><br><span class="line">cat &gt; ~/.pip/pip.conf &lt;&lt;EOF</span><br><span class="line">[global]</span><br><span class="line">index-url = https://pypi.tuna.tsinghua.edu.cn/simple</span><br><span class="line">[install]</span><br><span class="line">trusted-host=mirrors.aliyun.com</span><br><span class="line">EOF</span><br><span class="line"><span class="meta">#</span><span class="bash">git proxy</span> </span><br><span class="line">git config --global http.proxy &#x27;socks5://192.168.2.7:1080&#x27;</span><br><span class="line">git config --global https.proxy &#x27;socks5://192.168.2.7:1080&#x27;</span><br><span class="line">./user-bootstrap.sh</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> ubuntu 16.04 安装bf-sde-8.9.1</span></span><br><span class="line">tar xvf bf-sde-8.9.1.tar</span><br><span class="line">cd bf-sde-8.9.1/p4studio_build</span><br><span class="line">python p4studio_build.py --use-profile p416_examples_profile -rb</span><br><span class="line"><span class="meta">#</span><span class="bash"> 注意：保持git处于被代理状态。</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> grpc可能无法git <span class="built_in">clone</span>（原因未知），解决办法是：</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 将安装BMv2时的grpc（/home/xbo/mininet-install/tutorials/vm/grpc）复制至/home/xbo/bfsde-install/bf-sde-8.9.1/p4studio_build/third_party/grpc_protobuf/grpc，屏蔽/home/xbo/bfsde-install/bf-sde-8.9.1/p4studio_build/third_party/install_grpc.py中的line125-128，即：</span></span><br><span class="line"><span class="meta">	#</span><span class="bash">status = utils.exec_cmd(cmd, log_file)</span></span><br><span class="line">    #if status[2] != 0:</span><br><span class="line">    #    return (False, &#x27;Failed to extract GRPC, command - &#x27; + \</span><br><span class="line">    #                   &#x27;%s, error - %s&#x27; % (cmd, status[1]))</span><br><span class="line"><span class="meta">#</span><span class="bash"> 重新安装时可以 使用-rb参数，从上次编译失败的地方重新编译。</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 在/etc/profile 中添加如下变量</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> <span class="built_in">export</span> SDE=/home/xbo/bfsde-install/bf-sde-8.9.1</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> <span class="built_in">export</span> SDE_INSTALL=<span class="variable">$SDE</span>/install</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> <span class="built_in">export</span> PATH=<span class="variable">$PATH</span>:<span class="variable">$SDE_INSTALL</span>/bin</span></span><br><span class="line"></span><br><span class="line">配置</span><br><span class="line"><span class="meta">$</span><span class="bash">SDE/pkgsrc/p4-build/configure --prefix=<span class="variable">$SDE_INSTALL</span> enable_thrift=yes --with-tofino --with-p4c --with-bf-runtime P4_VERSION=p4-16 P4_ARCHITECTURE=tna P4_NAME=int_tna P4_PATH=/home/xbo/bf-sde-8.9.1-install/int-tna/int-tna.p4 P4JOBS=7</span></span><br><span class="line">编译与安装</span><br><span class="line">make</span><br><span class="line">make install</span><br><span class="line">启动端口</span><br><span class="line">sudo ~/P4/p4train/tools/veth_setup.sh</span><br><span class="line">启动Tofino-model</span><br><span class="line"><span class="meta">$</span><span class="bash">SDE/run_tofino_model.sh -p int_tna</span></span><br><span class="line">启动bfshell</span><br><span class="line"><span class="meta">$</span><span class="bash">SDE/run_switchd.sh -p int_tna</span></span><br></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2021/03/24/%E5%AE%89%E8%A3%85mininet%E5%92%8Ctofino-model/" data-id="ckmn1lhzo000bn8a80he25ya1" data-title="" class="article-share-link">Teilen</a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-TNA model" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2021/03/24/TNA%20model/" class="article-date">
  <time class="dt-published" datetime="2021-03-24T06:02:27.893Z" itemprop="datePublished">2021-03-24</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h2 id="Tofino-Architecture-Model"><a href="#Tofino-Architecture-Model" class="headerlink" title="Tofino Architecture Model"></a>Tofino Architecture Model</h2><p>当前TNA模型拥有六个可编程模块和三个固定功能模块( Phase-0 and Intrinsic Metadata (PIM) engine, the Packet buffer and Replication Engine (PRE) and the Buffer Queuing Engine (BQE) )。</p>
<p><img src="C:\Users\xbo\AppData\Roaming\Typora\typora-user-images\1568098562988.png" alt="1568098562988"></p>
<p>交换机将接收到的数据包缓存在输入缓存器中（未在图中画出），PIM引擎属于输入缓存器的一部分，用于在接收到的数据包开始处添加额外的元数据（metadata），包括intrinsic metadata and phase-0 or resubmit metadata， intrinsic metadata的结构和大小是固定的，结构定义为结构体ingress_intrinsic_metadata_t，大小为8 bytes，Phase-0 and resubmit metadata的结构和大小取决于应用程序，程序可以使用8 bytes或更少，没用使用的数据将被0填充。</p>
<p>TNA中数据包的处理流程的第一步是ingress处理，进入交换机的数据包首先被parser块解析，然后被ingress control块处理。从parser角度来看，交换机接收的原始数据包经过PIM引擎后会添加 intrinsic and phase-0 metadata，因此parser必须在解析真实数据包之前解析或者跳过PIM添加的PORT_METADATA bytes (16 bytes for TNA, 24 bytes for T2NA)大小的元数据。</p>
<p>在Tofino中，ingress control块可以执行一系列的匹配和动作操作（Match-Action，MA），每个MA操作由一个表查找和根据查找结果修改数据包包头（header）或元数据操作组成。在P4-16中动作可以在有或者没有任何表查找的情况下执行。<strong>能够匹配和修改任意数据包包头和元数据是P4可编程性的关键</strong> 。</p>
<p>在ingress control块之后，数据包在deparser control块中被重新组装，然后发送至PRE中。PRE执行多种固定功能分组交换功能，例如，PRE可以将单播包定向到某个给定的端口并缓存等待egress处理。PRE也可以丢弃数据包，或者是创建一个额外的包副本实现克隆功能，创建多个包副本实现多播。</p>
<p>在PRE之后，数据包和复制后的副本进入可选的egress处理阶段（egress pipeline）。通过在ingress处理阶段中设置intrinsic metadata中的bypass_egress标志位，可以跳过egress处理，但是镜像或多播产生的数据包副本不能跳过egress处理。在egress处理阶段，原始数据包和镜像产生的数据包副本可以被进一步修改。deparser以程序中指定的顺序提交（emit）需要的包头来构造数据包字节流。</p>
<p>TNA中可编程块的定义是根据一组用户定义的参数进行模板化的，这些参数必须由用户在control块实例化时提供。ingress pipeline和egress pipeline的类型参数不同，因此与P4-14不同，在ingress pipeline和egress pipeline中都没有全局元数据。所有对ingress pipeline中包头的修改必须由ingress deparser合并，并由egress parser解析。任何对ingress metadata的使用都必须通过在包中创建额外的桥接元数据头来手动传递(桥接)到egress pipeline。需要注意的是，即使用户可以为ingress control块和egress control块定义一个元数据类型，也不意味着这个元数据可以在ingress control块和egress control块之间共享。</p>
<p>在顶层，每个可编程块实例作为参数传递给主包块（ main package block），以实例化顶层包（ top-level package）。编译器假设存在一个名为main的顶级实例。如果没有在P4程序的定义‘main’实例会产生编译错误。</p>
<h2 id="命名规格"><a href="#命名规格" class="headerlink" title="命名规格"></a>命名规格</h2><p>在本文档中，我们使用以下命名约定:</p>
<ol>
<li>类型使用CamelCase命名法则，并后跟_t。例如，PortId_t。</li>
<li>Control类型和外部对象类型使用CamelCase命名法则。</li>
<li>结构类型的名称使用小写单词，并用_分隔，后跟_t。</li>
<li>Actions、外部方法、外部函数、包头、结构体和Control的实例的名称以小写字母开始，并用_进行分割。</li>
<li>Enum成员、Const定义和#define常量的名称全部使用大写字母，单词之间用_分隔。</li>
</ol>
<h1 id="数据类型"><a href="#数据类型" class="headerlink" title="数据类型"></a>数据类型</h1><h2 id="类型定义"><a href="#类型定义" class="headerlink" title="类型定义"></a>类型定义</h2><p>TNA使用固定的、特定于体系架构的位宽定义以下类型，这些位宽定义在架构文件中，在P4程序中建议使用这些类型来定义变量，而不是使用硬编码的位宽值。</p>
<p>typedef bit&lt;9&gt; PortId_t; // Port id – ingress or egress<br>typedef bit&lt;16&gt; MulticastGroupId_t; // Multicast group id<br>typedef bit&lt;5&gt; QueueId_t; // Queue id<br>typedef bit&lt;10&gt; MirrorId_t; // Mirror id<br>typedef bit&lt;16&gt; ReplicationId_t; // Replication id</p>
<h2 id="元数据类型"><a href="#元数据类型" class="headerlink" title="元数据类型"></a>元数据类型</h2><p>TNA中有两种元数据类型: 内部元数据（intrinsic metadata）和用户定义的元数据。内部元数据是基于硬件实现定义的，用户定义的元数据是基于P4应用程序定义的。在TNA中，根据元数据的来源和目标，将内部元数据分为若干组。例如，来自ingress parser的元数据命名为ingress_intrinsic_metadata_from_parser_t。类似地，目标为流量管理器(PRE的一部分)的元数据命名为ingress_intrinsic_metadata_for_tm_t。</p>
<p>ingress parser或egress parser接收的数据包的前缀是来自输入缓冲区的内部元数据：ingress intrinsic metadata, phase-0 and resubmit metadata。Phase-0 和resubmit metadata是互斥的，因为包只能是正常提交或重新提交，不能同时是两者。</p>
<p>header ingress_intrinsic_metadata_t {<br>bit&lt;1&gt; resubmit_flag; // Flag distinguishing original  packets from resubmitted packets.<br>bit&lt;1&gt; _pad1;<br>bit&lt;2&gt; packet_version; // Read-only Packet version.<br>bit&lt;3&gt; _pad2;<br>PortId_t ingress_port; // Ingress physical port id.<br>bit&lt;48&gt; ingress_mac_tstamp; // Ingress IEEE 1588 timestamp (in ns)  </p>
<p>}</p>
<p>来自输入缓冲区的ingress_intrinsic_metadata_t包含一个1位字段来区分正常和重新提交的数据包，一个9位字段用于表示ingress端口，一个48位字段用于表示ingress MAC时间戳。TNA程序应该始终提取 ingress intrinsic metadata。如果提取的内部元数据没有在ingress control块中使用，则提取不会产生任何硬件成本。类似地，TNA程序应该始终提取phase-0 或者 resubmit metadata。ingress_intrinsic_metadata_t在ingress parser中编写，在ingress control中读写。</p>
<p>struct ingress_intrinsic_metadata_from_parser_t {<br>bit&lt;48&gt; global_tstamp; // Global timestamp (ns) taken upon arrival at ingress.<br>bit&lt;32&gt; global_ver; // Global version number taken upon arrival at ingress, wired to 0.<br>bit&lt;16&gt; parser_err; // Error flags indicating error(s)  encountered at ingress parser.<br>}</p>
<p>ingress_intrinsic_metadata_from_parser_t结构中时间戳对于ingress control块是只读的。该结构包含两个元数据字段:global_timestamp字段，表示数据包进入ingress control块时的时间戳；parser_error字段，表示发生在parser中的任何错误代码。</p>
<p>PRE由在ingress control块中设置的，名为ingress_intrinsic_metadata_for_tm_t的内部元数据控制，</p>
<p>struct ingress_intrinsic_metadata_for_tm_t {<br>PortId_t ucast_egress_port; // Egress port for unicast packets. must be presented to TM for unicast.<br>bool bypass_egress; // Request flag for the warp mode (egress bypass).<br>bool deflect_on_drop; // Request for deflect on drop. must be presented to TM to enable deflection upon drop.<br>bit&lt;3&gt; ingress_cos; // Ingress cos (iCoS) for PG mapping, ingress admission control, PFC, etc.<br>QueueId_t qid; // Egress (logical) queue id into which this packet will be deposited.<br>bit&lt;3&gt; icos_for_copy_to_cpu; // Ingress cos for the copy to CPU. must be presented to TM if copy_to_cpu == 1.<br>bool copy_to_cpu; // Request for copy to cpu.<br>bit&lt;2&gt; packet_color; // Packet color (G,Y,R) that is typically derived from meters and used for color-based tail dropping.<br>bool disable_ucast_cutthru;  // Disable cut-through forwarding for unicast.<br>bool enable_mcast_cutthru; // Enable cut-through forwarding for multicast.<br>MulticastGroupId_t mcast_grp_a;// 1st multicast group (i.e., tree) id; a tree can have two levels. must be presented to TM for multicast.<br>MulticastGroupId_t mcast_grp_b;// 2nd multicast group (i.e., tree) id; a tree can have two levels.<br>bit&lt;13&gt; level1_mcast_hash; // Source of entropy for multicast replication-tree level1 (i.e., L3 replication). must be presented to TM for L3 dynamic member selection (e.g., ECMP) for multicast.<br>bit&lt;13&gt; level2_mcast_hash; // Source of entropy for multicast replication-tree level2 (i.e., L2 replication). must be presented to TM for L2 dynamic member selection (e.g., LAG) for nested multicast.<br>bit&lt;16&gt; level1_exclusion_id;  // Exclusion id for multicast replication-tree level1. used for pruning.<br>bit&lt;9&gt; level2_exclusion_id; // Exclusion id for multicast replication-tree level2. used for pruning.<br>ReplicationId_t rid; // L3 replication id for multicast.<br>}</p>
<p>在egress处理之前，数据包由PRE处理。与输入缓存器在输入数据包前添加元数据类似，PRE在数据包出PRE时添加额外的元数据egress_intrinsic_metadata_t ，该元数据在egress parser中被提取，并在egress control块中使用。</p>
<p>header egress_intrinsic_metadata_t {<br>bit&lt;7&gt; _pad0;<br>PortId_t egress_port; // Egress port id<br>bit&lt;5&gt; _pad1;<br>bit&lt;19&gt; enq_qdepth; // Queue depth at the packet enqueue time.<br>bit&lt;6&gt; _pad2;<br>bit&lt;2&gt; enq_congest_state; // Queue congestion state at the packet// enqueue time.<br>bit&lt;14&gt; _pad3;<br>bit&lt;18&gt; enq_tstamp; // Time when the packet is enqueued (in nsec).<br>bit&lt;5&gt; _pad4;<br>bit&lt;19&gt; deq_qdepth; ​// Queue depth at the packet dequeue time.<br>bit&lt;6&gt; _pad5;<br>bit&lt;2&gt; deq_congest_state; ​// Queue congestion state at the packet<br>​// dequeue time.<br>bit&lt;8&gt; app_pool_congest_state; ​// Dequeue-time application-pool<br>​// congestion state. 2 bits per pool.<br>bit&lt;14&gt; _pad6;<br>bit&lt;18&gt; deq_timedelta; ​// Time delta between the packet’s<br>​// enqueue and dequeue time.<br>ReplicationId_t egress_rid; ​// Replication id for multicast packets. <br>bit&lt;7&gt; _pad7;<br>bit&lt;1&gt; egress_rid_first; ​// Flag indicating the first replica for<br>// the given multicast group.<br>bit&lt;3&gt; _pad8; <br>QueueId_t egress_qid; ​// Egress (physical) queue id via<br>// which this packet was served.<br>bit&lt;5&gt; _pad9;<br>bit&lt;3&gt; egress_cos; ​// Egress cos (eCoS) value.<br>bit&lt;7&gt; _pad10;<br>bit&lt;1&gt; deflection_flag; ​// Flag indicating whether a packet is<br>// deflected due to deflect_on_drop.<br>bit&lt;2&gt; _pad11;<br>bit&lt;14&gt; pkt_length; ​// Packet length, in bytes<br>}</p>
<p>所有egress intrinsic metadata都是只读字段。不能在egress中进行修改。</p>
<h3 id="Unicast"><a href="#Unicast" class="headerlink" title="Unicast"></a>Unicast</h3><p>egress_port字段指定包的输出端口。由于该字段是只读的，因此egress不能通过修改该字段将包重定向到另一个端口。由于deparser使用该字段，因此该字段必须由egress parser提取，无法提取该字段将导致数据包丢失。</p>
<h3 id="Buffer-Queueing"><a href="#Buffer-Queueing" class="headerlink" title="Buffer Queueing"></a>Buffer Queueing</h3><p>在Tofino中，每个出端口最多可以有8个FIFO队列，一个数据包可以加入8个FIFO队列之一。此外，Tofino PRE buffer被划分为最多4个应用程序池，这为不同的应用程序流量提供了隔离。队列可以属于且只能属于一个应用程序池。enq_qdepth、enq_congest_state、enq_tstamp、deq_qdepth、deq_congest_state和deq_timedelta字段提供关于包当前所在队列的信息。所有队列深度计数器的单位都是80字节。拥塞状态来自队列深度与队列颜色限制(由驱动程序设置)的比较。编码如下</p>
<p>![1568107064901](E:\Desktop\笔记\TNA model\1568107064901.png)</p>
<p>enq_tstamp捕获包进入队列时的时间戳，以纳秒为单位。deq_timedelta捕获包在PRE中进入队列与离开队列之间的时间差，以纳秒为单位。</p>
<h3 id="Packet-Replication"><a href="#Packet-Replication" class="headerlink" title="Packet Replication"></a>Packet Replication</h3><p>数据包可能需要复制到相同的物理出端口。例如，当多个多播组共享同一个物理端口时，就会发生这种情况。Replication ID (RID)与包的每个副本相关联，以便交换机能够区分多播包的不同实例。一个{RID, egress port}的元组惟一地标识每个多播实例。</p>
<h3 id="Output-Queue"><a href="#Output-Queue" class="headerlink" title="Output Queue"></a>Output Queue</h3><p>Tofino MAC支持高达100 Gbps的数据速率和多达32个硬件队列。每个MAC可以进一步划分为4个通道，每个通道运行速度为25 Gbps。32个硬件队列可以配置并分配给4个通道中的任何一个。分配不必是统一的。例如，将4个队列分配给一个通道，将12个队列分配给另一个通道都是有效的。5位的egress_qid表示数据包所使用的32个硬件队列中的哪一个。每个硬件队列都可以配置一个3位服务等级(Class Of Service, COS)值。优先流控制(Priority Flow Control, PFC)使用COS实现来自下游端口的反压力，以限制上游端口中某些类的流量。每个硬件队列属于8个服务类中的一个。每个硬件队列的COS配置由驱动程序执行。PRE给出egress COS值，egress control块可以使用该值判断数据包属于哪一类服务。</p>
<h3 id="Packet-Length"><a href="#Packet-Length" class="headerlink" title="Packet Length"></a>Packet Length</h3><p>该字段的意义取决于包的类型。对于从ingress到egress的普通数据包，数据包长度是在ingress处理前的传入数据包的长度。对于从ingress镜像到egress的数据包，包长度是ingress处理前的包长度+附加镜像头的大小+ CRC的4字节。对于从egress镜像到egress的数据包，包长度为经过egress pipeline修改后的包的长度+额外镜像头的大小+ CRC的4字节。长度以字节计算。</p>
<h3 id="Match-types"><a href="#Match-types" class="headerlink" title="Match types"></a>Match types</h3><p>TNA在标准P4 16 match_kind类型的基础上支持另外两个match_kind类型。</p>
<p>match_kind {<br>range, // Used to represent min..max intervals<br>selector // Used for implementing ActionSelection<br>}</p>
<p>在TNA中，表键可以匹配范围(start, end)内的值，包括开始值，不包括结束值，这意味着start、start + 1、end - 1之间的任何值都将可以匹配。每个范围匹配条目使用多个TCAM条目。默认情况下，编译器假设表中25%的条目是范围条目。因此，范围匹配类型的表所消耗的TCAM条目的总数等于</p>
<p>75% × table size + 25% × table size × number of TCAM entries per range entry</p>
<p>每个范围条目最多使用8个TCAM条目，并且特定于实际范围值。某些范围值可能需要较少的TCAM条目来实现。</p>
<p>可以使用编译指示entries_with_ranges调整同一表中范围条目与非范围条目的比例。编译指示(pragma)指定表中范围条目的数量。如果编译指示指定的值大于表的大小，那么表中的所有条目都假定为范围条目。</p>
<p>选择器键只能在选择器表中使用。选择器表是一种特殊类型的表，其实现属性附加有操作选择器(请参阅“操作选择器”节)或操作概要文件(请参阅“操作概要文件”节)。选择器表中的键可以是选择器匹配类型和常规匹配类型(精确、三元、范围等)的混合。在匹配操作中使用常规匹配类型。选择器匹配类型用于选择操作概要文件和/或操作选择器中的多个操作之一。如果一个键同时用作常规匹配类型和选择器匹配类型，那么它需要在表键属性中以不同的匹配类型列出两次。</p>
<h2 id="Parser"><a href="#Parser" class="headerlink" title="Parser"></a>Parser</h2><p>TNA支持单独的入口（ingress）和出口（egress）解析器。入口解析器是入口管道中的第一个可编程块。它从输入包缓冲区接收一个字节流，并将字节流解析为系统定义的或用户定义的头文件。在本文中，系统定义的头也称为内部元数据。用户定义的头来自P4程序。下面声明了P4中入口解析器的顶级接口</p>
<p>parser IngressParser&lt;H, M&gt;(<br>packet_in pkt,<br>out H hdr,<br>out M ig_md,<br>out ingress_intrinsic_metadata_t ig_intr_md);</p>
<p>当在P4程序中实例化一个ingress解析器时，用户必须向H和M提供具体的类型。例如，下面的示例将H绑定到headers_t，并将M绑定到metadata_t。</p>
<p>struct headers_t { … }<br>struct metadata_t { … }<br>parser myIngressParser&lt;headers_t, metadat_t&gt; (<br>packet_in pkt,<br>out headers_t hdr,<br>out metadata_t ig_md,<br>out ingress_intrinsic_metadata_t ig_intr_md) { … }</p>
<p>注意，在本例中省略了headers_t、metadata_t和myIngressParser的主体，因为它们与讨论无关。用户可以省略类型参数&lt;headers_t, metadata_t&gt;，编译器可以从参数列表中的参数推断这些类型参数的值。因此，下面的代码相当于上面的示例。</p>
<p>struct headers_t { … }<br>struct metadata_t { … }<br>parser myIngressParser (<br>packet_in pkt,<br>out headers_t hdr,<br>out metadata_t ig_md,<br>out ingress_intrinsic_metadata_t ig_intr_md) { … }</p>
<p>ingress解析器接受四个参数。第一个参数是名为pkt的packet_in外部类型的无方向实例。从概念上讲，pkt对象提供了从输入缓冲区对原始字节流的访问。用户可以调用pkt对象上的extract或advance方法来将字节流解析为内部元数据或用户定义的头文件。第二个参数是用户定义结构类型，用于表示所有提取的头类型。第三个参数是另一个用户定义的结构类型，用于表示解析器初始化的所有元数据。第四个参数是由TNA体系结构定义的ingress解析器内部元数据类型。我们将在下面详细解释每种结构类型。</p>
<h3 id="Ingress-Intrinsic-Metadata"><a href="#Ingress-Intrinsic-Metadata" class="headerlink" title="Ingress Intrinsic Metadata"></a>Ingress Intrinsic Metadata</h3><p>TNA在每个包的传入字节流的开始处采用特定的布局。</p>
<p>![1568174993199](E:\Desktop\笔记\TNA model\1568174993199.png)</p>
<p>如上图所示，字节流布局取决于传入包的类型。TNA没有假设如何解析字节流，因此，P4程序员有责任实现正确的解析器逻辑来处理这些不同的布局。字节0到7保存着所有包类型所共有的入口固有元数据。建议ingress解析器将ingress内部元数据提取到提供的ingress_intrinsic_metadata_t参数中。</p>
<p>字节8到15包含phase-0 metadata或resubmit metadata。phase-0 metadata和resubmit metadata的布局由P4程序定义，最大大小为8字节，应用程序可以使用8字节或更少，未使用的字节用零填充。关于phase-0 metadata和resubmit metadata的其他详细信息在前面的元数据类型一节中提供。</p>
<p>如果一个包是一个再循环的包，那么这个包可能在phase-0头之后有可选的再循环头，并且头必须由入口解析器解析。如果不使用循环头，则循环头的大小为零，不需要解析逻辑。如果包是由内部包生成器生成的，则包可能在阶段0头之后具有可选的pktgen头。如果不使用pktgen头，则pktgen头的大小为零，不需要解析逻辑。最后，字节流的其余部分是从网络接收到的实际字节。</p>
<p>下图显示了ingress内部元数据的布局。图中显示了按网络顺序排列的布局，即第0位是ingress解析器接收到的第一个位。</p>
<p>![1568175571848](E:\Desktop\笔记\TNA model\1568175571848.png)</p>
<p>下面的P4源代码显示了TNA中ingress内部元数据的定义。</p>
<p>header ingress_intrinsic_metadata_t {<br>bit&lt;1&gt; resubmit_flag; // Flag distinguishing original  packets from resubmitted packets.<br>bit&lt;1&gt; _pad1;<br>bit&lt;2&gt; packet_version; // Read-only Packet version.<br>bit&lt;3&gt; _pad2;<br>PortId_t ingress_port; // Ingress physical port id.<br>bit&lt;48&gt; ingress_mac_tstamp; // Ingress IEEE 1588 timestamp (in ns)<br>}</p>
<h3 id="Egress-Intrinsic-Metadata"><a href="#Egress-Intrinsic-Metadata" class="headerlink" title="Egress Intrinsic Metadata"></a>Egress Intrinsic Metadata</h3><p>下图显示了在出口解析器中接收到的数据包的布局。包有两种类型:普通包和镜像包。正常数据包是经过ingress处理后的数据包。镜像包是PRE创建的传入包的副本。在TNA中，可以从ingress deparser或egress deparser进行镜像，镜像的流量被发送到egress deparser。关于镜像的详细信息将在后面的“镜像”一节中解释。</p>
<p>普通包和镜像包都以26个字节的内在元数据开始。出口解析器必须实现提取出口内在元数据的逻辑。在内部元数据之后，普通包包含桥接报头。桥接报头没有大小限制，然而，过多的桥接元数据会损害总体吞吐量。镜像包在内部元数据之后最多可以有32字节的镜像头数据。P4程序的职责是实现提取镜像头部的逻辑。对于小于32字节的镜像头，没有填充。</p>
<p>![1568176041043](E:\Desktop\笔记\TNA model\1568176041043.png)</p>
<p>header resubmit_metadata_t {<br>// fields omitted for brevity<br>}<br>header port_metadata_t {<br>// fields omitted for brevity<br>}<br>parser TofinoIngressParser(packet_in pkt, out<br>ingress_intrinsic_metadata_t ig_intr_md) {<br>state start {<br>pkt.extract(ig_intr_md);<br>transition select(ig_intr_md.resubmit_flag) {<br>1 : parse_resubmit;<br>0 : parse_port_metadata;<br>}<br>}<br>state parse_resubmit {<br>pkt.extract<resubmit_metadata_t>(<em>);<br>transition reject;<br>}<br>state parse_port_metadata {<br>pkt.extract<port_metadata_t>(</em>);<br>transition accept;<br>}<br>}<br>parser TofinoEgressParser(packet_in pkt,<br>out egress_intrinsic_metadata_t eg_intr_md) {<br>state start {<br>pkt.extract(eg_intr_md);<br>transition accept;<br>}<br>}</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2021/03/24/TNA%20model/" data-id="ckmn1li24000gn8a82mqxeo8q" data-title="" class="article-share-link">Teilen</a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-pktgen功能" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2021/03/24/pktgen%E5%8A%9F%E8%83%BD/" class="article-date">
  <time class="dt-published" datetime="2021-03-24T06:02:27.877Z" itemprop="datePublished">2021-03-24</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>#pktgen功能</p>
<p>I:\bf-sde-8.9.1\pkgsrc\p4-examples\p4_16_programs\tna_pktgen</p>
<p>###控制面配置pktgen相关表</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">pktgen_app_cfg_table &#x3D; bfrt_info.table_get(&quot;$PKTGEN_APPLICATION_CFG&quot;)</span><br><span class="line">pktgen_pkt_buffer_table &#x3D; bfrt_info.table_get(&quot;$PKTGEN_PKT_BUFFER&quot;)</span><br><span class="line">pktgen_port_cfg_table &#x3D; bfrt_info.table_get(&quot;$PKTGEN_PORT_CFG&quot;)</span><br></pre></td></tr></table></figure>

<p>###使能pktgen端口</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">pktgen_port_cfg_table.entry_add(</span><br><span class="line">	target,</span><br><span class="line">	[pktgen_port_cfg_table.make_key([gc.KeyTuple(&#39;dev_port&#39;, timer_port)])],</span><br><span class="line">	[pktgen_port_cfg_table.make_data([gc.DataTuple(&#39;pktgen_enable&#39;, bool_val&#x3D;True)])])</span><br></pre></td></tr></table></figure>

<p>entry_add用于向表table中添加表项entry，make_key用于设置P4程序中定义的表table的匹配字段key，make_data用于设置表项的操作action及其参数action_data。</p>
<p><code>def entry_add(self, target, key_list=None, data_list=None, atomicity=bfruntime_pb2.WriteRequest.CONTINUE_ON_ERROR)</code></p>
<p><code>def make_key(self, key_field_list_in)</code></p>
<p>``def make_data(self, data_field_list_in=[], action_name=None, get=False)`</p>
<p>例如，有如下P4程序：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">action miss() &#123;</span><br><span class="line">  ig_intr_dprsr_md.drop_ctl &#x3D; 0x1;</span><br><span class="line">&#125;</span><br><span class="line">action match(PortId_t port) &#123;</span><br><span class="line">  ig_intr_tm_md.ucast_egress_port &#x3D; port;</span><br><span class="line">  ig_intr_tm_md.bypass_egress &#x3D; true;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">table port_metadata &#123;</span><br><span class="line">  key &#x3D; &#123;</span><br><span class="line">    ig_intr_md.ingress_port : exact;</span><br><span class="line">    md.is_pktgen : exact;</span><br><span class="line">    md.app_type : exact;</span><br><span class="line">    md.app_id : exact;</span><br><span class="line">  &#125;</span><br><span class="line">  actions &#x3D; &#123;</span><br><span class="line">    miss;</span><br><span class="line">    match;</span><br><span class="line">  &#125;</span><br><span class="line">  default_action &#x3D; miss();</span><br><span class="line">  size &#x3D; 288;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>对应的表项添加操作如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">i_port_metadata_table &#x3D; bfrt_info.table_get(&quot;i.port_metadata&quot;)</span><br><span class="line">i_port_metadata_table.entry_add(</span><br><span class="line">        target,</span><br><span class="line">        [self.i_port_metadata_table.make_key([gc.KeyTuple(&#39;ig_intr_md.ingress_port&#39;, i_port),</span><br><span class="line">         gc.KeyTuple(&#39;md.is_pktgen&#39;, 1),</span><br><span class="line">         gc.KeyTuple(&#39;md.app_type&#39;, app_type),</span><br><span class="line">         gc.KeyTuple(&#39;md.app_id&#39;, app_id)])],</span><br><span class="line">         [self.i_port_metadata_table.make_data([gc.DataTuple(&#39;port&#39;, o_port)],</span><br><span class="line">            &#39;i.match&#39;)]</span><br><span class="line">    )</span><br></pre></td></tr></table></figure>
<h3 id="配置pktgen-APP"><a href="#配置pktgen-APP" class="headerlink" title="配置pktgen APP"></a>配置pktgen APP</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">pktgen_app_cfg_table.entry_add(</span><br><span class="line">	target,</span><br><span class="line">	[pktgen_app_cfg_table.make_key([gc.KeyTuple(&#39;app_id&#39;, app_id)])],</span><br><span class="line">	[pktgen_app_cfg_table.make_data([gc.DataTuple(&#39;timer_nanosec&#39;, 100),</span><br><span class="line">                 gc.DataTuple(&#39;app_enable&#39;,bool_val&#x3D;False),</span><br><span class="line">                 gc.DataTuple(&#39;pkt_len&#39;, (pktlen-6)),</span><br><span class="line">                 gc.DataTuple(&#39;pkt_buffer_offset&#39;, buff_offset),</span><br><span class="line">                 gc.DataTuple(&#39;pipe_local_source_port&#39;, timer_port),</span><br><span class="line">                 gc.DataTuple(&#39;increment_source_port&#39;, bool_val&#x3D;False),</span><br><span class="line">                 gc.DataTuple(&#39;batch_count_cfg&#39;, b_count-1),</span><br><span class="line">                 gc.DataTuple(&#39;packets_per_batch_cfg&#39;, p_count-1),</span><br><span class="line">                 gc.DataTuple(&#39;ibg&#39;, 1),</span><br><span class="line">                 gc.DataTuple(&#39;ibg_jitter&#39;, 0),</span><br><span class="line">                 gc.DataTuple(&#39;ipg&#39;, 1000),</span><br><span class="line">                 gc.DataTuple(&#39;ipg_jitter&#39;, 500),</span><br><span class="line">                 gc.DataTuple(&#39;batch_counter&#39;, 0),</span><br><span class="line">                 gc.DataTuple(&#39;pkt_counter&#39;, 0),</span><br><span class="line">                 gc.DataTuple(&#39;trigger_counter&#39;, 0)],</span><br><span class="line">                &#39;$PKTGEN_TRIGGER_TIMER_ONE_SHOT&#39;)])</span><br></pre></td></tr></table></figure>

<h3 id="配置pktgen-buffer"><a href="#配置pktgen-buffer" class="headerlink" title="配置pktgen buffer"></a>配置pktgen buffer</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">pktgen_pkt_buffer_table.entry_add(</span><br><span class="line">	target</span><br><span class="line">	[pktgen_pkt_buffer_table.make_key([gc.KeyTuple(&#39;pkt_buffer_offset&#39;, buff_offset),</span><br><span class="line">	 gc.KeyTuple(&#39;pkt_buffer_size&#39;, (pktlen-6))])],</span><br><span class="line">	[pktgen_pkt_buffer_table.make_data([gc.DataTuple(&#39;buffer&#39;, str(p)[6:])])])</span><br></pre></td></tr></table></figure>

<h3 id="使能pktgen"><a href="#使能pktgen" class="headerlink" title="使能pktgen"></a>使能pktgen</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">pktgen_app_cfg_table.entry_mod(</span><br><span class="line">	target,</span><br><span class="line">	[pktgen_app_cfg_table.make_key([gc.KeyTuple(&#39;app_id&#39;, app_id)])],</span><br><span class="line">	[pktgen_app_cfg_table.make_data([gc.DataTuple(&#39;app_enable&#39;,bool_val&#x3D;True)],</span><br><span class="line">	 &#39;$PKTGEN_TRIGGER_TIMER_ONE_SHOT&#39;)]</span><br><span class="line">            )</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="如何识别app-id-lookahead方法使用"><a href="#如何识别app-id-lookahead方法使用" class="headerlink" title="如何识别app_id(lookahead方法使用)"></a>如何识别app_id(lookahead方法使用)</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bit&lt;3&gt; app_id &#x3D; packet.lookahead&lt;bit&lt;8&gt;&gt;()[2:0];</span><br></pre></td></tr></table></figure>
<p>接收到的二进制数据流从bit0开始，即LSB-&gt;MSB，通过lookahead操作会转换为0xMSB-LSB，切片操作相当于把byte当成字符串，索引从MSB开始。<br>例如接收到的二进制数据流为：<code>packet= 01101001_11010110</code>，在不移动当前指针的情况下获取接下来8bit数据：<code>data8=packet.lookahead&lt;bit&lt;8&gt;&gt;()=10010110</code>， 切片操作<code>data3=data8[2:0]=100</code>。<br>header结构按接收到的字节流定义，例如有如下header结构：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">header ingress_intrinsic_metadata_t &#123;</span><br><span class="line">    bit&lt;1&gt; resubmit_flag;</span><br><span class="line">    bit&lt;1&gt; _pad1;</span><br><span class="line">    bit&lt;2&gt; packet_version;</span><br><span class="line">    bit&lt;3&gt; _pad2;</span><br><span class="line">    PortId_t ingress_port;</span><br><span class="line">    bit&lt;48&gt; ingress_mac_tstamp;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>对应的Layout为</p>
<p><img src="E:\Desktop\笔记\pktgen功能\1570762344090.png" alt="1570762344090"></p>
<p>pktgen中timer触发类型的header结构如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">header pktgen_timer_header_t &#123;</span><br><span class="line">    bit&lt;3&gt; _pad1;</span><br><span class="line">    bit&lt;2&gt; pipe_id; ​&#x2F;&#x2F; Pipe id </span><br><span class="line">    bit&lt;3&gt; app_id; ​&#x2F;&#x2F; Application id</span><br><span class="line">    bit&lt;8&gt; _pad2;</span><br><span class="line">    bit&lt;16&gt; batch_id; ​&#x2F;&#x2F; Start at 0 and increment to a programmed number  </span><br><span class="line">    bit&lt;16&gt; packet_id; ​&#x2F;&#x2F; Start at 0 and increment to a programmed number</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>
<p>对应的字节流为:<br><code>packet = |_pad1_LSB|.|pad1_MSB| |pip_id_LSB||pip_id_MSB| |app_id_LSB|.|app_id_MSB|...</code><br>在不extract提取报头（即不移动当前指针）的情况下获取app_id，可通过lookahead操作获取当前指针后8bit数据:<br><code>packet.lookahead&lt;bit&lt;8&gt;&gt;()=|app_id_MSB|.|app_id_LSB||pip_id_MSB||pip_id_LSB||pad1_MSB|. |_pad1_LSB|</code>，<br>通过切片操作获得app_id：<br><code>app_id = packet.lookahead&lt;bit&lt;8&gt;&gt;()[2:0] = |app_id_MSB|.|app_id_LSB|</code></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2021/03/24/pktgen%E5%8A%9F%E8%83%BD/" data-id="ckmn1lhzm0008n8a8eh4ug0t2" data-title="" class="article-share-link">Teilen</a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-ORM 框架-三层开发架构-中间件" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2021/03/24/ORM%20%E6%A1%86%E6%9E%B6-%E4%B8%89%E5%B1%82%E5%BC%80%E5%8F%91%E6%9E%B6%E6%9E%84-%E4%B8%AD%E9%97%B4%E4%BB%B6/" class="article-date">
  <time class="dt-published" datetime="2021-03-24T06:02:27.869Z" itemprop="datePublished">2021-03-24</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h2 id="ORM-框架-三层开发架构-中间件"><a href="#ORM-框架-三层开发架构-中间件" class="headerlink" title="ORM 框架\三层开发架构\中间件"></a>ORM 框架\三层开发架构\中间件</h2><p>[toc]</p>
<p>对象-关系映射（Object/Relation Mapping，简称ORM），是随着面向对象的软件开发方法发展而产生的。面向对象的开发方法是当今企业级应用开发环境中的主流开发方法，关系数据库是企业级应用环境中永久存放数据的主流数据存储系统。对象和关系数据是业务实体的两种表现形式，业务实体在内存中表现为对象，在数据库中表现为关系数据。内存中的对象之间存在关联和继承关系，而在数据库中，关系数据无法直接表达多对多关联和继承关系。因此，对象-关系映射(ORM)系统一般以中间件的形式存在，主要实现程序对象到关系数据库数据的映射。</p>
<p>ORM方法论基于三个核心原则：</p>
<ul>
<li>  简单性：以最基本的形式建模数据。</li>
<li>  传达性：数据库结构被任何人都能理解的语言文档化。</li>
<li>  精确性：基于数据模型创建正确标准化了的结构。</li>
</ul>
<p>面向对象是从软件工程基本原则(如耦合、聚合、封装)的基础上发展起来的，而关系数据库则是从数学理论发展而来的，两套理论存在显著的区别。为了解决这个不匹配的现象,对象关系映射技术应运而生。O/R中字母O起源于”对象”(Object),而R则来自于”关系”(Relational)。几乎所有的程序里面，都存在对象和关系数据库。在业务逻辑层和用户界面层中，我们是面向对象的。当对象信息发生变化的时候，我们需要把对象的信息保存在关系数据库中。</p>
<p>当开发一个应用程序的时候(不使用O/R Mapping),可能会写不少数据访问层的代码，用来从数据库保存，删除，读取对象信息，等等。在DAL中写了很多的方法来读取对象数据，改变状态对象等等任务。而这些代码写起来总是重复的。</p>
<p>如果开你最近的程序，看看DAL代码，肯定会看到很多近似的通用的模式。我们以保存对象的方法为例，传入一个对象，为SqlCommand对象添加SqlParameter，把所有属性和对象对应，设置SqlCommand的CommandText属性为存储过程，然后运行SqlCommand。对于每个对象都要重复的写这些代码。　　除此之外，还有更好的办法吗？有，引入一个O/R Mapping。实质上，一个O/R Mapping会为你生成DAL。与其自己写DAL代码，不如用O/R Mapping。用O/R Mapping保存，删除，读取对象，O/R Mapping负责生成SQL，你只需要关心对象就好。对象关系映射成功运用在不同的面向对象持久层产品中，</p>
<p> 一般的ORM包括以下四部分：　　</p>
<ul>
<li>  一个对持久类对象进行CRUD操作的API；　　</li>
<li>  一个语言或API用来规定与类和类属性相关的查询；　　</li>
<li>  一个规定mapping metadata的工具；　　</li>
<li>  一种技术可以让ORM的实现同事务对象一起进行dirty checking, lazy association fetching以及其他的优化操作。</li>
</ul>
<p>目前流行的 ORM 产品<br> Java系列：　</p>
<ul>
<li>   Apache OJB 　</li>
<li>   Cayenne 　　</li>
<li>   Jaxor 　　</li>
<li>   Hibernate　　</li>
<li>   iBatis　　</li>
<li>   jRelationalFramework 　</li>
<li>   mirage 　　</li>
<li>   SMYLE 　　</li>
<li>   TopLink</li>
</ul>
<p> 其中 TopLink 是 Oracle 的商业产品，其他均为开源项目。　　其中 Hibernate 的轻量级 ORM 模型逐步确立了在 Java ORM 架构中领导地位，甚至取代复杂而又繁琐的 EJB 模型而成为事实上的 Java ORM 工业标准。而且其中的许多设计均被 J2EE 标准组织吸纳而成为最新 EJB 3.0 规范的标准，</p>
<p>.Net系列：　</p>
<ul>
<li> NHibernate</li>
<li> NBear</li>
<li> Castle ActiveRecord</li>
<li> iBATIS.NET</li>
<li> DAAB　</li>
<li> EntitysCodeGenerate</li>
<li> EntityFormerWork</li>
<li> Linq to sql</li>
<li> PetaPoco</li>
</ul>
<p>一．NHibernate<br>   提起NHibernate，相信大家都不陌生，NHibernate来源于非常优秀的基于Java的Hibernate关系型持久化工具，它从数据库底层来持久化.Net对象到关系型数据库,NHibernate为我们完成这一切，而不用自己写SQL语句去操作数据库对象，所写的代码仅仅和对象关联，NHibernat自动产生SQL语句，并确保对象提交到正确的表和字段中去.大量减少开发时人工使用SQL和ADO.NET处理数据的时间. NHibernate可以帮助消除或者包装那些针对特定数据库的SQL代码，并且把结果集从表格的表示形式转换到一系列的对象去。NHibernate采用XML文件配置的方式，每一个实体类都会对应一个映射文件</p>
<p>二、EntitysCodeGenerate</p>
<p>EntitysCodeGenerate　 ：是（VB/C#.Net实体代码生成工具）的简称，EntitysCodeGenerate(ECG)是一款专门为.Net数据库程序开发量身定做的(ORM框架)代码生成工具，所生成的程序代码基于面向对象、分层架构、ORM及反射+工厂模式等。</p>
<p>三、 PetaPoco</p>
<p>PetaPoco是一款适用于.Net 和Mono的微小、快速、单文件的微型ORM。</p>
<p>PetaPoco有以下特色：</p>
<ul>
<li>微小，没有依赖项……单个的C#文件可以方便的添加到任何项目中。</li>
<li>工作于严格的没有装饰的Poco类，和几乎全部加了特性的Poco类</li>
<li>Insert/Delete/Update/Save and IsNew 等帮助方法。</li>
<li>分页支持：自动得到总行数和数据</li>
<li>支持简单的事务</li>
<li>更好的支持参数替换，包括从对象属性中抓取命名的参数。</li>
<li>很好的性能，剔除了Linq，并通过Dynamic方法快速的为属性赋值</li>
<li>T4模板自动生成Poco类</li>
<li>查询语言是Sql……不支持别扭的fluent或Linq语法（仁者见仁，智者见智）</li>
<li>包含一个低耦合的Sql Builder类，让内联的Sql更容易书写</li>
<li>为异常信息记录、值转换器安装和数据映射提供钩子。（Hooks for logging exceptions, installing value converters and mapping columns to properties without attributes.）</li>
<li>兼容SQL Server, SQL Server CE, MySQL, PostgreSQL and Oracle。</li>
<li>可以在.NET 3.5 或Mono 2.6或更高版本上运行</li>
<li>在.NET 4.0 和Mono 2.8下支持dynamic</li>
<li>NUnit单元测试</li>
<li>开源（Apache License）</li>
<li>所有功能大约用了1500行代码</li>
</ul>
<h2 id="CRUD"><a href="#CRUD" class="headerlink" title="CRUD"></a>CRUD</h2><p> CRUD是指在做计算处理时的增加(Create)、读取(Read)、更新(Update)和删除(Delete)几个单词的首字母简写。crud主要被用在描述软件系统中数据库或者<a target="_blank" rel="noopener" href="https://baike.baidu.com/item/%E6%8C%81%E4%B9%85%E5%B1%82/3584971">持久层</a>的基本操作功能。 </p>
<p>DAL是数据访问层的英文缩写，即为数据访问层（Data Access Layer）。其功能主要是负责数据库的访问。简单地说就是实现对数据表的Select（查询）、Insert（插入）、Update（更新）、Delete（删除）等操作。 </p>
<h2 id="三层开发架构"><a href="#三层开发架构" class="headerlink" title="三层开发架构"></a>三层开发架构</h2><p>三层架构(3-tier architecture) 通常意义上的三层架构就是将整个业务应用划分为：界面层（User Interface layer）、业务逻辑层（Business Logic Layer）、数据访问层（Data access layer）。区分层次的目的即为了“高内聚低耦合”的思想。在软件体系架构设计中，分层式结构是最常见，也是最重要的一种结构。微软推荐的分层式结构一般分为三层，从下至上分别为：数据访问层、业务逻辑层（又或称为领域层）、表示层。</p>
<h3 id="1-表示层（USL）"><a href="#1-表示层（USL）" class="headerlink" title="1.表示层（USL）"></a>1.表示层（USL）</h3><p>主要表示WEB方式，也可以表示成WINFORM方式。如果逻辑层相当强大和完善，无论表现层如何定义和更改，逻辑层都能完善地提供服务。</p>
<p>表示层又称表现层UI，位于三层构架的最上层，与用户直接接触，主要是B/S信息系统中的Web浏览页面。作为Web浏览页面，表示层的主要功能是实现系统数据的传入与输出，在此过程中不需要借助逻辑判断操作就可以将数据传送到BLL系统中进行数据处理，处理后会将处理结果反馈到表示层中。换句话说，表示层就是实现用户界面功能，将用户的需求传达和反馈，并用BLL或者是Models进行调试，保证用户体验。 </p>
<h3 id="2-业务逻辑层（BLL）："><a href="#2-业务逻辑层（BLL）：" class="headerlink" title="2.业务逻辑层（BLL）："></a>2.业务逻辑层（BLL）：</h3><p>主要是针对具体的问题的操作，也可以理解成对数据层的操作，对数据业务逻辑处理。如果说数据层是积木，那逻辑层就是对这些积木的搭建。</p>
<p>业务逻辑层（Business Logic Layer）无疑是系统架构中体现核心价值的部分。它的关注点主要集中在业务规则的制定、业务流程的实现等与业务需求有关的系统设计，也即是说它是与系统所应对的领域（Domain）逻辑有关，很多时候，也将业务逻辑层称为领域层。 </p>
<p>业务逻辑层负责系统领域业务的处理，负责逻辑性数据的生成、处理及转换。对所输入的逻辑性数据的正确性及有效性负责，但对输出的逻辑性数据及用户性数据的正确性不负责，对数据的呈现样式不负责。 </p>
<p>业务逻辑层BLL的功能是对具体问题进行逻辑判断与执行操作，接收到表现层UI的用户指令后，会连接数据访问层DAL，访问层在三层构架中位于表示层与数据层中间位置，同时也是表示层与数据层的桥梁，实现三层之间的数据连接和指令传达，可以对接收数据进行逻辑处理，实现数据的修改、获取、删除等功能，并将处理结果反馈到表示层UI中，实现软件功能。 </p>
<p>例如Martin Fowler在《Patterns of Enterprise Application Architecture》一书中，将整个架构分为三个主要的层：表示层、领域层和数据源层。作为领域驱动设计的先驱Eric Evans，对业务逻辑层作了更细致地划分，细分为应用层与领域层，通过分层进一步将领域逻辑与领域逻辑的解决方案分离。</p>
<p>业务逻辑层在体系架构中的位置很关键，它处于数据访问层与表示层中间，起到了数据交换中承上启下的作用。由于层是一种弱耦合结构，层与层之间的依赖是向下的，底层对于上层而言是“无知”的，改变上层的设计对于其调用的底层而言没有任何影响。如果在分层设计时，遵循了面向接口设计的思想，那么这种向下的依赖也应该是一种弱依赖关系。因而在不改变接口定义的前提下，理想的分层式架构，应该是一个支持可抽取、可替换的“抽屉”式架构。正因为如此，业务逻辑层的设计对于一个支持可扩展的架构尤为关键，因为它扮演了两个不同的角色。对于数据访问层而言，它是调用者；对于表示层而言，它却是被调用者。依赖与被依赖的关系都纠结在业务逻辑层上，如何实现依赖关系的解耦，则是除了实现业务逻辑之外留给设计师的任务。</p>
<h3 id="3-数据访问层（DAL）-数据访"><a href="#3-数据访问层（DAL）-数据访" class="headerlink" title="3.数据访问层（DAL） 数据访"></a>3.数据访问层（DAL） 数据访</h3><p>问层DAL是数据库的主要操控系统，实现数据的增加、删除、修改、查询等操作，并将操作结果反馈到业务逻辑层BLL。在实际运行的过程中，数据访问层没有逻辑判断能力，为了实现代码编写的严谨性，提高代码阅读程度，一般软件开发人员会在该层中编写DataAccessCommon，保证数据访问层DAL数据处理功能。</p>
<p>主要是对原始数据(数据库或者文本文件等存放数据的形式)的操作层，而不是指原始数据，也就是说，是对数据的操作，而不是数据库，具体为业务逻辑层或表示层提供数据服务。</p>
<p>数据库访问层：又称为DAL层，有时候也称为是持久层，其功能主要是负责数据库的访问。简单地说就是实现对数据表的Select（查询）、Insert（插入）、Update（更新）、Delete（删除）等操作。如果要加入ORM的思想，就会包括对象和数据表之间的映射，以及对象实体的持久化操作。</p>
<p>在项目实际开发过程，有的直接采用<a target="_blank" rel="noopener" href="https://baike.baidu.com/item/JDBC">JDBC</a>技术进行数据库持久化操作，有的采用目前很好用的<a target="_blank" rel="noopener" href="https://baike.baidu.com/item/ORM%E6%A1%86%E6%9E%B6">ORM框架</a>来进行数据库持久化操作。</p>
<p>抽取数据库访问层的主要作用是进行隔离，把与数据库打交道的事情都放在数据访问层解决，在服务层则只要调用数据访问层就可以了，不必和具体的ORM层实现相耦合。</p>
<p>讲到数据库访问层，不得不提下三层架构，通常会把应用系统划分为：表现层、业务逻辑层和数据库访问层。这样的设计目的是为了实现“高内聚，低耦合”的设计思想。数据库访问层在三层架构中只负责数据存储与读取。业务逻辑层作为数据库访问层的上层，内部调用数据库访问层提供的方法，来完成数据的存储与读取。数据库访问层与底层数据库应该是独立的，好的数据库访问层方案是能够在不修改程序代码功能的基础之上实现不同类型数据库的动态切换。我们比较熟悉的做法就是通过XML配置文件来完成底层数据库的切换。目前很多流行的数据库访问层框架都是采用这种方式来实现数据库的动态切换。数据访问层能够将应用程序中的数据持久化到存储介质中，通常我们使用的数据库都是关系型的数据库，采用的数据模型都是对象模型，这就需要数据库访问层实现对象模型与关系模型直接的、互相的转换。</p>
<p>DAO(Data Access Object)是一个数据访问接口，数据访问：顾名思义就是与数据库打交道。夹在业务逻辑与数据库资源中间。</p>
<p>在核心J2EE模式中是这样介绍DAO模式的：为了建立一个健壮的J2EE应用，应该将所有对数据源的访问操作抽象封装在一个公共API中。用程序设计的语言来说，就是建立一个接口，接口中定义了此应用程序中将会用到的所有事务方法。在这个应用程序中，当需要和数据源进行交互的时候则使用这个接口，并且编写一个单独的类来实现这个接口在逻辑上对应这个特定的数据存储。</p>
<h2 id="中间件"><a href="#中间件" class="headerlink" title="中间件"></a>中间件</h2><p> 中间件是介于应用系统和系统软件之间的一类软件，它使用系统软件所提供的基础服务（功能），衔接网络上应用系统的各个部分或不同的应用，能够达到资源共享、功能共享的目的。目前，它并没有很严格的定义，但是普遍接受IDC的定义：中间件是一种独立的系统软件服务程序，分布式应用软件借助这种软件在不同的技术之间共享资源，中间件位于客户机服务器的操作系统之上，管理计算资源和网络通信。从这个意义上可以用一个等式来表示中间件：中间件=平台+通信，这也就限定了只有用于分布式系统中才能叫中间件，同时也把它与支撑软件和实用软件区分开来。 </p>
<p>中间件是一类连接软件组件和应用的计算机软件，它包括一组服务。以便于运行在一台或多台机器上的多个软件通过网络进行交互。该技术所提供的互操作性，推动了一致分布式体系架构的演进，该架构通常用于支持并简化那些复杂的分布式应用程序，它包括web服务器、事务监控器和消息队列软件。 </p>
<p>中间件(middleware)是基础软件的一大类，属于可复用软件的范畴。顾名思义，中间件处于操作系统软件与用户的应用软件的中间。 </p>
<p>中间件在操作系统、网络和数据库之上，应用软件的下层，总的作用是为处于自己上层的应用软件提供运行与开发的环境，帮助用户灵活、高效地开发和集成复杂的应用软件。在众多关于中间件的定义中，比较普遍被接受的是IDC表述的：中间件是一种独立的系统软件或服务程序，分布式应用软件借助这种软件在不同的技术之间共享资源，中间件位于客户机服务器的操作系统之上，管理计算资源和网络通信。 </p>
<p>近年来，人类生活中越来越多的领域已经变得离不开计算机、网络技术以及通信技术。并且随着计算机技术的快速发展，更多的应用软件被要求在许多不同的网络协议、不同的硬件生产厂商以及不一样的网络平台和环境上运营。这导致了软件开发者需要面临数据离散、操作困难、系统匹配程度低，以及需要开发多种应用程序来达到运营的目的。所以，中间件技术的产生，在极大程度上减轻了开发者的负担，使得网络的运行更有效率。</p>
<h3 id="基本功能"><a href="#基本功能" class="headerlink" title="基本功能"></a>基本功能</h3><p>中间件是独立的系统级软件，连接操作系统层和应用程序层，将不同操作系统提供应用的接口标准化，协议统一化，屏蔽具体操作的细节，中间件一般提供如下功能： </p>
<p>####（1）通信支持</p>
<p>中间件为其所支持的应用软件提供平台化的运行环境，该环境屏蔽底层通信之间的接口差异，实现互操作，</p>
<p>所以通信支持是中间件一个最基本的功能。早期应用与分布式的中间件交互主要的通信方式为远程调用和消息两种方式。通信模块中，远程调用通过网络进行通信，通过支持数据的转换和通信服务，从而屏蔽不同的操作系统和网络协议。远程调用是提供给予过程的服务访问，为上层系统只提供非常简单的编程接口或过程调用模型。消息提供异步交互的机制。 [3]</p>
<p>####（2）应用支持</p>
<p>中间件的目的就是服务上层应用，提供应用层不同服务之间的互操作机制。它为上层应用开发提供统一的平台和运行环境，并封装不同操作系统提供API接口，向应用提供统一的标准接口，使应用的开发和运行与操作系统无关，实现其独立性。中间件松耦合的结构，标准的封装服务和接口，有效的互操作机制，从而给应用结构化和开发方法提供有力的支持。 </p>
<p>####（3）公共服务</p>
<p>公共服务是对应用软件中共性功能或约束的提取。将这些共性的功能或者约束分类实现，并支持复用，作为公共服务，提供给应用程序使用。通过提供标准、统一的公共服务，可减少上层应用的开发工作量，缩短应用的开发时间，并有助于提供应用软件的质量。  </p>
<h3 id="分类"><a href="#分类" class="headerlink" title="分类"></a>分类</h3><p>####（1）事务式中间件</p>
<p>事务式中间件又称事务处理管理程序，是当前用的最广泛的中间件之一，其主要功能是提供联机事务处理所需要的通信、并发访问控制、事务控制、资源管理、安全管理、负载平衡、故障恢复和其他必要的服务。事务式中间件支持大量客户进程的并发访问，具有极强的扩展性。由于事务式中间件具有可靠性高、极强的扩展性等特点，主要应用于电信、金融、飞机订票系统、证券等拥有大量客户的领域。 [3] </p>
<p>####（2）过程式中间件</p>
<p>过程式中间件又称远程过程调用中间件。过程中间件一般从逻辑上分为两部分：客户和服务器。客户和服务器是一个逻辑概念，既可以运行在同一计算机上，也可以运行在不同的计算机上，甚至客户和服务器底层的操作系统也可以不同。客户机和服务器之间的通信可以使用同步通信，也可以采用线程式异步调用。所以过程式中间件有较好的异构支持能力，简单易用，但由于客户和服务器之间采用访问连接，所以在易剪裁性和容错方面有一定的局限性。 [3] </p>
<p>####（3）面向消息的中间件</p>
<p>面向消息的中间件，简称为消息中间件，是一类以消息为载体进行通信的中间件，利用高效可靠的消息机制来实现不同应用间大量的数据交换。按其通信模型的不同，消息中间件的通信模型有两类：消息队列和消息传递。通过这两种消息模型，不同应用之间的通信和网络的复杂性脱离，摆脱对不同通信协议的依赖，可以在复杂的网络环境中高可靠、高效率的实现安全的异步通信。消息中间件的非直接连接，支持多种通信规程，达到多个系统之间的数据的共享和同步。面向消息中间件是一类常用的中间件。 </p>
<p>####（4）面向对象中间件</p>
<p>面向对象中间件又称分布对象中间件，是分布式计算技术和面向对象技术发展的结合，简称对象中间件。分布对象模型是面向对象模型在分布异构环境下的自然拓广。面向对象中间件给应用层提供过重不同形式的通信服务，通过这些服务，上层应用对事务处理、分布式数据访问，对象管理等处理更简单易行。OMG组织是分布对象技术标准化方面的国际组织，它制定出了CORBA等标准。 </p>
<p>####（5）Web应用服务器</p>
<p>Web应用服务器是Web服务器和应用服务器相结合的产物。应用服务器中间件可以说是软件的基础设施，利用构件化技术将应用软件整合到一个确定的协同工作环境中，并提供多种通信机制，事务处理能力，及应用的开发管理功能。由于直接支持三层或多层应用系统的开发，应用服务器受到了广大用户的欢迎，是目前中间件市场上竞争的热点，J2EE架构是目前应用服务器方面的主流标准。 </p>
<p>####（6）其他</p>
<p>新的应用需求、新的技术创新、新的应用领域促成了新的中间件产品的出现。如，ASAAC在研究标准航空电子体系结构时提出的通用系统管理GSM，属于典型的嵌入式航电系统的中间件，互联网云技术的发展云计算中间件、物流网的中间件等随着应用市场的需求应运而生。 </p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2021/03/24/ORM%20%E6%A1%86%E6%9E%B6-%E4%B8%89%E5%B1%82%E5%BC%80%E5%8F%91%E6%9E%B6%E6%9E%84-%E4%B8%AD%E9%97%B4%E4%BB%B6/" data-id="ckmn1li07000fn8a8euau8pyg" data-title="" class="article-share-link">Teilen</a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-指令重排序" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2021/03/24/%E6%8C%87%E4%BB%A4%E9%87%8D%E6%8E%92%E5%BA%8F/" class="article-date">
  <time class="dt-published" datetime="2021-03-24T06:02:27.856Z" itemprop="datePublished">2021-03-24</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="指令重排序"><a href="#指令重排序" class="headerlink" title="指令重排序"></a>指令重排序</h1><p>目录：<br>1.数据依赖性<br>2.程序顺序规则<br>3.重排序对多线程的影响<br>4.编译器重排序<br>5.指令集并行的重排序<br>6.内存系统的重排序<br>7.memory barrier<br>8.JDK 1.7 内存屏障实现</p>
<h2 id="1-数据依赖性"><a href="#1-数据依赖性" class="headerlink" title="1.数据依赖性"></a>1.数据依赖性</h2><p>如果两个操作访问同一个变量，且这两个操作中有一个为写操作，此时这两个操作之间就存在数据依赖性。数据依赖分下列三种类型：</p>
<p>| 名称 | 代码示例 | 说明 |<br>| 写后读 | a = 1;b = a; | 写一个变量之后，再读这个位置。 |<br>| 写后写 | a = 1;a = 2; | 写一个变量之后，再写这个变量。 |<br>| 读后写 | a = b;b = 1; | 读一个变量之后，再写这个变量。 |</p>
<p>上面三种情况，只要重排序两个操作的执行顺序，程序的执行结果将会被改变。</p>
<p>前面提到过，编译器和处理器可能会对操作做重排序。编译器和处理器在重排序时，会遵守数据依赖性，编译器和处理器不会改变存在数据依赖关系的两个操作的执行顺序。</p>
<p>注意，这里所说的数据依赖性仅针对单个处理器中执行的指令序列和单个线程中执行的操作，不同处理器之间和不同线程之间的数据依赖性不被编译器和处理器考虑。</p>
<h4 id="as-if-serial-语义"><a href="#as-if-serial-语义" class="headerlink" title="as-if-serial 语义"></a>as-if-serial 语义</h4><p>as-if-serial 语义的意思指：不管怎么重排序（编译器和处理器为了提高并行度），（单线程）程序的执行结果不能被改变。编译器，runtime 和处理器都必须遵守 as-if-serial 语义。</p>
<p>为了遵守 as-if-serial 语义，编译器和处理器不会对存在数据依赖关系的操作做重排序，因为这种重排序会改变执行结果。但是，如果操作之间不存在数据依赖关系，这些操作可能被编译器和处理器重排序。为了具体说明，请看下面计算圆面积的代码示例：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">double</span> pi  = <span class="number">3.14</span>;    <span class="comment">//A</span></span><br><span class="line"><span class="keyword">double</span> r   = <span class="number">1.0</span>;     <span class="comment">//B</span></span><br><span class="line"><span class="keyword">double</span> area = pi * r * r; <span class="comment">//C  </span></span><br></pre></td></tr></table></figure>

<p>上面三个操作的数据依赖关系如下图所示：</p>
<p><img src="https://upload-images.jianshu.io/upload_images/10803273-bcfc7e3373884054..png?imageMogr2/auto-orient/strip%7CimageView2/2/w/188/format/webp" alt="img"></p>
<p>image</p>
<p>如上图所示，A 和 C 之间存在数据依赖关系，同时 B 和 C 之间也存在数据依赖关系。因此在最终执行的指令序列中，C 不能被重排序到 A 和 B 的前面（C 排到 A 和 B 的前面，程序的结果将会被改变）。但 A 和 B 之间没有数据依赖关系，编译器和处理器可以重排序 A 和 B 之间的执行顺序。下图是该程序的两种执行顺序：</p>
<p><img src="https://upload-images.jianshu.io/upload_images/10803273-bec9a75cd5fd4ae8..png?imageMogr2/auto-orient/strip%7CimageView2/2/w/387/format/webp" alt="img"></p>
<p>image</p>
<p>as-if-serial 语义把单线程程序保护了起来，遵守 as-if-serial 语义的编译器，runtime 和处理器共同为编写单线程程序的程序员创建了一个幻觉：单线程程序是按程序的顺序来执行的。as-if-serial 语义使单线程程序员无需担心重排序会干扰他们，也无需担心内存可见性问题。</p>
<h2 id="2-程序顺序规则"><a href="#2-程序顺序规则" class="headerlink" title="2.程序顺序规则"></a>2.程序顺序规则</h2><p>根据 happens- before 的程序顺序规则，上面计算圆的面积的示例代码存在三个 happens- before 关系：</p>
<ol>
<li>A happens- before B；</li>
<li>B happens- before C；</li>
<li>A happens- before C；</li>
</ol>
<p>这里的第3个 happens- before 关系，是根据 happens- before 的传递性推导出来的。</p>
<p>这里 A happens- before B，但实际执行时 B 却可以排在 A 之前执行（看上面的重排序后的执行顺序）。在第一章提到过，如果 A happens- before B，JMM 并不要求 A 一定要在 B 之前执行。JMM 仅仅要求前一个操作（执行的结果）对后一个操作可见，且前一个操作按顺序排在第二个操作之前。这里操作 A 的执行结果不需要对操作 B 可见；而且重排序操作 A 和操作 B 后的执行结果，与操作 A 和操作 B 按 happens- before 顺序执行的结果一致。在这种情况下，JMM 会认为这种重排序并不非法（not illegal），JMM 允许这种重排序。</p>
<p>在计算机中，软件技术和硬件技术有一个共同的目标：在不改变程序执行结果的前提下，尽可能的开发并行度。编译器和处理器遵从这一目标，从 happens- before 的定义我们可以看出，JMM 同样遵从这一目标。</p>
<h2 id="3-重排序对多线程的影响"><a href="#3-重排序对多线程的影响" class="headerlink" title="3.重排序对多线程的影响"></a>3.重排序对多线程的影响</h2><p>现在让我们来看看，重排序是否会改变多线程程序的执行结果。请看下面的示例代码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ReorderExample</span> </span>&#123;</span><br><span class="line"><span class="keyword">int</span> a = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">boolean</span> flag = <span class="keyword">false</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">writer</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    a = <span class="number">1</span>;                   <span class="comment">//1</span></span><br><span class="line">    flag = <span class="keyword">true</span>;             <span class="comment">//2</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">Public <span class="keyword">void</span> <span class="title">reader</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (flag) &#123;                <span class="comment">//3</span></span><br><span class="line">        <span class="keyword">int</span> i =  a * a;        <span class="comment">//4</span></span><br><span class="line">        ……</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;  </span><br></pre></td></tr></table></figure>

<p>flag 变量是个标记，用来标识变量 a 是否已被写入。这里假设有两个线程 A 和 B，A 首先执行writer() 方法，随后 B 线程接着执行 reader() 方法。线程B在执行操作4时，能否看到线程 A 在操作1对共享变量 a 的写入？</p>
<p>答案是：不一定能看到。</p>
<p>由于操作1和操作2没有数据依赖关系，编译器和处理器可以对这两个操作重排序；同样，操作3和操作4没有数据依赖关系，编译器和处理器也可以对这两个操作重排序。让我们先来看看，当操作1和操作2重排序时，可能会产生什么效果？请看下面的程序执行时序图：</p>
<p><img src="https://upload-images.jianshu.io/upload_images/10803273-a02a7d96d2acf939..png?imageMogr2/auto-orient/strip%7CimageView2/2/w/367/format/webp" alt="img"></p>
<p>image</p>
<p>如上图所示，操作1和操作2做了重排序。程序执行时，线程A首先写标记变量 flag，随后线程 B 读这个变量。由于条件判断为真，线程 B 将读取变量a。此时，变量 a 还根本没有被线程 A 写入，在这里多线程程序的语义被重排序破坏了！</p>
<p>※注：本文统一用红色的虚箭线表示错误的读操作，用绿色的虚箭线表示正确的读操作。</p>
<p>下面再让我们看看，当操作3和操作4重排序时会产生什么效果（借助这个重排序，可以顺便说明控制依赖性）。下面是操作3和操作4重排序后，程序的执行时序图：</p>
<p><img src="https://upload-images.jianshu.io/upload_images/10803273-8923bdc498c7bf46..png?imageMogr2/auto-orient/strip%7CimageView2/2/w/456/format/webp" alt="img"></p>
<p>image</p>
<p>在程序中，操作3和操作4存在控制依赖关系。当代码中存在控制依赖性时，会影响指令序列执行的并行度。为此，编译器和处理器会采用猜测（Speculation）执行来克服控制相关性对并行度的影响。以处理器的猜测执行为例，执行线程 B 的处理器可以提前读取并计算 a*a，然后把计算结果临时保存到一个名为重排序缓冲（reorder buffer ROB）的硬件缓存中。当接下来操作3的条件判断为真时，就把该计算结果写入变量i中。</p>
<p>从图中我们可以看出，猜测执行实质上对操作3和4做了重排序。重排序在这里破坏了多线程程序的语义！</p>
<p>在单线程程序中，对存在控制依赖的操作重排序，不会改变执行结果（这也是 as-if-serial 语义允许对存在控制依赖的操作做重排序的原因）；但在多线程程序中，对存在控制依赖的操作重排序，可能会改变程序的执行结果。</p>
<h2 id="4-编译器指令重排"><a href="#4-编译器指令重排" class="headerlink" title="4.编译器指令重排"></a>4.编译器指令重排</h2><p>下面我们简单看一个编译器重排的例子：</p>
<p>线程 1 线程 2<br>1： x2 = a ; 3: x1 = b ;<br>2: b = 1; 4: a = 2 ;</p>
<p>两个线程同时执行，分别有1、2、3、4四段执行代码，其中1、2属于线程1 ， 3、4属于线程2 ，从程序的执行顺序上看，似乎不太可能出现x1 = 1 和x2 = 2 的情况，但实际上这种情况是有可能发现的，因为如果编译器对这段程序代码执行重排优化后，可能出现下列情况</p>
<p>线程 1 线程 2<br>2: b = 1; 4: a = 2 ;<br>1：x2 = a ; 3: x1 = b ;</p>
<p>这种执行顺序下就有可能出现x1 = 1 和x2 = 2 的情况，这也就说明在多线程环境下，由于编译器优化重排的存在，两个线程中使用的变量能否保证一致性是无法确定的。</p>
<h2 id="5-指令集并行的重排序"><a href="#5-指令集并行的重排序" class="headerlink" title="5.指令集并行的重排序"></a>5.指令集并行的重排序</h2><p>指令集并行的重排序是对CPU的性能优化，从指令的执行角度来说一条指令可以分为多个步骤完成，如下:</p>
<ul>
<li>取指 IF</li>
<li>译码和取寄存器操作数 ID</li>
<li>执行或者有效地址计算 EX</li>
<li>存储器访问 MEM</li>
<li>写回 WB</li>
</ul>
<p>CPU在工作时，需要将上述指令分为多个步骤依次执行(注意硬件不同有可能不一样),由于每一个步会使用到不同的硬件操作，比如取指时会只有PC寄存器和存储器，译码时会执行到指令寄存器组，执行时会执行ALU(算术逻辑单元)、写回时使用到寄存器组。为了提高硬件利用率，CPU指令是按流水线技术来执行的，如下：</p>
<p><img src="https://upload-images.jianshu.io/upload_images/10803273-be37ed816609d345?imageMogr2/auto-orient/strip%7CimageView2/2/w/543/format/webp" alt="img"></p>
<p>image</p>
<p>从图中可以看出当指令1还未执行完成时，第2条指令便利用空闲的硬件开始执行，这样做是有好处的，如果每个步骤花费1ms，那么如果第2条指令需要等待第1条指令执行完成后再执行的话，则需要等待5ms，但如果使用流水线技术的话，指令2只需等待1ms就可以开始执行了，这样就能大大提升CPU的执行性能。虽然流水线技术可以大大提升CPU的性能，但不幸的是一旦出现流水中断，所有硬件设备将会进入一轮停顿期，当再次弥补中断点可能需要几个周期，这样性能损失也会很大，就好比工厂组装手机的流水线，一旦某个零件组装中断，那么该零件往后的工人都有可能进入一轮或者几轮等待组装零件的过程。因此我们需要尽量阻止指令中断的情况，指令重排就是其中一种优化中断的手段，我们通过一个例子来阐明指令重排是如何阻止流水线技术中断的</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">a &#x3D; b + c ;</span><br><span class="line">d &#x3D; e + f ;</span><br></pre></td></tr></table></figure>

<p>下面通过汇编指令展示了上述代码在CPU执行的处理过程</p>
<p><img src="https://upload-images.jianshu.io/upload_images/10803273-968efb02463da660?imageMogr2/auto-orient/strip%7CimageView2/2/w/817/format/webp" alt="img"></p>
<p>image</p>
<ul>
<li>LW指令 表示 load，其中LW R1,b表示把b的值加载到寄存器R1中</li>
<li>LW R2,c 表示把c的值加载到寄存器R2中</li>
<li>ADD 指令表示加法，把R1 、R2的值相加，并存入R3寄存器中。</li>
<li>SW 表示 store 即将 R3寄存器的值保持到变量a中</li>
<li>LW R4,e 表示把e的值加载到寄存器R4中</li>
<li>LW R5,f 表示把f的值加载到寄存器R5中</li>
<li>SUB 指令表示减法，把R4 、R5的值相减，并存入R6寄存器中。</li>
<li>SW d,R6 表示将R6寄存器的值保持到变量d中</li>
</ul>
<p>上述便是汇编指令的执行过程，在某些指令上存在X的标志，X代表中断的含义，也就是只要有X的地方就会导致指令流水线技术停顿，同时也会影响后续指令的执行，可能需要经过1个或几个指令周期才可能恢复正常，那为什么停顿呢？这是因为部分数据还没准备好，如执行ADD指令时，需要使用到前面指令的数据R1，R2，而此时R2的MEM操作没有完成，即未拷贝到存储器中，这样加法计算就无法进行，必须等到MEM操作完成后才能执行，也就因此而停顿了，其他指令也是类似的情况。前面阐述过，停顿会造成CPU性能下降，因此我们应该想办法消除这些停顿，这时就需要使用到指令重排了，如下图，既然ADD指令需要等待，那我们就利用等待的时间做些别的事情，如把<code>LW R4,e</code> 和 <code>LW R5,f</code> 移动到前面执行，毕竟<code>LW R4,e</code> 和 <code>LW R5,f</code>执行并没有数据依赖关系，对他们有数据依赖关系的<code>SUB R6,R5,R4</code>指令在R4,R5加载完成后才执行的，没有影响，过程如下：</p>
<p><img src="https://upload-images.jianshu.io/upload_images/10803273-5437272b8a7c272b?imageMogr2/auto-orient/strip%7CimageView2/2/w/934/format/webp" alt="img"></p>
<p>image</p>
<p>正如上图所示，所有的停顿都完美消除了，指令流水线也无需中断了，这样CPU的性能也能带来很好的提升，这就是处理器指令重排的作用。</p>
<h2 id="6-内存系统的重排序"><a href="#6-内存系统的重排序" class="headerlink" title="6.内存系统的重排序"></a>6.内存系统的重排序</h2><p><strong>内存体系</strong></p>
<p><img src="https://upload-images.jianshu.io/upload_images/10803273-4bf35e9b441a38e7..png?imageMogr2/auto-orient/strip%7CimageView2/2/w/640/format/webp" alt="img"></p>
<p>image</p>
<p>图1.对于2012 Sandy Bridge核心来说，内存模型可以大致按照如下进行分解：</p>
<p><strong>1.寄存器：</strong>在每个核心上，有160个用于整数和144个用于浮点的寄存器单元。访问这些寄存器只需要一个时钟周期，这构成了对执行核心来说最快的内存。编译器会将本地变量和函数参数分配到这些寄存器上。当使用超线程技术（ <a target="_blank" rel="noopener" href="https://link.jianshu.com/?t=http://en.wikipedia.org/wiki/Hyper-threading">hyperthreading</a> ）时，这些寄存器可以在超线程协同下共享。</p>
<p><strong>2.内存排序缓冲（Memory Ordering Buffers (MOB)*<em>*</em> ）：</strong>MOB由一个64长度的load缓冲和36长度的store缓冲组成。这些缓冲用于记录等待缓存子系统时正在执行的操作。store缓冲是一个完全的相关性队列，可以用于搜索已经存在store操作，这些store操作在等待L1缓存的时候被队列化。在数据与缓存子系统传输时， 缓冲可以让处理器异步运转。当处理器异步读或者异步写的时候，结果可以乱序返回。为了使之与已发布的内存模型（ <a target="_blank" rel="noopener" href="https://link.jianshu.com/?t=http://en.wikipedia.org/wiki/Memory_model_(programming)">memory model</a> ）一致，MOB用于消除load和store的顺序。</p>
<p><strong>3.Level 1 缓存：</strong>L1是一个本地核心内的缓存，被分成独立的32K数据缓存和32K指令缓存。访问需要3个时钟周期，并且当指令被核心流水化时， 如果数据已经在L1缓存中的话，访问时间可以忽略。</p>
<p><strong>4.L2缓存：</strong>L2缓存是一个本地核心内的缓存，被设计为L1缓存与共享的L3缓存之间的缓冲。L2缓存大小为256K，主要作用是作为L1和L3之间的高效内存访问队列。L2缓存同时包含数据和指令。L2缓存的延迟为12个时钟周期。</p>
<p><strong>5</strong>.<strong>L3缓存：</strong> 在同插槽的所有核心都共享L3缓存。L3缓存被分为数个2MB的段，每一个段都连接到槽上的环形网络。每一个核心也连接到这个环形网络上。地址通过hash的方式映射到段上以达到更大的吞吐量。根据缓存大小，延迟有可能高达38个时钟周期。在环上每增加一个节点将消耗一个额外的时钟周期。缓存大小根据段的数量最大可以达到20MB。L3缓存包括了在同一个槽上的所有L1和L2缓存中的数据。这种设计消耗了空间，但是使L3缓存可以拦截对L1和L2缓存的请求，减轻了各核心私有的L1和L2缓存的负担。</p>
<p><strong>6.主内存</strong>：在缓存完全没命中的情况下，DRAM通道到每个槽的延迟平均为65ns。具体延迟多少取决于很多因素，比如，下一次对同一缓存 行中数据的访问将极大降低延迟，而当队列化效果和内存刷新周期冲突时将显著增加延迟。每个槽使用4个内存通道聚合起来增加吞吐量，并通过在独立内存通道上流水线化（ <a target="_blank" rel="noopener" href="https://link.jianshu.com/?t=http://en.wikipedia.org/wiki/Pipelining">pipelining</a> ）将隐藏这种延迟。</p>
<p>*<em>7. *</em>**NUMA：**在一个多插槽的服务器上，会使用非一致性内存访问（ <a target="_blank" rel="noopener" href="https://link.jianshu.com/?t=http://en.wikipedia.org/wiki/Non-Uniform_Memory_Access">non-uniform memory access</a>）。所谓的非一致性是指，需要访问的内存可能在另一个插槽上，并且通过 <a target="_blank" rel="noopener" href="https://link.jianshu.com/?t=http://en.wikipedia.org/wiki/QPI">QPI</a> 总线访问需要额外花费40ns。 Sandy Bridge对于以往的兼容系统来说，在2插槽系统上是一个巨大的进步。在 Sandy Bridge上，QPI总线的能力从6.4GT/s提升到8.0GT/s，并且可以使用两条线路，消除了以前系统的瓶颈。对于 Nehalem and Westmere 来说，QPI只能使用内存控制器为一个单独插槽分配的带宽中的40%，这使访问远程内存成为一个瓶颈。另外，现在QPI链接可以使用预读取请求，而前一代系统不行。</p>
<p><strong>关联度（Associativity Levels）</strong></p>
<p>缓存是一个依赖于hash表的高效硬件。使用hash函数常常只是将地址中低位bit 进行映射 ，以实现缓存索引。hash表需要有解决对于同一位置冲突的机制。 关联度就是hash表中槽（slot）的数量，也被称为组（ways）和集合（sets），可以用来存储一个内存地址的hash版本。关联度的多少需要在存储数据的容量，耗电量和查询时间之间寻找平衡。（校对注：关联度越高，槽的数量越多，hash冲突越小，查询速度越快）</p>
<p>对于Sandy Bridge，L1和L2是8路组相连 ，L3是12路组相连 。（For Sandy Bridge the L1D and L2 are 8-way associative, the L3 is 12-way associative.）</p>
<p><strong>缓存一致性</strong></p>
<p>由于一些缓存在内核本地，我们需要一些方法保证一致性，使所有核心的内存视图一致。对于主流系统来说，内存子系统需要考虑“真实的来源（source of truth）”。如果数据只从缓存中来，那么它永远不会过期；当数据同时在缓存和主内存中存在时，缓存中存的是主拷贝（master copy）。这种内存管理被称为写-回（<a target="_blank" rel="noopener" href="https://link.jianshu.com/?t=http://www.webopedia.com/TERM/W/write_back_cache.html">write-back</a>），在此方式下，当新的缓存行占用旧行，导致旧行被驱逐时，缓存数据只会被写回主内存中。x86架构的每个缓存块的大小为64 bytes，称为缓存行（ <a target="_blank" rel="noopener" href="https://link.jianshu.com/?t=http://en.wikipedia.org/wiki/CPU_cache%23Cache_Entries">cache-line</a>）。其它种类的处理器的缓存行大小可能不同。更大的缓存行容量降低延迟，但是需要更大的带宽<em>（**校对</em>注：数据总线带宽）。</p>
<p>对于不同插槽的CPU，L1和L2的数据并不共享，一般通过MESI协议保证Cache的一致性，但需要付出代价。</p>
<p>在MESI协议中，每个Cache line有4种状态，分别是：</p>
<p>1、M(Modified)这行数据有效，但是被修改了，和内存中的数据不一致，数据只存在于本Cache中</p>
<p>2、E(Exclusive)这行数据有效，和内存中的数据一致，数据只存在于本Cache中</p>
<p>3、S(Shared)这行数据有效，和内存中的数据一致，数据分布在很多Cache中</p>
<p>4、I(Invalid)这行数据无效</p>
<p>每个Core的Cache控制器不仅知道自己的读写操作，也监听其它Cache的读写操作，假如有4个Core：1、Core1从内存中加载了变量X，值为10，这时Core1中缓存变量X的cache line的状态是E；2、Core2也从内存中加载了变量X，这时Core1和Core2缓存变量X的cache line状态转化成S；3、Core3也从内存中加载了变量X，然后把X设置成了20，这时Core3中缓存变量X的cache line状态转化成M，其它Core对应的cache line变成I（无效）</p>
<p>当然了，不同的处理器内部细节也是不一样的，比如Intel的core i7处理器使用从MESI中演化出的MESIF协议，F(Forward)从Share中演化而来，一个cache line如果是F状态，可以把数据直接传给其它内核，这里就不纠结了。</p>
<p>CPU在cache line状态的转化期间是阻塞的，经过长时间的优化，在寄存器和L1缓存之间添加了LoadBuffer、StoreBuffer来降低阻塞时间，LoadBuffer、StoreBuffer，合称排序缓冲(Memoryordering Buffers (MOB))，Load缓冲64长度，store缓冲36长度，Buffer与L1进行数据传输时，CPU无须等待。</p>
<p>1、CPU执行load读数据时，把读请求放到LoadBuffer，这样就不用等待其它CPU响应，先进行下面操作，稍后再处理这个读请求的结果。2、CPU执行store写数据时，把数据写到StoreBuffer中，待到某个适合的时间点，把StoreBuffer的数据刷到主存中。</p>
<p>因为StoreBuffer的存在，CPU在写数据时，真实数据并不会立即表现到内存中，所以对于其它CPU是不可见的；同样的道理，LoadBuffer中的请求也无法拿到其它CPU设置的最新数据；</p>
<p>由于StoreBuffer和LoadBuffer是异步执行的，所以在外面看来，先写后读，还是先读后写，没有严格的固定顺序。</p>
<p><img src="https://upload-images.jianshu.io/upload_images/10803273-34f6833a2aecf7e8.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1200/format/webp" alt="img"></p>
<p>TBD1.png</p>
<p><img src="https://upload-images.jianshu.io/upload_images/10803273-c3f236a86305e485.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1200/format/webp" alt="img"></p>
<p>TBD2.png</p>
<p><img src="https://upload-images.jianshu.io/upload_images/10803273-71c39fa7338093a0.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1200/format/webp" alt="img"></p>
<p>TBD3.png</p>
<p>MESI协议中有两个行为效率会比较低，</p>
<ol>
<li>当cache line状态为Invalid时，需要写入数据。</li>
<li>把cache line的状态变为invalid</li>
</ol>
<p>CPU通过store buffer和invalid queue(用来实现LoadBuffer)来降低延时。<br>当在invalid状态进行写入时，首先会给其它CPU核发送invalid消息，然后把当前写入的数据写入到store buffer中。然后在某个时刻在真正的写入到cache line中。由于不是马上写入到cache line中，所以当前核如果要读cache line中的数据，需要先扫描store buffer，同时其它CPU核是看不到当前核store buffer中的数据的。除非store buffer中的数据被刷到cache中。<br>对于invalid queue，当收到invalid消息时，cache line不会马上变成invalid状态，而是把消息写入invalid queue中。和store buffer不同的是当前核是无法扫描invalid queue的。<br>为了保证数据的一致性，这就需要memory barrier了。store barrier会把store buffer中的数据刷到cache中，read barrier会执行invalid queue中的消息。</p>
<blockquote>
<p><strong>注意</strong><br>要保证数据的一致性，仅仅有MESI协议还不够，通常还需要memory barrier的配合。</p>
</blockquote>
<h2 id="7-memory-barrier"><a href="#7-memory-barrier" class="headerlink" title="7.memory barrier"></a>7.memory barrier</h2><p>memory barrier的作用有两个</p>
<ul>
<li>保证数据的可见性<br>我们知道，内存中的数据除了在内存中的副本，还有可能在各个核的CPU中，当某个核修改了对应cache中的数据后，这时其它核中对应内存地址的数据还有主存中的数据就不是最新的了，其它核为了能够读取到最新的数据，需要执行memory barrier指令，把store buffer中的修改写到主存中。</li>
<li>防止指令之间的重排序<br>前面讲到一条指令的执行会分为几个步骤，也就是pipeline，为了得到更高的性能，编译器或者处理器有可能会改变指令的执行顺序，以此来提高指令执行的并行度。不管是编译器还是处理器的重排序，都要遵守as-if-serial语义。as-if-serial说的是，不管怎么重排序，在单线程中执行这些指令，其结果应该是一样的。在多线程的情况下，需要memory barrier来保证整体的顺序，否则会出现意想不到的结果。</li>
</ul>
<p>不同的处理器架构的memory barrier也不太一样，以Intel x86为例，有三种memory barrier</p>
<p><img src="https://upload-images.jianshu.io/upload_images/10803273-2a352e8feda958db.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1200/format/webp" alt="img"></p>
<p>TBD4.png</p>
<h4 id="store-barrier"><a href="#store-barrier" class="headerlink" title="store barrier"></a>store barrier</h4><p>对应<a target="_blank" rel="noopener" href="https://link.jianshu.com/?t=http://x86.renejeschke.de/html/file_module_x86_id_289.html">sfence</a>指令</p>
<ol>
<li>保证了sfence前后store指令的顺序，防止重排序。</li>
<li>通过刷新store buffer保证了sfence之后的store指令全局可见之前，sfence之前的store要指令要先全局可见。</li>
</ol>
<h4 id="load-barrier"><a href="#load-barrier" class="headerlink" title="load barrier"></a>load barrier</h4><p>对应<a target="_blank" rel="noopener" href="https://link.jianshu.com/?t=http://x86.renejeschke.de/html/file_module_x86_id_155.html">lfence</a>指令，</p>
<ol>
<li>保证了lfence前后的load指令的顺序，防止重排序。</li>
<li>刷新load buffer。</li>
</ol>
<h4 id="full-barrier"><a href="#full-barrier" class="headerlink" title="full barrier"></a>full barrier</h4><p>对应<a target="_blank" rel="noopener" href="https://link.jianshu.com/?t=http://x86.renejeschke.de/html/file_module_x86_id_170.html">mfence</a>指令</p>
<ol>
<li>保证了mfence前后的store和load指令的顺序，防止重排序。</li>
<li>保证了mfence之后的store指令全局可见之前，mfence之前的store指令要先全局可见。</li>
</ol>
<p><img src="https://upload-images.jianshu.io/upload_images/10803273-630f6cf743669bde.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1200/format/webp" alt="img"></p>
<p>TBD5.png</p>
<p><img src="https://upload-images.jianshu.io/upload_images/10803273-2e6be31b00237551.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1200/format/webp" alt="img"></p>
<p>TBD6.png</p>
<h2 id="8-JDK-1-7-内存屏障实现"><a href="#8-JDK-1-7-内存屏障实现" class="headerlink" title="8. JDK 1.7 内存屏障实现"></a>8. JDK 1.7 内存屏障实现</h2><p>JVM的代码。</p>
<p><img src="https://upload-images.jianshu.io/upload_images/10803273-c8fa442e07c46eb5.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/980/format/webp" alt="img"></p>
<p>1.png</p>
<p>执行完赋值操作后，紧接着执行<code>OrderAccess::storeload()</code>，这又是啥？</p>
<p>其实这就是经常会念叨的内存屏障，之前只知道念，却不知道是如何实现的。从CPU缓存结构分析中已经知道：一个load操作需要进入LoadBuffer，然后再去内存加载；一个store操作需要进入StoreBuffer，然后再写入缓存，这两个操作都是异步的，会导致不正确的指令重排序，所以在JVM中定义了一系列的内存屏障来指定指令的执行顺序。</p>
<p>JVM中定义的内存屏障如下，JDK1.7的实现</p>
<p><img src="https://upload-images.jianshu.io/upload_images/10803273-50d8710d40c2e318.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/982/format/webp" alt="img"></p>
<p>2.png</p>
<p>下面是常见处理器允许的重排序类型的列表：</p>
<p><img src="https://upload-images.jianshu.io/upload_images/10803273-3b5c9c9c1518cf87.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/775/format/webp" alt="img"></p>
<p>11.png</p>
<p>上表单元格中的 “N” 表示处理器不允许两个操作重排序，“Y” 表示允许重排序。</p>
<p>从上表我们可以看出：常见的处理器都允许 Store-Load 重排序；常见的处理器都不允许对存在数据依赖的操作做重排序。sparc-TSO 和 x86 拥有相对较强的处理器内存模型，它们仅允许对写-读操作做重排序（因为它们都使用了写缓冲区）。</p>
<p><img src="https://upload-images.jianshu.io/upload_images/10803273-a2b96aad8dc32627.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/952/format/webp" alt="img"></p>
<p>12.png</p>
<p>Store Barrier<br>sfence指令实现了Store Barrier，相当于StoreStore Barriers。<br>强制所有在sfence指令之前的store指令，都在该sfence指令执行之前被执行，发送缓存失效信号，并把store buffer中的数据刷出到CPU的L1 Cache中；所有在sfence指令之后的store指令，都在该sfence指令执行之后被执行。即，禁止对sfence指令前后store指令的重排序跨越sfence指令，使所有Store Barrier之前发生的内存更新都是可见的。<br>这里的“可见”，指修改值可见（内存可见性）且操作结果可见（禁用重排序）。下同。</p>
<p>内存屏障的标准中，讨论的是缓存与内存间的相干性，实际上，同样适用于寄存器与缓存、甚至寄存器与内存间等多级缓存之间。x86架构使用了MESI协议的一个变种，由协议保证三层缓存与内存间的相关性，则内存屏障只需要保证store buffer（可以认为是寄存器与L1 Cache间的一层缓存）与L1 Cache间的相干性。下同。</p>
<p>Load Barrier<br>lfence指令实现了Load Barrier，相当于LoadLoad Barriers。<br>强制所有在lfence指令之后的load指令，都在该lfence指令执行之后被执行，并且一直等到load buffer被该CPU读完才能执行之后的load指令（发现缓存失效后发起的刷入）。即，禁止对lfence指令前后load指令的重排序跨越lfence指令，配合Store Barrier，使所有Store Barrier之前发生的内存更新，对Load Barrier之后的load操作都是可见的。</p>
<p>Full Barrier<br>mfence指令实现了Full Barrier，相当于StoreLoad Barriers。<br>mfence指令综合了sfence指令与lfence指令的作用，强制所有在mfence指令之前的store/load指令，都在该mfence指令执行之前被执行；所有在mfence指令之后的store/load指令，都在该mfence指令执行之后被执行。即，禁止对mfence指令前后store/load指令的重排序跨越mfence指令，使所有Full Barrier之前发生的操作，对所有Full Barrier之后的操作都是可见的。</p>
<p>1、loadload屏障（load1，loadload， load2）2、loadstore屏障（load，loadstore， store）</p>
<p>这两个屏障都通过<code>acquire()</code>方法实现</p>
<p><img src="https://upload-images.jianshu.io/upload_images/10803273-0f2dac73f616939c.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/992/format/webp" alt="img"></p>
<p>3.png</p>
<p>其中<code>__asm__</code>，表示汇编代码的开始。volatile，之前分析过了，禁止编译器对代码进行优化。.最后的”memory”是编译器屏障的作用。</p>
<p>在LoadBuffer中插入该屏障，清空屏障之前的load操作，然后才能执行屏障之后的操作，可以保证load操作的数据在下个store指令之前准备好</p>
<p>3、storestore屏障（store1，storestore， store2）通过”release()”方法实现：</p>
<p><img src="https://upload-images.jianshu.io/upload_images/10803273-e01c9d3b6e89706a.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/806/format/webp" alt="img"></p>
<p>4.png</p>
<p>在StoreBuffer中插入该屏障，清空屏障之前的store操作，然后才能执行屏障之后的store操作，保证store1写入的数据在执行store2时对其它CPU可见。</p>
<p>4、storeload屏障（store，storeload， load）对java中的volatile变量进行赋值之后，插入的就是这个屏障，通过”fence()”方法实现：</p>
<p><img src="https://upload-images.jianshu.io/upload_images/10803273-f954c5ce9b25b838.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/981/format/webp" alt="img"></p>
<p>5.png</p>
<p>看到这个有没有很兴奋？</p>
<p>通过<code>os::is_MP()</code>先判断是不是多核，如果只有一个CPU的话，就不存在这些问题了。</p>
<p>storeload屏障，完全由下面这些指令实现</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">__asm__ volatile (<span class="string">&quot;lock; addl <span class="variable">$0</span>,0(%%rsp)&quot;</span> : : : <span class="string">&quot;cc&quot;</span>, <span class="string">&quot;memory&quot;</span>);</span><br></pre></td></tr></table></figure>

<p>为了试验这些指令到底有什么用，我们再写点c++代码编译一下</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> foo = <span class="number">10</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">const</span> <span class="keyword">char</span> * argv[])</span> </span>&#123;</span><br><span class="line">    <span class="comment">// insert code here...</span></span><br><span class="line">    <span class="keyword">volatile</span> <span class="keyword">int</span> a = foo + <span class="number">10</span>;</span><br><span class="line">    <span class="comment">// __asm__ volatile (&quot;lock; addl $0,0(%%rsp)&quot; : : : &quot;cc&quot;, &quot;memory&quot;);</span></span><br><span class="line">    <span class="keyword">volatile</span> <span class="keyword">int</span> b = foo + <span class="number">20</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>为了变量a和b不被编译器优化掉，这里使用了volatile进行修饰，编译后的汇编指令如下：</p>
<p><img src="https://upload-images.jianshu.io/upload_images/10803273-fa8df2c676df466f.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/985/format/webp" alt="img"></p>
<p>9.png</p>
<p>从编译后的代码可以发现，第二次使用foo变量时，没有从内存重新加载，使用了寄存器的值。</p>
<p>把<code>__asm__ volatile ***</code>指令加上之后重新编译</p>
<p><img src="https://upload-images.jianshu.io/upload_images/10803273-759208c8b2491c7b.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/983/format/webp" alt="img"></p>
<p>10.png</p>
<p>相比之前，这里多了两个指令，一个lock，一个addl。lock指令的作用是：在执行lock后面指令时，会设置处理器的LOCK#信号（这个信号会锁定总线，阻止其它CPU通过总线访问内存，直到这些指令执行结束），这条指令的执行变成原子操作，之前的读写请求都不能越过lock指令进行重排，相当于一个内存屏障。</p>
<p>还有一个：第二次使用foo变量时，从内存中重新加载，保证可以拿到foo变量的最新值，这是由如下指令实现</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">__asm__ <span class="title">volatile</span> <span class="params">( : : : <span class="string">&quot;cc&quot;</span>, <span class="string">&quot;memory&quot;</span>)</span></span>;</span><br></pre></td></tr></table></figure>

<p>同样是编译器屏障，通知编译器重新生成加载指令(不可以从缓存寄存器中取)。</p>
<h4 id="读取volatile变量"><a href="#读取volatile变量" class="headerlink" title="读取volatile变量"></a>读取volatile变量</h4><p>同样在<code>bytecodeInterpreter.cpp</code>文件中，找到getstatic字节码指令的解释器实现。</p>
<p><img src="https://upload-images.jianshu.io/upload_images/10803273-5d21e8f2d703b92b.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/994/format/webp" alt="img"></p>
<p>7.png</p>
<p>通过<code>obj-&gt;obj_field_acquire(field_offset)</code>获取变量值</p>
<p><img src="https://upload-images.jianshu.io/upload_images/10803273-0622f8f730f8ebd6.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/990/format/webp" alt="img"></p>
<p>8.png</p>
<p>最终通过<code>OrderAccess::load_acquire</code>实现</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">inline</span> jint <span class="title">OrderAccess::load_acquire</span><span class="params">(<span class="keyword">volatile</span> jint* p)</span> </span>&#123; <span class="keyword">return</span> *p; &#125;</span><br></pre></td></tr></table></figure>

<p>底层基于C++的volatile实现，因为volatile自带了编译器屏障的功能，总能拿到内存中的最新值。</p>
<p>9人点赞</p>
<p><a target="_blank" rel="noopener" href="https://www.jianshu.com/nb/23803512">5篇文章搞定JVM</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2021/03/24/%E6%8C%87%E4%BB%A4%E9%87%8D%E6%8E%92%E5%BA%8F/" data-id="ckmn1li26000in8a86u3g4wao" data-title="" class="article-share-link">Teilen</a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-Makefile-tutorial" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2021/03/24/Makefile-tutorial/" class="article-date">
  <time class="dt-published" datetime="2021-03-24T06:02:27.811Z" itemprop="datePublished">2021-03-24</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>#Makefile文件格式</p>
<p>##概述</p>
<p>Makefile文件由一系列规则（rules）构成，每条规则的形式如下：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;target: &lt;prerequisites</span><br><span class="line">[tab]  &lt;commands&gt;</span><br></pre></td></tr></table></figure>

<p>上面第一行冒号前面的部分，叫做”目标”（target），冒号后面的部分叫做”前置条件”（prerequisites）；第二行必须由一个tab键起首，后面跟着”命令”（commands）。</p>
<p>“目标”是必需的，不可省略；”前置条件”和”命令”都是可选的，但是两者之中必须至少存在一个。</p>
<p>每条规则就明确两件事：构建目标的前置条件是什么，以及如何构建。</p>
<p>##目标（target）</p>
<p>一个目标（target）就构成一条规则。目标通常是文件名，指明Make命令所要构建的对象，比如上文的 a.txt 。目标可以是一个文件名，也可以是多个文件名，之间用空格分隔。</p>
<p>除了文件名，目标还可以是某个操作的名字，这称为”伪目标”（phony target）。</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">clean:</span></span><br><span class="line">	rm *.o</span><br></pre></td></tr></table></figure>

<p>上面代码的目标是clean，它不是文件名，而是一个操作的名字，属于”伪目标 “，作用是删除对象文件。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ make  clean</span><br></pre></td></tr></table></figure>

<p>但是，如果当前目录中，正好有一个文件叫做clean，那么这个命令不会执行。因为Make发现clean文件已经存在，就认为没有必要重新构建了，就不会执行指定的rm命令。</p>
<p>为了避免这种情况，可以明确声明clean是”伪目标”，写法如下。</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta"><span class="meta-keyword">.PHONY</span>: clean</span></span><br><span class="line"><span class="section">clean:</span></span><br><span class="line">	rm *.o temp</span><br></pre></td></tr></table></figure>

<p>声明clean是”伪目标”之后，make就不会去检查是否存在一个叫做clean的文件，而是每次运行都执行对应的命令。像.PHONY这样的内置目标名还有不少，可以查看<a target="_blank" rel="noopener" href="http://www.gnu.org/software/make/manual/html_node/Special-Targets.html#Special-Targets">手册</a>。</p>
<p>如果Make命令运行时没有指定目标，默认会执行Makefile文件的第一个目标。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ make</span><br></pre></td></tr></table></figure>

<p>上面代码执行Makefile文件的第一个目标。</p>
<p>##前置条件（prerequisites）</p>
<p>前置条件通常是一组文件名，之间用空格分隔。它指定了”目标”是否重新构建的判断标准：只要有一个前置文件不存在，或者有过更新（前置文件的last-modification时间戳比目标的时间戳新），”目标”就需要重新构建。</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">result.txt: source.txt</span></span><br><span class="line">	cp source.txt result.txt</span><br></pre></td></tr></table></figure>

<p>上面代码中，构建 result.txt 的前置条件是 source.txt 。如果当前目录中，source.txt 已经存在，那么<code>make result.txt</code>可以正常运行，否则make会转向构建目标source.txt，由于makefile中没有这个目标，执行该命令会报错。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">make: *** No rule to make target <span class="string">&#x27;source.txt&#x27;</span>, needed by <span class="string">&#x27;result.txt&#x27;</span>.  Stop.</span><br></pre></td></tr></table></figure>
<p>必须再写一条规则，来生成 source.txt 。</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">source.txt:</span></span><br><span class="line">	echo <span class="string">&quot;this is the source&quot;</span> source.txt</span><br></pre></td></tr></table></figure>

<p>上面代码中，source.txt后面没有前置条件，就意味着它跟其他文件都无关，只要这个文件还不存在，每次构建目标source.txt，它都会生成。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ make result.txt</span><br><span class="line">$ make result.txt</span><br></pre></td></tr></table></figure>

<p>上面命令连续执行两次<code>make result.txt</code>。第一次执行时前置条件不满足，会先转向构建前置条件，即新建 source.txt，然后再继续构建 result.txt，即将source.txt复制为result.txt。第二次执行，Make发现前置条件 source.txt 没有更新，即last-modification时间戳比result.txt时间戳早，就不会执行任何操作，即不会重新生成result.txt。</p>
<p>##命令（commands）</p>
<p>命令（commands）表示如何更新目标文件，由一行或多行的Shell命令组成。它是构建”目标”的具体指令，它的运行结果通常就是生成目标文件。</p>
<p>每行命令之前必须有一个tab键。如果想用其他键，可以用内置变量.RECIPEPREFIX声明。</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">.RECIPEPREFIX = &gt;</span><br><span class="line"><span class="section">all:</span></span><br><span class="line">echo Hello, world</span><br></pre></td></tr></table></figure>

<p>上面代码用.RECIPEPREFIX指定，大于号（&gt;）替代tab键。所以，每一行命令的起首变成了大于号，而不是tab键。</p>
<p>需要注意的是，每行命令在一个单独的shell中执行。这些Shell之间没有继承关系。</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">var-lost:</span></span><br><span class="line">	<span class="keyword">export</span> foo=bar</span><br><span class="line">	echo <span class="string">&quot;foo=[$$foo]&quot;</span></span><br></pre></td></tr></table></figure>

<p>上面代码执行后（<code>make var-lost</code>），取不到foo的值。因为两行命令在两个不同的进程执行。一个解决办法是将两行命令写在一行，中间用分号分隔。</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">var-kept:</span></span><br><span class="line">	<span class="keyword">export</span> foo=bar; echo <span class="string">&quot;foo=[$$foo]&quot;</span></span><br></pre></td></tr></table></figure>

<p>命令太长可以使用“\“做换行符。</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">var-kept:</span></span><br><span class="line">	<span class="keyword">export</span> foo=bar; \</span><br><span class="line">	echo <span class="string">&quot;foo=[$$foo]&quot;</span></span><br></pre></td></tr></table></figure>

<p>最后一个方法是加上<code>.ONESHELL:</code>命令。</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">.ONESHELL:</span></span><br><span class="line"><span class="section">var-kept:</span></span><br><span class="line">	<span class="keyword">export</span> foo=bar; </span><br><span class="line">	echo <span class="string">&quot;foo=[$$foo]&quot;</span></span><br></pre></td></tr></table></figure>

<h2 id="Makefile文件的语法"><a href="#Makefile文件的语法" class="headerlink" title="Makefile文件的语法"></a>Makefile文件的语法</h2><h3 id="注释"><a href="#注释" class="headerlink" title="注释"></a>注释</h3><p>井号（#）在Makefile中表示注释。</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">这是注释</span><br><span class="line"><span class="section">sult.txt: source.txt</span></span><br><span class="line"><span class="comment"># 这是注释</span></span><br><span class="line">	cp source.txt result.txt <span class="comment"># 这也是注释</span></span><br></pre></td></tr></table></figure>

<h3 id="回声（echoing）"><a href="#回声（echoing）" class="headerlink" title="回声（echoing）"></a>回声（echoing）</h3><p>正常情况下，make会打印每条命令，然后再执行，这就叫做回声（echoing）。</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">test:</span></span><br><span class="line">	<span class="comment"># 这是测试</span></span><br></pre></td></tr></table></figure>

<p>执行上面的规则，会得到下面的结果。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$make</span> <span class="built_in">test</span></span><br><span class="line"><span class="comment"># 这是测试</span></span><br></pre></td></tr></table></figure>

<p>在命令的前面加上@，就可以关闭回声。</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">test:</span></span><br><span class="line">	@<span class="comment"># 这是测试</span></span><br></pre></td></tr></table></figure>

<p>现在再执行<code>make test</code>，就不会有任何输出。</p>
<p>由于在构建过程中，需要了解当前在执行哪条命令，所以通常只在注释和纯显示的echo命令前面加上@。</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">test:</span></span><br><span class="line">	@<span class="comment"># 这是测试</span></span><br><span class="line">	@echo TODO</span><br></pre></td></tr></table></figure>

<h3 id="通配符"><a href="#通配符" class="headerlink" title="通配符"></a>通配符</h3><p>通配符（wildcard）用来指定一组符合条件的文件名。Makefile 的通配符与 Bash 一致，主要有星号（*）、问号（？）和 […] 。比如， *.o 表示所有后缀名为o的文件。</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">clean:</span></span><br><span class="line">	rm -f *.o</span><br></pre></td></tr></table></figure>

<h3 id="模式匹配"><a href="#模式匹配" class="headerlink" title="模式匹配"></a>模式匹配</h3><p>Make命令允许对文件名，进行类似正则运算的匹配，主要用到的匹配符是%。比如，假定当前目录下有 f1.c 和 f2.c 两个源码文件，需要将它们编译为对应的对象文件。</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">%.o: %.c</span></span><br></pre></td></tr></table></figure>

<p>等同于下面的写法。</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">f1.o: f1.c</span></span><br><span class="line"><span class="section">f2.o: f2.c</span></span><br></pre></td></tr></table></figure>

<p>使用匹配符%，可以将大量同类型的文件，只用一条规则就完成构建。</p>
<h3 id="变量和赋值符"><a href="#变量和赋值符" class="headerlink" title="变量和赋值符"></a>变量和赋值符</h3><p>Makefile 允许使用等号自定义变量。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">txt = Hello World</span><br><span class="line"><span class="built_in">test</span>:</span><br><span class="line">	@<span class="built_in">echo</span> $(txt)</span><br></pre></td></tr></table></figure>

<p>上面代码中，变量 txt 等于 Hello World。调用时，变量需要放在 $( ) 之中。</p>
<p>调用Shell变量，需要在美元符号前，再加一个美元符号，这是因为Make命令会对美元符号转义。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">test</span>:</span><br><span class="line">	@<span class="built_in">echo</span> $<span class="variable">$HOME</span></span><br></pre></td></tr></table></figure>

<p>有时，变量的值可能指向另一个变量。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">v1 = $(v2)</span><br></pre></td></tr></table></figure>

<p>上面代码中，变量 v1 的值是另一个变量 v2。这时会产生一个问题，v1 的值到底在定义时扩展（静态扩展），还是在运行时扩展（动态扩展）？如果 v2 的值是动态的，这两种扩展方式的结果可能会差异很大。</p>
<p>为了解决类似问题，Makefile一共提供了四个赋值运算符 （=、:=、？=、+=），它们的区别请看<a target="_blank" rel="noopener" href="http://stackoverflow.com/questions/448910/makefile-variable-assignment">StackOverflow</a>。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">VARIABLE = value</span><br><span class="line"><span class="comment"># 在执行时扩展，允许递归扩展。</span></span><br><span class="line">VARIABLE := value</span><br><span class="line"><span class="comment"># 在定义时扩展。</span></span><br><span class="line">VARIABLE ?= value</span><br><span class="line"><span class="comment"># 只有在该变量为空时才设置值。</span></span><br><span class="line">VARIABLE += value</span><br><span class="line"><span class="comment"># 将值追加到变量的尾端。</span></span><br></pre></td></tr></table></figure>

<h3 id="内置变量（Implicit-Variables）"><a href="#内置变量（Implicit-Variables）" class="headerlink" title="内置变量（Implicit Variables）"></a>内置变量（Implicit Variables）</h3><p>Make命令提供一系列内置变量，比如，$(CC) 指向当前使用的编译器，$(MAKE) 指向当前使用的Make工具。这主要是为了跨平台的兼容性，详细的内置变量清单见<a target="_blank" rel="noopener" href="https://www.gnu.org/software/make/manual/html_node/Implicit-Variables.html">手册</a>。</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">output:</span></span><br><span class="line">	<span class="variable">$(CC)</span> -o output input.c</span><br></pre></td></tr></table></figure>
<h3 id="自动变量（Automatic-Variables）"><a href="#自动变量（Automatic-Variables）" class="headerlink" title="自动变量（Automatic Variables）"></a>自动变量（Automatic Variables）</h3><p>Make命令还提供一些自动变量，它们的值与当前规则有关。主要有以下几个。</p>
<p>（1）$@</p>
<p>$@指代当前目标，就是Make命令当前构建的那个目标。比如，make foo的 $@ 就指代foo。</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">a.txt b.txt: </span><br><span class="line">	touch <span class="variable">$@</span></span><br></pre></td></tr></table></figure>

<p>等同于下面的写法。</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">a.txt:</span></span><br><span class="line">	touch a.txt</span><br><span class="line"><span class="section">b.txt:</span></span><br><span class="line">	touch b.txt</span><br></pre></td></tr></table></figure>

<p>（2）$&lt;</p>
<p>$&lt; 指代第一个前置条件。比如，规则为 t: p1 p2，那么$&lt; 就指代p1。</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">a.txt: b.txt c.txt</span></span><br><span class="line">	cp <span class="variable">$&lt;</span> <span class="variable">$@</span> </span><br></pre></td></tr></table></figure>

<p>等同于下面的写法。</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">a.txt: b.txt c.txt</span></span><br><span class="line">	cp b.txt a.txt </span><br></pre></td></tr></table></figure>

<p>（3）$?</p>
<p>$? 指代比目标更新的所有前置条件，之间以空格分隔。比如，规则为 t: p1 p2，其中 p2 的时间戳比 t 新，$?就指代p2。</p>
<p>（4）$^</p>
<p>$^ 指代所有前置条件，之间以空格分隔。比如，规则为 t: p1 p2，那么 $^ 就指代 p1 p2 。</p>
<p>（5）$*</p>
<p>$* 指代匹配符 % 匹配的部分， 比如% 匹配 f1.txt 中的f1 ，$* 就表示 f1。</p>
<p>（6）$(@D) 和 $(@F)</p>
<p>$(@D) 和 $(@F) 分别指向 $@ 的目录名和文件名。比如，$@是 src/input.c，那么$(@D) 的值为 src ，$(@F) 的值为 input.c。</p>
<p>（7）$(&lt;D) 和 $(&lt;F)</p>
<p>$(&lt;D) 和 $(&lt;F) 分别指向 $&lt; 的目录名和文件名。</p>
<p>所有的自动变量清单，请看手册。下面是自动变量的一个例子。</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">dest/%.txt: src/%.txt</span></span><br><span class="line">	@[ -d dest ] || mkdir dest</span><br><span class="line">	cp <span class="variable">$&lt;</span> <span class="variable">$@</span></span><br></pre></td></tr></table></figure>

<p>上面代码将 src 目录下的 txt 文件，拷贝到 dest 目录下。首先判断 dest 目录是否存在，如果不存在就新建，然后，$&lt; 指代前置文件（src/%.txt）， ​$@ 指代目标文件（dest/%.txt）。</p>
<h3 id="判断和循环"><a href="#判断和循环" class="headerlink" title="判断和循环"></a>判断和循环</h3><p>Makefile使用 Bash 语法，完成判断和循环。</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ifeq</span> (<span class="variable">$(CC)</span>,gcc)</span><br><span class="line">	libs=<span class="variable">$(libs_for_gcc)</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">	libs=<span class="variable">$(normal_libs)</span></span><br><span class="line"><span class="keyword">endif</span></span><br></pre></td></tr></table></figure>

<p>上面代码判断当前编译器是否 gcc ，然后指定不同的库文件。</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">LIST = one two three</span><br><span class="line"><span class="section">all:</span></span><br><span class="line">	for i in <span class="variable">$(LIST)</span>; do \</span><br><span class="line">		echo $$i; \</span><br><span class="line">	done</span><br><span class="line"></span><br><span class="line"><span class="comment"># 等同于</span></span><br><span class="line"></span><br><span class="line"><span class="section">all:</span></span><br><span class="line">	for i in one two three; do \</span><br><span class="line">		echo $i; \</span><br><span class="line">	done</span><br></pre></td></tr></table></figure>

<p>上面代码的运行结果。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">one</span><br><span class="line">two</span><br><span class="line">three</span><br></pre></td></tr></table></figure>

<h3 id="函数"><a href="#函数" class="headerlink" title="函数"></a>函数</h3><p>Makefile 还可以使用函数，格式如下。</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$(function arguments)</span></span><br><span class="line"><span class="comment"># 或者</span></span><br><span class="line">$&#123;function arguments&#125;</span><br></pre></td></tr></table></figure>

<p>Makefile提供了许多<a target="_blank" rel="noopener" href="http://www.gnu.org/software/make/manual/html_node/Functions.html">内置函数</a>，可供调用。下面是几个常用的内置函数。</p>
<p>（1）shell 函数</p>
<p>shell 函数用来执行 shell 命令</p>
<p>​```makefile<br>srcfiles := $(shell echo src/{00..99}.txt)</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">（2）wildcard 函数</span><br><span class="line"></span><br><span class="line">wildcard 函数用来在 Makefile 中，替换 Bash 的通配符。</span><br><span class="line"></span><br><span class="line">&#96;&#96;&#96;makefile</span><br><span class="line">srcfiles :&#x3D; $(wildcard src&#x2F;*.txt)</span><br></pre></td></tr></table></figure>

<p>（3）subst 函数</p>
<p>subst 函数用来文本替换，格式如下。</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$(<span class="built_in">subst</span> from,to,text)</span></span><br></pre></td></tr></table></figure>

<p>下面的例子将字符串”feet on the street”替换成”fEEt on the strEEt”。</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$(<span class="built_in">subst</span> ee,EE,feet on the street)</span></span><br></pre></td></tr></table></figure>

<p>下面是一个稍微复杂的例子。</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">comma:= ,</span><br><span class="line">empty:=</span><br><span class="line">\<span class="comment"># space变量用两个空变量作为标识符，当中是一个空格</span></span><br><span class="line">space:= <span class="variable">$(empty)</span> <span class="variable">$(empty)</span></span><br><span class="line">foo:= a b c</span><br><span class="line">bar:= <span class="variable">$(<span class="built_in">subst</span> <span class="variable">$(space)</span>,<span class="variable">$(comma)</span>,<span class="variable">$(foo)</span>)</span></span><br><span class="line">\<span class="comment"># bar is now `a,b,c&#x27;.</span></span><br></pre></td></tr></table></figure>

<p>（4）patsubst函数</p>
<p>patsubst 函数用于模式匹配的替换，格式如下。</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$(<span class="built_in">patsubst</span> pattern,replacement,text)</span></span><br></pre></td></tr></table></figure>

<p>下面的例子将文件名”x.c.c bar.c”，替换成”x.c.o bar.o”。</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$(<span class="built_in">patsubst</span> %.c,%.o,x.c.c bar.c)</span></span><br></pre></td></tr></table></figure>

<p>（5）替换后缀名</p>
<p>替换后缀名函数的写法是：变量名 + 冒号 + 后缀名替换规则。它实际上patsubst函数的一种简写形式。</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">min: $(OUTPUT:.js=.min.js)</span></span><br></pre></td></tr></table></figure>

<p>上面代码的意思是，将变量OUTPUT中的后缀名 .js 全部替换成 .min.js 。</p>
<p>#Makefile 简介</p>
<p>Makefile 是和 make 命令一起配合使用的.</p>
<p>很多大型项目的编译都是通过 Makefile 来组织的, 如果没有 Makefile, 那很多项目中各种库和代码之间的依赖关系不知会多复杂.</p>
<p>Makefile的组织流程的能力如此之强, 不仅可以用来编译项目, 还可以用来组织我们平时的一些日常操作. 这个需要大家发挥自己的想象力.</p>
<p>本篇博客是基于 <a target="_blank" rel="noopener" href="http://bbs.chinaunix.net/forum.php?mod=viewthread&tid=408225">{精华} 跟我一起写 Makefile</a> 而整理的, 有些删减, 追加了一些示例.</p>
<p>非常感谢 gunguymadman_cu 提供如此详尽的Makefile介绍, 这正是我一直寻找的Makefile中文文档.</p>
<h2 id="1-1-Makefile-主要部分"><a href="#1-1-Makefile-主要部分" class="headerlink" title="1.1 Makefile 主要部分"></a>1.1 Makefile 主要部分</h2><p>Makefile基本格式如下:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">target ... : prerequisites1 [space] prerequisites2 ...</span><br><span class="line">[tab] command</span><br><span class="line">    ...</span><br><span class="line">    ...</span><br></pre></td></tr></table></figure>

<p>其中,</p>
<ul>
<li>target    - 目标文件, 可以是 Object File, 也可以是可执行文件</li>
<li>prerequisites - 生成 target 所需要的文件或者目标</li>
<li>command    - make需要执行的命令 (任意的shell命令), Makefile中的命令必须以 [tab] 开头</li>
</ul>
<ol>
<li>显示规则 :: 说明如何生成一个或多个目标文件(包括 生成的文件, 文件的依赖文件, 生成的命令)</li>
<li>隐晦规则 :: make的自动推导功能所执行的规则</li>
<li>变量定义 :: Makefile中定义的变量</li>
<li>文件指示 :: Makefile中引用其他Makefile; 指定Makefile中有效部分; 定义一个多行命令</li>
<li>注释   :: Makefile只有行注释 “#”, 如果要使用或者输出”#”字符, 需要进行转义, “#“</li>
</ol>
<p>##GNU make 的工作方式</p>
<ol>
<li>读入主Makefile (主Makefile中可以引用其他Makefile)</li>
<li>读入被include的其他Makefile</li>
<li>初始化文件中的变量</li>
<li>推导隐晦规则, 并分析所有规则</li>
<li>为所有的目标文件创建依赖关系链</li>
<li>根据依赖关系, 决定哪些目标要重新生成</li>
<li>执行生成命令</li>
</ol>
<h2 id="2-Makefile-初级语法"><a href="#2-Makefile-初级语法" class="headerlink" title="2. Makefile 初级语法"></a><strong>2. Makefile 初级语法</strong></h2><h3 id="2-1-Makefile-规则"><a href="#2-1-Makefile-规则" class="headerlink" title="2.1 Makefile 规则"></a><strong>2.1 Makefile 规则</strong></h3><h4 id="2-1-1-规则语法"><a href="#2-1-1-规则语法" class="headerlink" title="2.1.1 规则语法"></a><strong>2.1.1 规则语法</strong></h4><p>规则主要有2部分: 依赖关系 和 生成目标的方法.</p>
<p>语法有以下2种:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">target ... : prerequisites ...</span><br><span class="line">    command</span><br><span class="line">    ...</span><br></pre></td></tr></table></figure>

<p>或者</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">target ... : prerequisites ; command</span><br><span class="line">    command</span><br><span class="line">    ...</span><br></pre></td></tr></table></figure>

<p>*<strong>注*</strong> command太长, 可以用 “&quot; 作为换行符</p>
<h4 id="2-1-2-规则中的通配符"><a href="#2-1-2-规则中的通配符" class="headerlink" title="2.1.2 规则中的通配符"></a><strong>2.1.2 规则中的通配符</strong></h4><ul>
<li>*   :: 表示任意一个或多个字符</li>
<li>?   :: 表示任意一个字符</li>
<li>[…] :: ex. [abcd] 表示a,b,c,d中任意一个字符, [^abcd]表示除a,b,c,d以外的字符, [0-9]表示 0~9中任意一个数字</li>
<li>~   :: 表示用户的home目录</li>
</ul>
<h4 id="2-1-3-路径搜索"><a href="#2-1-3-路径搜索" class="headerlink" title="2.1.3 路径搜索"></a><strong>2.1.3 路径搜索</strong></h4><p>当一个Makefile中涉及到大量源文件时(这些源文件和Makefile极有可能不在同一个目录中),</p>
<p>这时, 最好将源文件的路径明确在Makefile中, 便于编译时查找. Makefile中有个特殊的变量 <strong>VPATH</strong> 就是完成这个功能的.</p>
<p>指定了 <strong>VPATH</strong> 之后, 如果当前目录中没有找到相应文件或依赖的文件, Makefile 回到 <strong>VPATH</strong> 指定的路径中再去查找..</p>
<p><strong>VPATH</strong> 使用方法:</p>
<ul>
<li>vpath <directories>      :: 当前目录中找不到文件时, 就从<directories>中搜索</li>
<li>vpath <pattern> <directories> :: 符合<pattern>格式的文件, 就从<directories>中搜索</li>
<li>vpath <pattern>        :: 清除符合<pattern>格式的文件搜索路径</li>
<li>vpath             :: 清除所有已经设置好的文件路径</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"># 示例1 - 当前目录中找不到文件时, 按顺序从 src目录 ..&#x2F;parent-dir目录中查找文件</span><br><span class="line">VPATH src:..&#x2F;parent-dir   </span><br><span class="line"></span><br><span class="line"># 示例2 - .h结尾的文件都从 .&#x2F;header 目录中查找</span><br><span class="line">VPATH %.h .&#x2F;header</span><br><span class="line"></span><br><span class="line"># 示例3 - 清除示例2中设置的规则</span><br><span class="line">VPATH %.h</span><br><span class="line"></span><br><span class="line"># 示例4 - 清除所有VPATH的设置</span><br><span class="line">VPATH</span><br></pre></td></tr></table></figure>

<p><a href="javascript:void(0);"><img src="Makefile-tutorial.assets/copycode.gif" alt="复制代码"></a></p>
<h3 id="2-2-Makefile-中的变量"><a href="#2-2-Makefile-中的变量" class="headerlink" title="2.2 Makefile 中的变量"></a><strong>2.2 Makefile 中的变量</strong></h3><h4 id="2-2-1-变量定义-or"><a href="#2-2-1-变量定义-or" class="headerlink" title="2.2.1 变量定义 ( = or := )"></a><strong>2.2.1 变量定义 ( = or := )</strong></h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">OBJS &#x3D; programA.o programB.o</span><br><span class="line">OBJS-ADD &#x3D; $(OBJS) programC.o</span><br><span class="line"># 或者</span><br><span class="line">OBJS :&#x3D; programA.o programB.o</span><br><span class="line">OBJS-ADD :&#x3D; $(OBJS) programC.o</span><br></pre></td></tr></table></figure>

<p>其中 = 和 := 的区别在于, := 只能使用前面定义好的变量, = 可以使用后面定义的变量</p>
<p><strong>测试 =</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"># Makefile内容</span><br><span class="line">OBJS2 &#x3D; $(OBJS1) programC.o</span><br><span class="line">OBJS1 &#x3D; programA.o programB.o</span><br><span class="line"></span><br><span class="line">all:</span><br><span class="line">    @echo $(OBJS2)</span><br><span class="line"></span><br><span class="line"># bash中执行 make, 可以看出虽然 OBJS1 是在 OBJS2 之后定义的, 但在 OBJS2中可以提前使用</span><br><span class="line">$ make</span><br><span class="line">programA.o programB.o programC.o</span><br></pre></td></tr></table></figure>

<p><a href="javascript:void(0);"><img src="https://common.cnblogs.com/images/copycode.gif" alt="复制代码"></a></p>
<p><strong>测试 :=</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"># Makefile内容</span><br><span class="line">OBJS2 :&#x3D; $(OBJS1) programC.o</span><br><span class="line">OBJS1 :&#x3D; programA.o programB.o</span><br><span class="line"></span><br><span class="line">all:</span><br><span class="line">    @echo $(OBJS2)</span><br><span class="line"></span><br><span class="line"># bash中执行 make, 可以看出 OBJS2 中的 $(OBJS1) 为空</span><br><span class="line">$ make</span><br><span class="line">programC.o</span><br></pre></td></tr></table></figure>

<p><a href="javascript:void(0);"><img src="https://common.cnblogs.com/images/copycode.gif" alt="复制代码"></a></p>
<h4 id="2-2-2-变量替换"><a href="#2-2-2-变量替换" class="headerlink" title="2.2.2 变量替换"></a><strong>2.2.2 变量替换</strong></h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"># Makefile内容</span><br><span class="line">SRCS :&#x3D; programA.c programB.c programC.c</span><br><span class="line">OBJS :&#x3D; $(SRCS:%.c&#x3D;%.o)</span><br><span class="line"></span><br><span class="line">all:</span><br><span class="line">    @echo &quot;SRCS: &quot; $(SRCS)</span><br><span class="line">    @echo &quot;OBJS: &quot; $(OBJS)</span><br><span class="line"></span><br><span class="line"># bash中运行make</span><br><span class="line">$ make</span><br><span class="line">SRCS:  programA.c programB.c programC.c</span><br><span class="line">OBJS:  programA.o programB.o programC.o</span><br></pre></td></tr></table></figure>

<p><a href="javascript:void(0);"><img src="https://common.cnblogs.com/images/copycode.gif" alt="复制代码"></a></p>
<h4 id="2-2-3-变量追加值"><a href="#2-2-3-变量追加值" class="headerlink" title="2.2.3 变量追加值 +="></a><strong>2.2.3 变量追加值 +=</strong></h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"># Makefile内容</span><br><span class="line">SRCS :&#x3D; programA.c programB.c programC.c</span><br><span class="line">SRCS +&#x3D; programD.c</span><br><span class="line"></span><br><span class="line">all:</span><br><span class="line">    @echo &quot;SRCS: &quot; $(SRCS)</span><br><span class="line"></span><br><span class="line"># bash中运行make</span><br><span class="line">$ make</span><br><span class="line">SRCS:  programA.c programB.c programC.c programD.c</span><br></pre></td></tr></table></figure>

<p><a href="javascript:void(0);"><img src="https://common.cnblogs.com/images/copycode.gif" alt="复制代码"></a></p>
<h4 id="2-2-4-变量覆盖-override"><a href="#2-2-4-变量覆盖-override" class="headerlink" title="2.2.4 变量覆盖 override"></a><strong>2.2.4 变量覆盖 override</strong></h4><p>作用是使 Makefile中定义的变量能够覆盖 make 命令参数中指定的变量</p>
<p>语法:</p>
<ul>
<li>override <variable> = <value></li>
<li>override <variable> := <value></li>
<li>override <variable> += <value></li>
</ul>
<p>下面通过一个例子体会 override 的作用：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"># Makefile内容 (没有用override)</span><br><span class="line">SRCS :&#x3D; programA.c programB.c programC.c</span><br><span class="line"></span><br><span class="line">all:</span><br><span class="line">    @echo &quot;SRCS: &quot; $(SRCS)</span><br><span class="line"></span><br><span class="line"># bash中运行make</span><br><span class="line">$ make SRCS&#x3D;nothing</span><br><span class="line">SRCS:  nothing</span><br><span class="line"></span><br><span class="line">#################################################</span><br><span class="line"></span><br><span class="line"># Makefile内容 (用override)</span><br><span class="line">override SRCS :&#x3D; programA.c programB.c programC.c</span><br><span class="line"></span><br><span class="line">all:</span><br><span class="line">    @echo &quot;SRCS: &quot; $(SRCS)</span><br><span class="line"></span><br><span class="line"># bash中运行make</span><br><span class="line">$ make SRCS&#x3D;nothing</span><br><span class="line">SRCS:  programA.c programB.c programC.c</span><br></pre></td></tr></table></figure>

<p><a href="javascript:void(0);"><img src="https://common.cnblogs.com/images/copycode.gif" alt="复制代码"></a></p>
<h4 id="2-2-5-目标变量"><a href="#2-2-5-目标变量" class="headerlink" title="2.2.5 目标变量"></a><strong>2.2.5 目标变量</strong></h4><p>作用是使变量的作用域仅限于这个目标(target), 而不像之前例子中定义的变量, 对整个Makefile都有效.</p>
<p>语法:</p>
<ul>
<li>&lt;target …&gt; :: <variable-assignment></li>
<li>&lt;target …&gt; :: override <variable-assignment> (override作用参见 变量覆盖的介绍)</li>
</ul>
<p>示例:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"># Makefile 内容</span><br><span class="line">SRCS :&#x3D; programA.c programB.c programC.c</span><br><span class="line"></span><br><span class="line">target1: TARGET1-SRCS :&#x3D; programD.c</span><br><span class="line">target1:</span><br><span class="line">    @echo &quot;SRCS: &quot; $(SRCS)</span><br><span class="line">    @echo &quot;SRCS: &quot; $(TARGET1-SRCS)</span><br><span class="line"></span><br><span class="line">target2:</span><br><span class="line">    @echo &quot;SRCS: &quot; $(SRCS)</span><br><span class="line">    @echo &quot;SRCS: &quot; $(TARGET1-SRCS)</span><br><span class="line"></span><br><span class="line"># bash中执行make</span><br><span class="line">$ make target1</span><br><span class="line">SRCS:  programA.c programB.c programC.c</span><br><span class="line">SRCS:  programD.c</span><br><span class="line"></span><br><span class="line">$ make target2     &lt;-- target2中显示不了 $(TARGET1-SRCS)</span><br><span class="line">SRCS:  programA.c programB.c programC.c</span><br><span class="line">SRCS:</span><br></pre></td></tr></table></figure>

<p><a href="javascript:void(0);"><img src="https://common.cnblogs.com/images/copycode.gif" alt="复制代码"></a></p>
<h3 id="2-3-Makefile-命令前缀"><a href="#2-3-Makefile-命令前缀" class="headerlink" title="2.3 Makefile 命令前缀"></a><strong>2.3 Makefile 命令前缀</strong></h3><p>Makefile 中书写shell命令时可以加2种前缀 @ 和 -, 或者不用前缀.</p>
<p>3种格式的shell命令区别如下:</p>
<ul>
<li>不用前缀 :: 输出执行的命令以及命令执行的结果, 出错的话停止执行</li>
<li>前缀 @  :: 只输出命令执行的结果, 出错的话停止执行</li>
<li>前缀 -  :: 命令执行有错的话, 忽略错误, 继续执行</li>
</ul>
<p>示例:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"># Makefile 内容 (不用前缀)</span><br><span class="line">all:</span><br><span class="line">    echo &quot;没有前缀&quot;</span><br><span class="line">    cat this_file_not_exist</span><br><span class="line">    echo &quot;错误之后的命令&quot;       &lt;-- 这条命令不会被执行</span><br><span class="line"></span><br><span class="line"># bash中执行 make</span><br><span class="line">$ make</span><br><span class="line">echo &quot;没有前缀&quot;             &lt;-- 命令本身显示出来</span><br><span class="line">没有前缀                    &lt;-- 命令执行结果显示出来</span><br><span class="line">cat this_file_not_exist</span><br><span class="line">cat: this_file_not_exist: No such file or directory</span><br><span class="line">make: *** [all] Error 1</span><br><span class="line"></span><br><span class="line">###########################################################</span><br><span class="line"></span><br><span class="line"># Makefile 内容 (前缀 @)</span><br><span class="line">all:</span><br><span class="line">    @echo &quot;没有前缀&quot;</span><br><span class="line">    @cat this_file_not_exist</span><br><span class="line">    @echo &quot;错误之后的命令&quot;       &lt;-- 这条命令不会被执行</span><br><span class="line"></span><br><span class="line"># bash中执行 make</span><br><span class="line">$ make</span><br><span class="line">没有前缀                         &lt;-- 只有命令执行的结果, 不显示命令本身</span><br><span class="line">cat: this_file_not_exist: No such file or directory</span><br><span class="line">make: *** [all] Error 1</span><br><span class="line"></span><br><span class="line">###########################################################</span><br><span class="line"></span><br><span class="line"># Makefile 内容 (前缀 -)</span><br><span class="line">all:</span><br><span class="line">    -echo &quot;没有前缀&quot;</span><br><span class="line">    -cat this_file_not_exist</span><br><span class="line">    -echo &quot;错误之后的命令&quot;       &lt;-- 这条命令会被执行</span><br><span class="line"></span><br><span class="line"># bash中执行 make</span><br><span class="line">$ make</span><br><span class="line">echo &quot;没有前缀&quot;             &lt;-- 命令本身显示出来</span><br><span class="line">没有前缀                    &lt;-- 命令执行结果显示出来</span><br><span class="line">cat this_file_not_exist</span><br><span class="line">cat: this_file_not_exist: No such file or directory</span><br><span class="line">make: [all] Error 1 (ignored)</span><br><span class="line">echo &quot;错误之后的命令&quot;       &lt;-- 出错之后的命令也会显示</span><br><span class="line">错误之后的命令              &lt;-- 出错之后的命令也会执行</span><br></pre></td></tr></table></figure>

<p><a href="javascript:void(0);"><img src="https://common.cnblogs.com/images/copycode.gif" alt="复制代码"></a></p>
<h3 id="2-4-伪目标"><a href="#2-4-伪目标" class="headerlink" title="2.4 伪目标"></a><strong>2.4 伪目标</strong></h3><p>伪目标并不是一个”目标(target)”, 不像真正的目标那样会生成一个目标文件.</p>
<p>典型的伪目标是 Makefile 中用来清理编译过程中中间文件的 clean 伪目标, 一般格式如下:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">.PHONY: clean   &lt;-- 这句没有也行, 但是最好加上</span><br><span class="line">clean:</span><br><span class="line">    -rm -f *.o</span><br></pre></td></tr></table></figure>

<h3 id="2-5-引用其他的-Makefile"><a href="#2-5-引用其他的-Makefile" class="headerlink" title="2.5 引用其他的 Makefile"></a><strong>2.5 引用其他的 Makefile</strong></h3><p>语法: include <filename> (filename 可以包含通配符和路径)</p>
<p>示例:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"># Makefile 内容</span><br><span class="line">all:</span><br><span class="line">    @echo &quot;主 Makefile begin&quot;</span><br><span class="line">    @make other-all</span><br><span class="line">    @echo &quot;主 Makefile end&quot;</span><br><span class="line"></span><br><span class="line">include .&#x2F;other&#x2F;Makefile</span><br><span class="line"></span><br><span class="line"># .&#x2F;other&#x2F;Makefile 内容</span><br><span class="line">other-all:</span><br><span class="line">    @echo &quot;other makefile begin&quot;</span><br><span class="line">    @echo &quot;other makefile end&quot;</span><br><span class="line"></span><br><span class="line"># bash中执行 make</span><br><span class="line">$ ll</span><br><span class="line">total 20K</span><br><span class="line">-rw-r--r-- 1 wangyubin wangyubin  125 Sep 23 16:13 Makefile</span><br><span class="line">-rw-r--r-- 1 wangyubin wangyubin  11K Sep 23 16:15 makefile.org   &lt;-- 这个文件不用管</span><br><span class="line">drwxr-xr-x 2 wangyubin wangyubin 4.0K Sep 23 16:11 other</span><br><span class="line">$ ll other&#x2F;</span><br><span class="line">total 4.0K</span><br><span class="line">-rw-r--r-- 1 wangyubin wangyubin 71 Sep 23 16:11 Makefile</span><br><span class="line"></span><br><span class="line">$ make</span><br><span class="line">主 Makefile begin</span><br><span class="line">make[1]: Entering directory &#96;&#x2F;path&#x2F;to&#x2F;test&#x2F;makefile&#39;</span><br><span class="line">other makefile begin</span><br><span class="line">other makefile end</span><br><span class="line">make[1]: Leaving directory &#96;&#x2F;path&#x2F;to&#x2F;test&#x2F;makefile&#39;</span><br><span class="line">主 Makefile end</span><br></pre></td></tr></table></figure>

<p><a href="javascript:void(0);"><img src="https://common.cnblogs.com/images/copycode.gif" alt="复制代码"></a></p>
<h3 id="2-6-查看C文件的依赖关系"><a href="#2-6-查看C文件的依赖关系" class="headerlink" title="2.6 查看C文件的依赖关系"></a><strong>2.6 查看C文件的依赖关系</strong></h3><p>写 Makefile 的时候, 需要确定每个目标的依赖关系.</p>
<p>GNU提供一个机制可以查看C代码文件依赖那些文件, 这样我们在写 Makefile 目标的时候就不用打开C源码来看其依赖那些文件了.</p>
<p>比如, 下面命令显示内核源码中 virt/kvm/kvm_main.c 中的依赖关系</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ cd virt&#x2F;kvm&#x2F;</span><br><span class="line">$ gcc -MM kvm_main.c </span><br><span class="line">kvm_main.o: kvm_main.c iodev.h coalesced_mmio.h async_pf.h   &lt;-- 这句就可以加到 Makefile 中作为编译 kvm_main.o 的依赖关系</span><br></pre></td></tr></table></figure>

<h3 id="2-7-make-退出码"><a href="#2-7-make-退出码" class="headerlink" title="2.7 make 退出码"></a><strong>2.7 make 退出码</strong></h3><p>Makefile的退出码有以下3种：</p>
<ul>
<li>0 :: 表示成功执行</li>
<li>1 :: 表示make命令出现了错误</li>
<li>2 :: 使用了 “-q” 选项, 并且make使得一些目标不需要更新</li>
</ul>
<h3 id="2-8-指定-Makefile，-指定特定目标"><a href="#2-8-指定-Makefile，-指定特定目标" class="headerlink" title="2.8 指定 Makefile， 指定特定目标"></a><strong>2.8 指定 Makefile， 指定特定目标</strong></h3><p>默认执行 make 命令时, GNU make在当前目录下依次搜索下面3个文件 “GNUmakefile”, “makefile”, “Makefile”,</p>
<p>找到对应文件之后, 就开始执行此文件中的第一个目标(target). 如果找不到这3个文件就报错.</p>
<p>非默认情况下, 可以在 make 命令中指定特定的 Makefile 和特定的 目标.</p>
<p>示例：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"># Makefile文件名改为 MyMake, 内容</span><br><span class="line">target1:</span><br><span class="line">    @echo &quot;target [1]  begin&quot;</span><br><span class="line">    @echo &quot;target [1]  end&quot;</span><br><span class="line"></span><br><span class="line">target2:</span><br><span class="line">    @echo &quot;target [2]  begin&quot;</span><br><span class="line">    @echo &quot;target [2]  end&quot;</span><br><span class="line"></span><br><span class="line"># bash 中执行 make</span><br><span class="line">$ ls</span><br><span class="line">Makefile</span><br><span class="line">$ mv Makefile MyMake</span><br><span class="line">$ ls</span><br><span class="line">MyMake</span><br><span class="line">$ make                     &lt;-- 找不到默认的 Makefile</span><br><span class="line">make: *** No targets specified and no makefile found.  Stop.</span><br><span class="line">$ make -f MyMake           &lt;-- 指定特定的Makefile</span><br><span class="line">target [1]  begin</span><br><span class="line">target [1]  end</span><br><span class="line">$ make -f MyMake target2   &lt;-- 指定特定的目标(target)</span><br><span class="line">target [2]  begin</span><br><span class="line">target [2]  end</span><br></pre></td></tr></table></figure>

<p><a href="javascript:void(0);"><img src="https://common.cnblogs.com/images/copycode.gif" alt="复制代码"></a></p>
<h3 id="2-9-make-参数介绍"><a href="#2-9-make-参数介绍" class="headerlink" title="2.9 make 参数介绍"></a><strong>2.9 make 参数介绍</strong></h3><p>make 的参数有很多, 可以通过 make -h 去查看, 下面只介绍几个我认为比较有用的.</p>
<table>
<thead>
<tr>
<th><strong>参数</strong></th>
<th><strong>含义</strong></th>
</tr>
</thead>
<tbody><tr>
<td>–debug[=<options>]</td>
<td>输出make的调试信息, options 可以是 a, b, v</td>
</tr>
<tr>
<td>-j –jobs</td>
<td>同时运行的命令的个数, 也就是多线程执行 Makefile</td>
</tr>
<tr>
<td>-r –no-builtin-rules</td>
<td>禁止使用任何隐含规则</td>
</tr>
<tr>
<td>-R –no-builtin-variabes</td>
<td>禁止使用任何作用于变量上的隐含规则</td>
</tr>
<tr>
<td>-B –always-make</td>
<td>假设所有目标都有更新, 即强制重编译</td>
</tr>
</tbody></table>
<h3 id="2-10-Makefile-隐含规则"><a href="#2-10-Makefile-隐含规则" class="headerlink" title="2.10 Makefile 隐含规则"></a><strong>2.10 Makefile 隐含规则</strong></h3><p>这里只列一个和编译C相关的.</p>
<p>编译C时，<n>.o 的目标会自动推导为 <n>.c</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"># Makefile 中</span><br><span class="line">main : main.o</span><br><span class="line">    gcc -o main main.o</span><br><span class="line"></span><br><span class="line">#会自动变为:</span><br><span class="line">main : main.o</span><br><span class="line">    gcc -o main main.o</span><br><span class="line"></span><br><span class="line">main.o: main.c    &lt;-- main.o 这个目标是隐含生成的</span><br><span class="line">    gcc -c main.c</span><br></pre></td></tr></table></figure>

<p><a href="javascript:void(0);"><img src="https://common.cnblogs.com/images/copycode.gif" alt="复制代码"></a></p>
<h3 id="2-11-隐含规则中的-命令变量-和-命令参数变量"><a href="#2-11-隐含规则中的-命令变量-和-命令参数变量" class="headerlink" title="2.11 隐含规则中的 命令变量 和 命令参数变量"></a><strong>2.11 隐含规则中的 命令变量 和 命令参数变量</strong></h3><h4 id="2-11-1-命令变量-书写Makefile可以直接写-shell时用这些变量"><a href="#2-11-1-命令变量-书写Makefile可以直接写-shell时用这些变量" class="headerlink" title="2.11.1 命令变量, 书写Makefile可以直接写 shell时用这些变量."></a><strong>2.11.1 命令变量, 书写Makefile可以直接写 shell时用这些变量.</strong></h4><p>下面只列出一些C相关的</p>
<table>
<thead>
<tr>
<th><strong>变量名</strong></th>
<th><strong>含义</strong></th>
</tr>
</thead>
<tbody><tr>
<td>RM</td>
<td>rm -f</td>
</tr>
<tr>
<td>AR</td>
<td>ar</td>
</tr>
<tr>
<td>CC</td>
<td>cc</td>
</tr>
<tr>
<td>CXX</td>
<td>g++</td>
</tr>
</tbody></table>
<p>示例:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"># Makefile 内容</span><br><span class="line">all:</span><br><span class="line">    @echo $(RM)</span><br><span class="line">    @echo $(AR)</span><br><span class="line">    @echo $(CC)</span><br><span class="line">    @echo $(CXX)</span><br><span class="line"></span><br><span class="line"># bash 中执行make, 显示各个变量的值</span><br><span class="line">$ make</span><br><span class="line">rm -f</span><br><span class="line">ar</span><br><span class="line">cc</span><br><span class="line">g++</span><br></pre></td></tr></table></figure>

<p><a href="javascript:void(0);"><img src="https://common.cnblogs.com/images/copycode.gif" alt="复制代码"></a></p>
<h4 id="2-11-2-命令参数变量"><a href="#2-11-2-命令参数变量" class="headerlink" title="2.11.2 命令参数变量"></a><strong>2.11.2 命令参数变量</strong></h4><table>
<thead>
<tr>
<th><strong>变量名</strong></th>
<th><strong>含义</strong></th>
</tr>
</thead>
<tbody><tr>
<td>ARFLAGS</td>
<td>AR命令的参数</td>
</tr>
<tr>
<td>CFLAGS</td>
<td>C语言编译器的参数</td>
</tr>
<tr>
<td>CXXFLAGS</td>
<td>C++语言编译器的参数</td>
</tr>
</tbody></table>
<p>示例: 下面以 CFLAGS 为例演示</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"># test.c 内容</span><br><span class="line">#include &lt;stdio.h&gt;</span><br><span class="line"></span><br><span class="line">int main(int argc, char *argv[])</span><br><span class="line">&#123;</span><br><span class="line">    printf (&quot;Hello Makefile\n&quot;);</span><br><span class="line">    return 0;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"># Makefile 内容</span><br><span class="line">test: test.o</span><br><span class="line">    $(CC) -o test test.o</span><br><span class="line"></span><br><span class="line"># bash 中用 make 来测试</span><br><span class="line">$ ll</span><br><span class="line">total 24K</span><br><span class="line">-rw-r--r-- 1 wangyubin wangyubin  69 Sep 23 17:31 Makefile</span><br><span class="line">-rw-r--r-- 1 wangyubin wangyubin 14K Sep 23 19:51 makefile.org   &lt;-- 请忽略这个文件</span><br><span class="line">-rw-r--r-- 1 wangyubin wangyubin 392 Sep 23 17:31 test.c</span><br><span class="line"></span><br><span class="line">$ make</span><br><span class="line">cc    -c -o test.o test.c</span><br><span class="line">cc -o test test.o               &lt;-- 这个是自动推导的</span><br><span class="line"></span><br><span class="line">$ rm -f test test.o</span><br><span class="line"></span><br><span class="line">$ make CFLAGS&#x3D;-Wall             &lt;-- 命令中加的编译器参数自动追加入下面的编译中了</span><br><span class="line">cc -Wall   -c -o test.o test.c</span><br><span class="line">cc -o test test.o</span><br></pre></td></tr></table></figure>

<p><a href="javascript:void(0);"><img src="https://common.cnblogs.com/images/copycode.gif" alt="复制代码"></a></p>
<h3 id="2-12-自动变量"><a href="#2-12-自动变量" class="headerlink" title="2.12 自动变量"></a><strong>2.12 自动变量</strong></h3><p>Makefile 中很多时候通过自动变量来简化书写, 各个自动变量的含义如下:</p>
<table>
<thead>
<tr>
<th><strong>自动变量</strong></th>
<th><strong>含义</strong></th>
</tr>
</thead>
<tbody><tr>
<td>$@</td>
<td>目标集合</td>
</tr>
<tr>
<td>$%</td>
<td>当目标是函数库文件时, 表示其中的目标文件名</td>
</tr>
<tr>
<td>$&lt;</td>
<td>第一个依赖目标. 如果依赖目标是多个, 逐个表示依赖目标</td>
</tr>
<tr>
<td>$?</td>
<td>比目标新的依赖目标的集合</td>
</tr>
<tr>
<td>$^</td>
<td>所有依赖目标的集合, 会去除重复的依赖目标</td>
</tr>
<tr>
<td>$+</td>
<td>所有依赖目标的集合, 不会去除重复的依赖目标</td>
</tr>
<tr>
<td>$*</td>
<td>这个是GNU make特有的, 其它的make不一定支持</td>
</tr>
</tbody></table>
<h2 id="3-Makefile-高级语法"><a href="#3-Makefile-高级语法" class="headerlink" title="3. Makefile 高级语法"></a><strong>3. Makefile 高级语法</strong></h2><h3 id="3-1-嵌套Makefile"><a href="#3-1-嵌套Makefile" class="headerlink" title="3.1 嵌套Makefile"></a><strong>3.1 嵌套Makefile</strong></h3><p>在 Makefile 初级语法中已经提到过引用其它 Makefile的方法. 这里有另一种写法, 并且可以向引用的其它 Makefile 传递参数.</p>
<p>示例: (不传递参数, 只是调用子文件夹 other 中的Makefile)</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"># Makefile 内容</span><br><span class="line">all:</span><br><span class="line">    @echo &quot;主 Makefile begin&quot;</span><br><span class="line">    @cd .&#x2F;other &amp;&amp; make</span><br><span class="line">    @echo &quot;主 Makefile end&quot;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># .&#x2F;other&#x2F;Makefile 内容</span><br><span class="line">other-all:</span><br><span class="line">    @echo &quot;other makefile begin&quot;</span><br><span class="line">    @echo &quot;other makefile end&quot;</span><br><span class="line"></span><br><span class="line"># bash中执行 make</span><br><span class="line">$ ll</span><br><span class="line">total 28K</span><br><span class="line">-rw-r--r-- 1 wangyubin wangyubin  104 Sep 23 20:43 Makefile</span><br><span class="line">-rw-r--r-- 1 wangyubin wangyubin  17K Sep 23 20:44 makefile.org   &lt;-- 这个文件不用管</span><br><span class="line">drwxr-xr-x 2 wangyubin wangyubin 4.0K Sep 23 20:42 other</span><br><span class="line">$ ll other&#x2F;</span><br><span class="line">total 4.0K</span><br><span class="line">-rw-r--r-- 1 wangyubin wangyubin 71 Sep 23 16:11 Makefile</span><br><span class="line"></span><br><span class="line">$ make</span><br><span class="line">主 Makefile begin</span><br><span class="line">make[1]: Entering directory &#96;&#x2F;path&#x2F;to&#x2F;test&#x2F;makefile&#x2F;other&#39;</span><br><span class="line">other makefile begin</span><br><span class="line">other makefile end</span><br><span class="line">make[1]: Leaving directory &#96;&#x2F;path&#x2F;to&#x2F;test&#x2F;makefile&#x2F;other&#39;</span><br><span class="line">主 Makefile end</span><br></pre></td></tr></table></figure>

<p><a href="javascript:void(0);"><img src="https://common.cnblogs.com/images/copycode.gif" alt="复制代码"></a></p>
<p>示例: (用export传递参数)</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"># Makefile 内容</span><br><span class="line">export VALUE1 :&#x3D; export.c    &lt;-- 用了 export, 此变量能够传递到 .&#x2F;other&#x2F;Makefile 中</span><br><span class="line">VALUE2 :&#x3D; no-export.c        &lt;-- 此变量不能传递到 .&#x2F;other&#x2F;Makefile 中</span><br><span class="line"></span><br><span class="line">all:</span><br><span class="line">    @echo &quot;主 Makefile begin&quot;</span><br><span class="line">    @cd .&#x2F;other &amp;&amp; make</span><br><span class="line">    @echo &quot;主 Makefile end&quot;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># .&#x2F;other&#x2F;Makefile 内容</span><br><span class="line">other-all:</span><br><span class="line">    @echo &quot;other makefile begin&quot;</span><br><span class="line">    @echo &quot;VALUE1: &quot; $(VALUE1)</span><br><span class="line">    @echo &quot;VALUE2: &quot; $(VALUE2)</span><br><span class="line">    @echo &quot;other makefile end&quot;</span><br><span class="line"></span><br><span class="line"># bash中执行 make</span><br><span class="line">$ make</span><br><span class="line">主 Makefile begin</span><br><span class="line">make[1]: Entering directory &#96;&#x2F;path&#x2F;to&#x2F;test&#x2F;makefile&#x2F;other&#39;</span><br><span class="line">other makefile begin</span><br><span class="line">VALUE1:  export.c        &lt;-- VALUE1 传递成功</span><br><span class="line">VALUE2:                  &lt;-- VALUE2 传递失败</span><br><span class="line">other makefile end</span><br><span class="line">make[1]: Leaving directory &#96;&#x2F;path&#x2F;to&#x2F;test&#x2F;makefile&#x2F;other&#39;</span><br><span class="line">主 Makefile end</span><br></pre></td></tr></table></figure>

<p><a href="javascript:void(0);"><img src="https://common.cnblogs.com/images/copycode.gif" alt="复制代码"></a></p>
<p>*<strong>补充*</strong> export 语法格式如下:</p>
<ul>
<li>export variable = value</li>
<li>export variable := value</li>
<li>export variable += value</li>
</ul>
<h3 id="3-2-定义命令包"><a href="#3-2-定义命令包" class="headerlink" title="3.2 定义命令包"></a><strong>3.2 定义命令包</strong></h3><p>命令包有点像是个函数, 将连续的相同的命令合成一条, 减少 Makefile 中的代码量, 便于以后维护.</p>
<p><strong>语法:</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">define &lt;command-name&gt;</span><br><span class="line">command</span><br><span class="line">...</span><br><span class="line">endef</span><br></pre></td></tr></table></figure>

<p><strong>示例:</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"># Makefile 内容</span><br><span class="line">define run-hello-makefile</span><br><span class="line">@echo -n &quot;Hello&quot;</span><br><span class="line">@echo &quot; Makefile!&quot;</span><br><span class="line">@echo &quot;这里可以执行多条 Shell 命令!&quot;</span><br><span class="line">endef</span><br><span class="line"></span><br><span class="line">all:</span><br><span class="line">    $(run-hello-makefile)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># bash 中运行make</span><br><span class="line">$ make</span><br><span class="line">Hello Makefile!</span><br><span class="line">这里可以执行多条 Shell 命令!</span><br></pre></td></tr></table></figure>

<p><a href="javascript:void(0);"><img src="https://common.cnblogs.com/images/copycode.gif" alt="复制代码"></a></p>
<h3 id="3-3-条件判断"><a href="#3-3-条件判断" class="headerlink" title="3.3 条件判断"></a><strong>3.3 条件判断</strong></h3><p>条件判断的关键字主要有 <strong>ifeq ifneq ifdef ifndef</strong></p>
<p><strong>语法:</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;conditional-directive&gt;</span><br><span class="line">&lt;text-if-true&gt;</span><br><span class="line">endif</span><br><span class="line"></span><br><span class="line"># 或者</span><br><span class="line">&lt;conditional-directive&gt;</span><br><span class="line">&lt;text-if-true&gt;</span><br><span class="line">else</span><br><span class="line">&lt;text-if-false&gt;</span><br><span class="line">endif</span><br></pre></td></tr></table></figure>

<p><a href="javascript:void(0);"><img src="https://common.cnblogs.com/images/copycode.gif" alt="复制代码"></a></p>
<p><strong>示例:</strong> ifeq的例子, ifneq和ifeq的使用方法类似, 就是取反</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"># Makefile 内容</span><br><span class="line">all:</span><br><span class="line">ifeq (&quot;aa&quot;, &quot;bb&quot;)</span><br><span class="line">    @echo &quot;equal&quot;</span><br><span class="line">else</span><br><span class="line">    @echo &quot;not equal&quot;</span><br><span class="line">endif</span><br><span class="line"></span><br><span class="line"># bash 中执行 make</span><br><span class="line">$ make</span><br><span class="line">not equal</span><br></pre></td></tr></table></figure>

<p><a href="javascript:void(0);"><img src="https://common.cnblogs.com/images/copycode.gif" alt="复制代码"></a></p>
<p><strong>示例:</strong> ifdef的例子, ifndef和ifdef的使用方法类似, 就是取反</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"># Makefile 内容</span><br><span class="line">SRCS :&#x3D; program.c</span><br><span class="line"></span><br><span class="line">all:</span><br><span class="line">ifdef SRCS</span><br><span class="line">    @echo $(SRCS)</span><br><span class="line">else</span><br><span class="line">    @echo &quot;no SRCS&quot;</span><br><span class="line">endif</span><br><span class="line"></span><br><span class="line"># bash 中执行 make</span><br><span class="line">$ make</span><br><span class="line">program.c</span><br></pre></td></tr></table></figure>

<p><a href="javascript:void(0);"><img src="https://common.cnblogs.com/images/copycode.gif" alt="复制代码"></a></p>
<h3 id="3-4-Makefile-中的函数"><a href="#3-4-Makefile-中的函数" class="headerlink" title="3.4 Makefile 中的函数"></a><strong>3.4 Makefile 中的函数</strong></h3><p>Makefile 中自带了一些函数, 利用这些函数可以简化 Makefile 的编写.</p>
<p>函数调用语法如下:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$(&lt;function&gt; &lt;arguments&gt;)</span><br><span class="line"># 或者</span><br><span class="line">$&#123;&lt;function&gt; &lt;arguments&gt;&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><function> 是函数名</li>
<li><arguments> 是函数参数</li>
</ul>
<h4 id="3-4-1-字符串函数"><a href="#3-4-1-字符串函数" class="headerlink" title="3.4.1 字符串函数"></a><strong>3.4.1 字符串函数</strong></h4><p><strong>字符串替换函数: $(subst ,,)</strong></p>
<p>功能: 把字符串<text> 中的 <from> 替换为 <to></p>
<p>返回: 替换过的字符串</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"># Makefile 内容</span><br><span class="line">all:</span><br><span class="line">    @echo $(subst t,e,maktfilt)  &lt;-- 将t替换为e</span><br><span class="line"></span><br><span class="line"># bash 中执行 make</span><br><span class="line">$ make</span><br><span class="line">makefile</span><br></pre></td></tr></table></figure>

<p><a href="javascript:void(0);"><img src="https://common.cnblogs.com/images/copycode.gif" alt="复制代码"></a></p>
<p><strong>模式字符串替换函数: $(patsubst ,,)</strong></p>
<p>功能: 查找<text>中的单词(单词以”空格”, “tab”, “换行”来分割) 是否符合 <pattern>, 符合的话, 用 <replacement> 替代.</p>
<p>返回: 替换过的字符串</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"># Makefile 内容</span><br><span class="line">all:</span><br><span class="line">    @echo $(patsubst %.c,%.o,programA.c programB.c)</span><br><span class="line"></span><br><span class="line"># bash 中执行 make</span><br><span class="line">$ make</span><br><span class="line">programA.o programB.o</span><br></pre></td></tr></table></figure>

<p><a href="javascript:void(0);"><img src="https://common.cnblogs.com/images/copycode.gif" alt="复制代码"></a></p>
<p><strong>去空格函数: $(strip )</strong></p>
<p>功能: 去掉 <string> 字符串中开头和结尾的空字符</p>
<p>返回: 被去掉空格的字符串值</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"># Makefile 内容</span><br><span class="line">VAL :&#x3D; &quot;       aa  bb  cc &quot;</span><br><span class="line"></span><br><span class="line">all:</span><br><span class="line">    @echo &quot;去除空格前: &quot; $(VAL)</span><br><span class="line">    @echo &quot;去除空格后: &quot; $(strip $(VAL))</span><br><span class="line"></span><br><span class="line"># bash 中执行 make</span><br><span class="line">$ make</span><br><span class="line">去除空格前:         aa  bb  cc </span><br><span class="line">去除空格后:   aa bb cc</span><br></pre></td></tr></table></figure>

<p><a href="javascript:void(0);"><img src="https://common.cnblogs.com/images/copycode.gif" alt="复制代码"></a></p>
<p><strong>查找字符串函数: $(findstring ,)</strong></p>
<p>功能: 在字符串 <in> 中查找 <find> 字符串</p>
<p>返回: 如果找到, 返回 <find> 字符串, 否则返回空字符串</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"># Makefile 内容</span><br><span class="line">VAL :&#x3D; &quot;       aa  bb  cc &quot;</span><br><span class="line"></span><br><span class="line">all:</span><br><span class="line">    @echo $(findstring aa,$(VAL))</span><br><span class="line">    @echo $(findstring ab,$(VAL))</span><br><span class="line"></span><br><span class="line"># bash 中执行 make</span><br><span class="line">$ make</span><br><span class="line">aa</span><br></pre></td></tr></table></figure>

<p><a href="javascript:void(0);"><img src="https://common.cnblogs.com/images/copycode.gif" alt="复制代码"></a></p>
<p><strong>过滤函数: $(filter ,)</strong></p>
<p>功能: 以 <pattern> 模式过滤字符串 <text>, <em>保留</em> 符合模式 <pattern> 的单词, 可以有多个模式</p>
<p>返回: 符合模式 <pattern> 的字符串</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"># Makefile 内容</span><br><span class="line">all:</span><br><span class="line">    @echo $(filter %.o %.a,program.c program.o program.a)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># bash 中执行 make</span><br><span class="line">$ make</span><br><span class="line">program.o program.a</span><br></pre></td></tr></table></figure>

<p><a href="javascript:void(0);"><img src="https://common.cnblogs.com/images/copycode.gif" alt="复制代码"></a></p>
<p><strong>反过滤函数: $(filter-out ,)</strong></p>
<p>功能: 以 <pattern> 模式过滤字符串 <text>, <em>去除</em> 符合模式 <pattern> 的单词, 可以有多个模式</p>
<p>返回: 不符合模式 <pattern> 的字符串</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"># Makefile 内容</span><br><span class="line">all:</span><br><span class="line">    @echo $(filter-out %.o %.a,program.c program.o program.a)</span><br><span class="line"></span><br><span class="line"># bash 中执行 make</span><br><span class="line">$ make</span><br><span class="line">program.c</span><br></pre></td></tr></table></figure>

<p><a href="javascript:void(0);"><img src="https://common.cnblogs.com/images/copycode.gif" alt="复制代码"></a></p>
<p><strong>排序函数: $(sort )</strong></p>
<p>功能: 给字符串 <list> 中的单词排序 (升序)</p>
<p>返回: 排序后的字符串</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"># Makefile 内容</span><br><span class="line">all:</span><br><span class="line">    @echo $(sort bac abc acb cab)</span><br><span class="line"></span><br><span class="line"># bash 中执行 make</span><br><span class="line">$ make</span><br><span class="line">abc acb bac cab</span><br></pre></td></tr></table></figure>

<p><a href="javascript:void(0);"><img src="https://common.cnblogs.com/images/copycode.gif" alt="复制代码"></a></p>
<p><strong>取单词函数: $(word ,)</strong></p>
<p>功能: 取字符串 <text> 中的 第<n>个单词 (n从1开始)</p>
<p>返回: <text> 中的第<n>个单词, 如果<n> 比 <text> 中单词个数要大, 则返回空字符串</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"># Makefile 内容</span><br><span class="line">all:</span><br><span class="line">    @echo $(word 1,aa bb cc dd)</span><br><span class="line">    @echo $(word 5,aa bb cc dd)</span><br><span class="line">    @echo $(word 4,aa bb cc dd)</span><br><span class="line"></span><br><span class="line"># bash 中执行 make</span><br><span class="line">$ make</span><br><span class="line">aa</span><br><span class="line"></span><br><span class="line">dd</span><br></pre></td></tr></table></figure>

<p><a href="javascript:void(0);"><img src="https://common.cnblogs.com/images/copycode.gif" alt="复制代码"></a></p>
<p><strong>取单词串函数: $(wordlist ,,)</strong></p>
<p>功能: 从字符串<text>中取从<s>开始到<e>的单词串. <s>和<e>是一个数字.</p>
<p>返回: 从<s>到<e>的字符串</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"># Makefile 内容</span><br><span class="line">all:</span><br><span class="line">    @echo $(wordlist 1,3,aa bb cc dd)</span><br><span class="line">    @echo $(word 5,6,aa bb cc dd)</span><br><span class="line">    @echo $(word 2,5,aa bb cc dd)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># bash 中执行 make</span><br><span class="line">$ make</span><br><span class="line">aa bb cc</span><br><span class="line"></span><br><span class="line">bb</span><br></pre></td></tr></table></figure>

<p><a href="javascript:void(0);"><img src="https://common.cnblogs.com/images/copycode.gif" alt="复制代码"></a></p>
<p><strong>单词个数统计函数: $(words )</strong></p>
<p>功能: 统计字符串 <text> 中单词的个数</p>
<p>返回: 单词个数</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"># Makefile 内容</span><br><span class="line"></span><br><span class="line">all:</span><br><span class="line">    @echo $(words aa bb cc dd)</span><br><span class="line">    @echo $(words aabbccdd)</span><br><span class="line">    @echo $(words )</span><br><span class="line"></span><br><span class="line"># bash 中执行 make</span><br><span class="line">$ make</span><br><span class="line">4</span><br><span class="line">1</span><br><span class="line">0</span><br></pre></td></tr></table></figure>

<p><a href="javascript:void(0);"><img src="https://common.cnblogs.com/images/copycode.gif" alt="复制代码"></a></p>
<p><strong>首单词函数: $(firstword )</strong></p>
<p>功能: 取字符串 <text> 中的第一个单词</p>
<p>返回: 字符串 <text> 中的第一个单词</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"># Makefile 内容</span><br><span class="line">all:</span><br><span class="line">    @echo $(firstword aa bb cc dd)</span><br><span class="line">    @echo $(firstword aabbccdd)</span><br><span class="line">    @echo $(firstword )</span><br><span class="line"></span><br><span class="line"># bash 中执行 make</span><br><span class="line">$ make</span><br><span class="line">aa</span><br><span class="line">aabbccdd</span><br></pre></td></tr></table></figure>

<p><a href="javascript:void(0);"><img src="https://common.cnblogs.com/images/copycode.gif" alt="复制代码"></a></p>
<h4 id="3-4-2-文件名函数"><a href="#3-4-2-文件名函数" class="headerlink" title="3.4.2 文件名函数"></a><strong>3.4.2 文件名函数</strong></h4><p><strong>取目录函数: $(dir )</strong></p>
<p>功能: 从文件名序列 <names> 中取出目录部分</p>
<p>返回: 文件名序列 <names> 中的目录部分</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"># Makefile 内容</span><br><span class="line">all:</span><br><span class="line">    @echo $(dir &#x2F;home&#x2F;a.c .&#x2F;bb.c ..&#x2F;c.c d.c)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># bash 中执行 make</span><br><span class="line">$ make</span><br><span class="line">&#x2F;home&#x2F; .&#x2F; ..&#x2F; .&#x2F;</span><br></pre></td></tr></table></figure>

<p><a href="javascript:void(0);"><img src="https://common.cnblogs.com/images/copycode.gif" alt="复制代码"></a></p>
<p><strong>取文件函数: $(notdir )</strong></p>
<p>功能: 从文件名序列 <names> 中取出非目录部分</p>
<p>返回: 文件名序列 <names> 中的非目录部分</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"># Makefile 内容</span><br><span class="line">all:</span><br><span class="line">    @echo $(notdir &#x2F;home&#x2F;a.c .&#x2F;bb.c ..&#x2F;c.c d.c)</span><br><span class="line"></span><br><span class="line"># bash 中执行 make</span><br><span class="line">$ make</span><br><span class="line">a.c bb.c c.c d.c</span><br></pre></td></tr></table></figure>

<p><a href="javascript:void(0);"><img src="https://common.cnblogs.com/images/copycode.gif" alt="复制代码"></a></p>
<p><strong>取后缀函数: $(suffix )</strong></p>
<p>功能: 从文件名序列 <names> 中取出各个文件名的后缀</p>
<p>返回: 文件名序列 <names> 中各个文件名的后缀, 没有后缀则返回空字符串</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"># Makefile 内容</span><br><span class="line">all:</span><br><span class="line">    @echo $(suffix &#x2F;home&#x2F;a.c .&#x2F;b.o ..&#x2F;c.a d)</span><br><span class="line"></span><br><span class="line"># bash 中执行 make</span><br><span class="line">$ make</span><br><span class="line">.c .o .a</span><br></pre></td></tr></table></figure>

<p><a href="javascript:void(0);"><img src="https://common.cnblogs.com/images/copycode.gif" alt="复制代码"></a></p>
<p><strong>取前缀函数: $(basename )</strong></p>
<p>功能: 从文件名序列 <names> 中取出各个文件名的前缀</p>
<p>返回: 文件名序列 <names> 中各个文件名的前缀, 没有前缀则返回空字符串</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"># Makefile 内容</span><br><span class="line">all:</span><br><span class="line">    @echo $(basename &#x2F;home&#x2F;a.c .&#x2F;b.o ..&#x2F;c.a &#x2F;home&#x2F;.d .e)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># bash 中执行 make</span><br><span class="line">$ make</span><br><span class="line">&#x2F;home&#x2F;a .&#x2F;b ..&#x2F;c &#x2F;home&#x2F;</span><br></pre></td></tr></table></figure>

<p><a href="javascript:void(0);"><img src="https://common.cnblogs.com/images/copycode.gif" alt="复制代码"></a></p>
<p><strong>加后缀函数: $(addsuffix ,)</strong></p>
<p>功能: 把后缀 <suffix> 加到 <names> 中的每个单词后面</p>
<p>返回: 加过后缀的文件名序列</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"># Makefile 内容</span><br><span class="line">all:</span><br><span class="line">    @echo $(addsuffix .c,&#x2F;home&#x2F;a b .&#x2F;c.o ..&#x2F;d.c)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># bash 中执行 make</span><br><span class="line">$ make</span><br><span class="line">&#x2F;home&#x2F;a.c b.c .&#x2F;c.o.c ..&#x2F;d.c.c</span><br></pre></td></tr></table></figure>

<p><a href="javascript:void(0);"><img src="https://common.cnblogs.com/images/copycode.gif" alt="复制代码"></a></p>
<p><strong>加前缀函数: $(addprefix ,)</strong></p>
<p>功能: 把前缀 <prefix> 加到 <names> 中的每个单词前面</p>
<p>返回: 加过前缀的文件名序列</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"># Makefile 内容</span><br><span class="line">all:</span><br><span class="line">    @echo $(addprefix test_,&#x2F;home&#x2F;a.c b.c .&#x2F;d.c)</span><br><span class="line"></span><br><span class="line"># bash 中执行 make</span><br><span class="line">$ make</span><br><span class="line">test_&#x2F;home&#x2F;a.c test_b.c test_.&#x2F;d.c</span><br></pre></td></tr></table></figure>

<p><a href="javascript:void(0);"><img src="https://common.cnblogs.com/images/copycode.gif" alt="复制代码"></a></p>
<p><strong>连接函数: $(join ,)</strong></p>
<p>功能: <list2> 中对应的单词加到 <list1> 后面</p>
<p>返回: 连接后的字符串</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"># Makefile 内容</span><br><span class="line">all:</span><br><span class="line">    @echo $(join a b c d,1 2 3 4)</span><br><span class="line">    @echo $(join a b c d,1 2 3 4 5)</span><br><span class="line">    @echo $(join a b c d e,1 2 3 4)</span><br><span class="line"></span><br><span class="line"># bash 中执行 make</span><br><span class="line">$ make</span><br><span class="line">a1 b2 c3 d4</span><br><span class="line">a1 b2 c3 d4 5</span><br><span class="line">a1 b2 c3 d4 e</span><br></pre></td></tr></table></figure>

<p><a href="javascript:void(0);"><img src="https://common.cnblogs.com/images/copycode.gif" alt="复制代码"></a></p>
<h4 id="3-4-3-foreach"><a href="#3-4-3-foreach" class="headerlink" title="3.4.3 foreach"></a><strong>3.4.3 foreach</strong></h4><p><strong>语法:</strong></p>
<p>$(foreach <var>,<list>,<text>)</p>
<p><strong>示例:</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"># Makefile 内容</span><br><span class="line">targets :&#x3D; a b c d</span><br><span class="line">objects :&#x3D; $(foreach i,$(targets),$(i).o)</span><br><span class="line"></span><br><span class="line">all:</span><br><span class="line">    @echo $(targets)</span><br><span class="line">    @echo $(objects)</span><br><span class="line"></span><br><span class="line"># bash 中执行 make</span><br><span class="line">$ make</span><br><span class="line">a b c d</span><br><span class="line">a.o b.o c.o d.o</span><br></pre></td></tr></table></figure>

<p><a href="javascript:void(0);"><img src="https://common.cnblogs.com/images/copycode.gif" alt="复制代码"></a></p>
<h4 id="3-4-4-if"><a href="#3-4-4-if" class="headerlink" title="3.4.4 if"></a><strong>3.4.4 if</strong></h4><p>这里的if是个函数, 和前面的条件判断不一样, 前面的条件判断属于Makefile的关键字</p>
<p><strong>语法:</strong></p>
<p>$(if <condition>,<then-part>)</p>
<p>$(if <condition>,<then-part>,<else-part>)</p>
<p><strong>示例:</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"># Makefile 内容</span><br><span class="line">val :&#x3D; a</span><br><span class="line">objects :&#x3D; $(if $(val),$(val).o,nothing)</span><br><span class="line">no-objects :&#x3D; $(if $(no-val),$(val).o,nothing)</span><br><span class="line"></span><br><span class="line">all:</span><br><span class="line">    @echo $(objects)</span><br><span class="line">    @echo $(no-objects)</span><br><span class="line"></span><br><span class="line"># bash 中执行 make</span><br><span class="line">$ make</span><br><span class="line">a.o</span><br><span class="line">nothing</span><br></pre></td></tr></table></figure>

<p><a href="javascript:void(0);"><img src="https://common.cnblogs.com/images/copycode.gif" alt="复制代码"></a></p>
<h4 id="3-4-5-call-创建新的参数化函数"><a href="#3-4-5-call-创建新的参数化函数" class="headerlink" title="3.4.5 call - 创建新的参数化函数"></a><strong>3.4.5 call - 创建新的参数化函数</strong></h4><p><strong>语法:</strong></p>
<p>$(call <expression>,<parm1>,<parm2>,<parm3>…)</p>
<p><strong>示例:</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"># Makefile 内容</span><br><span class="line">log &#x3D; &quot;&#x3D;&#x3D;&#x3D;&#x3D;debug&#x3D;&#x3D;&#x3D;&#x3D;&quot; $(1) &quot;&#x3D;&#x3D;&#x3D;&#x3D;end&#x3D;&#x3D;&#x3D;&#x3D;&quot;</span><br><span class="line"></span><br><span class="line">all:</span><br><span class="line">    @echo $(call log,&quot;正在 Make&quot;)</span><br><span class="line"></span><br><span class="line"># bash 中执行 make</span><br><span class="line">$ make</span><br><span class="line">&#x3D;&#x3D;&#x3D;&#x3D;debug&#x3D;&#x3D;&#x3D;&#x3D; 正在 Make &#x3D;&#x3D;&#x3D;&#x3D;end&#x3D;&#x3D;&#x3D;&#x3D;</span><br></pre></td></tr></table></figure>

<p><a href="javascript:void(0);"><img src="https://common.cnblogs.com/images/copycode.gif" alt="复制代码"></a></p>
<h4 id="3-4-6-origin-判断变量的来源"><a href="#3-4-6-origin-判断变量的来源" class="headerlink" title="3.4.6 origin - 判断变量的来源"></a><strong>3.4.6 origin - 判断变量的来源</strong></h4><p><strong>语法:</strong></p>
<p>$(origin <variable>)</p>
<p>返回值有如下类型:</p>
<table>
<thead>
<tr>
<th><strong>类型</strong></th>
<th><strong>含义</strong></th>
</tr>
</thead>
<tbody><tr>
<td>undefined</td>
<td><variable> 没有定义过</td>
</tr>
<tr>
<td>default</td>
<td><variable> 是个默认的定义, 比如 CC 变量</td>
</tr>
<tr>
<td>environment</td>
<td><variable> 是个环境变量, 并且 make时没有使用 -e 参数</td>
</tr>
<tr>
<td>file</td>
<td><variable> 定义在Makefile中</td>
</tr>
<tr>
<td>command line</td>
<td><variable> 定义在命令行中</td>
</tr>
<tr>
<td>override</td>
<td><variable> 被 override 重新定义过</td>
</tr>
<tr>
<td>automatic</td>
<td><variable> 是自动化变量</td>
</tr>
</tbody></table>
<p><strong>示例:</strong></p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Makefile 内容</span></span><br><span class="line">val-in-file := test-file</span><br><span class="line"><span class="keyword">override</span> val-override := test-override</span><br><span class="line"></span><br><span class="line"><span class="section">all:</span></span><br><span class="line">    @echo <span class="variable">$(<span class="built_in">origin</span> not-define)</span>    <span class="comment"># not-define 没有定义</span></span><br><span class="line">    @echo <span class="variable">$(<span class="built_in">origin</span> CC)</span>            <span class="comment"># CC 是Makefile默认定义的变量</span></span><br><span class="line">    @echo <span class="variable">$(<span class="built_in">origin</span> PATH)</span>         <span class="comment"># PATH 是 bash 环境变量</span></span><br><span class="line">    @echo <span class="variable">$(<span class="built_in">origin</span> val-in-<span class="built_in">file</span>)</span>    <span class="comment"># 此Makefile中定义的变量</span></span><br><span class="line">    @echo <span class="variable">$(<span class="built_in">origin</span> val-in-cmd)</span>    <span class="comment"># 这个变量会加在 make 的参数中</span></span><br><span class="line">    @echo <span class="variable">$(<span class="built_in">origin</span> val-override)</span> <span class="comment"># 此Makefile中定义的override变量</span></span><br><span class="line">    @echo <span class="variable">$(<span class="built_in">origin</span> @)</span>             <span class="comment"># 自动变量, 具体前面的介绍</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># bash 中执行 make</span></span><br><span class="line">$ make val-in-cmd=val-cmd</span><br><span class="line">undefined</span><br><span class="line">default</span><br><span class="line">environment</span><br><span class="line">file</span><br><span class="line">command line</span><br><span class="line"><span class="keyword">override</span></span><br><span class="line">automatic</span><br></pre></td></tr></table></figure>

<p><a href="javascript:void(0);"><img src="https://common.cnblogs.com/images/copycode.gif" alt="复制代码"></a></p>
<h4 id="3-4-7-shell"><a href="#3-4-7-shell" class="headerlink" title="3.4.7 shell"></a><strong>3.4.7 shell</strong></h4><p><strong>语法:</strong></p>
<p>$(shell <shell command>)</p>
<p>它的作用就是执行一个shell命令, 并将shell命令的结果作为函数的返回.</p>
<p>作用和 <code>&lt;shell command&gt;</code> 一样, <strong>`</strong> 是反引号</p>
<h4 id="3-4-8-make-控制函数"><a href="#3-4-8-make-控制函数" class="headerlink" title="3.4.8 make 控制函数"></a><strong>3.4.8 make 控制函数</strong></h4><p><strong>产生一个致命错误: $(error )</strong></p>
<p>功能: 输出错误信息, 停止Makefile的运行</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"># Makefile 内容</span><br><span class="line">all:</span><br><span class="line">    $(error there is an error!)</span><br><span class="line">    @echo &quot;这里不会执行!&quot;</span><br><span class="line"></span><br><span class="line"># bash 中执行 make</span><br><span class="line">$ make</span><br><span class="line">Makefile:2: *** there is an error!.  Stop.</span><br></pre></td></tr></table></figure>

<p><a href="javascript:void(0);"><img src="https://common.cnblogs.com/images/copycode.gif" alt="复制代码"></a></p>
<p><strong>输出警告: $(warning )</strong></p>
<p>功能: 输出警告信息, Makefile继续运行</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"># Makefile 内容</span><br><span class="line">all:</span><br><span class="line">    $(warning there is an warning!)</span><br><span class="line">    @echo &quot;这里会执行!&quot;</span><br><span class="line"></span><br><span class="line"># bash 中执行 make</span><br><span class="line">$ make</span><br><span class="line">Makefile:2: there is an warning!</span><br><span class="line">这里会执行!</span><br></pre></td></tr></table></figure>

<p><a href="javascript:void(0);"><img src="https://common.cnblogs.com/images/copycode.gif" alt="复制代码"></a></p>
<h3 id="3-5-Makefile中一些GNU约定俗成的伪目标"><a href="#3-5-Makefile中一些GNU约定俗成的伪目标" class="headerlink" title="3.5 Makefile中一些GNU约定俗成的伪目标"></a><strong>3.5 Makefile中一些GNU约定俗成的伪目标</strong></h3><p>如果有过在Linux上, 从源码安装软件的经历的话, 就会对 make clean, make install 比较熟悉.</p>
<p>像 clean, install 这些伪目标, 广为人知, 不用解释就大家知道是什么意思了.</p>
<p>下面列举一些常用的伪目标, 如果在自己项目的Makefile合理使用这些伪目标的话, 可以让我们自己的Makefile看起来更专业, 呵呵 :)</p>
<table>
<thead>
<tr>
<th><strong>伪目标</strong></th>
<th><strong>含义</strong></th>
</tr>
</thead>
<tbody><tr>
<td>all</td>
<td>所有目标的目标，其功能一般是编译所有的目标</td>
</tr>
<tr>
<td>clean</td>
<td>删除所有被make创建的文件</td>
</tr>
<tr>
<td>install</td>
<td>安装已编译好的程序，其实就是把目标可执行文件拷贝到指定的目录中去</td>
</tr>
<tr>
<td>print</td>
<td>列出改变过的源文件</td>
</tr>
<tr>
<td>tar</td>
<td>把源程序打包备份. 也就是一个tar文件</td>
</tr>
<tr>
<td>dist</td>
<td>创建一个压缩文件, 一般是把tar文件压成Z文件. 或是gz文件</td>
</tr>
<tr>
<td>TAGS</td>
<td>更新所有的目标, 以备完整地重编译使用</td>
</tr>
<tr>
<td>check 或 test</td>
<td>一般用来测试makefile的流程</td>
</tr>
</tbody></table>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2021/03/24/Makefile-tutorial/" data-id="ckmn1li29000ln8a8fqtr577b" data-title="" class="article-share-link">Teilen</a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-gitignore使用方法" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2021/03/24/gitignore%E4%BD%BF%E7%94%A8%E6%96%B9%E6%B3%95/" class="article-date">
  <time class="dt-published" datetime="2021-03-24T06:02:27.796Z" itemprop="datePublished">2021-03-24</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="gitignore使用方法"><a href="#gitignore使用方法" class="headerlink" title=".gitignore使用方法"></a>.gitignore使用方法</h1><h2 id="git忽略文件的原则"><a href="#git忽略文件的原则" class="headerlink" title="git忽略文件的原则"></a>git忽略文件的原则</h2><ul>
<li><p>忽略操作系统自动生成的文件，比如缩略图等；</p>
</li>
<li><p>忽略编译生成的中间文件、可执行文件等，也就是如果一个文件是通过另一个文件自动生成的，那自动生成的文件就没必要放进版本库，比如Java编译产生的.class文件；</p>
</li>
<li><p>忽略你自己的带有敏感信息的配置文件，比如存放口令的配置文件。 </p>
</li>
</ul>
<h2 id="git忽略规则的优先级"><a href="#git忽略规则的优先级" class="headerlink" title="git忽略规则的优先级"></a>git忽略规则的优先级</h2><p>在 .gitingore 文件中，每一行指定一个忽略规则，Git检查忽略规则的时候有多个来源，它的优先级如下（由高到低）：</p>
<ul>
<li>从命令行中读取可用的忽略规则</li>
<li>当前目录定义的规则</li>
<li>父级目录定义的规则，依次递推</li>
<li>$GIT_DIR/info/exclude 文件中定义的规则</li>
<li>core.excludesfile中定义的全局规则 </li>
</ul>
<h2 id="gitignore忽略规则的匹配语法"><a href="#gitignore忽略规则的匹配语法" class="headerlink" title=".gitignore忽略规则的匹配语法"></a>.gitignore忽略规则的匹配语法</h2><p>在 .gitignore 文件中，每一行的忽略规则的语法如下：</p>
<ul>
<li>空格不匹配任意文件，可作为分隔符，可用反斜杠转义</li>
<li>以“＃”开头的行都会被 Git 忽略。即#开头的文件标识注释，可以使用反斜杠进行转义。</li>
<li>可以使用标准的glob模式匹配。所谓的glob模式是指shell所使用的简化了的正则表达式。</li>
<li>以斜杠”/“开头表示目录；”/“结束的模式只匹配文件夹以及在该文件夹路径下的内容，但是不匹配该文件；”/“开始的模式匹配项目根目录；如果一个模式不包含斜杠，则它匹配相对于当前 .gitignore 文件路径的内容，如果该模式不在 .gitignore 文件中，则相对于项目根目录。</li>
<li>以星号”*“通配多个字符，即匹配多个任意字符；使用两个星号”**“ 表示匹配任意中间目录，比如a/**/z可以匹配 a/z, a/b/z 或 a/b/c/z等。</li>
<li>以问号”?”通配单个字符，即匹配一个任意字符；</li>
<li>以方括号”[]”包含单个字符的匹配列表，即匹配任何一个列在方括号中的字符。比如[abc]表示要么匹配一个a，要么匹配一个b，要么匹配一个c；如果在方括号中使用短划线分隔两个字符，表示所有在这两个字符范围内的都可以匹配。比如[0-9]表示匹配所有0到9的数字，[a-z]表示匹配任意的小写字母。</li>
<li>以叹号”!”表示不忽略(跟踪)匹配到的文件或目录，即要忽略指定模式以外的文件或目录，可以在模式前加上惊叹号（!）取反。需要特别注意的是：如果文件的父目录已经被前面的规则排除掉了，那么对这个文件用”!”规则是不起作用的。。可以使用反斜杠进行转义。</li>
</ul>
<p>需要谨记：git对于.ignore配置文件是按行从上到下进行规则匹配的，意味着如果前面的规则匹配的范围更大，则后面的规则将不会生效；</p>
<h2 id="gitignore忽略规则简单说明"><a href="#gitignore忽略规则简单说明" class="headerlink" title=".gitignore忽略规则简单说明"></a>.gitignore忽略规则简单说明</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">#        		表示此为注释,将被Git忽略</span><br><span class="line">*.a       		表示忽略所有 .a 结尾的文件</span><br><span class="line">!lib.a     		表示lib.a除外</span><br><span class="line">&#x2F;TODO      		表示仅仅忽略项目根目录下的 TODO 文件，不包括 subdir&#x2F;TODO</span><br><span class="line">build&#x2F;     		表示忽略 build&#x2F;目录下的所有文件，过滤整个build文件夹；</span><br><span class="line">doc&#x2F;*.txt    	表示会忽略doc&#x2F;notes.txt但不包括 doc&#x2F;server&#x2F;arch.txt</span><br><span class="line">bin&#x2F;:      		表示忽略当前路径下的bin文件夹，该文件夹下的所有内容都会被忽略，不忽略 bin 文件</span><br><span class="line">&#x2F;bin:      		表示忽略根目录下的bin文件</span><br><span class="line">&#x2F;*.c:      		表示忽略根目录下的cat.c，不忽略 build&#x2F;cat.c</span><br><span class="line">debug&#x2F;*.obj:  	表示忽略debug&#x2F;io.obj，不忽略 debug&#x2F;common&#x2F;io.obj和tools&#x2F;debug&#x2F;io.obj</span><br><span class="line">**&#x2F;foo:     	表示忽略&#x2F;foo,a&#x2F;foo,a&#x2F;b&#x2F;foo等</span><br><span class="line">a&#x2F;**&#x2F;b:     	表示忽略a&#x2F;b, a&#x2F;x&#x2F;b,a&#x2F;x&#x2F;y&#x2F;b等</span><br><span class="line">!&#x2F;bin&#x2F;run.sh  	表示不忽略bin目录下的run.sh文件</span><br><span class="line">*.log:     		表示忽略所有 .log 文件</span><br><span class="line">config.php:   	表示忽略当前路径的 config.php 文件</span><br><span class="line"></span><br><span class="line">&#x2F;mtk&#x2F;			表示过滤整个文件夹</span><br><span class="line">*.zip      		表示过滤所有.zip文件</span><br><span class="line">&#x2F;mtk&#x2F;do.c    	表示过滤某个具体文件</span><br><span class="line"></span><br><span class="line">被过滤掉的文件就不会出现在git仓库中（gitlab或github）了，当然本地库中还有，只是push的时候不会上传。需要注意的是，gitignore还可以指定要将哪些文件添加到版本管理中，如下：</span><br><span class="line">!*.zip</span><br><span class="line">!&#x2F;mtk&#x2F;one.txt</span><br><span class="line">唯一的区别就是规则开头多了一个感叹号，Git会将满足这类规则的文件添加到版本管理中。为什么要有两种规则呢？</span><br><span class="line">想象一个场景：假如我们只需要管理&#x2F;mtk&#x2F;目录中的one.txt文件，这个目录中的其他文件都不需要管理，那么.gitignore规则应写为：：</span><br><span class="line">&#x2F;mtk&#x2F;*</span><br><span class="line">!&#x2F;mtk&#x2F;one.txt</span><br><span class="line">假设我们只有过滤规则，而没有添加规则，那么我们就需要把&#x2F;mtk&#x2F;目录下除了one.txt以外的所有文件都写出来！</span><br><span class="line">注意上面的&#x2F;mtk&#x2F;*不能写为&#x2F;mtk&#x2F;，否则父目录被前面的规则排除掉了，one.txt文件虽然加了!过滤规则，也不会生效！即父目录被排除，则！不生效，但当前目录所有文件被排除，！仍旧生效，故使用！前需要确认父目录没有被排除，如果当前目录的其他文件都需要排除，可以使用&#x2F;*的方式排除当前目录下的所有文件，再使用！添加。</span><br><span class="line"></span><br><span class="line">还有一些规则如下：</span><br><span class="line">fd1&#x2F;*</span><br><span class="line">说明：忽略目录 fd1 下的全部内容；注意，不管是根目录下的&#x2F;fd1&#x2F;目录，还是某个子目录 &#x2F;child&#x2F;fd1&#x2F;目录，都会被忽略；</span><br><span class="line">&#x2F;fd1&#x2F;*</span><br><span class="line">说明：忽略根目录下的&#x2F;fd1&#x2F;目录的全部内容；</span><br><span class="line">&#x2F;*</span><br><span class="line">!.gitignore</span><br><span class="line">!&#x2F;fw&#x2F;</span><br><span class="line">&#x2F;fw&#x2F;*</span><br><span class="line">!&#x2F;fw&#x2F;bin&#x2F;</span><br><span class="line">!&#x2F;fw&#x2F;sf&#x2F;</span><br><span class="line">说明：忽略全部内容，但是不忽略 .gitignore 文件、根目录下的&#x2F;fw&#x2F;bin&#x2F;和&#x2F;fw&#x2F;sf&#x2F;目录；注意要先对bin&#x2F;的父目录使用!规则，使其不被排除。</span><br></pre></td></tr></table></figure>

<p> <strong>温馨提示：</strong><br>如果你不慎在创建.gitignore文件之前就push了项目，那么即使你在.gitignore文件中写入新的过滤规则，这些规则也不会起作用，Git仍然会对所有文件进行版本管理。简单来说出现这种问题的原因就是Git已经开始管理这些文件了，所以你无法再通过过滤规则过滤它们。.gitignore只能忽略那些原来没有被追踪的文件，如果某些文件已经被纳入了版本管理中，则修改.gitignore是无效的。那么解决方法就是先把本地缓存删除（改变成未被追踪状态），然后再提交：</p>
<p>git rm -r –cached .</p>
<p>git add .</p>
<p>git commit -m ‘update .gitignore’</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2021/03/24/gitignore%E4%BD%BF%E7%94%A8%E6%96%B9%E6%B3%95/" data-id="ckmn1lhzj0004n8a815nbcc4v" data-title="" class="article-share-link">Teilen</a>
      
      
      
    </footer>
  </div>
  
</article>



  


  <nav id="page-nav">
    
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="page-number" href="/page/3/">3</a><a class="extend next" rel="next" href="/page/2/">weiter &raquo;</a>
  </nav>

</section>
        
          <aside id="sidebar">
  
    

  
    

  
    
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archiv</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/03/">March 2021</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">letzter Beitrag</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2021/03/24/Python%20Cheatsheet/">(no title)</a>
          </li>
        
          <li>
            <a href="/2021/03/24/Python%E8%87%AA%E5%AE%9A%E4%B9%89%E5%8C%85%E5%92%8C%E6%A8%A1%E5%9D%97/">(no title)</a>
          </li>
        
          <li>
            <a href="/2021/03/24/tofino-command/">(no title)</a>
          </li>
        
          <li>
            <a href="/2021/03/24/%E5%AE%89%E8%A3%85mininet%E5%92%8Ctofino-model/">(no title)</a>
          </li>
        
          <li>
            <a href="/2021/03/24/TNA%20model/">(no title)</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      
      &copy; 2021 xbo<br>
      Powered by <a href="https://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>

    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    


<script src="/js/jquery-3.4.1.min.js"></script>



  
<script src="/fancybox/jquery.fancybox.min.js"></script>




<script src="/js/script.js"></script>





  </div>
</body>
</html>