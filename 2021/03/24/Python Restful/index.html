<!DOCTYPE html>

<html lang="zh">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
  
  <title>Python接口测试学习笔记 [ xbo&#39;s Blog ]</title>
  
    <!-- stylesheets list from config.yml -->
    
      <link rel="stylesheet" href="/css/iLiKE.css">
    
  
  
  
  <script src="//cdn1.lncld.net/static/js/3.1.1/av-min.js"></script>
    <script id="leancloud">
      AV.init({
          appId: "6E5zTbTljdUbVW2WkXPsXGJk-gzGzoHsz",
          appKey: "0vsyDKfNpeSECAI70J794ugv"
      });
    </script>

<meta name="generator" content="Hexo 5.4.0"></head>
<body>
    <div class="header">
        <div class="container">
    <div class="menu">
      <div class="menu-left">
        <a href="/">
          <img src="/favicon.ico"></img>
        </a>
      </div>
      <div class="menu-right">
        
          
          
          
          
          
          
          <a href="/">Home</a>
        
          
          
          
          
          
          
          <a href="/archives">Archives</a>
        
          
          
          
          
          
          
          <a href="/about">About</a>
        
      </div>
    </div>
</div>
    </div>
    <div class="container">
        <h1 class="post-title">Python接口测试学习笔记</h1>
<article class="post markdown-style">
  <h1 id="Python接口测试实战1（上）-接口测试理论"><a href="#Python接口测试实战1（上）-接口测试理论" class="headerlink" title="Python接口测试实战1（上）- 接口测试理论"></a><a target="_blank" rel="noopener" href="https://www.cnblogs.com/superhin/p/10338915.html">Python接口测试实战1（上）- 接口测试理论</a></h1><h2 id="课程目录"><a href="#课程目录" class="headerlink" title="课程目录"></a><a target="_blank" rel="noopener" href="https://www.cnblogs.com/superhin/p/10338915.html#3873478755">课程目录</a></h2><p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/superhin/p/10338915.html">Python接口测试实战1（上）- 接口测试理论</a></p>
<p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/superhin/p/10338924.html">Python接口测试实战1（下）- 接口测试工具的使用</a></p>
<p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/superhin/p/10338930.html">Python接口测试实战2 - 使用Python发送请求</a></p>
<p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/superhin/p/10338985.html">Python接口测试实战3（上）- Python操作数据库</a></p>
<p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/superhin/p/10338993.html">Python接口测试实战3（下）- unittest测试框架</a></p>
<p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/superhin/p/10339002.html">Python接口测试实战4（上） - 接口测试框架实战</a></p>
<p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/superhin/p/10339009.html">Python接口测试实战4（下） - 框架完善：用例基类，用例标签，重新运行上次失败用例</a></p>
<p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/superhin/p/10339016.html">Python接口测试实战5（上） - Git及Jenkins持续集成</a></p>
<p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/superhin/p/10339004.html">Python接口测试实战5（下） - RESTful、Web Service及Mock Server</a></p>
<p>PDF下载：链接:<a target="_blank" rel="noopener" href="https://pan.baidu.com/s/1OwAa8nl1eeBj8fcrgd3sBA">https://pan.baidu.com/s/1OwAa8nl1eeBj8fcrgd3sBA</a> 密码:e9d8</p>
<h2 id="本节内容本节内容"><a href="#本节内容本节内容" class="headerlink" title="本节内容本节内容"></a>本节内容<a target="_blank" rel="noopener" href="https://www.cnblogs.com/superhin/p/10338915.html#1031820271">本节内容</a></h2><ul>
<li>接口及接口测试</li>
<li>网络基础知识：IP,域名, DNS及端口</li>
<li>网络基础知识：OSI七层模型及TCP协议</li>
<li>HTTP协议</li>
</ul>
<h2 id="接口及接口测试"><a href="#接口及接口测试" class="headerlink" title="接口及接口测试"></a>接口及接口测试</h2><p>这里插播一个段子<br><a target="_blank" rel="noopener" href="https://upload-images.jianshu.io/upload_images/7575721-a3f224fae8404fec.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">![app随手机壳变色](Python Restful.assets/7575721-a3f224fae8404fec.jpg)</a></p>
<p>上图中，程序员口中提到的接口是什么意思呢？</p>
<p>手机壳有没有颜色这个属性（功能）？ — 有</p>
<p>手机壳有没有提供让程序获取它颜色的途径？ — 没有，这个途径就是接口</p>
<h3 id="接口的概念"><a href="#接口的概念" class="headerlink" title="接口的概念"></a>接口的概念</h3><p>接口又称API（Application Programming Interface,应用程序编程接口），是一些预先定义的函数，目的是提供应用程序与开发人员基于某软件或硬件得以访问一组例程的能力，而又无需访问源码，或理解内部工作机制的细节。</p>
<p><strong>简单概括为以下3点：</strong></p>
<ul>
<li>程序代码（函数方法）</li>
<li>屏蔽实现细节</li>
<li>可以被访问/调用来获取信息或实现某些功能（提供访问地址，定义了访问规则）</li>
</ul>
<p><strong>接口自述（通俗的来说）：</strong></p>
<ul>
<li>首先我有一些功能（功能函数）</li>
<li>你不用关心我怎么实现的（屏蔽细节）</li>
<li>我会给你一个我的地址（接口地址）</li>
<li>你按照地址找到我，按照我规定的格式（请求类型）告诉我所需要的信息（参数）就行</li>
<li>我会给你个反馈（响应信息）</li>
</ul>
<p><strong>举个栗子</strong></p>
<p>西虹市公考报名处 — <em>接口名称</em></p>
<p>报名地址： 西虹市街口区带莫路3号 — <em>接口地址</em></p>
<p>现场需填写资料： 姓名，身份证证号码，专业，报考岗位等等 — <em>接口参数</em></p>
<p>验证规则： — <em>参数验证规则</em></p>
<ul>
<li>身份证需与本人一致</li>
<li>专业需与报考岗位符合</li>
<li>报名时间 2024.8.22-2024.8.30<br>现场会给出是否报名成功 — <em>接口响应信息</em></li>
</ul>
<p><strong>软件中的接口</strong><br><a target="_blank" rel="noopener" href="https://upload-images.jianshu.io/upload_images/7575721-daa3a4bfc6632c98.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">![接口处理过程](Python Restful.assets/7575721-daa3a4bfc6632c98.png)</a></p>
<p>软件项目中，接口是系统与系统之间，模块与模块之间或者服务于服务之间相互调用的入口。<br>从开发者角度，接口是分工协作的产物，不同开发者实现自己的功能之后，封装成接口，供其他开发者调用。其他开发者只要按规定格式发送一些必要参数，就能使用该功能<br><a target="_blank" rel="noopener" href="https://upload-images.jianshu.io/upload_images/7575721-83bc1d149b0d91ba.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">![接口交互场景](Python Restful.assets/7575721-83bc1d149b0d91ba.jpg)</a></p>
<p><strong>常见接口类型</strong></p>
<ul>
<li>HTTP接口：通过HTTP协议传输的接口，可以传输文本表单数据，也可以传输Json类型的对象数据或xml类型的数据</li>
<li>RPC: 远程方法调用，随着分布式系统的出现，当你需要调用部署到其他服务器上的方法时，需要用到RPC。RPC只是提出了这样一个问题，有很多种解决方案，比如WebService(基于SOAP协议)， REST(基于HTTP协议）。</li>
<li>SOAP: 简单面向对象协议，基于HTTP，使用xml作为默认传输格式</li>
<li>Web Service: 基于SOAP协议的一种RPC实现方案。相比传统的HTTP接口只传输文本请求和文本相应，通过Web Service可以直接拿到远程的一个对象，并能够直接调用该对象的属性和方法，比HTTP更高级。</li>
<li>REST/RESTful API: REST，表述性状态转移。一种HTTP接口的设计风格，将一切接口视为资源，要求接口路径同意管理，分版本管理，规定了GET/POST等请求以及HTTP状态码的使用规范，默认使用JSON格式传输。RESTful API即满足REST风格即设计规范的API接口<br><a target="_blank" rel="noopener" href="https://upload-images.jianshu.io/upload_images/7575721-813bf8f97da5513b.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">![相互关系](Python Restful.assets/7575721-813bf8f97da5513b.png)</a></li>
</ul>
<h3 id="什么是接口测试"><a href="#什么是接口测试" class="headerlink" title="什么是接口测试"></a>什么是接口测试</h3><p>接口测试是测试系统组件间接口的一种测试。接口测试主要用于检测外部系统与系统之间以及内部各个子系统之间的交互点。测试的重点是要检查数据的交换、传递和控制管理过程，以及系统间的相互逻辑依赖关系等。</p>
<p><strong>为什么要做接口测试？</strong></p>
<ul>
<li>接口测试介于单元测试与系统测试之间，单元测试一般由开发完成（不要相信开发）</li>
<li>接口是各种系统功能的基础，一旦接口出现问题可能会引起许多系统功能的问题并且不容易定位</li>
<li>开展接口测试可以及早发现问题，有效降低测试成本</li>
<li>接口一般较UI相对稳定，利于进行自动化和持续集成</li>
</ul>
<p><strong>接口测试都测什么？</strong></p>
<p>接口测试一般有以下岗位实施：</p>
<ul>
<li>手工测试岗：先提测接口再提出功能，兼做接口自动化</li>
<li>服务端测试岗：梳理代码，审核接口实现逻辑是否与业务设计一致，技术实现逻辑的合理性，异常流测试，接口压测及安全性测试</li>
<li>测试开发岗：专职做接口（或UI）的自动化用例开发，测试工具开发</li>
</ul>
<p>接口测试点参考：<br><a target="_blank" rel="noopener" href="https://upload-images.jianshu.io/upload_images/7575721-4217c4e35c7fecfc.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">![服务端接口测试](Python Restful.assets/7575721-4217c4e35c7fecfc.jpg)</a></p>
<p><strong>怎样掌握接口测试？</strong></p>
<ol>
<li>了解OSI网络模型，TCP/UDP协议，掌握HTTP/HTTPS协议，了解RPC, Web Service及REST，理解Session和Cookie</li>
<li>掌握常用的接口测试工具如curl命令,Postman,Jmeter,LR,SoupUI,AB等</li>
<li>掌握基本的抓包工具如Chrome开发者工具,Fiddler,Charles,Wireshark,tcpdumps等</li>
<li>掌握一门编程语言Python或Java</li>
<li>了解Nginx, Apache, Tomcat等服务器中间件</li>
<li>掌握数据库基本查询命令，及一些NoSQL(如Redis)操作，用于检查响应结果</li>
<li>掌握基本的Linux日子查询和筛选命令</li>
</ol>
<p><strong>接口测试重难点</strong></p>
<ol>
<li>动态变量参数化</li>
<li>接口依赖及中间变量问题</li>
<li>异步接口结果验证问题</li>
<li>相应参数及嵌套很多的验证问题</li>
<li>接口测试框架的稳定性问题</li>
<li>资源清理问题</li>
<li>多接口场景测试<br>…</li>
</ol>
<h2 id="网络基础知识"><a href="#网络基础知识" class="headerlink" title="网络基础知识"></a>网络基础知识</h2><h3 id="IP地址"><a href="#IP地址" class="headerlink" title="IP地址"></a>IP地址</h3><p>就像每个人都有一个身份证号码，IP地址是IP协议提供的一种统一的地址格式，它为互联网上的每一个网络和每一台主机分配一个逻辑地址</p>
<p><a target="_blank" rel="noopener" href="https://upload-images.jianshu.io/upload_images/7575721-bd2857232be312e9.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">![ip地址](Python Restful.assets/7575721-bd2857232be312e9.png)</a></p>
<p><strong>查看IP命令</strong></p>
<ul>
<li>Windows: ipconfig</li>
<li>Linux: ifconfig</li>
</ul>
<blockquote>
<p>Python练习：检查字符串是否ip</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">def is_ip(ip):</span><br><span class="line">    num_list &#x3D; ip.split(&quot;.&quot;)</span><br><span class="line">    for num in num_list:</span><br><span class="line">        if not num.isdigit() or not 0 &lt;&#x3D; int(num) &lt;&#x3D;255:</span><br><span class="line">            return False</span><br><span class="line">    return True</span><br><span class="line"></span><br><span class="line">print(is_ip(&quot;101.1.0.201&quot;))</span><br></pre></td></tr></table></figure>

<p>使用map函数实现方法（参考）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">def  check_ipv4(str):</span><br><span class="line">    ip &#x3D; str.strip().split(&quot;.&quot;)</span><br><span class="line">    return False if len(ip) !&#x3D; 4 or False in map(lambda x:True if x.isdigit() and 0&lt;&#x3D; int(x) &lt;&#x3D; 255 else False, ip) else True</span><br></pre></td></tr></table></figure>

<h3 id="端口"><a href="#端口" class="headerlink" title="端口"></a>端口</h3><p>“端口”是英文port的意译，可以认为是设备与外界通讯交流的出口。如果把IP地址比作一间房子，端口就是出入这间房子的门。一个IP地址的端口可以有65536（即：2^16）个。</p>
<p><strong>端口类型</strong></p>
<ul>
<li>公认端口：从0到1023，紧密绑定于一些服务</li>
<li>注册端口：人1024到49151，许多服务绑定这些端口，这些端口同样用于许多其它目的。</li>
<li>动态或私有端口：从49152到65535。理论上，不应为服务分配这此端口。实际上，机器通常从1024起分配动态端口。</li>
</ul>
<p><strong>常见软件默认端口</strong></p>
<ul>
<li>Apache/Nginx(HTTP服务): 80</li>
<li>Tomcat: 8080</li>
<li>Oracle: 1521</li>
<li>MySQL: 3306</li>
<li>SQL Server: 1433</li>
<li>PostgreSQL: 5432</li>
<li>MongoDB: 27017</li>
<li>Redis: 6379</li>
<li>Memcached: 11211</li>
</ul>
<p><strong>查看端口命令</strong></p>
<ul>
<li>Windows: netstat -ano</li>
<li>Linux: netstat -ntlp</li>
</ul>
<p><a target="_blank" rel="noopener" href="https://upload-images.jianshu.io/upload_images/7575721-81af81edd8b037ae.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">![端口查看](Python Restful.assets/7575721-81af81edd8b037ae.png)</a></p>
<blockquote>
<p>解决端口占用问题</p>
</blockquote>
<ul>
<li>Windows: netstat -ano | findstr “8080”,找到占用端口的程序的PID -&gt; 打开任务管理器 -&gt; 设置显示PID -&gt; 找到并结束对于程序</li>
<li>Linux: netstat -ntlp | grep “8080”, 找到对应的程序 -&gt; ps -ef | grep “程序名” 找到对于的pid -&gt; kill 相应的id</li>
</ul>
<h3 id="域名及DNS"><a href="#域名及DNS" class="headerlink" title="域名及DNS"></a>域名及DNS</h3><p>由于IP地址不容易记忆，为IP地址赋予了一个利于记忆的别名，称为域名，如百度的ip为： 61.135.169.125，对应的域名为 <a target="_blank" rel="noopener" href="http://www.baidu.com/">www.baidu.com</a></p>
<p><a target="_blank" rel="noopener" href="https://upload-images.jianshu.io/upload_images/7575721-c5a41f36c802e4eb.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">![域名及ip](Python Restful.assets/7575721-c5a41f36c802e4eb.png)</a></p>
<p><strong>如何查看域名所对于的ip？</strong></p>
<ul>
<li>Windows/Linux: ping <a target="_blank" rel="noopener" href="http://www.baidu.com/">www.baidu.com</a></li>
</ul>
<p><strong>DNS</strong></p>
<p>DNS即域名解析系统，域名和IP地址相互映射的一个分布式数据库，提供域名转到对应ip的服务</p>
<h3 id="OSI七层模型"><a href="#OSI七层模型" class="headerlink" title="OSI七层模型"></a>OSI七层模型</h3><p>OSI即开放系统互连参考模型，一种网络架构，分为7层。</p>
<p><a target="_blank" rel="noopener" href="https://upload-images.jianshu.io/upload_images/7575721-d2ff3c16cacaa9a1.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">![OSI网络模型](Python Restful.assets/7575721-d2ff3c16cacaa9a1.png)</a></p>
<ul>
<li>上三层—应用层，控制软件方面<ul>
<li>应用层：文件传输，电子邮件，文件服务，虚拟终端 TFTP，HTTP，SNMP，FTP，SMTP，DNS，Telnet</li>
<li>表示层：数据格式化，代码转换，数据加密</li>
<li>会话层：解除或建立与别的接点的联系(会话)</li>
</ul>
</li>
<li>下四层—数据流层，用来管理硬件<ul>
<li>传输层：提供端对端的接口 TCP，UDP</li>
<li>网络层：为数据包选择路由 IP，ICMP，RIP，OSPF，BGP，IGMP</li>
<li>数据链路层 传输有地址的帧以及错误检测功能 SLIP，CSLIP，PPP，ARP，RARP，MTU</li>
<li>物理层 以二进制数据形式在物理媒体上传输数据 ISO2110，IEEE802，IEEE802.2</li>
</ul>
</li>
</ul>
<p><strong>OSI七层模型及各层协议</strong></p>
<h3 id="TCP及UDP协议"><a href="#TCP及UDP协议" class="headerlink" title="TCP及UDP协议"></a>TCP及UDP协议</h3><p>TCP和UDP都是传输层的协议</p>
<ul>
<li>TCP：传输控制协议</li>
<li>UDP: 数据报文协议</li>
</ul>
<p><strong>TCP和UDP的区别</strong></p>
<ul>
<li>UDP的特点如下：</li>
</ul>
<ol>
<li>无链接</li>
<li>UDP使用尽最大努力交付，不保证可靠性</li>
<li>UDP是面向报文的，UDP对应用层交付下来的报文，既不合并，也不拆分，而是保留这些报文的边界。应用层交给UDP多长的报文，UDP就照样发送，即一次发送一个报文</li>
<li>UDP没有拥塞控制</li>
<li>UDP支持一对一、一对多、多对一和多对多的交互通信</li>
<li>UDP的首部开销小，只有8字节</li>
</ol>
<ul>
<li>TCP的特点：</li>
</ul>
<ol>
<li>TCP是面向连接的</li>
<li>每条TCP连接只能用于两个断点，一对一</li>
<li>TCP提供可靠交付的服务：连接传输数据、无差错、不丢失、不重复、并且按序到达</li>
<li>TCP提供全双工通信</li>
<li>面向字节流。TCP根据对方给出的窗口和当前网络拥塞的程度来决定一个报文应该包含多少个字节</li>
</ol>
<blockquote>
<p>参考：<a target="_blank" rel="noopener" href="https://blog.csdn.net/yyf_it/article/details/52206715">TCP和UDP协议的对比</a></p>
</blockquote>
<h2 id="HTTP协议"><a href="#HTTP协议" class="headerlink" title="HTTP协议"></a>HTTP协议</h2><p>HTTP：超文本传输协议，是用于从WWW服务器传输超文本到本地浏览器的传输协议。<br>HTTP协议是一种无状态协议，主要包含请求和相应两大部分：</p>
<h3 id="请求（Request"><a href="#请求（Request" class="headerlink" title="请求（Request)"></a>请求（Request)</h3><p>请求是我们发送给接口的数据对象，包含接口地址（URL），请求方法，参数，请求头（Headers), Cookies, 数据等。</p>
<p><strong>真实抓包一个请求：</strong><br><a target="_blank" rel="noopener" href="https://upload-images.jianshu.io/upload_images/7575721-8ba6733a001dc668.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">![抓包请求](Python Restful.assets/7575721-8ba6733a001dc668.png)</a></p>
<p>请求原始格式-GET（Raw格式：Fiddler抓包得到）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">GET https:&#x2F;&#x2F;www.sojson.com&#x2F;open&#x2F;api&#x2F;weather&#x2F;json.shtml?city&#x3D;%E5%8C%97%E4%BA%AC HTTP&#x2F;1.1</span><br><span class="line">Host: www.sojson.com</span><br><span class="line">Connection: keep-alive</span><br><span class="line">Upgrade-Insecure-Requests: 1</span><br><span class="line">User-Agent: Mozilla&#x2F;5.0 (Windows NT 10.0; Win64; x64) AppleWebKit&#x2F;537.36 (KHTML, like Gecko) Chrome&#x2F;68.0.3440.106 Safari&#x2F;537.36</span><br><span class="line">Accept: text&#x2F;html,application&#x2F;xhtml+xml,application&#x2F;xml;q&#x3D;0.9,image&#x2F;webp,image&#x2F;apng,*&#x2F;*;q&#x3D;0.8</span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">Accept-Language: zh-CN,zh;q&#x3D;0.9,en-US;q&#x3D;0.8,en;q&#x3D;0.7</span><br><span class="line">Cookie: __cfduid&#x3D;dccd65c484a7657b468327b66023fefc41534934250; yjs_id&#x3D;59d1c42afa817b578b4b562d1f72651f; ctrl_time&#x3D;1</span><br></pre></td></tr></table></figure>

<ul>
<li>第1行： 请求方法 接口地址 HTTP协议版本</li>
<li>第2-N行：请求headers(如果有Cookie，最后一行为Cookie)</li>
<li>空一行</li>
<li>请求数据（POST等方法使用，此处为空）</li>
</ul>
<p>请求原始格式-POST请求（Raw格式：Fiddler抓包得到）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">POST http:&#x2F;&#x2F;openapi.tuling123.com&#x2F;openapi&#x2F;api&#x2F;v2 HTTP&#x2F;1.1</span><br><span class="line">Content-Type: application&#x2F;json</span><br><span class="line">cache-control: no-cache</span><br><span class="line">Postman-Token: 1a39439e-61c8-4e59-82a1-736a362c5962</span><br><span class="line">User-Agent: PostmanRuntime&#x2F;7.2.0</span><br><span class="line">Accept: *&#x2F;*</span><br><span class="line">Host: openapi.tuling123.com</span><br><span class="line">accept-encoding: gzip, deflate</span><br><span class="line">content-length: 468</span><br><span class="line">Connection: keep-alive</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">	&quot;reqType&quot;:0,</span><br><span class="line">    &quot;perception&quot;: &#123;</span><br><span class="line">        &quot;inputText&quot;: &#123;</span><br><span class="line">            &quot;text&quot;: &quot;附近的酒店&quot;</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;inputImage&quot;: &#123;</span><br><span class="line">            &quot;url&quot;: &quot;imageUrl&quot;</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;selfInfo&quot;: &#123;</span><br><span class="line">            &quot;location&quot;: &#123;</span><br><span class="line">                &quot;city&quot;: &quot;北京&quot;,</span><br><span class="line">                &quot;province&quot;: &quot;北京&quot;,</span><br><span class="line">                &quot;street&quot;: &quot;信息路&quot;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    &quot;userInfo&quot;: &#123;</span><br><span class="line">        &quot;apiKey&quot;: &quot;ec961279f453459b9248f0aeb6600bbe&quot;,</span><br><span class="line">        &quot;userId&quot;: &quot;206379&quot;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="URL"><a href="#URL" class="headerlink" title="URL"></a>URL</h3><p>URL：统一资源定位符，接口的访问地址（包含服务器地址+接口地址）</p>
<p><strong>URL组成格式</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">协议\\: 服务器地址:端口号\资源路径?参数1&#x3D;值1&amp;参数2&#x3D;值2</span><br></pre></td></tr></table></figure>

<p>如：<a target="_blank" rel="noopener" href="https://www.sojson.com/open/api/weather/json.shtml?city=%E5%8C%97%E4%BA%AC">https://www.sojson.com/open/api/weather/json.shtml?city=北京</a></p>
<p><strong>注意</strong>：?号要使用英文?,不能使用中文？</p>
<p><strong>URL编码</strong></p>
<p>URL编码是一种浏览器用来打包请求参数及表单参数的格式, 参数和参数之间使用&amp;分割，非ASCII码使用%加16进制编码替换，如：<code>https://www.sojson.com/open/api/weather/json.shtml?city=北京</code><br>编码后为：<code>https://www.sojson.com/open/api/weather/json.shtml?city=%E5%8C%97%E4%BA%AC</code></p>
<p>链接：URL编码/解码工具(<a target="_blank" rel="noopener" href="http://tool.chinaz.com/Tools/urlencode.aspx">http://tool.chinaz.com/Tools/urlencode.aspx</a>)</p>
<h3 id="请求方法"><a href="#请求方法" class="headerlink" title="请求方法"></a>请求方法</h3><table>
<thead>
<tr>
<th>序号</th>
<th>方法</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>1</td>
<td>GET</td>
<td>请求指定的页面信息，并返回实体主体</td>
</tr>
<tr>
<td>2</td>
<td>POST</td>
<td>向指定资源提交数据进行处理请求（例如提交表单或者上传文件）数据被包含在请求体中</td>
</tr>
<tr>
<td>3</td>
<td>HEAD</td>
<td>类似于get请求，只不过返回的响应中没有具体的内容，用于获取报头</td>
</tr>
<tr>
<td>4</td>
<td>PUT</td>
<td>从客户端向服务器传送的数据取代指定的文档的内容</td>
</tr>
<tr>
<td>5</td>
<td>DELETE</td>
<td>请求服务器删除指定的页面</td>
</tr>
<tr>
<td>6</td>
<td>CONNECT</td>
<td>预留给能够将连接改为管道方式的代理服务器</td>
</tr>
<tr>
<td>7</td>
<td>OPTIONS</td>
<td>允许客户端查看服务器的性能</td>
</tr>
<tr>
<td>8</td>
<td>TRACE</td>
<td>回显服务器收到的请求，主要用于测试或诊断</td>
</tr>
</tbody></table>
<p><strong>GET请求和POST请求的区别</strong></p>
<ul>
<li>GET请求：<ul>
<li>GET请求可被缓存</li>
<li>GET请求保留在浏览器历史记录中</li>
<li>GET请求可被收藏为书签</li>
<li>GET请求不应在处理敏感数据时使用</li>
<li>GET请求有长度限制</li>
<li>GET请求只应当用于取回数据</li>
</ul>
</li>
<li>POST请求：<ul>
<li>POST请求不会被缓存</li>
<li>POST请求不会保留在浏览器历史记录中</li>
<li>POST不能被收藏为书签</li>
<li>POST请求对数据长度没有要求</li>
</ul>
</li>
</ul>
<h3 id="请求参数（URL参数）"><a href="#请求参数（URL参数）" class="headerlink" title="请求参数（URL参数）"></a>请求参数（URL参数）</h3><p>如：<code>https://www.sojson.com/open/api/weather/json.shtml?city=北京</code></p>
<ul>
<li>中的<code>city=北京</code>,向接口传递一个参数“city”,参数值为“北京”</li>
<li>不同的参数之间用&amp;隔开，非ASCII码参数会自动url encode</li>
</ul>
<h3 id="请求Headers（请求头）"><a href="#请求Headers（请求头）" class="headerlink" title="请求Headers（请求头）"></a>请求Headers（请求头）</h3><p><strong>常见Headers</strong><br><a target="_blank" rel="noopener" href="https://upload-images.jianshu.io/upload_images/7575721-c13fd028ac875d7a.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">![常见Headers](Python Restful.assets/7575721-c13fd028ac875d7a.png)</a></p>
<h3 id="请求数据-又称为Request-Body-或-Data"><a href="#请求数据-又称为Request-Body-或-Data" class="headerlink" title="请求数据(又称为Request Body 或 Data)#"></a>请求数据(又称为Request Body 或 Data)<a target="_blank" rel="noopener" href="https://www.cnblogs.com/superhin/p/10338915.html#2243169553">#</a></h3><p>请求数据类型（Content-Type）（重点）</p>
<ul>
<li>application/x-www-form-urlencoded： 网页表单格式（默认）</li>
<li>application/json：REST接口常用格式</li>
<li>text/xml：xml格式，RPC接口，Dubbo接口常用格式</li>
<li>test/html： html格式</li>
<li>multipart/form-data: 混合表单，支持上传图片</li>
</ul>
<p><strong>数据编码</strong></p>
<ul>
<li>ASCII码: 单字节，美国信息交换标准码, 包含数字，字母，英文标点及一些控制字符</li>
<li>ISO-8859-1：又称Latin1，单字节，向下兼容ASCII，用于支持部分于欧洲使用的语言</li>
<li>ANSI编码：单字节表示英文，双字节表示汉字，对ASCII的扩展，不同的国家和地区制定了不同的标准，中文中的GBK,GB2312属于ANSI编码</li>
<li>Unicode编码: 采用二个字节编码（英文和中文的字符都以双字节存放），与ANSI码不兼容</li>
<li>UTF-8：是目前互联网上使用最广泛的一种Unicode 编码方式，又称万国码</li>
</ul>
<blockquote>
<p>指定请求数据编码（解决中文乱码）：<br>请求Headers设置Content-Type: application/json; charset=utf-8</p>
</blockquote>
<ul>
<li>Base64: 一种用64个字符来表示任意二进制数据的方法。<ul>
<li>Base64编码的作用：由于某些系统中只能使用ASCII字符。Base64就是用来将非ASCII字符的数据转换成ASCII字符的一种方法。</li>
<li>而且base64特别适合在http，mime协议下快速传输数据。</li>
</ul>
</li>
</ul>
<p><a target="_blank" rel="noopener" href="https://upload-images.jianshu.io/upload_images/7575721-02cdf86673350586?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">![Base64在接口中的的使用](Python Restful.assets/7575721-02cdf86673350586)</a></p>
<p>参考：<a target="_blank" rel="noopener" href="https://www.cnblogs.com/cuihongyu3503319/p/5564265.html">Base64编码及其作用</a></p>
<h3 id="响应（Response"><a href="#响应（Response" class="headerlink" title="响应（Response)#"></a>响应（Response)<a target="_blank" rel="noopener" href="https://www.cnblogs.com/superhin/p/10338915.html#3940228231">#</a></h3><p>接口返回的信息，包含HTTP状态码，响应头和相应信息</p>
<p>原始相应数据（Raw格式，Fiddler抓包）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">HTTP&#x2F;1.1 200 OK</span><br><span class="line">Date: Thu, 23 Aug 2018 06:32:26 GMT</span><br><span class="line">Transfer-Encoding: chunked</span><br><span class="line">Connection: keep-alive</span><br><span class="line"></span><br><span class="line">&#123;&quot;intent&quot;:&#123;&quot;actionName&quot;:&quot;&quot;,&quot;code&quot;:10005,&quot;intentName&quot;:&quot;&quot;,&quot;parameters&quot;:&#123;&quot;lon&quot;:&quot;&quot;,&quot;checkout_date&quot;:&quot;2018-08-25&quot;,&quot;star&quot;:&quot;0&quot;,&quot;city&quot;:&quot;北京&quot;,&quot;days&quot;:&quot;1&quot;,&quot;order&quot;:&quot;&quot;,&quot;price_range&quot;:&quot;&quot;,&quot;nearby_place&quot;:&quot;酒店&quot;,&quot;brand&quot;:&quot;&quot;,&quot;checkin_date&quot;:&quot;2018-08-24&quot;,&quot;place&quot;:&quot;信息路&quot;,&quot;lat&quot;:&quot;&quot;,&quot;needgeo&quot;:&quot;0&quot;&#125;&#125;,&quot;results&quot;:[&#123;&quot;groupType&quot;:1,&quot;resultType&quot;:&quot;url&quot;,&quot;values&quot;:&#123;&quot;url&quot;:&quot;http:&#x2F;&#x2F;m.elong.com&#x2F;hotel&#x2F;0101&#x2F;nlist&#x2F;#indate&#x3D;2018-08-24&amp;outdate&#x3D;2018-08-25&amp;keywords&#x3D;%E4%BF%A1%E6%81%AF%E8%B7%AF&quot;&#125;&#125;,&#123;&quot;groupType&quot;:1,&quot;resultType&quot;:&quot;text&quot;,&quot;values&quot;:&#123;&quot;text&quot;:&quot;亲，已帮你找到相关酒店信息&quot;&#125;&#125;]&#125;</span><br></pre></td></tr></table></figure>

<p><strong>常见的响应格式</strong></p>
<ul>
<li>html</li>
<li>json</li>
<li>xml</li>
</ul>
<p>响应编码：有时需要根据不同的编码来正确解析响应内容</p>
<h3 id="HTTP状态码"><a href="#HTTP状态码" class="headerlink" title="HTTP状态码"></a>HTTP状态码</h3><ul>
<li>1** 信息，服务器收到请求，需要请求者继续执行操作</li>
<li>2** 成功，操作被成功接收并处理</li>
<li>3** 重定向，需要进一步的操作以完成请求</li>
<li>4** 客户端错误，请求包含语法错误或无法完成请求</li>
<li>5** 服务器错误，服务器在处理请求的过程中发生了错误</li>
</ul>
<p><strong>常见HTTP响应码</strong></p>
<ul>
<li>200： 成功</li>
<li>301/302： 请求重定向到另外一个接口</li>
<li>400: 请求语法错误</li>
<li>403：资源没有访问权限</li>
<li>404：资源不存在（有可能是请求url错误或参数不正确）</li>
<li>405：请求方法不被允许（比如接口只允许Post,使用Get请求接口）</li>
<li>500：服务器内部错误（通常是服务器挂了或接口Bug)</li>
<li>502: 网关失效</li>
<li>504: 网关请求超时</li>
</ul>
<h3 id="HTTP与HTTPS"><a href="#HTTP与HTTPS" class="headerlink" title="HTTP与HTTPS"></a>HTTP与HTTPS</h3><p>HTTP协议传输的数据都是未加密的，HTTPS协议是由HTTP+SSL协议构建的可进行加密传输、身份认证的网络协议，要比HTTP协议安全。</p>
<p><strong>HTTPS和HTTP的区别</strong></p>
<ul>
<li>HTTPS协议需要到ca申请证书，一般免费证书较少，因而需要一定费用。</li>
<li>HTTP是超文本传输协议，信息是明文传输，HTTPS则是具有安全性的SSL加密传输协议。</li>
<li>HTTP和HTTPS使用的是完全不同的连接方式，用的端口也不一样，前者是80，后者是443。</li>
<li>HTTP的连接很简单，是无状态的；HTTPS协议是由HTTP+SSL协议构建的可进行加密传输、身份认证的网络协议，比HTTP协议安全。</li>
</ul>
<h3 id="Cookie和Session"><a href="#Cookie和Session" class="headerlink" title="Cookie和Session"></a>Cookie和Session</h3><ul>
<li>Cookie/Cookies: 是指某些网站为了<em>辨别用户身份</em>、<em>进行session跟踪</em>而<em>储存在用户本地</em>终端上的数据（通常经过加密）。</li>
<li>Session：服务端为客户端访问所建立和维持的会话，通常会生成一个唯一的id，会话有一定的有效期。<br>由于HTTP是无状态的，即服务器不知道用户上一次做了什么，默认也无法识别用户身份。<br>比较流行的做法是：</li>
<li>用户访问时服务端建立会话（Session）</li>
<li>将会话id（Session ID）随响应返回，并保存在客户端的Cookies里</li>
<li>后续的访问中，服务器通过辨识，客户端请求时携带的Cookies内容来识别用户</li>
</ul>
<p><a target="_blank" rel="noopener" href="https://upload-images.jianshu.io/upload_images/7575721-ecc0f69142c1f0c2.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">![用户首次访问服务器向客户端设置Cookie](Python Restful.assets/7575721-ecc0f69142c1f0c2.jpg)</a><br><a target="_blank" rel="noopener" href="https://upload-images.jianshu.io/upload_images/7575721-80561012c8f03f2c.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">![后续访问时携带Cookie](Python Restful.assets/7575721-80561012c8f03f2c.jpg)</a></p>
<p><strong>Cookie和Session的区别</strong></p>
<ul>
<li>cookie是存在客户端（浏览器）的进程内存中和客户端所在的机器硬盘上</li>
<li>cookie只能能够存储少量文本，大概4K大小</li>
<li>cookie是不能在不同浏览器之间共享</li>
<li>Session存在服务器端，存在网站进程的内存中</li>
<li>Session在初次设置session的时候，会在session池中实例化一个session对象，以sessionid 的值作为key，同时会将key以cookie的形式保存到客户端的内存中</li>
<li>Session的作用域只存在当前浏览器的会话中，当浏览器关闭以后就会将sessionid丢失，但是服务器的Session对象要20分钟以后才会回收</li>
</ul>
<h3 id="授权与加密"><a href="#授权与加密" class="headerlink" title="授权与加密"></a>授权与加密</h3><p><strong>常见的接口安全策略</strong></p>
<ol>
<li>Session/Cookie机制： 即需要登录，登录后可访问各个接口，最常用的一种策略，适用于内部接口。</li>
<li>固定appid模式： 用户注册时会生成一个唯一的appid，用户调用接口时需要携带appid，适用于公开接口，安全性较差。</li>
<li>动态token模式： token即身份令牌，用户访问接口需要使用个人appid临时申请一个token，token有一定有效期，适用于公开接口，安全性较appid模式好。</li>
<li>开放协议： Basic Auth/ Oauth1.0 / Oauth2.0: 适用于开放接口。</li>
<li>数字签名： 将所有请求参数及参数值进行排列拼接，加上用户私钥，再进行Md5或其他加密生成一个请求的签名（sign）,请求是需要携带签名，服务器收到请求后，会对请求重新计算签名并核实与请求所携带签名是否一致。安全性较高，可以有效防止请求被篡改。适用于内部接口及微服务接口。</li>
</ol>
<p><strong>常见的加密算法</strong></p>
<p>在接口数据传输过程中常对一些敏感数据（如密码）进行Base64编码或MD5加密，以增加安全性。<br>加密算法分为对称式加密算法和非对称式加密算法，对称式加解密使用同一个秘钥，非对称式使用不同的秘钥。</p>
<ul>
<li>对称式加密<ul>
<li>DES: 数据加密标准，速度较快，适用于加密大量数据的场合</li>
<li>AES: 高级加密标准，速度快，安全级别高</li>
</ul>
</li>
<li>非对称式加密<ul>
<li>RSA: 是一个支持变长密钥的公共密钥算法， 分公钥和私钥，SSH协议使用该算法</li>
<li>MD5: 最常用的一种加密方法，是一种摘要算法。</li>
</ul>
</li>
</ul>
<h3 id="缓存"><a href="#缓存" class="headerlink" title="缓存"></a>缓存</h3><p>HTTP 缓存机制作是 web 性能优化的重要手段，当用户第一次请求服务器资源时，服务器将资源缓存到客户端本地，在一定时间内（缓存有效期内）当用户再次向服务器请求同样的资源时，可以直接从缓存中读取，而不用从服务器下载。</p>
<p><strong>接口测试中缓存相关注意点</strong></p>
<ul>
<li>在更新或调试接口是，注意是否需要清理缓存（或临时禁用缓存）</li>
<li>缓存有一定的有效期</li>
<li>接口性能测试中会关注缓存的命中率</li>
</ul>
<h1 id="Python接口测试实战1（下）-接口测试工具的使用"><a href="#Python接口测试实战1（下）-接口测试工具的使用" class="headerlink" title="Python接口测试实战1（下）- 接口测试工具的使用"></a><a target="_blank" rel="noopener" href="https://www.cnblogs.com/superhin/p/10338924.html">Python接口测试实战1（下）- 接口测试工具的使用</a></h1><p>PDF下载：链接:<a target="_blank" rel="noopener" href="https://pan.baidu.com/s/1OwAa8nl1eeBj8fcrgd3sBA">https://pan.baidu.com/s/1OwAa8nl1eeBj8fcrgd3sBA</a> 密码:e9d8</p>
<h2 id="本节内容"><a href="#本节内容" class="headerlink" title="本节内容"></a>本节内容</h2><ul>
<li>抓包工具的使用</li>
<li>Postman的使用</li>
</ul>
<h2 id="抓包工具的使用"><a href="#抓包工具的使用" class="headerlink" title="抓包工具的使用"></a>抓包工具的使用</h2><h3 id="抓包工具简介"><a href="#抓包工具简介" class="headerlink" title="抓包工具简介"></a>抓包工具简介</h3><ul>
<li>Chrome/Firefox 开发者工具: 浏览器内置，方便易用</li>
<li>Fiddler/Charles: 基于代理的抓包，功能强大，可以手机抓包，模拟弱网，拦截请求，定制响应<ul>
<li>Fiddler: 免费，只支持Win</li>
<li>Charles: 收费，支持Win/Linux/Mac</li>
</ul>
</li>
<li>wireshark/tcpdumps：给予网卡层的抓包，数据量大，可以抓取tcp/udp等多种协议的数据包（需要做好过滤）<ul>
<li>wireshark: 支持Win/Linux/Mac</li>
<li>tcpdumps: Linux抓包命令，功能强大，常用作服务端抓包</li>
</ul>
</li>
</ul>
<p><strong>什么是代理？</strong><a target="_blank" rel="noopener" href="https://upload-images.jianshu.io/upload_images/7575721-2201dfc3c8e872d9.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">![正向代理](Python Restful.assets/7575721-2201dfc3c8e872d9.png)</a></p>
<p><strong>正向代理与反向代理</strong><a target="_blank" rel="noopener" href="https://upload-images.jianshu.io/upload_images/7575721-2811c480056a63d5.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">![正向代理与反向代理](Python Restful.assets/7575721-2811c480056a63d5.png)</a></p>
<ul>
<li>正向代理中, 代理和客户端在一个局域网内，对服务器透明</li>
<li>反向带来中，代理和服务器在一个局域网内，对客户端透明</li>
</ul>
<p>例如：使用代理访问Google属于正向代理，通过不同的域名通过Nginx向同一台服务器请求不同的网站属于反向代理</p>
<ul>
<li>反向代理可以做负载均衡</li>
<li>反省代理接口测试一般要先绑定本地hosts</li>
</ul>
<p><strong>怎么手动添加代理?</strong></p>
<ul>
<li>启动代理服务器，如开启Postman的代理服务（本机ip,默认端口5555）</li>
<li>Win设置-&gt;代理 → 配置代理ip和域名</li>
</ul>
<p><strong>手机设置上网代理（手机抓包）</strong></p>
<ul>
<li>笔记本和手机使用同一wifi上网</li>
<li>笔记本上启动代理服务器，如开启Postman的代理服务（本机ip,默认端口5555）</li>
<li>手机上长按wifi-&gt;选择管理网络或高级-&gt; 手动配置代理 → 配置代理ip和域名</li>
</ul>
<p>** 绑定hosts(适用于反向代理)**</p>
<ul>
<li>Win: notepad C:\Windows\System32\drivers\etc\hosts</li>
<li>Linux: vim /etc/hosts(格式： ip 域名)</li>
</ul>
<h3 id="Chrome开发者工具"><a href="#Chrome开发者工具" class="headerlink" title="Chrome开发者工具#"></a>Chrome开发者工具<a target="_blank" rel="noopener" href="https://www.cnblogs.com/superhin/p/10338924.html#3045042696">#</a></h3><ul>
<li>Elements: HTML元素面板，用于定位查看元素源代码</li>
<li>Console: js控制台面板，js命令行，查看前端日志</li>
<li>Sources: 资源面板，用于断点调试js</li>
<li><strong>Network</strong>: 请求信息面板，查看请求及响应信息</li>
<li>Timeline: 时间线面板，记录网站生命周期内所发生的各类事件</li>
<li>Profiles: 事件详情面板</li>
<li>Application: 本地存储，Session存储等资源信息</li>
<li>Secuity: 判断当前网页是否安全</li>
<li>Audits: 网络性能诊断</li>
</ul>
<p><strong>Network面板</strong><a target="_blank" rel="noopener" href="https://upload-images.jianshu.io/upload_images/7575721-284b8e2030d275a8.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">![Network面板](Python Restful.assets/7575721-284b8e2030d275a8.png)</a></p>
<ol>
<li>Console: 外观及功能控制<ul>
<li>录制：记录或停止记录请求</li>
<li>清空： 清空所有请求</li>
<li>抓取快照：按帧捕获屏幕事件</li>
<li>过滤: 请用关闭过滤功能</li>
<li>搜索：搜索请求</li>
<li>Group by frame：按框架分组</li>
<li>Preserve log：页面重载时保留请求</li>
<li>Disable cache：禁用缓存</li>
<li>Offline：断网及弱网模拟</li>
</ul>
</li>
<li>Filters: 请求过滤器</li>
<li>Overview: 资源时间轴</li>
<li>Requests Table: 请求列表<ul>
<li>Name: 资源名称</li>
<li>Status: HTTP状态码</li>
<li>Initiator: 请求源</li>
<li>Size: 从服务器下载的文件和请求的资源大小。如果是从缓存中取得的资源则该列会显示(from cache)</li>
<li>Timeline: 显示所有网络请求时间状态轴</li>
</ul>
</li>
<li>Summary: 请求总数，数据传输量，加载时间信息<ul>
<li>DOMContentLoaded：页面上DOM完全加载并解析完毕</li>
<li>load：页面上所有DOM、CSS、JS、图片完全加载完毕</li>
</ul>
</li>
</ol>
<blockquote>
<p>导出请求：右击请求 →  → Copy as fetch / Copy as cUrl</p>
</blockquote>
<h3 id="Fiddler简介"><a href="#Fiddler简介" class="headerlink" title="Fiddler简介#"></a>Fiddler简介<a target="_blank" rel="noopener" href="https://www.cnblogs.com/superhin/p/10338924.html#1935410240">#</a></h3><blockquote>
<p>Fiddler 4.6 下载 <a target="_blank" rel="noopener" href="http://www.downza.cn/soft/234727.html">http://www.downza.cn/soft/234727.html</a></p>
</blockquote>
<p><strong>为什么使用Fiddler?</strong></p>
<ul>
<li>可以抓到请求数据，查看Raw格式/表单格式/Json/XML格式</li>
<li>可以拦截和修改请求</li>
<li>更强大的过滤器</li>
<li>可以抓取Postman/接口脚本发送的请求，方便调试</li>
<li>可以抓包手机请求 …</li>
</ul>
<p><strong>Fiddler主界面</strong> Fiddler的主界面分为 工具面板、会话面板、监控面板、状态面板<a target="_blank" rel="noopener" href="https://upload-images.jianshu.io/upload_images/947566-66f000394932159c.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/700">![Fiddler主界面](Python Restful.assets/947566-66f000394932159c.jpg)</a></p>
<ul>
<li><p>Inspectors</p>
<p>: 检查员</p>
<ul>
<li>Raw：请求的原始格式</li>
<li>WebForm: 请求的表单格式</li>
<li>Json：请求的Json格式请求</li>
<li>XML：请求的XML格式</li>
</ul>
</li>
<li><p>AutoResponsder: 自动回复，可用于构造响应，Mock，不修改服务器文件调试接口</p>
</li>
<li><p><strong>Composer</strong>: 设计者, 发送和调试请求</p>
</li>
<li><p>FidderScript:</p>
</li>
<li><p>Filters</p>
<p>: 过滤器</p>
<ul>
<li>Hosts: 按服务器过滤</li>
<li>Clients Process: 按客户端程序过滤</li>
<li>Request Headers: 按请求头过滤</li>
<li>Breakpoints: 设置断点</li>
<li>Response Status Code: 按状态码过滤</li>
<li>Response Type and Size: 按响应类型及大学过滤</li>
<li>Response Headers: 按响应头过滤</li>
</ul>
</li>
</ul>
<p><strong>自动断点设置</strong> 菜单Rules → Automatic Breakpoints → Before Requests/After Requests</p>
<p><strong>手机抓包</strong> 安装fiddler的笔记本和手机使用同一wifi → 手机长按该wifi,选择高级 → 添加代理 ip为笔记本ip, 端口为8888 → 笔记本开启fiddler, 手机端访问网页</p>
<blockquote>
<p>参考： <a target="_blank" rel="noopener" href="https://www.cnblogs.com/conquerorren/p/8472285.html#">Fiddler详细教程</a></p>
</blockquote>
<h3 id="服务端抓包-tcpdumps"><a href="#服务端抓包-tcpdumps" class="headerlink" title="服务端抓包 - tcpdumps#"></a>服务端抓包 - tcpdumps<a target="_blank" rel="noopener" href="https://www.cnblogs.com/superhin/p/10338924.html#1390060528">#</a></h3><h2 id="Postman的使用"><a href="#Postman的使用" class="headerlink" title="Postman的使用#"></a>Postman的使用<a target="_blank" rel="noopener" href="https://www.cnblogs.com/superhin/p/10338924.html#2662379066">#</a></h2><h3 id="常见接口测试工具"><a href="#常见接口测试工具" class="headerlink" title="常见接口测试工具#"></a>常见接口测试工具<a target="_blank" rel="noopener" href="https://www.cnblogs.com/superhin/p/10338924.html#1259258259">#</a></h3><ul>
<li>Postman: 简单方便的接口调试工具，便于分享和协作。具有接口调试，接口集管理，环境配置，参数化，断言，批量执行，录制接口，Mock Server, 接口文档，接口监控等功能</li>
<li>JMeter: 开源接口测试及压测工具，支持Linux及无界面运行</li>
<li>LR: 商业版接口性能测试工具，简单易用，功能强大</li>
<li>SoupUI: 开源，WebService接口常用测试工具，也可以测试Rest接口及接口安全</li>
</ul>
<h3 id="新版Postman使用简介"><a href="#新版Postman使用简介" class="headerlink" title="新版Postman使用简介#"></a>新版Postman使用简介<a target="_blank" rel="noopener" href="https://www.cnblogs.com/superhin/p/10338924.html#745774290">#</a></h3><blockquote>
<p>Postman 6.1.4 独立安装版 下载 <a target="_blank" rel="noopener" href="http://www.downza.cn/soft/205171.html">http://www.downza.cn/soft/205171.html</a></p>
</blockquote>
<p><a target="_blank" rel="noopener" href="https://upload-images.jianshu.io/upload_images/7575721-7e55bae965258ea6.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">![Postman主界面](Python Restful.assets/7575721-7e55bae965258ea6.png)</a></p>
<p><strong>工具栏</strong></p>
<ul>
<li>New: 新建，可以新建Request请求，Collection请求集，环境等等</li>
<li>Import: 导入，可以导入别人导出的请求集</li>
<li>Runner: 运行一个请求集（批量执行）</li>
<li>Invite: 邀请（需要注册，邀请进行协作）</li>
<li>同步图标： （需要注册，同步你的项目到云端）</li>
<li>抓包图标： 抓包/捕获请求，用于开启Postman代理， 手动设置代理（或手机代理）后可抓包/录制请求</li>
<li>设置图标： Postman设置</li>
<li>消息图标： 官方及协助消息</li>
<li>收藏图标： 我的收藏（需要注册）</li>
<li>云端图标： 用户云端数据（需要注册）</li>
</ul>
<p><strong>接口管理区</strong></p>
<ul>
<li>History: 请求历史记录，可以查询到之前的请求记录</li>
<li>Collections: 接口集，相当于一个接口项目或测试计划，接口集中可以建立无限极子文件夹，用于对接口进行分组管理</li>
</ul>
<p><strong>环境管理区</strong></p>
<ul>
<li>环境切换：用于切换环境</li>
<li>环境预览：用于快速预览环境中的所有变量</li>
<li>环境管理：用于添加修改环境及环境变量，以及全局变量</li>
</ul>
<p><strong>什么是环境</strong> 接口完整地址 = 服务地址 + 接口地址， 如</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Copywww.sojson.com + &#x2F;open&#x2F;api&#x2F;weather&#x2F;json.shtml</span><br></pre></td></tr></table></figure>

<p>环境是一套配置，包含许多环境变量。在接口测试中，根据部署在不同的服务器上，服务器地址有可能不同，而同一个接口，接口地址是不变的。为了测试部署在不同服务器上的同一套接口，我们可以建立不同的环境，不同环境中host变量使用不同的地址</p>
<p><strong>接口设计区</strong> 可以通过上方tab边上的+号，新建多个请求。接口设计区从上到下分为请求区和响应区</p>
<ul>
<li>请求区<ul>
<li>请求地址行：可以选择请求方法（GET/POST/…），填写请求地址，发送请求和保存请求到测试集</li>
<li>请求数据区：分为授权，请求头，请求数据，请求发送前执行的脚本（用于准备数据），请求结束后执行的脚本（用于断言）</li>
</ul>
</li>
<li>响应区：<ul>
<li>响应内容： 可以查看Pretty（美化格式），Raw（原始格式），Preview（HTML预览格式）</li>
<li>响应Cookie</li>
<li>响应头</li>
<li>测试结果，对应请求中Tests中设置的断言</li>
</ul>
</li>
</ul>
<p><a target="_blank" rel="noopener" href="https://upload-images.jianshu.io/upload_images/7575721-b54bbb849d1aa12a.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">![Postman主界面功能](Python Restful.assets/7575721-b54bbb849d1aa12a.png)</a></p>
<p><strong>Collection请求集</strong> 测试集是Postman中接口管理的一个“整体”单位，运行、导出、分享等都是基于测试集的。</p>
<ul>
<li><p>新建测试集： New按钮-&gt;Collection 或 直接点击测试集列表上方的新建测试集按钮</p>
<p>![新建测试集](Python Restful.assets/7575721-9ac1ac3adb615c13.png)</p>
<ul>
<li>授权： 测试集及其子文件夹下的接口统一使用该授权，不用每个接口再都单独设置一遍</li>
<li>请求前脚本： 测试集的每个接口公用的请求前脚本</li>
<li>请求后断言： 测试集每个接口公用的请求后脚本</li>
<li>请求集变量： 请求集中公用的一些变量</li>
</ul>
</li>
<li><p>子文件夹 子文件夹的属性中同样拥有描述，授权，请求前脚本，和请求后断言（没有变量，一个请求集的变量统一管理），实现了不同范围（Scope）的Fixture功能。</p>
</li>
<li><p>请求集导出：请求集可以导出并发送给别人（不携带环境信息），别人通过导入来使用你的接口</p>
</li>
<li><p>请求集分享： 请求集直接分享给别人（双方都需要注册）</p>
</li>
</ul>
<p>** 环境管理**<a target="_blank" rel="noopener" href="https://upload-images.jianshu.io/upload_images/7575721-9a1cb4b7a504bba5.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">![新建环境](Python Restful.assets/7575721-9a1cb4b7a504bba5.png)</a>我们可以环境中设置多个变量，以供在请求中使用 环境变量使用方法： 选择环境，在请求URL或者请求Body里使用来使用环境变量，变量可以在请求Body的各种格式中使用，但不能直接在请求前脚本（Pre-request Script）和请求后脚本（Tests）中使用<a target="_blank" rel="noopener" href="https://upload-images.jianshu.io/upload_images/7575721-b2d8bf07fbd2cd29.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">![环境变量的使用](Python Restful.assets/7575721-b2d8bf07fbd2cd29.png)</a></p>
<p>环境管理中还可以点击“Global”添加全局变量，环境变量只有当选择了该环境时生效，全局变量在任何环境中生效，测试集中的变量只在当前测试集生效，当测试集变量，环境变量，全局变量有重复的变量名时，优先级为：环境变量&gt;全局变量&gt;测试集变量</p>
<p><strong>Params使用</strong> 当请求URL中参数很多时，不方便进行添加和查看，可以点击URL输入框后的Params按钮，以表格的方式添加变量及值，从表格添加后，变量和值会自动添加到URL中<a target="_blank" rel="noopener" href="https://upload-images.jianshu.io/upload_images/7575721-eba92e50a1c61d3e.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">![添加URL参数](Python Restful.assets/7575721-eba92e50a1c61d3e.png)</a></p>
<p><strong>请求设计</strong></p>
<ul>
<li>授权：如果接口需要授权，可以在该页面设置授权方式（type）和授权信息</li>
<li>Header: 请求头，可以设置请求类型（Content-Type）和Cookie</li>
<li>Body: 请求数据<ul>
<li>form-data：混合表单，支持上传文件</li>
<li>x-www-form-urlencoded：文本表单</li>
<li>raw：原始格式，支持JSON/XML格式（后面可选择）</li>
<li>binary: 二进制格式，用于发送二进制数据流</li>
</ul>
</li>
<li>Pre-request Script: 请求前脚本，Javascript语法，用于在发送请求前生成一些动态数据或做一些处理</li>
<li>Tests：请求后脚本，Javascript语法，用于请求返回后做一些处理或断言结果</li>
</ul>
<p><strong>Postman发送各种格式请求的方法：</strong> 注意：选择不同的请求可是，会自动在Header中添加Content-Type信息<a target="_blank" rel="noopener" href="https://upload-images.jianshu.io/upload_images/7575721-aa9a6a944329899f.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">![混合表单请求](Python Restful.assets/7575721-aa9a6a944329899f.png)</a><a target="_blank" rel="noopener" href="https://upload-images.jianshu.io/upload_images/7575721-fbde5d4494c45f93.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">![传统表单请求](Python Restful.assets/7575721-fbde5d4494c45f93.png)</a><a target="_blank" rel="noopener" href="https://upload-images.jianshu.io/upload_images/7575721-995b11203be4c69b.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">![JSON格式请求](Python Restful.assets/7575721-995b11203be4c69b.png)</a><a target="_blank" rel="noopener" href="https://upload-images.jianshu.io/upload_images/7575721-ce3ddb66be5aaa69.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">![XML请求](Python Restful.assets/7575721-ce3ddb66be5aaa69.png)</a></p>
<p><strong>Tests断言</strong></p>
<ul>
<li>HTTP状态码断言:</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Copytests[&quot;HTTP状态码200&quot;]&#x3D;responseCode.code &#x3D;&#x3D; 200;</span><br></pre></td></tr></table></figure>

<ul>
<li>响应包含内容断言：</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Copytests[&quot;状态码200&quot;] &#x3D; responseBody.has(&quot;登录成功&quot;);</span><br></pre></td></tr></table></figure>

<p>接口样例： POST <a target="_blank" rel="noopener" href="https://demo.fastadmin.net/admin/index/login.html">https://demo.fastadmin.net/admin/index/login.html</a> 用户名/密码： admin/123456<a target="_blank" rel="noopener" href="https://upload-images.jianshu.io/upload_images/7575721-4a5ba14efb542088.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">![接口样例](Python Restful.assets/7575721-4a5ba14efb542088.png)</a><a target="_blank" rel="noopener" href="https://upload-images.jianshu.io/upload_images/7575721-81d6af50b1f4132b.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">![断言方法](Python Restful.assets/7575721-81d6af50b1f4132b.png)</a></p>
<ul>
<li>JSON响应断言</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Copyvar jsonData &#x3D; JSON.parse(responseBody);</span><br><span class="line">tests[&quot;code为200&quot;] &#x3D; jsonData.code&#x3D;&#x3D;200</span><br><span class="line">tests[&quot;msg为success&quot;] &#x3D; jsonData.msg &#x3D;&#x3D; &quot;success&quot;</span><br></pre></td></tr></table></figure>

<p>接口样例： GET <a target="_blank" rel="noopener" href="http://www.tuling123.com/openapi/api?key=ec961279f453459b9248f0aeb6600bbe&amp;info=%E4%BD%A0%E5%A5%BD%5B!%5BJSON%E5%93%8D%E5%BA%94%E6%96%AD%E8%A8%80%5D">http://www.tuling123.com/openapi/api?key=ec961279f453459b9248f0aeb6600bbe&amp;info=你好[![JSON响应断言]</a>(Python Restful.assets/7575721-f5fb65c4afac83c3.png)](<a target="_blank" rel="noopener" href="https://upload-images.jianshu.io/upload_images/7575721-f5fb65c4afac83c3.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">https://upload-images.jianshu.io/upload_images/7575721-f5fb65c4afac83c3.png?imageMogr2/auto-orient/strip|imageView2/2/w/1240</a>)</p>
<p><strong>Runner: 测试集批量执行</strong></p>
<ul>
<li>支持设置迭代次数</li>
<li>支持加载csv或json类测试数据</li>
</ul>
<p>操作方法： 如<a target="_blank" rel="noopener" href="https://demo.fastadmin.net/admin/index/login.html%E6%8E%A5%E5%8F%A3">https://demo.fastadmin.net/admin/index/login.html接口</a></p>
<ul>
<li>新建一个Collection，比如名称Demo2</li>
<li>填入URL：<a target="_blank" rel="noopener" href="https://demo.fastadmin.net/admin/index/login.html%EF%BC%8C">https://demo.fastadmin.net/admin/index/login.html，</a> 选择POST方法</li>
<li>请求数据（Body）格式选x-www-form-urlecoded，请求数据填写username  password ，这里使用了两个变量来做参数化</li>
</ul>
<p><a target="_blank" rel="noopener" href="https://upload-images.jianshu.io/upload_images/7575721-584b98ec14d6bb70.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">![请求设置](Python Restful.assets/7575721-584b98ec14d6bb70.png)</a></p>
<ul>
<li>保存请求到Demo2中</li>
<li>在电脑上新建一个data.csv文件，第一行为变量名，下面是数据，如下图</li>
</ul>
<p><a target="_blank" rel="noopener" href="https://upload-images.jianshu.io/upload_images/7575721-32602f0ba05c840e.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">![数据文件](Python Restful.assets/7575721-32602f0ba05c840e.png)</a></p>
<ul>
<li>点击Postman工具栏的Runner按钮，Collection选择Demo2， Data选择数据文件data.csv， 点击运行Demo2</li>
</ul>
<p><a target="_blank" rel="noopener" href="https://upload-images.jianshu.io/upload_images/7575721-095ad8df66066b3c.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">![Runner配置](Python Restful.assets/7575721-095ad8df66066b3c.png)</a></p>
<p><a target="_blank" rel="noopener" href="https://upload-images.jianshu.io/upload_images/7575721-84fc8a278d88f30a.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">![运行结果](Python Restful.assets/7575721-84fc8a278d88f30a.png)</a></p>
<h1 id="Python接口测试实战2-使用Python发送请求"><a href="#Python接口测试实战2-使用Python发送请求" class="headerlink" title="Python接口测试实战2 - 使用Python发送请求"></a><a target="_blank" rel="noopener" href="https://www.cnblogs.com/superhin/p/10338930.html">Python接口测试实战2 - 使用Python发送请求</a></h1><h2 id="本节内容-1"><a href="#本节内容-1" class="headerlink" title="本节内容#"></a>本节内容<a target="_blank" rel="noopener" href="https://www.cnblogs.com/superhin/p/10338930.html#2813491216">#</a></h2><ul>
<li>requests安装</li>
<li>requests使用</li>
<li>JSON类型解析</li>
<li>requests库详解</li>
<li>带安全认证的请求</li>
</ul>
<h2 id="序言"><a href="#序言" class="headerlink" title="序言#"></a>序言<a target="_blank" rel="noopener" href="https://www.cnblogs.com/superhin/p/10338930.html#538624536">#</a></h2><p>上节课我们学习了接口测试的理论，抓包工具及使用Postman手工测试各种接口，这节课我们主要讲解使用Python语言来发送接口请求，实现接口测试自动化。</p>
<p>发送请求,我们这里主要使用Python的一个第三方包(需要先安装)：<em>requests</em>。<br>Python3自带的http.client和urllib.request都能发送http请求，不过相对来说使用较麻烦，第三方库requests让发送请求更简单，支持自动编码解码，会话保持，长连等</p>
<blockquote>
<p>参考: <a target="_blank" rel="noopener" href="http://docs.python-requests.org/zh_CN/latest/index.html">requests官方文档</a></p>
</blockquote>
<h2 id="requests安装"><a href="#requests安装" class="headerlink" title="requests安装#"></a>requests安装<a target="_blank" rel="noopener" href="https://www.cnblogs.com/superhin/p/10338930.html#643190484">#</a></h2><ul>
<li>Windows: 打开cmd命令行，输入<code>pip install requests</code>，等待安装完成即可</li>
<li>Linux: (建议使用Python3)，终端中输入<code>pip3 install requests</code>，等待安装完成即可</li>
<li>Mac: (建议使用Python3), <code>sudo python3 -m pip install requests</code>，等待安装完成即可</li>
</ul>
<p><strong>验证是否安装成功：</strong></p>
<p>打开命令行，输入<code>python</code>，在python shell环境下输入<code>import requests</code>没有报错即安装成功</p>
<h2 id="requests的使用"><a href="#requests的使用" class="headerlink" title="requests的使用#"></a>requests的使用<a target="_blank" rel="noopener" href="https://www.cnblogs.com/superhin/p/10338930.html#4124829679">#</a></h2><h3 id="一个最简单的GET请求"><a href="#一个最简单的GET请求" class="headerlink" title="一个最简单的GET请求#"></a>一个最简单的GET请求<a target="_blank" rel="noopener" href="https://www.cnblogs.com/superhin/p/10338930.html#1051751449">#</a></h3><p><strong>发送一个请求分3步：</strong></p>
<ol>
<li>组装请求： 请求可能包含url，params(url参数)，data(请求数据)，headers(请求头)，cookies等，最少必须有url</li>
<li>发送请求，获取响应：支持get，post等各种方法发送，返回的是一个响应对象</li>
<li>解析响应: 输出响应文本</li>
</ol>
<p>打开Pycharm，新建一个demo项目，项目下新建一个Python文件，输入以下内容：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 导入requests包</span></span><br><span class="line"><span class="keyword">import</span> requests </span><br><span class="line"></span><br><span class="line"><span class="comment"># 1. 组装请求</span></span><br><span class="line">url = <span class="string">&quot;http://httpbin.org/get&quot;</span>  <span class="comment"># 这里只有url，字符串格式</span></span><br><span class="line"><span class="comment"># 2. 发送请求，获取响应</span></span><br><span class="line">res = requests.get(url) <span class="comment"># res即返回的响应对象</span></span><br><span class="line"><span class="comment"># 3. 解析响应</span></span><br><span class="line"><span class="built_in">print</span>(res.text)  <span class="comment"># 输出响应的文本</span></span><br></pre></td></tr></table></figure>

<h3 id="带参数的GET请求"><a href="#带参数的GET请求" class="headerlink" title="带参数的GET请求#"></a>带参数的GET请求<a target="_blank" rel="noopener" href="https://www.cnblogs.com/superhin/p/10338930.html#2055863930">#</a></h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests </span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;http://www.tuling123.com/openapi/api?key=ec961279f453459b9248f0aeb6600bbe&amp;info=你好&quot;</span>  <span class="comment"># 参数可以写到url里</span></span><br><span class="line">res = requests.get(url=url) <span class="comment"># 第一个url指get方法的参数，第二个url指上一行我们定义的接口地址</span></span><br><span class="line"><span class="built_in">print</span>(res.text)  </span><br></pre></td></tr></table></figure>

<p>或</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests </span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;http://www.tuling123.com/openapi/api&quot;</span></span><br><span class="line">params = &#123;<span class="string">&quot;key&quot;</span>:<span class="string">&quot;ec961279f453459b9248f0aeb6600bbe&quot;</span>,<span class="string">&quot;info&quot;</span>:<span class="string">&quot;你好&quot;</span>&#125; <span class="comment"># 字典格式，单独提出来，方便参数的添加修改等操作</span></span><br><span class="line">res = requests.get(url=url, params=params) </span><br><span class="line"><span class="built_in">print</span>(res.text)  </span><br></pre></td></tr></table></figure>

<h3 id="传统表单类POST请求（x-www-form-urlencoded）"><a href="#传统表单类POST请求（x-www-form-urlencoded）" class="headerlink" title="传统表单类POST请求（x-www-form-urlencoded）#"></a>传统表单类POST请求（x-www-form-urlencoded）<a target="_blank" rel="noopener" href="https://www.cnblogs.com/superhin/p/10338930.html#1164089452">#</a></h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests </span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;http://httpbin.org/post&quot;</span></span><br><span class="line">data = &#123;<span class="string">&quot;name&quot;</span>: <span class="string">&quot;hanzhichao&quot;</span>, <span class="string">&quot;age&quot;</span>: <span class="number">18</span>&#125; <span class="comment"># Post请求发送的数据，字典格式</span></span><br><span class="line">res = requests.post(url=url, data=data) <span class="comment"># 这里使用post方法，参数和get方法一样</span></span><br><span class="line"><span class="built_in">print</span>(res.text)  </span><br></pre></td></tr></table></figure>

<h3 id="JSON类型的POST请求（application-json）"><a href="#JSON类型的POST请求（application-json）" class="headerlink" title="JSON类型的POST请求（application/json）#"></a>JSON类型的POST请求（application/json）<a target="_blank" rel="noopener" href="https://www.cnblogs.com/superhin/p/10338930.html#1295199343">#</a></h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests </span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;http://httpbin.org/post&quot;</span></span><br><span class="line">data = <span class="string">&#x27;&#x27;&#x27;&#123;</span></span><br><span class="line"><span class="string">        &quot;name&quot;: &quot;hanzhichao&quot;,</span></span><br><span class="line"><span class="string">        &quot;age&quot;: 18</span></span><br><span class="line"><span class="string">        &#125;&#x27;&#x27;&#x27;</span> <span class="comment"># 多行文本, 字符串格式，也可以单行（注意外层有引号，为字符串） data = &#x27;&#123;&quot;name&quot;: &quot;hanzhichao&quot;, &quot;age&quot;: 18&#125;&#x27;</span></span><br><span class="line">res = requests.post(url=url, data=data) <span class="comment">#  data支持字典或字符串</span></span><br><span class="line"><span class="built_in">print</span>(res.text)  </span><br></pre></td></tr></table></figure>

<p>data参数支持字典格式也支持字符串格式，如果是字典格式，requests方法会将其按照默认表单urlencoded格式转换为字符串，如果是字符串则不转化<br>如果data以字符串格式传输需要遵循以下几点：</p>
<ul>
<li>必须是严格的JSON格式字符串，里面必须用双引号，k-v之间必须有逗号，布尔值必须是小写的true/false等等</li>
<li>不能有中文，直接传字符串不会自动编码</li>
</ul>
<p>一般来说，建议将data声明为字典格式（方便数据添加修改），然后再用json.dumps()方法把data转换为合法的JSON字符串格式</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests </span><br><span class="line"><span class="keyword">import</span> json <span class="comment"># 使用到JSON中的方法，需要提前导入</span></span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;http://httpbin.org/post&quot;</span></span><br><span class="line">data = &#123;</span><br><span class="line">        <span class="string">&quot;name&quot;</span>: <span class="string">&quot;hanzhichao&quot;</span>,</span><br><span class="line">        <span class="string">&quot;age&quot;</span>: <span class="number">18</span></span><br><span class="line">        &#125;  <span class="comment"># 字典格式，方便添加</span></span><br><span class="line">headers = &#123;<span class="string">&quot;Content-Type&quot;</span>:<span class="string">&quot;application/json&quot;</span>&#125; <span class="comment"># 严格来说，我们需要在请求头里声明我们发送的格式</span></span><br><span class="line">res = requests.post(url=url, data=json.dumps(data), headers=headers) <span class="comment">#  将字典格式的data变量转换为合法的JSON字符串传给post的data参数</span></span><br><span class="line"><span class="built_in">print</span>(res.text)  </span><br></pre></td></tr></table></figure>

<p>或直接将字典格式的data数据赋给post方法的JSON参数（会自动将字典格式转为合法的JSON文本并添加headers）</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests </span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;http://openapi.tuling123.com/openapi/api/v2&quot;</span></span><br><span class="line">data = &#123;</span><br><span class="line">	<span class="string">&quot;reqType&quot;</span>:<span class="number">0</span>,</span><br><span class="line">    <span class="string">&quot;perception&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;inputText&quot;</span>: &#123;</span><br><span class="line">            <span class="string">&quot;text&quot;</span>: <span class="string">&quot;附近的酒店&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="string">&quot;inputImage&quot;</span>: &#123;</span><br><span class="line">            <span class="string">&quot;url&quot;</span>: <span class="string">&quot;imageUrl&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="string">&quot;selfInfo&quot;</span>: &#123;</span><br><span class="line">            <span class="string">&quot;location&quot;</span>: &#123;</span><br><span class="line">                <span class="string">&quot;city&quot;</span>: <span class="string">&quot;北京&quot;</span>,</span><br><span class="line">                <span class="string">&quot;province&quot;</span>: <span class="string">&quot;北京&quot;</span>,</span><br><span class="line">                <span class="string">&quot;street&quot;</span>: <span class="string">&quot;信息路&quot;</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="string">&quot;userInfo&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;apiKey&quot;</span>: <span class="string">&quot;ec961279f453459b9248f0aeb6600bbe&quot;</span>,</span><br><span class="line">        <span class="string">&quot;userId&quot;</span>: <span class="string">&quot;206379&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125; </span><br><span class="line">res = requests.post(url=url, json=data) <span class="comment"># JSON格式的请求，将数据赋给json参数</span></span><br><span class="line"><span class="built_in">print</span>(res.text)  </span><br></pre></td></tr></table></figure>

<p><strong>练习：</strong></p>
<ol>
<li>利用图灵聊天接口（GET） <code>http://www.tuling123.com/openapi/api?key=ec961279f453459b9248f0aeb6600bbe&amp;info=你好</code>，结合Python的input编写一个机器人聊天室</li>
<li>利用图灵查询接口（POST）<code>http://openapi.tuling123.com/openapi/api/v2</code>，封装一个实用的查询方法，查询你附近的美食等等</li>
</ol>
<h2 id="JSON类型解析"><a href="#JSON类型解析" class="headerlink" title="JSON类型解析#"></a>JSON类型解析<a target="_blank" rel="noopener" href="https://www.cnblogs.com/superhin/p/10338930.html#412108096">#</a></h2><h3 id="序列化和反序列化"><a href="#序列化和反序列化" class="headerlink" title="序列化和反序列化#"></a>序列化和反序列化<a target="_blank" rel="noopener" href="https://www.cnblogs.com/superhin/p/10338930.html#433310555">#</a></h3><p>程序中的对象，如Python中的字典、列表、函数、类等，都是存在内存中的，一旦断电就会消失，不方便传递或存储，所以我们需要将内存中的对象转化为文本或者文件格式，来满足传输和持久化（存储）需求</p>
<ul>
<li>序列化： 内存对象 -&gt; 文本/文件</li>
<li>反序列化： 文本 -&gt; 内存对象</li>
</ul>
<p><strong>对象在HTTP中的传输过程</strong><br>HTTP协议是超文本传输协议，是通过文本或二进制进行传输的，所以我们发送的请求要转化成文本进行传输，收到的响应也是文本格式，如果是JSON，一般还需要将文本格式重新转化为对象</p>
<p>JSON对象（Python字典） -&gt; 转为文本请求 -&gt; 发送请求<br>-&gt; 服务器收到文本请求 -&gt; 将文本请求转化为对象，获取其中的参数，处理业务<br>-&gt; 返回文本格式的响应 -&gt; 客户端转为对象格式来从响应中取值</p>
<h3 id="JSON对象与Python字典的区别"><a href="#JSON对象与Python字典的区别" class="headerlink" title="JSON对象与Python字典的区别#"></a>JSON对象与Python字典的区别<a target="_blank" rel="noopener" href="https://www.cnblogs.com/superhin/p/10338930.html#2126075627">#</a></h3><p>JSON对象是javascript object即javascript中的对象，是一种通用的格式，格式严格，不支持备注。</p>
<p><strong>JSON文本和JSON对象的区别：</strong></p>
<ul>
<li>JSON文本是符合JSON格式的文本，实际上是一个字符串</li>
<li>JSON对象是内存中一个对象，拥有属性和方法，可以通过对象获取其中的参数信息</li>
</ul>
<blockquote>
<p>Python中我们一般提到JSON对象指的是字典</p>
</blockquote>
<p>Python的字典的格式和JSON格式，稍有不同：</p>
<ul>
<li>字典中的引号支持单引号和双引号，JSON格式只支持双引号</li>
<li>字典中的True/False首字母大写，JSON格式为true/false</li>
<li>字典中的空值为None, JSON格式为null</li>
</ul>
<h3 id="JSON格式操作方法"><a href="#JSON格式操作方法" class="headerlink" title="JSON格式操作方法#"></a>JSON格式操作方法<a target="_blank" rel="noopener" href="https://www.cnblogs.com/superhin/p/10338930.html#2030795724">#</a></h3><ul>
<li>序列化（字典 -&gt; 文本/文件句柄）： json.dumps()/json.dump()</li>
<li>反序列化（文本/文件句柄 -&gt; 字典) : json.loads()/json.load()</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> json <span class="comment"># 需要导入JSON包</span></span><br><span class="line"></span><br><span class="line">data = &#123;<span class="string">&#x27;name&#x27;</span>: <span class="string">&#x27;张三&#x27;</span>, <span class="string">&#x27;password&#x27;</span>: <span class="string">&#x27;123456&#x27;</span>, <span class="string">&quot;male&quot;</span>: <span class="literal">True</span>, <span class="string">&quot;money&quot;</span>: <span class="literal">None</span>&#125; <span class="comment"># 字典格式</span></span><br><span class="line">str_data = json.dumps(data) <span class="comment"># 序列化，转化为合法的JSON文本（方便HTTP传输）</span></span><br><span class="line"><span class="built_in">print</span>(str_data)</span><br></pre></td></tr></table></figure>

<p>输出：<code>&#123;&quot;name&quot;: &quot;\u5f20\u4e09&quot;, &quot;password&quot;: &quot;123456&quot;, &quot;male&quot;: true, &quot;money&quot;: null&#125;</code></p>
<blockquote>
<p>json.dumps()支持将json文本格式化输出</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests </span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"></span><br><span class="line">res = requests.post(<span class="string">&quot;http://www.tuling123.com/openapi/api?key=ec961279f453459b9248f0aeb6600bbe&amp;info=怎么又是你&quot;</span>) </span><br><span class="line"><span class="built_in">print</span>(res.text) <span class="comment"># 输出为一行文本</span></span><br><span class="line">res_dict = res.json() <span class="comment"># 将响应转为json对象（字典）等同于`json.loads(res.text)`</span></span><br><span class="line"><span class="built_in">print</span>(json.dumps(res_dict, indent=<span class="number">2</span>, sort_keys=<span class="literal">True</span>, ensure_ascii=<span class="literal">False</span>)) <span class="comment"># 重新转为文本</span></span><br></pre></td></tr></table></figure>

<p>看一下输出结果对比：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#123;&quot;code&quot;:100000,&quot;text&quot;:&quot;我才要说怎么又是你&quot;&#125;  # res.text，有些接口中文会返回为\u..</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;code&quot;</span>: <span class="number">100000</span>,</span><br><span class="line">  <span class="attr">&quot;text&quot;</span>: <span class="string">&quot;我才要说怎么又是你&quot;</span>  # 树状格式，比较清晰，显示中文</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>indent: 缩进空格数，indent=0输出为一行</li>
<li>sork_keys=True: 将json结果的key按ascii码排序</li>
<li>ensure_ascii=Fasle: 不确保ascii码，如果返回格式为utf-8包含中文，不转化为\u…</li>
</ul>
<p><strong>反序列化</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> json</span><br><span class="line"></span><br><span class="line">res_text = &#123;<span class="string">&quot;name&quot;</span>: <span class="string">&quot;\u5f20\u4e09&quot;</span>, <span class="string">&quot;password&quot;</span>: <span class="string">&quot;123456&quot;</span>, <span class="string">&quot;male&quot;</span>: true, <span class="string">&quot;money&quot;</span>: null&#125;  <span class="comment"># JSON文本格式的响应信息</span></span><br><span class="line">res_dict = json.loads(res_text) <span class="comment"># 转化为字典 </span></span><br><span class="line"><span class="built_in">print</span>(res_dict[<span class="string">&#x27;name&#x27;</span>])  <span class="comment"># 方便获取其中的参数值</span></span><br></pre></td></tr></table></figure>

<p>输出：<code>张三</code></p>
<p><strong>文件的序列化与反序列化</strong></p>
<ol>
<li>序列化：字典 -&gt; 文件句柄</li>
</ol>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> json</span><br><span class="line"></span><br><span class="line">res_dict = &#123;<span class="string">&#x27;name&#x27;</span>: <span class="string">&#x27;张三&#x27;</span>, <span class="string">&#x27;password&#x27;</span>: <span class="string">&#x27;123456&#x27;</span>, <span class="string">&quot;male&quot;</span>: <span class="literal">True</span>, <span class="string">&quot;money&quot;</span>: <span class="literal">None</span>&#125; <span class="comment"># 字典格式</span></span><br><span class="line">f = <span class="built_in">open</span>(<span class="string">&quot;demo1.json&quot;</span>,<span class="string">&quot;w&quot;</span>)</span><br><span class="line">json.dump(res_dict, f)</span><br></pre></td></tr></table></figure>

<p>查看同级目录，增加了一个demo1.json文件,内容为：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="attr">&quot;name&quot;</span>: <span class="string">&quot;\u5f20\u4e09&quot;</span>, <span class="attr">&quot;password&quot;</span>: <span class="string">&quot;123456&quot;</span>, <span class="attr">&quot;male&quot;</span>: <span class="literal">true</span>, <span class="attr">&quot;money&quot;</span>: <span class="literal">null</span>&#125;</span><br></pre></td></tr></table></figure>

<ol>
<li>序列化： 文件句柄 -&gt; 字典</li>
</ol>
<p>在项目中（和下面脚本文件同一路径下）新建<code>demo2.json</code>文件，内容如下，保存</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;name&quot;</span>: <span class="string">&quot;张三&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;password&quot;</span>: <span class="string">&quot;123456&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;male&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="attr">&quot;money&quot;</span>: <span class="literal">null</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>新建Python文件</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> json</span><br><span class="line"></span><br><span class="line">f = <span class="built_in">open</span>(<span class="string">&quot;demo.JSON&quot;</span>,<span class="string">&quot;r&quot;</span>, encoding=<span class="string">&quot;utf-8&quot;</span>)  <span class="comment"># 文件中有中文需要指定编码</span></span><br><span class="line">f_dict = json.load(f) <span class="comment"># 反序列化将文件句柄转化为字典</span></span><br><span class="line"><span class="built_in">print</span>(f[<span class="string">&#x27;name&#x27;</span>]) <span class="comment"># 读取其中参数</span></span><br><span class="line">f.close()</span><br></pre></td></tr></table></figure>

<p><strong>什么时候使用JSON对象（字典）什么时候使用JSON文本？</strong><br>一般在组装data参数时，建议使用字典格式，发送请求时用<code>json.dumps(data)</code>转化为文本发送，收到请求后使用<code>json.loads(res.text)</code>转化为字典，方便我们获取其中的参数信息<br><strong>练习：</strong></p>
<ol>
<li>解析以下json格式文件，发送请求并打印响应</li>
</ol>
<p>注： method支持get和post，如果没有method，有data默认发post请求，没有data默认发get请求，type支持：form或json，没有默认发form格式<br><em>demo1.json</em></p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;url&quot;</span>: <span class="string">&quot;http://www.tuling123.com/openapi/api&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;method&quot;</span>: <span class="string">&quot;get&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;params&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;key&quot;</span>: <span class="string">&quot;ec961279f453459b9248f0aeb6600bbe&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;info&quot;</span>: <span class="string">&quot;你好&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><em>demo2.json</em></p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;url&quot;</span>: <span class="string">&quot;http://openapi.tuling123.com/openapi/api/v2&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;method&quot;</span>: <span class="string">&quot;post&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;type&quot;</span>: <span class="string">&quot;json&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;data&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;reqType&quot;</span>: <span class="number">0</span>,</span><br><span class="line">    <span class="attr">&quot;perception&quot;</span>: &#123;</span><br><span class="line">      <span class="attr">&quot;inputText&quot;</span>: &#123;</span><br><span class="line">        <span class="attr">&quot;text&quot;</span>: <span class="string">&quot;附近的酒店&quot;</span></span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">&quot;inputImage&quot;</span>: &#123;</span><br><span class="line">        <span class="attr">&quot;url&quot;</span>: <span class="string">&quot;imageUrl&quot;</span></span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">&quot;selfInfo&quot;</span>: &#123;</span><br><span class="line">        <span class="attr">&quot;location&quot;</span>: &#123;</span><br><span class="line">          <span class="attr">&quot;city&quot;</span>: <span class="string">&quot;北京&quot;</span>,</span><br><span class="line">          <span class="attr">&quot;province&quot;</span>: <span class="string">&quot;北京&quot;</span>,</span><br><span class="line">          <span class="attr">&quot;street&quot;</span>: <span class="string">&quot;信息路&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">&quot;userInfo&quot;</span>: &#123;</span><br><span class="line">      <span class="attr">&quot;apiKey&quot;</span>: <span class="string">&quot;ec961279f453459b9248f0aeb6600bbe&quot;</span>,</span><br><span class="line">      <span class="attr">&quot;userId&quot;</span>: <span class="string">&quot;206379&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="requests库详解"><a href="#requests库详解" class="headerlink" title="requests库详解#"></a>requests库详解<a target="_blank" rel="noopener" href="https://www.cnblogs.com/superhin/p/10338930.html#4151157499">#</a></h2><h3 id="请求方法-1"><a href="#请求方法-1" class="headerlink" title="请求方法#"></a>请求方法<a target="_blank" rel="noopener" href="https://www.cnblogs.com/superhin/p/10338930.html#2908766635">#</a></h3><ul>
<li>requests.get()</li>
<li>requests.post()</li>
<li>requests.put()<br>…</li>
<li>requests.session(): 用于保持会话（session）<br>除了requests.session()外，其他请求方法的参数都差不多，都包含url，params, data, headers, cookies, files, auth, timeout等等</li>
</ul>
<h3 id="请求参数"><a href="#请求参数" class="headerlink" title="请求参数#"></a>请求参数<a target="_blank" rel="noopener" href="https://www.cnblogs.com/superhin/p/10338930.html#346469101">#</a></h3><ul>
<li>url: 字符串格式，参数也可以直接写到url中</li>
<li>params：url参数，字典格式</li>
<li>data: 请求数据，字典或字符串格式</li>
<li>headers: 请求头，字典格式</li>
<li>cookies: 字典格式，可以通过携带cookies绕过登录</li>
<li>files: 字典格式，用于混合表单（form-data）中上传文件</li>
<li>auth: Basic Auth授权，数组格式 <code>auth=(user,password)</code></li>
<li>timeout: 超时时间（防止请求一直没有响应，最长等待时间），数字格式，单位为秒</li>
</ul>
<h3 id="响应解析"><a href="#响应解析" class="headerlink" title="响应解析#"></a>响应解析<a target="_blank" rel="noopener" href="https://www.cnblogs.com/superhin/p/10338930.html#765363214">#</a></h3><ul>
<li>res.status_code: 响应的HTTP状态码</li>
<li>res.reason: 响应的状态码含义</li>
<li>req.text：响应的文本格式，按req.encoding解码</li>
<li>req.content: 响应的二进制格式</li>
<li>req.encoding: 解码格式，可以通过修改<code>req.encoding=&#39;utf-8&#39;</code>来解决一部分中文乱码问题</li>
<li>req.apparent_encoding：真实编码，由chardet库提供的明显编码</li>
<li>req.json(): （注意，有括号），响应的json对象（字典）格式，慎用！如果响应文本不是合法的json文本，或报错</li>
<li>req.headers: 响应头</li>
<li>req.cookies: 响应的cookieJar对象，可以通过<code>req.cookies.get(key)</code>来获取响应cookies中某个key对应的值<br>…<br>示例：</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests </span><br><span class="line"></span><br><span class="line">res = requests.get(<span class="string">&quot;https://www.baidu.com&quot;</span>) </span><br><span class="line"><span class="built_in">print</span>(res.status_code, res.reason) <span class="comment"># 200 OK</span></span><br><span class="line"><span class="built_in">print</span>(res.text) <span class="comment"># 文本格式，有乱码</span></span><br><span class="line"><span class="built_in">print</span>(res.content) <span class="comment"># 二进制格式</span></span><br><span class="line"><span class="built_in">print</span>(res.encoding) <span class="comment"># 查看解码格式 ISO-8859-1</span></span><br><span class="line"><span class="built_in">print</span>(res.apparent_encoding) <span class="comment"># utf-8</span></span><br><span class="line">res.encoding=<span class="string">&#x27;utf-8&#x27;</span> <span class="comment"># 手动设置解码格式为utf-8</span></span><br><span class="line"><span class="built_in">print</span>(res.text) <span class="comment"># 乱码问题被解决</span></span><br><span class="line"><span class="built_in">print</span>(res.cookies.items()) <span class="comment"># cookies中的所有的项 [(&#x27;BDORZ&#x27;, &#x27;27315&#x27;)]</span></span><br><span class="line"><span class="built_in">print</span>(res.cookies.get(<span class="string">&quot;BDORZ&quot;</span>)) <span class="comment"># 获取cookies中BDORZ所对应的值 27315</span></span><br></pre></td></tr></table></figure>

<p>详情参考:<a target="_blank" rel="noopener" href="http://www.cnblogs.com/zhangxinqi/p/9201594.html">Py.qi: python3之requests</a></p>
<h2 id="带安全认证的请求"><a href="#带安全认证的请求" class="headerlink" title="带安全认证的请求#"></a>带安全认证的请求<a target="_blank" rel="noopener" href="https://www.cnblogs.com/superhin/p/10338930.html#697726014">#</a></h2><h3 id="需要登录的请求（Cookie-Session认证）"><a href="#需要登录的请求（Cookie-Session认证）" class="headerlink" title="需要登录的请求（Cookie/Session认证）#"></a>需要登录的请求（Cookie/Session认证）<a target="_blank" rel="noopener" href="https://www.cnblogs.com/superhin/p/10338930.html#2634416847">#</a></h3><p>例如：<br>直接访问: <a target="_blank" rel="noopener" href="https://demo.fastadmin.net/admin/dashboard?ref=addtabs">https://demo.fastadmin.net/admin/dashboard?ref=addtabs</a><br>页面（页面可以看做一个返回html代码的GET请求）会提示请登录后操作<br>登录页面：<a target="_blank" rel="noopener" href="https://demo.fastadmin.net/admin/index/login.html">https://demo.fastadmin.net/admin/index/login.html</a> 用户名/密码：admin/123456（POST表单请求）<br><a target="_blank" rel="noopener" href="https://upload-images.jianshu.io/upload_images/7575721-a7f34ec31cb6d121.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">![未登录访问接口](Python Restful.assets/7575721-a7f34ec31cb6d121.png)</a></p>
<ol>
<li>使用会话保持</li>
</ol>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">s = requests.session() <span class="comment"># 新建一个会话</span></span><br><span class="line">s.post(url=<span class="string">&quot;https://demo.fastadmin.net/admin/index/login.html&quot;</span>,data=&#123;<span class="string">&quot;username&quot;</span>:<span class="string">&quot;admin&quot;</span>,<span class="string">&quot;password&quot;</span>:<span class="string">&quot;123456&quot;</span>&#125;) <span class="comment"># 发送登录请求</span></span><br><span class="line">res = s.get(<span class="string">&quot;https://demo.fastadmin.net/admin/dashboard?ref=addtabs&quot;</span>) <span class="comment"># 使用同一个会话发送get请求，可以保持登录状态</span></span><br><span class="line"><span class="built_in">print</span>(res.text)</span><br></pre></td></tr></table></figure>

<blockquote>
<p>如果不使用session()而单独发一个post登录请求一个get请求是否可以呢？你可以自己试一下（requests.get()或post()每次都会建立一个新会话）</p>
</blockquote>
<ol>
<li>抓取cookies<ol>
<li>使用Chrome浏览器访问<a target="_blank" rel="noopener" href="https://demo.fastadmin.net/admin/index/login.html%EF%BC%8C%E7%99%BB%E5%BD%95">https://demo.fastadmin.net/admin/index/login.html，登录</a></li>
<li>打开开发者工具刷新当前页面（<a target="_blank" rel="noopener" href="https://demo.fastadmin.net/admin/index/login.html%EF%BC%89">https://demo.fastadmin.net/admin/index/login.html）</a></li>
<li>Network面包查看当前请求，将cookie后面的值复制出来，组装成字典格式</li>
</ol>
</li>
</ol>
<p><a target="_blank" rel="noopener" href="https://upload-images.jianshu.io/upload_images/7575721-9f67524b690545d5.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">![抓取cookies](Python Restful.assets/7575721-9f67524b690545d5.png)</a></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;https://demo.fastadmin.net/admin/dashboard?ref=addtabs&quot;</span></span><br><span class="line">cookies = &#123;<span class="string">&quot;PHPSESSID&quot;</span>:<span class="string">&quot;9bf6b19ddb09938cf73d55a094b36726&quot;</span>&#125;</span><br><span class="line">res = requests.get(url=url, cookies=cookies) <span class="comment"># 携带cookies发送请求</span></span><br><span class="line"><span class="built_in">print</span>(res.text)</span><br></pre></td></tr></table></figure>

<p><strong>两种方式的对比</strong></p>
<ul>
<li>使用session方式：每次都要发送两次请求，效率较低</li>
<li>使用携带cookies方式：需要手动抓包，提取组装，cookies中是session有一定有效期，过期之后要重新抓取和更换cookies</li>
<li>如果很多或所有请求都需要登录，可以发一次请求，保持该session为全局变量，其他接口都使用该session发送请求（同样要注意登录过期时间）<br><strong>练习</strong></li>
</ul>
<ol>
<li>抓包并用脚本发一条微博或一篇博客</li>
</ol>
<h3 id="appid或token方式"><a href="#appid或token方式" class="headerlink" title="appid或token方式#"></a>appid或token方式<a target="_blank" rel="noopener" href="https://www.cnblogs.com/superhin/p/10338930.html#1911028442">#</a></h3><ul>
<li>appid: 系统为合法用户赋予的访问id，固定的字符串，一般经过加密以确保HTTP传输中的安全</li>
<li>token: 即令牌，固定或需要动态申请（有一定有效期），一般由用户信息及申请时间计算加密而成，用于验证接口访问的权限</li>
</ul>
<p><strong>token与session的区别</strong></p>
<ul>
<li>session是存在服务器的，服务端通过验证客户端的请求所携带的session值在服务会话中是否存在，来验证用户是否合法</li>
<li>token: 是按一定算法加密计算出来的，服务端通过解密客户端所携带的token值来验证用户是否合法<br>**示例： **</li>
<li>访问百度AI开发者平台：<a target="_blank" rel="noopener" href="http://ai.baidu.com/%EF%BC%8C%E6%B3%A8%E5%86%8C%E5%B9%B6%E7%99%BB%E5%BD%95%EF%BC%8C%E6%88%90%E4%B8%BA%E5%BC%80%E5%8F%91%E8%80%85%EF%BC%8C%E9%80%89%E6%8B%A9%E6%96%87%E5%AD%97%E8%AF%86%E5%88%AB">http://ai.baidu.com/，注册并登录，成为开发者，选择文字识别</a></li>
<li>文字识别开发者文档：<a target="_blank" rel="noopener" href="http://ai.baidu.com/docs#/OCR-API/top">http://ai.baidu.com/docs#/OCR-API/top</a></li>
<li>根据文档新建应用，查看自己的App Key和Secret Key</li>
</ul>
<p><a target="_blank" rel="noopener" href="https://upload-images.jianshu.io/upload_images/7575721-d9b9e34794e314c0.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">![创建应用](Python Restful.assets/7575721-d9b9e34794e314c0.png)</a></p>
<ul>
<li>参考文档：<a target="_blank" rel="noopener" href="http://ai.baidu.com/docs#/Auth/top%EF%BC%8C%E4%BD%BF%E7%94%A8App">http://ai.baidu.com/docs#/Auth/top，使用App</a> Key和Secret Key获取token</li>
</ul>
<p><a target="_blank" rel="noopener" href="https://upload-images.jianshu.io/upload_images/7575721-a370deafc79da451.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">![获取token](Python Restful.assets/7575721-a370deafc79da451.png)</a></p>
<ul>
<li>参考通用文字接口文档： <a target="_blank" rel="noopener" href="http://ai.baidu.com/docs#/OCR-API/top">http://ai.baidu.com/docs#/OCR-API/top</a></li>
</ul>
<p><a target="_blank" rel="noopener" href="https://upload-images.jianshu.io/upload_images/7575721-cb9ea9ce352e1cad.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">![通用文字接口](Python Restful.assets/7575721-cb9ea9ce352e1cad.png)</a></p>
<ul>
<li>从网络上找一张带文字的图片，右键，复制图片地址（注意不支持https地址的图片）</li>
</ul>
<p><a target="_blank" rel="noopener" href="https://upload-images.jianshu.io/upload_images/7575721-40c847532432e852.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">![带文字的图片](Python Restful.assets/7575721-40c847532432e852.png)</a></p>
<p><a target="_blank" rel="noopener" href="https://upload-images.jianshu.io/upload_images/7575721-808d2c1b9525c64d.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">![请求结果](Python Restful.assets/7575721-808d2c1b9525c64d.png)</a></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"></span><br><span class="line">app_key = <span class="string">&#x27;kPoFYw85FXsnojsy5bB9hu6x&#x27;</span></span><br><span class="line">secret_key = <span class="string">&#x27;l7SuGBkDQHkjiTPU3m6NaNddD6SCvDMC&#x27;</span></span><br><span class="line">img_url = <span class="string">&#x27;//upload-images.jianshu.io/upload_images/7575721-40c847532432e852.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240&#x27;</span></span><br><span class="line"><span class="comment"># 获取token</span></span><br><span class="line">get_token_url = <span class="string">&#x27;https://aip.baidubce.com/oauth/2.0/token?grant_type=client_credentials&amp;client_id=&#123;&#125;&amp;client_secret=&#123;&#125;&#x27;</span>.<span class="built_in">format</span>(app_key,secret_key)</span><br><span class="line">token = requests.get(url=get_token_url).json().get(<span class="string">&quot;access_token&quot;</span>)  <span class="comment"># 从获取token接口的响应中取得token值</span></span><br><span class="line"><span class="comment"># 识别图片文字</span></span><br><span class="line">orc_url = <span class="string">&#x27;https://aip.baidubce.com/rest/2.0/ocr/v1/general_basic?access_token=&#123;&#125;&#x27;</span>.<span class="built_in">format</span>(token)</span><br><span class="line">data = &#123;<span class="string">&quot;url&quot;</span>: img_url&#125;</span><br><span class="line">res = requests.post(url=orc_url, data=data)</span><br><span class="line"><span class="built_in">print</span>(json.dumps(res.json(), indent=<span class="number">2</span>, ensure_ascii=<span class="literal">False</span>)) <span class="comment"># 格式化输出</span></span><br></pre></td></tr></table></figure>

<p>显示结果：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;log_id&quot;</span>: <span class="number">4745549456768330559</span>,</span><br><span class="line">  <span class="attr">&quot;words_result_num&quot;</span>: <span class="number">6</span>,</span><br><span class="line">  <span class="attr">&quot;words_result&quot;</span>: [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">&quot;words&quot;</span>: <span class="string">&quot;我又问:那么何时,你带我回去?&quot;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">&quot;words&quot;</span>: <span class="string">&quot;莲师言:你是你,我是我。你若不愿流连凡尘,自会回去。&quot;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">&quot;words&quot;</span>: <span class="string">&quot;我问莲师:我从哪里来,要到哪里去?&quot;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">&quot;words&quot;</span>: <span class="string">&quot;莲师言:世间种种变相,皆有起源。来与去皆是命中定数,不可参度。&quot;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">&quot;words&quot;</span>: <span class="string">&quot;我再问:我是否还会再见到你?&quot;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">&quot;words&quot;</span>: <span class="string">&quot;莲师言:你若心中有我,自然会再见。&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>练习：</strong></p>
<ol>
<li>自己注册任意一个开发者平台（微信开发者平台，百度开发者平台，饿了么开发者平台），创建应用，根据相应的授权方式获取token，并使用token正常访问一个接口</li>
</ol>
<h3 id="开放协议授权"><a href="#开放协议授权" class="headerlink" title="开放协议授权#"></a>开放协议授权<a target="_blank" rel="noopener" href="https://www.cnblogs.com/superhin/p/10338930.html#3097605131">#</a></h3><p>reqeusts支持Basic Auth（基本授权）和Digist Auth（摘要授权）</p>
<blockquote>
<p>Oauth1.0 Oauth2.0 参考: <a target="_blank" rel="noopener" href="http://cn.python-requests.org/zh_CN/latest/user/authentication.html">requests官方文档</a><br><a target="_blank" rel="noopener" href="https://upload-images.jianshu.io/upload_images/7575721-8df1ff33c5ed97b1.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">![Basic Auth](Python Restful.assets/7575721-8df1ff33c5ed97b1.png)</a></p>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"></span><br><span class="line"><span class="comment"># 基本授权可以直接在请求方法中使用`auth = (user,password)`</span></span><br><span class="line">res = requests.get(<span class="string">&quot;https://api.github.com/user&quot;</span>, auth=(<span class="string">&quot;hanzhichao&quot;</span>, <span class="string">&quot;hanzhichao123&quot;</span>))</span><br><span class="line"><span class="built_in">print</span>(json.dumps(res.json(), indent=<span class="number">2</span>, ensure_ascii=<span class="literal">False</span>))  <span class="comment"># 格式化输出 </span></span><br></pre></td></tr></table></figure>

<h3 id="数字签名"><a href="#数字签名" class="headerlink" title="数字签名#"></a>数字签名<a target="_blank" rel="noopener" href="https://www.cnblogs.com/superhin/p/10338930.html#813460275">#</a></h3><p>无论是cookie/session还是appid/token方式，只用来验证请求者身份而不验证参数，因此无法防止请求参数被抓包拦截后篡改（仍携带合法的cookie或token）<br>数字签名（sign或sig）是用来对原始参数整体进行加密后生成的一个字符串，请求时参数和签名一期发送，服务器收到请求后对参数再次计算签名核对和所携带的签名是否一致。<br>例如： 原始签名{}</p>
<h1 id="Python接口测试实战3（上）-Python操作数据库"><a href="#Python接口测试实战3（上）-Python操作数据库" class="headerlink" title="Python接口测试实战3（上）- Python操作数据库"></a><a target="_blank" rel="noopener" href="https://www.cnblogs.com/superhin/p/10338985.html">Python接口测试实战3（上）- Python操作数据库</a></h1><h2 id="课程目录-1"><a href="#课程目录-1" class="headerlink" title="课程目录#"></a>课程目录<a target="_blank" rel="noopener" href="https://www.cnblogs.com/superhin/p/10338985.html#4059836774">#</a></h2><p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/superhin/p/10338915.html">Python接口测试实战1（上）- 接口测试理论</a><br><a target="_blank" rel="noopener" href="https://www.cnblogs.com/superhin/p/10338924.html">Python接口测试实战1（下）- 接口测试工具的使用</a><br><a target="_blank" rel="noopener" href="https://www.cnblogs.com/superhin/p/10338930.html">Python接口测试实战2 - 使用Python发送请求</a><br><a target="_blank" rel="noopener" href="https://www.cnblogs.com/superhin/p/10338985.html">Python接口测试实战3（上）- Python操作数据库</a><br><a target="_blank" rel="noopener" href="https://www.cnblogs.com/superhin/p/10338993.html">Python接口测试实战3（下）- unittest测试框架</a><br><a target="_blank" rel="noopener" href="https://www.cnblogs.com/superhin/p/10339002.html">Python接口测试实战4（上） - 接口测试框架实战</a><br><a target="_blank" rel="noopener" href="https://www.cnblogs.com/superhin/p/10339009.html">Python接口测试实战4（下） - 框架完善：用例基类，用例标签，重新运行上次失败用例</a><br><a target="_blank" rel="noopener" href="https://www.cnblogs.com/superhin/p/10339016.html">Python接口测试实战5（上） - Git及Jenkins持续集成</a><br><a target="_blank" rel="noopener" href="https://www.cnblogs.com/superhin/p/10339004.html">Python接口测试实战5（下） - RESTful、Web Service及Mock Server</a></p>
<blockquote>
<p>更多学习资料请加添加作者微信：lockingfree获取<br>PDF下载：链接:<a target="_blank" rel="noopener" href="https://pan.baidu.com/s/1OwAa8nl1eeBj8fcrgd3sBA">https://pan.baidu.com/s/1OwAa8nl1eeBj8fcrgd3sBA</a> 密码:e9d8</p>
</blockquote>
<h2 id="本节内容-2"><a href="#本节内容-2" class="headerlink" title="本节内容#"></a>本节内容<a target="_blank" rel="noopener" href="https://www.cnblogs.com/superhin/p/10338985.html#3168935925">#</a></h2><ul>
<li>数据库操作</li>
<li>封装数据库操作</li>
</ul>
<h2 id="前言"><a href="#前言" class="headerlink" title="前言#"></a>前言<a target="_blank" rel="noopener" href="https://www.cnblogs.com/superhin/p/10338985.html#2935540700">#</a></h2><p>在功能、接口测试中常常需要通过数据库的操作，来准备数据、检测环境及核对功能、接口的数据库操作是否正确。<br>在自动化测试中，就需要我们用代码连接数据库自动完成数据准备、环境检查及数据库断言的功能。<br>使用Python操作MySQL数据库这里我们需要用到三方库<code>PyMySQl</code></p>
<blockquote>
<p>安装方法：<code>pip install pymysql</code></p>
</blockquote>
<h2 id="数据库操作"><a href="#数据库操作" class="headerlink" title="数据库操作#"></a>数据库操作<a target="_blank" rel="noopener" href="https://www.cnblogs.com/superhin/p/10338985.html#1718266286">#</a></h2><ol>
<li>建立数据库连接 <code>conn = pymysql.connect()</code></li>
<li>从连接建立操作游标 <code>cur = conn.cursor()</code></li>
<li>使用游标执行sql（读/写） <code>cur.execute(sql)</code></li>
<li>获取结果（读）/ 提交更改（写） <code>cur.fetchall()</code> / <code>conn.commit()</code></li>
<li>关闭游标及连接 <code>cur.close();conn.close()</code></li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">Copyimport pymysql</span><br><span class="line"></span><br><span class="line"># 1. 建立连接</span><br><span class="line">conn &#x3D; pymysql.connect(host&#x3D;&#39;127.0.0.1&#39;,</span><br><span class="line">                    port&#x3D;3306,</span><br><span class="line">                    user&#x3D;&#39;root&#39;,</span><br><span class="line">                    passwd&#x3D;&#39;123456&#39;,   # password也可以</span><br><span class="line">                    db&#x3D;&#39;api_test&#39;,</span><br><span class="line">                    charset&#x3D;&#39;utf8&#39;)   # 如果查询有中文需要指定数据库编码</span><br><span class="line">                    </span><br><span class="line"># 2. 从连接建立游标（有了游标才能操作数据库）</span><br><span class="line">cur &#x3D; conn.cursor()</span><br><span class="line"></span><br><span class="line"># 3. 查询数据库（读）</span><br><span class="line">cur.execute(&quot;select * from user where name&#x3D;&#39;张三&#39;&quot;)</span><br><span class="line"></span><br><span class="line"># 4. 获取查询结果</span><br><span class="line">result &#x3D; cur.fetchall()</span><br><span class="line">print(result)</span><br><span class="line"></span><br><span class="line"># 3. 更改数据库（写）</span><br><span class="line">cur.execute(&quot;delete from user where name&#x3D;&#39;李四&#39;&quot;)</span><br><span class="line"></span><br><span class="line"># 4. 提交更改</span><br><span class="line">conn.commit()  # 注意是用的conn不是cur</span><br><span class="line"></span><br><span class="line"># 5. 关闭游标及连接</span><br><span class="line">cur.close()</span><br><span class="line">conn.close()</span><br></pre></td></tr></table></figure>

<blockquote>
<p>什么是游标？ 游标类似文件句柄，可以逐条的访问数据库执行结果集。pymysql中只能通过游标来执行sql和获取结果</p>
</blockquote>
<p><strong>查询操作</strong><br>使用cur.execute(), 执行数据库查询后无返回的是影响的行数，而非查询结果。我们要使用<code>cur.fetchone()/cur.fetchmany()/cur.fetchall()</code>来获取查询结果</p>
<ul>
<li>cur.fetchone(): 获取一条数据（同时获取的数据会从结果集删除），返回元祖<code>(&#39;张三&#39;,&#39;123456&#39;)</code></li>
<li>cur.fetchmany(3): 获取多条数据，返回嵌套元祖<code>((&#39;张三&#39;,&#39;123456&#39;),(&#39;李四&#39;,&#39;123456&#39;),(&quot;王五&quot;,&quot;123456&quot;))</code></li>
<li>cur.fetchall(): 获取所有数据，返回嵌套元祖，<code>((&#39;张三&#39;,&#39;123456&#39;),)</code>（只有一条数据时）</li>
</ul>
<p><strong>注意：</strong> 获取完数据后，数据会从数据集中删除，再次获取获取不到，如：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Copycur.execute(select * from user where name&#x3D;&#39;张三&#39;)</span><br><span class="line">print(cur.fetchone()) # 结果： (&#39;张三&#39;,&#39;123456&#39;)</span><br><span class="line">print(cur.fetchone()) # 结果：None</span><br><span class="line">print(cur.fetchall()) # 结果：()</span><br></pre></td></tr></table></figure>

<p>所以我们需要重复使用查询结果时，需要将查询结果赋给某个变量</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Copycur.execute(select * from user where name&#x3D;&#39;张三&#39;)</span><br><span class="line">result &#x3D; cur.fetchall()</span><br><span class="line">print(result)  # 结果： (&#39;张三&#39;,&#39;123456&#39;)</span><br><span class="line">print(result)  # 结果： (&#39;张三&#39;,&#39;123456&#39;)</span><br></pre></td></tr></table></figure>

<p><strong>修改操作</strong><br>执行修改数据库的操作后不立即生效，使用连接<code>conn.commit()</code>提交后才生效，支持事物及回滚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Copytry:</span><br><span class="line">    cur.execute(&quot;insert into user (name,password) values (&#39;张三&#39;, &#39;123456&#39;)&quot;)</span><br><span class="line">    cur.execute(&quot;insert into user (name, passwd) values (&#39;李四&#39;), &#39;123456&#39;&quot;) # 此处sql出错</span><br><span class="line">    conn.commit()  # 使用连接提交所有更改</span><br><span class="line">except Exception as e:</span><br><span class="line">    conn.rollback()  # 回滚所有更改（注意用的是conn)</span><br><span class="line">    print(str(e))</span><br></pre></td></tr></table></figure>

<h2 id="封装数据库操作"><a href="#封装数据库操作" class="headerlink" title="封装数据库操作#"></a>封装数据库操作<a target="_blank" rel="noopener" href="https://www.cnblogs.com/superhin/p/10338985.html#1696663650">#</a></h2><p>由于经常要使用到数据库操作，建议将所有数据库操作封装成公用的数据库模块</p>
<ol>
<li>新建db.py, 代码如下：</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line">Copyimport pymysql</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 获取连接方法</span><br><span class="line">import pymysql</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 获取连接方法</span><br><span class="line">def get_db_conn():</span><br><span class="line">    conn &#x3D; pymysql.connect(host&#x3D;&#39;127.0.0.1&#39;,</span><br><span class="line">                           port&#x3D;3306,</span><br><span class="line">                           user&#x3D;&#39;test&#39;,</span><br><span class="line">                           passwd&#x3D;&#39;123456&#39;,  </span><br><span class="line">                           db&#x3D;&#39;api_test&#39;,</span><br><span class="line">                           charset&#x3D;&#39;utf8&#39;)  # 如果查询有中文，需要指定测试集编码</span><br><span class="line"></span><br><span class="line">    return conn</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 封装数据库查询操作</span><br><span class="line">def query_db(sql):</span><br><span class="line">    conn &#x3D; get_db_conn()  # 获取连接</span><br><span class="line">    cur &#x3D; conn.cursor()  # 建立游标</span><br><span class="line">    cur.execute(sql)  # 执行sql</span><br><span class="line">    result &#x3D; cur.fetchall()  # 获取所有查询结果</span><br><span class="line">    cur.close()  # 关闭游标</span><br><span class="line">    conn.close()  # 关闭连接</span><br><span class="line">    return result  # 返回结果</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 封装更改数据库操作</span><br><span class="line">def change_db(sql):</span><br><span class="line">    conn &#x3D; get_db_conn()  # 获取连接</span><br><span class="line">    cur &#x3D; conn.cursor()  # 建立游标</span><br><span class="line">    try:</span><br><span class="line">        cur.execute(sql)  # 执行sql</span><br><span class="line">        conn.commit()  # 提交更改</span><br><span class="line">    except Exception as e:</span><br><span class="line">        conn.rollback()  # 回滚</span><br><span class="line">    finally:</span><br><span class="line">        cur.close()  # 关闭游标</span><br><span class="line">        conn.close()  # 关闭连接</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 封装常用数据库操作</span><br><span class="line">def check_user(name):</span><br><span class="line">    # 注意sql中&#39;&#39;号嵌套的问题</span><br><span class="line">    sql &#x3D; &quot;select * from user where name &#x3D; &#39;&#123;&#125;&#39;&quot;.format(name)</span><br><span class="line">    result &#x3D; query_db(sql)</span><br><span class="line">    return True if result else False</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def add_user(name, password):</span><br><span class="line">    sql &#x3D; &quot;insert into user (name, passwd) values (&#39;&#123;&#125;&#39;,&#39;&#123;&#125;&#39;)&quot;.format(name, password)</span><br><span class="line">    change_db(sql)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def del_user(name):</span><br><span class="line">    sql &#x3D; &quot;delete from user where name&#x3D;&#39;&#123;&#125;&#39;&quot;.format(name)</span><br><span class="line">    change_db(sql)</span><br></pre></td></tr></table></figure>

<blockquote>
<p>相比用例中直接使用sql操作数据库，封装常用的数据库操作会更安全</p>
</blockquote>
<ol>
<li>调用方法(其他模块)</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Copyfrom db import *</span><br><span class="line"></span><br><span class="line">if check_user(&quot;张三&quot;):</span><br><span class="line">    del_user(&quot;张三&quot;)</span><br></pre></td></tr></table></figure>

<p><strong>补充：</strong>另一种封装方法</p>
<p>由于上面这种封装方法，每一次查询都会建立一次数据库连接，效率较低，也可以采用下面面向对象的封装方法</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">db2.py</span><br><span class="line">Copyimport pymysql</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">class DB:</span><br><span class="line">    def __init__(self):</span><br><span class="line">        self.conn &#x3D; pymysql.connect(host&#x3D;&#39;127.0.0.1&#39;,</span><br><span class="line">                    port&#x3D;3306,</span><br><span class="line">                    user&#x3D;&#39;root&#39;,</span><br><span class="line">                    passwd&#x3D;&#39;123456&#39;,   # passwd 不是 password</span><br><span class="line">                    db&#x3D;&#39;api_test&#39;)</span><br><span class="line">        self.cur &#x3D; self.conn.cursor()</span><br><span class="line">        </span><br><span class="line">    def __del__(self): # 析构函数，实例删除时触发</span><br><span class="line">        self.cur.close()</span><br><span class="line">        self.conn.close()</span><br><span class="line">        </span><br><span class="line">    def query(self, sql):</span><br><span class="line">        self.cur.execute(sql)</span><br><span class="line">        return self.cur.fetchall()</span><br><span class="line">    </span><br><span class="line">    def exec(self, sql):</span><br><span class="line">        try:</span><br><span class="line">            self.cur.execute(sql)</span><br><span class="line">            self.conn.commit()</span><br><span class="line">        except Exception as e:</span><br><span class="line">            self.conn.rollback()</span><br><span class="line">            print(str(e))</span><br><span class="line">    </span><br><span class="line">    def check_user(self,name):</span><br><span class="line">        result &#x3D; self.query(&quot;select * from user where name&#x3D;&#39;&#123;&#125;&#39;&quot;.format(name))</span><br><span class="line">        return True if result else False</span><br><span class="line">        </span><br><span class="line">    def del_user(self, name)</span><br><span class="line">        self.exec(&quot;delete from user where name&#x3D;&#39;&#123;&#125;&#39;&quot;.format(name))</span><br><span class="line">        </span><br></pre></td></tr></table></figure>

<p>使用方法</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Copyfrom db2 import DB:</span><br><span class="line"></span><br><span class="line">db &#x3D; DB()  # 实例化一个数据库操作对象</span><br><span class="line">if db.check_user(&quot;张三&quot;):</span><br><span class="line">    db.del_user(&quot;张三&quot;)</span><br></pre></td></tr></table></figure>

<h2 id="后言"><a href="#后言" class="headerlink" title="后言#"></a>后言<a target="_blank" rel="noopener" href="https://www.cnblogs.com/superhin/p/10338985.html#2535759092">#</a></h2><ul>
<li>数据库连接信息建议写到配置文件中，从配置文件中读取</li>
<li>sql语句建议先在手工测试一下没有语法问题再进行封装</li>
<li>通过封装各种sql可以完成各种业务操作</li>
<li>更改数据库有风险，操作需谨慎！！！</li>
</ul>
<h1 id="Python接口测试实战3（下）-unittest测试框架"><a href="#Python接口测试实战3（下）-unittest测试框架" class="headerlink" title="Python接口测试实战3（下）- unittest测试框架"></a><a target="_blank" rel="noopener" href="https://www.cnblogs.com/superhin/p/10338993.html">Python接口测试实战3（下）- unittest测试框架</a></h1><blockquote>
<p>更多学习资料请加QQ群: 822601020获取<br>PDF下载：链接:<a target="_blank" rel="noopener" href="https://pan.baidu.com/s/1OwAa8nl1eeBj8fcrgd3sBA">https://pan.baidu.com/s/1OwAa8nl1eeBj8fcrgd3sBA</a> 密码:e9d8</p>
</blockquote>
<h2 id="本节内容-3"><a href="#本节内容-3" class="headerlink" title="本节内容#"></a>本节内容<a target="_blank" rel="noopener" href="https://www.cnblogs.com/superhin/p/10338993.html#2665593693">#</a></h2><ul>
<li>unittest简介</li>
<li>用例编写</li>
<li>用例组织及运行</li>
<li>生成测试报告</li>
</ul>
<h2 id="unitttest简介"><a href="#unitttest简介" class="headerlink" title="unitttest简介#"></a>unitttest简介<a target="_blank" rel="noopener" href="https://www.cnblogs.com/superhin/p/10338993.html#3895470559">#</a></h2><blockquote>
<p>参考：<a target="_blank" rel="noopener" href="https://docs.python.org/2/library/unittest.html">unittest官方文档</a> <a target="_blank" rel="noopener" href="https://www.cnblogs.com/superhin/p/13278988.html">翻译版</a></p>
</blockquote>
<p><strong>为什么要使用unittest？</strong><br>在编写接口自动化用例时，我们一般针对一个接口建立一个.py文件，一条测试用例封装为一个函数（方法），但是在批量执行的过程中，如果其中一条出错，后面的用例就无法执行。使用测试框架可以互不影响的用例执行及更灵活的执行控制</p>
<p><strong>unittest特点</strong></p>
<ul>
<li>python自带的单元测试框架，无需安装</li>
<li>用例执行互不干扰</li>
<li>提供不同范围的setUp(测试准备)和tearDown(测试清理)方法</li>
<li>提供丰富的断言方法</li>
<li>可以通过discover批量执行所有模块的用例</li>
<li>可以通过TestSuite(测试集)灵活的组织用例</li>
</ul>
<p><strong>unittest几大组成部分</strong></p>
<ul>
<li>TestCase: 用例对象，编写测试用例时要继承该类，以具有TestCase的属性和方法</li>
<li>TestSuite: 测试集或测试套件，测试用例的集合，用来组织用例，支持嵌套</li>
<li>TestLoader: 用例加载器，用于向TestSuite中添加用例</li>
<li>TextTestRunner: 用例执行器（输出文本结果），一般以TestSuite为单位执行用例</li>
<li>TestResult: 测试结果</li>
</ul>
<h2 id="用例编写"><a href="#用例编写" class="headerlink" title="用例编写#"></a>用例编写<a target="_blank" rel="noopener" href="https://www.cnblogs.com/superhin/p/10338993.html#816614811">#</a></h2><ol>
<li>新建一个test_开头（必须）的.py文件，如<code>test_user_login.py</code></li>
<li>导入unittest</li>
<li>编写一个Test开头（必须）的类，并继承unittest.TestCase，做为测试类</li>
<li>在类中编写一个test_开头（必须）的方法，作为用例</li>
</ol>
<p><code>test_user_login.py</code> # 文件必须test_开头</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> unittest  <span class="comment"># 导入unittest</span></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TestUserLogin</span>(<span class="params">unittest.TestCase</span>):</span>  <span class="comment"># 类必须Test开头，继承TestCase才能识别为用例类</span></span><br><span class="line">    url = <span class="string">&#x27;http://115.28.108.130:5000/api/user/login/&#x27;</span></span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">test_user_login_normal</span>(<span class="params">self</span>):</span>   <span class="comment"># 一条测试用例，必须test_开头</span></span><br><span class="line">        data = &#123;<span class="string">&quot;name&quot;</span>: <span class="string">&quot;张三&quot;</span>, <span class="string">&quot;password&quot;</span>: <span class="string">&quot;123456&quot;</span>&#125;</span><br><span class="line">        res = requests.post(url=self.url, data=data)</span><br><span class="line">        self.assertIn(<span class="string">&#x27;登录成功&#x27;</span>, res.text)  <span class="comment"># 断言</span></span><br><span class="line">        </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">test_user_login_password_wrong</span>(<span class="params">self</span>):</span></span><br><span class="line">        data = &#123;<span class="string">&quot;name&quot;</span>: <span class="string">&quot;张三&quot;</span>, <span class="string">&quot;password&quot;</span>: <span class="string">&quot;1234567&quot;</span>&#125;</span><br><span class="line">        res = requests.post(url=self.url, data=data)</span><br><span class="line">        self.assertIn(<span class="string">&#x27;登录失败&#x27;</span>, res.text)  <span class="comment"># 断言</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:  <span class="comment"># 如果是直接从当前模块执行（非别的模块调用本模块）</span></span><br><span class="line">	unittest.main(verbosity=<span class="number">2</span>)    <span class="comment"># 运行本测试类所有用例,verbosity为结果显示级别</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>用例执行顺序：并非按书写顺序执行，而是按用例名ascii码先后顺序执行</p>
</blockquote>
<p><strong>用例断言</strong></p>
<p>unittest提供了丰富的断言方法，常用为以下几种：</p>
<ul>
<li>判断相等<ul>
<li>assertEqual(a,b)/assertNotEqual(a,b): 断言值是否相等</li>
<li>assertIs(a,b)/assertIsNot(a,b): 断言是否同一对象（内存地址一样）</li>
<li>assertListEqual(list1, list2)/assertItemNotEqual(list1, list2): 断言列表是否相等</li>
<li>assertDictEqual(dict1, dict2)/assertDictNotEqual(dict1, dict2): 断言字典是否相等</li>
</ul>
</li>
<li>是否为空<ul>
<li>assertIsNone(a)/assertIsNotNone(a)</li>
</ul>
</li>
<li>判断真假<ul>
<li>assertTrue(a)/assertFalse(a)</li>
</ul>
</li>
<li>是否包含<ul>
<li>assertIn(a,b)/assertNotIn(a,b) # b中是否包含a</li>
</ul>
</li>
<li>大小判断<ul>
<li>assertGreater(a,b)/assertLess(a,b) : 断言a&gt;b / 断言a&lt;b</li>
<li>assertGreaterEqual(a,b)/assertLessEqual: 断言a&gt;=b / 断言a&lt;=b</li>
</ul>
</li>
<li>类型判断<ul>
<li>assertIsInstance(a,dict)/assertNotIsInstance(a,list) # 断言a为字典 / 断言a非列表</li>
</ul>
</li>
</ul>
<p><strong>示例：</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> unittest</span><br><span class="line"></span><br><span class="line">case = unittest.TestCase()</span><br><span class="line">case.assertEqual(<span class="number">1</span>,<span class="number">2.0</span>/<span class="number">2</span>) <span class="comment"># 通过1=2.0/2</span></span><br><span class="line">case.assertEqual(<span class="number">1</span>, <span class="literal">True</span>) <span class="comment"># 通过</span></span><br><span class="line">case.assertIs(<span class="number">1.0</span>, <span class="number">2.0</span>/<span class="number">2</span>) <span class="comment"># 失败，不是同一对象</span></span><br><span class="line">case.assertListEqual([<span class="number">1</span>,<span class="number">2</span>],[<span class="number">1</span>,<span class="number">2</span>]) <span class="comment"># 通过（顺序要一致）</span></span><br><span class="line">case.assertDictEqual(&#123;<span class="string">&quot;a&quot;</span>:<span class="number">1</span>,<span class="string">&quot;b&quot;</span>:<span class="number">2</span>&#125;,&#123;<span class="string">&quot;b&quot;</span>:<span class="number">2</span>,<span class="string">&quot;a&quot;</span>:<span class="number">1</span>&#125;) <span class="comment"># 通过，字典本无序</span></span><br><span class="line">case.assertIsNone(&#123;&#125;) <span class="comment"># 失败</span></span><br><span class="line">case.assertFalse(&#123;&#125;) <span class="comment"># 通过，空字典为False</span></span><br><span class="line">case.assertIn(<span class="string">&quot;h&quot;</span>,<span class="string">&quot;hello&quot;</span>) <span class="comment"># 通过</span></span><br><span class="line">case.assertGreater(<span class="number">3</span>,<span class="number">2</span>) <span class="comment"># 通过，3&gt;2</span></span><br><span class="line">case.assertIsInstance(&#123;<span class="string">&quot;a&quot;</span>:<span class="number">1</span>&#125;, <span class="built_in">dict</span>) <span class="comment"># 通过</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>断言是unittest.TestCase的一种方法，通过断言判断用例是否通过（Pass/Fail)</p>
</blockquote>
<p><strong>Test Fixtures(用例包裹方法)</strong></p>
<p>Test Fixtures即setUp（用例准备）及tearDown（测试清理）方法，用于分别在测试前及测试后执行</p>
<p>按照不同的作用范围分为：</p>
<ul>
<li>setUp()/tearDown(): 每个用例执行前/后执行一次</li>
<li>setUpClass()/tearDownClass(): 每个测试类加载时/结束时执行一次</li>
<li>setUpMoudle()/tearDownMoudle(): 每个测试模块（一个py文件为一个模块）加载/结束时执行一次</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> unittest</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">setUpModule</span>():</span>    <span class="comment"># 当前模块执行前只执行一次</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;=== setUpModule ===&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">tearDownModule</span>():</span> <span class="comment"># 当前模块执行后只执行一次</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;=== tearDownModule ===&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TestClass1</span>(<span class="params">unittest.TestCase</span>):</span></span><br><span class="line"><span class="meta">    @classmethod          </span><span class="comment"># 声明为类方法（必须）</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">setUpClass</span>(<span class="params">cls</span>):</span>  <span class="comment"># 类方法，注意后面是cls，整个类只执行一次</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;--- setUpClass ---&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">    @classmethod</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">tearDownClass</span>(<span class="params">cls</span>):</span>  </span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;--- tearDownClass ---&#x27;</span>)</span><br><span class="line">        </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">setUp</span>(<span class="params">self</span>):</span>  <span class="comment"># 该类中每个测试用例执行一次</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;... setUp ...&#x27;</span>)</span><br><span class="line">        </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">tearDown</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;... tearDown ...&#x27;</span>)</span><br><span class="line">        </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">test_a</span>(<span class="params">self</span>):</span>  <span class="comment"># 测试用例</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;a&quot;</span>)</span><br><span class="line">        </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">test_B</span>(<span class="params">self</span>):</span> <span class="comment"># 大写B的ascii比小写a靠前，会比test_a先执行</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;B&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TestClass2</span>(<span class="params">unittest.TestCase</span>):</span>  <span class="comment"># 该模块另一个测试类</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">test_A</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;A&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    unittest.main()</span><br></pre></td></tr></table></figure>

<p>执行结果:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&#x3D;&#x3D;&#x3D; setUpModule &#x3D;&#x3D;&#x3D;</span><br><span class="line">--- setUpClass ---</span><br><span class="line">... setUp ...</span><br><span class="line">B</span><br><span class="line">... tearDown ...</span><br><span class="line">... setUp ...</span><br><span class="line">a</span><br><span class="line">... tearDown ...</span><br><span class="line">--- tearDownClass ---</span><br><span class="line">A</span><br><span class="line">&#x3D;&#x3D;&#x3D; tearDownModule &#x3D;&#x3D;&#x3D;</span><br><span class="line">...</span><br><span class="line">----------------------------------------------------------------------</span><br><span class="line">Ran 3 tests in 0.001s</span><br><span class="line"></span><br><span class="line">OK</span><br></pre></td></tr></table></figure>

<p><strong>完整的接口测试用例</strong><br>一条完整的测试接口用例需要包含：</p>
<ol>
<li>数据准备：准备测试数据，可手工准备，也可使用代码准备（通常涉及数据库操作）</li>
<li>环境检查：如果手工准备的数据，连接数据库进行环境检查会使用例更健壮</li>
<li>发送请求：发送接口请求</li>
<li>响应断言/数据库断言：响应断言后，还需要进行数据库断言，以确保接口数据库操作的正确性</li>
<li>数据清理：如果接口有更数据库操作，断言结束后需要还原更改</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line">test_user_reg.py</span><br><span class="line">import unittest</span><br><span class="line">import requests</span><br><span class="line">from db import *   # 导入db.py文件，源码见上篇</span><br><span class="line"></span><br><span class="line"># 数据准备</span><br><span class="line">NOT_EXIST_USER &#x3D; &#39;范冰冰&#39;</span><br><span class="line">EXIST_USER &#x3D; &#39;张三&#39;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">class TestUserReg(unittest.TestCase):</span><br><span class="line">    url &#x3D; &#39;http:&#x2F;&#x2F;127.0.0.1:5000&#x2F;api&#x2F;user&#x2F;reg&#x2F;&#39;</span><br><span class="line">    </span><br><span class="line">    def test_user_reg_normal(self):</span><br><span class="line">        # 环境检查</span><br><span class="line">        if check_user(NOT_EXIST_USER):</span><br><span class="line">            del_user(NOT_EXIST_USER)</span><br><span class="line">        </span><br><span class="line">        # 发送请求</span><br><span class="line">        data &#x3D; &#123;&#39;name&#39;: NOT_EXIST_USER, &#39;password&#39;: &#39;123456&#39;&#125;</span><br><span class="line">        res &#x3D; requests.post(url&#x3D;self.url, json&#x3D;data)</span><br><span class="line">        </span><br><span class="line">        # 期望响应结果，注意字典格式和json格式的区别（如果有true&#x2F;false&#x2F;null要转化为字典格式）</span><br><span class="line">        except_res &#x3D; &#123;</span><br><span class="line">                        &quot;code&quot;: &quot;100000&quot;,</span><br><span class="line">                        &quot;msg&quot;: &quot;成功&quot;,</span><br><span class="line">                        &quot;data&quot;: &#123;</span><br><span class="line">                                    &quot;name&quot;: NOT_EXIST_USER,</span><br><span class="line">                                    &quot;password&quot;: &quot;e10adc3949ba59abbe56e057f20f883e&quot;</span><br><span class="line">                                &#125;</span><br><span class="line">                      &#125;</span><br><span class="line">        </span><br><span class="line">        # 响应断言（整体断言）</span><br><span class="line">        self.assertDictEqual(res.json(), except_res)</span><br><span class="line">        </span><br><span class="line">        # 数据库断言</span><br><span class="line">        self.assertTrue(check_user(NOT_EXIST_USER))</span><br><span class="line">        </span><br><span class="line">        # 环境清理（由于注册接口向数据库写入了用户信息）</span><br><span class="line">        del_user(NOT_EXIST_USER)</span><br><span class="line">        </span><br><span class="line">    def test_user_reg_exist(self):</span><br><span class="line">         # 环境检查</span><br><span class="line">        if not check_user(EXIST_USER):</span><br><span class="line">            add_user(EXIST_USER)</span><br><span class="line">        </span><br><span class="line">        # 发送请求</span><br><span class="line">        data &#x3D; &#123;&#39;name&#39;: EXIST_USER, &#39;password&#39;: &#39;123456&#39;&#125;</span><br><span class="line">        res &#x3D; requests.post(url&#x3D;self.url, json&#x3D;data)</span><br><span class="line">        </span><br><span class="line">        # 期望响应结果，注意字典格式和json格式的区别（如果有true&#x2F;false&#x2F;null要转化为字典格式）</span><br><span class="line">        except_res &#x3D; &#123;</span><br><span class="line">                        &quot;code&quot;: &quot;100001&quot;,</span><br><span class="line">                        &quot;msg&quot;: &quot;失败，用户已存在&quot;,</span><br><span class="line">                        &quot;data&quot;: &#123;</span><br><span class="line">                                    &quot;name&quot;: EXIST_USER,</span><br><span class="line">                                    &quot;password&quot;: &quot;e10adc3949ba59abbe56e057f20f883e&quot;</span><br><span class="line">                                &#125;</span><br><span class="line">                      &#125;</span><br><span class="line">        </span><br><span class="line">        # 响应断言（整体断言）</span><br><span class="line">        self.assertDictEqual(res.json(), except_res)</span><br><span class="line">        </span><br><span class="line">        # 数据库断言(没有注册成功，数据库没有添加新用户)</span><br><span class="line">        </span><br><span class="line">        # 环境清理（无需清理）</span><br><span class="line">        </span><br><span class="line">if __name__ &#x3D;&#x3D; &#39;__main__&#39;:</span><br><span class="line">    unittest.main(verbosity&#x3D;2)   # 运行所有用例</span><br></pre></td></tr></table></figure>

<h2 id="用例组织及运行"><a href="#用例组织及运行" class="headerlink" title="用例组织及运行#"></a>用例组织及运行<a target="_blank" rel="noopener" href="https://www.cnblogs.com/superhin/p/10338993.html#3553768232">#</a></h2><p>除了使用unittest.main()运行整个测试类之外，我们还可以通过TestSuite来灵活的组织要运行的测试集</p>
<ol>
<li>新建TestSuite并添加测试用例</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">import unittest</span><br><span class="line">from test_user_login import TestUserLogin  </span><br><span class="line">from test_user_reg import TestUserReg # 从上面两个例子里导入测试类</span><br><span class="line"></span><br><span class="line">suite &#x3D; unittest.TestSuite()</span><br><span class="line">suite.addTest(TestUserLogin(&#39;test_user_login_normal&#39;)) # 添加单个用例</span><br><span class="line">suite.addTests([TestUserReg(&#39;test_user_reg_normal&#39;),TestUserReg(&#39;test_user_reg_exist&#39;)]) # 添加多个用例</span><br><span class="line"></span><br><span class="line"># 运行测试集</span><br><span class="line">unittest.TextTestRunner(verbosity&#x3D;2).run(suite)  # verbosity显示级别，运行顺序为添加到suite中的顺序</span><br></pre></td></tr></table></figure>

<ol>
<li>使用makeSuite来制作用例集</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">import unittest</span><br><span class="line">from test_user_login import TestUserLogin</span><br><span class="line"></span><br><span class="line">suite1 &#x3D; unittest.makeSuite(TestUserLogin, &#39;test_user_login_normal&#39;) # 使用测试类的单条用例制作测试集</span><br><span class="line">suite2 &#x3D; unittest.makeSuite(TestUserLogin) # 使用整个测试类制作测试集合(包含该测试类所有用例)</span><br><span class="line"></span><br><span class="line">unittest.TextTestRunner(verbosity&#x3D;2).run(suite1)</span><br></pre></td></tr></table></figure>

<ol>
<li>使用TestLoader（用例加载器）生成测试集</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">improt unittest</span><br><span class="line">from test_user_login import TestUserLogin</span><br><span class="line"></span><br><span class="line">suite &#x3D; unittest.TestLoader().loadTestsFromTestCase(TestUserLogin) # 加载该测试类所有用例并生成测试集</span><br><span class="line"></span><br><span class="line">unittest.TextTestRunner(verbosity&#x3D;2).run(suite)</span><br></pre></td></tr></table></figure>

<ol>
<li>使用discover（用例发现）遍历所有的用例</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">import unittest</span><br><span class="line"></span><br><span class="line">suite &#x3D; unittest.defaultTestLoader.discover(&quot;.&#x2F;&quot;)  # 遍历当前目录及子包中所有test_*.py中所有unittest用例</span><br><span class="line">unittest.TextTestRunner(verbosity&#x3D;2).run(suite)</span><br></pre></td></tr></table></figure>

<p><strong>注意：</strong></p>
<ul>
<li>子目录中需要包含<code>__init__.py</code>文件，及应为的Python包</li>
<li>所有用例因为test_*.py,包含测试类应以Test开头，并继承unittest.TestCase, 用例应以test_开头</li>
</ul>
<ol>
<li>测试集嵌套</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">import unittest</span><br><span class="line">from test_user_login import TestUserLogin</span><br><span class="line"></span><br><span class="line">suite1 &#x3D; unittest.TestSuite()</span><br><span class="line">suite1.addTest(TestUserLogin(&#39;test_user_login_normal&#39;))</span><br><span class="line"></span><br><span class="line">suite2 &#x3D; makeSuite(TestUserLogin, &#39;test_user_login_password_wrong&#39;)</span><br><span class="line"></span><br><span class="line">suite &#x3D; unittest.TestSuite([suite1, suite2])  # 将两个测试集组合为一个</span><br><span class="line"></span><br><span class="line">unittest.TextTestRunner(verbosity&#x3D;2).run(suite)</span><br></pre></td></tr></table></figure>

<h2 id="生成测试报告"><a href="#生成测试报告" class="headerlink" title="生成测试报告#"></a>生成测试报告<a target="_blank" rel="noopener" href="https://www.cnblogs.com/superhin/p/10338993.html#323694860">#</a></h2><p><strong>生成文本报告</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">import unittest</span><br><span class="line"></span><br><span class="line">suite &#x3D; unittest.defaultTestLoader.discover(&quot;.&#x2F;&quot;)</span><br><span class="line"></span><br><span class="line"># 输出测试结果到文本文件</span><br><span class="line">with open(&quot;result.txt&quot;,&quot;w&quot;) as f:</span><br><span class="line">    unittest.TextTestRunner(stream&#x3D;f,verbosity&#x3D;2).run(suite) # 将输出流stream输出到文件</span><br></pre></td></tr></table></figure>

<p><strong>生成HTML报告</strong></p>
<ol>
<li>下载<a target="_blank" rel="noopener" href="https://github.com/findyou/HTMLTestRunnerCN">HTMLTestRunnerCN</a></li>
<li>解压并将解压包中python3x文件夹下的HTMLTestRunnerCN.py拷贝到项目目录</li>
<li>在目录下新建脚本<code>run_all.py</code></li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">import unittest</span><br><span class="line">from HTMLTestReportCN import HTMLTestRunner</span><br><span class="line"></span><br><span class="line">suite &#x3D; unittest.defaultTestLoader.discover(&quot;.&#x2F;&quot;)</span><br><span class="line"></span><br><span class="line">f &#x3D; open(&quot;report.html&quot;, &#39;wb&#39;) # 二进制写格式打开要生成的报告文件</span><br><span class="line">HTMLTestRunner(stream&#x3D;f,title&#x3D;&quot;Api Test&quot;,description&#x3D;&quot;测试描述&quot;,runner&#x3D;&quot;卡卡&quot;).run(suite)</span><br><span class="line">f.close()</span><br></pre></td></tr></table></figure>

<ol>
<li>运行脚本，会在当前文件夹下生成report.html，用浏览器打开即可</li>
</ol>
<p><a target="_blank" rel="noopener" href="https://upload-images.jianshu.io/upload_images/7575721-76d298822f890486.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">![项目预览](Python Restful.assets/7575721-76d298822f890486.png)</a></p>
<p><a target="_blank" rel="noopener" href="https://upload-images.jianshu.io/upload_images/7575721-bd6b13406bbd7d91.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">![测试报告](Python Restful.assets/7575721-bd6b13406bbd7d91.png)</a></p>
<blockquote>
<p>源码下载请联系作者</p>
</blockquote>
<h1 id="Python接口测试实战4（上）-接口测试框架实战本节内容"><a href="#Python接口测试实战4（上）-接口测试框架实战本节内容" class="headerlink" title="Python接口测试实战4（上） - 接口测试框架实战本节内容"></a><a target="_blank" rel="noopener" href="https://www.cnblogs.com/superhin/p/10339002.html#4042132923">Python接口测试实战4（上） - 接口测试框架实战本节内容</a></h1><ul>
<li>数据分离 - 从Excel中读取数据</li>
<li>增加log功能</li>
<li>发送邮件</li>
<li>使用配置文件</li>
<li>框架整理</li>
</ul>
<p><a target="_blank" rel="noopener" href="https://upload-images.jianshu.io/upload_images/7575721-93d65d7b90ec067d.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">![上节课的框架雏形](Python Restful.assets/7575721-93d65d7b90ec067d.png)</a></p>
<h2 id="数据分离-从Excel中读取数据"><a href="#数据分离-从Excel中读取数据" class="headerlink" title="数据分离 - 从Excel中读取数据#"></a>数据分离 - 从Excel中读取数据<a target="_blank" rel="noopener" href="https://www.cnblogs.com/superhin/p/10339002.html#3023692453">#</a></h2><p>之前的用例中，数据直接写在代码文件里，不利于修改和构造数据<br>这里我们使用Excel保存测试数据，实现代码和数据的分离<br>新建Excel文件<code>test_user_data.xlsx</code>包含两个工作簿<code>TestUserLogin</code>和<code>TestUserReg</code>，并复制到项目根目录下<br><a target="_blank" rel="noopener" href="https://upload-images.jianshu.io/upload_images/7575721-6e67acc06a7e24fe.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">![test_user_data.xlsx](Python Restful.assets/7575721-6e67acc06a7e24fe.png)</a></p>
<blockquote>
<p>更新: excel表格中,增加一个headers列,内容为json格式, 如下</p>
</blockquote>
<p>TestUserLogin</p>
<table>
<thead>
<tr>
<th>case_name</th>
<th>url</th>
<th>method</th>
<th>headers</th>
<th>data</th>
<th>expect_res</th>
</tr>
</thead>
<tbody><tr>
<td>test_user_login_normal</td>
<td><a target="_blank" rel="noopener" href="http://115.28.108.130:5000/api/user/login/">http://115.28.108.130:5000/api/user/login/</a></td>
<td>POST</td>
<td>{}</td>
<td>{“name”: “张三”,”password”:”123456”}</td>
<td><code>&lt;h1&gt;登录成功&lt;/h1&gt;</code></td>
</tr>
<tr>
<td>test_user_login_password_wrong</td>
<td><a target="_blank" rel="noopener" href="http://115.28.108.130:5000/api/user/login/">http://115.28.108.130:5000/api/user/login/</a></td>
<td>POST</td>
<td>{}</td>
<td>{“name”: “张三”,”password”:”1234567”}</td>
<td><code>&lt;h1&gt;失败，用户名或密码错误&lt;/h1&gt;</code></td>
</tr>
</tbody></table>
<p>TestUserReg</p>
<table>
<thead>
<tr>
<th>case_name</th>
<th>url</th>
<th>method</th>
<th>headers</th>
<th>data</th>
<th>expect_res</th>
</tr>
</thead>
<tbody><tr>
<td>test_user_reg_normal</td>
<td><a target="_blank" rel="noopener" href="http://115.28.108.130:5000/api/user/login/">http://115.28.108.130:5000/api/user/login/</a></td>
<td>POST</td>
<td>{}</td>
<td>{“name”: “范冰冰”,”password”:”123456”}</td>
<td>“{“code: “100000”,”msg”: “成功,”data”:</td>
</tr>
<tr>
<td>test_user_reg_exist</td>
<td><a target="_blank" rel="noopener" href="http://115.28.108.130:5000/api/user/login/">http://115.28.108.130:5000/api/user/login/</a></td>
<td>POST</td>
<td>{}</td>
<td>{“name”: “张三”,”password”:”123456”}</td>
<td>“{“code”: “100001”,”msg”: “失败，用户已存在”,”data”: {“name”: “张三”,”password”:”e10adc3949ba59abbe56e057f20f883e”}}”</td>
</tr>
</tbody></table>
<p><strong>Excel读取方法：</strong><br>Python我们使用三方库xlrd来读取Excel</p>
<blockquote>
<p>安装方法： pip install xlrd</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">import xlrd</span><br><span class="line"></span><br><span class="line">wb &#x3D; xlrd.open_workbook(&quot;test_user_data.xlsx&quot;)  # 打开excel</span><br><span class="line">sh &#x3D; wb.sheet_by_name(&quot;TestUserLogin&quot;)  # 按工作簿名定位工作表</span><br><span class="line">print(sh.nrows)  # 有效数据行数</span><br><span class="line">print(sh.ncols)  # 有效数据列数</span><br><span class="line">print(sh.cell(0, 0).value)  # 输出第一行第一列的值&#96;case_name&#96;</span><br><span class="line">print(sh.row_values(0))  # 输出第1行的所有值（列表格式）</span><br><span class="line"></span><br><span class="line"># 将数据和标题组装成字典，使数据更清晰</span><br><span class="line">print(dict(zip(sh.row_values(0), sh.row_values(1))))</span><br><span class="line"></span><br><span class="line"># 遍历excel,打印所有的数据</span><br><span class="line">for i in range(sh.nrows):</span><br><span class="line">    print(sh.row_values(i))</span><br></pre></td></tr></table></figure>

<p>结果：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">3</span><br><span class="line">5</span><br><span class="line">case_name</span><br><span class="line">[&#39;case_name&#39;, &#39;url&#39;, &#39;method&#39;, &#39;data&#39;, &#39;expect_res&#39;]</span><br><span class="line">&#123;&#39;case_name&#39;: &#39;test_user_login_normal&#39;, &#39;url&#39;: &#39;http:&#x2F;&#x2F;115.28.108.130:5000&#x2F;api&#x2F;user&#x2F;login&#x2F;&#39;, &#39;method&#39;: &#39;POST&#39;, &#39;data&#39;: &#39;&#123;&quot;name&quot;: &quot;张三&quot;,&quot;password&quot;:&quot;123456&quot;&#125;&#39;, &#39;expect_res&#39;: &#39;&lt;h1&gt;登录成功&lt;&#x2F;h1&gt;&#39;&#125;</span><br><span class="line">[&#39;case_name&#39;, &#39;url&#39;, &#39;method&#39;, &#39;data&#39;, &#39;expect_res&#39;]</span><br><span class="line">[&#39;test_user_login_normal&#39;, &#39;http:&#x2F;&#x2F;115.28.108.130:5000&#x2F;api&#x2F;user&#x2F;login&#x2F;&#39;, &#39;POST&#39;, &#39;&#123;&quot;name&quot;: &quot;张三&quot;,&quot;password&quot;:&quot;123456&quot;&#125;&#39;, &#39;&lt;h1&gt;登录成功&lt;&#x2F;h1&gt;&#39;]</span><br><span class="line">[&#39;test_user_login_password_wrong&#39;, &#39;http:&#x2F;&#x2F;115.28.108.130:5000&#x2F;api&#x2F;user&#x2F;login&#x2F;&#39;, &#39;POST&#39;, &#39;&#123;&quot;name&quot;: &quot;张三&quot;,&quot;password&quot;:&quot;1234567&quot;&#125;&#39;, &#39;&lt;h1&gt;失败，用户不存在&lt;&#x2F;h1&gt;&#39;]</span><br></pre></td></tr></table></figure>

<p><strong>封装读取excel操作：</strong><br>新建<code>read_excel.py</code><br><a target="_blank" rel="noopener" href="https://upload-images.jianshu.io/upload_images/7575721-483884d4d1b8aef2.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">![封装读取excel操作](Python Restful.assets/7575721-483884d4d1b8aef2.png)</a></p>
<p>我们的目的是获取某条用例的数据，需要3个参数，excel数据文件名（data_file），工作簿名（sheet），用例名（case_name）<br>如果我们只封装一个函数，每次调用（每条用例）都要打开一次excel并遍历一次，这样效率比较低。<br>我们可以拆分成两个函数，一个函数<code>excel_to_list(data_file, sheet)</code>，一次获取一个工作表的所有数据，另一个函数<code>get_test_data(data_list, case_name)</code>从所有数据中去查找到该条用例的数据。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">import xlrd</span><br><span class="line"></span><br><span class="line">def excel_to_list(data_file, sheet):</span><br><span class="line">    data_list &#x3D; []  # 新建个空列表，来乘装所有的数据</span><br><span class="line">    wb &#x3D; xlrd.open_workbook(data_file)  # 打开excel</span><br><span class="line">    sh &#x3D; wb.sheet_by_name(sheet)  # 获取工作簿</span><br><span class="line">    header &#x3D; sh.row_values(0)  # 获取标题行数据</span><br><span class="line">    for i in range(1, sh.nrows):  # 跳过标题行，从第二行开始取数据</span><br><span class="line">        d &#x3D; dict(zip(header, sh.row_values(i)))  # 将标题和每行数据组装成字典</span><br><span class="line">        data_list.append(d)</span><br><span class="line">    return data_list  # 列表嵌套字典格式，每个元素是一个字典</span><br><span class="line"></span><br><span class="line">def get_test_data(data_list, case_name):</span><br><span class="line">    for case_data in data_list:</span><br><span class="line">        if case_name &#x3D;&#x3D; case_data[&#39;case_name&#39;]:  # 如果字典数据中case_name与参数一致</span><br><span class="line">            return case_data</span><br><span class="line">            # 如果查询不到会返回None</span><br><span class="line"></span><br><span class="line">if __name__ &#x3D;&#x3D; &#39;__main__&#39;:   # 测试一下自己的代码</span><br><span class="line">    data_list &#x3D; excel_to_list(&quot;test_user_data.xlsx&quot;, &quot;TestUserLogin&quot;)  # 读取excel，TestUserLogin工作簿的所有数据</span><br><span class="line">    case_data &#x3D; get_test_data(data_list, &#39;test_user_login_normal&#39;)  # 查找用例&#39;test_user_login_normal&#39;的数据</span><br><span class="line">    print(case_data)</span><br></pre></td></tr></table></figure>

<p>输出结果：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#39;case_name&#39;: &#39;test_user_login_normal&#39;, &#39;url&#39;: &#39;http:&#x2F;&#x2F;115.28.108.130:5000&#x2F;api&#x2F;user&#x2F;login&#x2F;&#39;, &#39;method&#39;: &#39;POST&#39;, &#39;data&#39;: &#39;&#123;&quot;name&quot;: &quot;张三&quot;,&quot;password&quot;:&quot;123456&quot;&#125;&#39;, &#39;expect_res&#39;: &#39;&lt;h1&gt;登录成功&lt;&#x2F;h1&gt;&#39;&#125;</span><br></pre></td></tr></table></figure>

<p><strong>用例中使用方法</strong><br>test_user_login.py 部分</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">import unittest</span><br><span class="line">import requests</span><br><span class="line">from read_excel import *  # 导入read_excel中的方法</span><br><span class="line">import json  # 用来转化excel中的json字符串为字典</span><br><span class="line"></span><br><span class="line">class TestUserLogin(unittest.TestCase):</span><br><span class="line">    @classmethod</span><br><span class="line">    def setUpClass(cls):   # 整个测试类只执行一次</span><br><span class="line">        cls.data_list &#x3D; excel_to_list(&quot;test_user_data.xlsx&quot;, &quot;TestUserLogin&quot;)  # 读取该测试类所有用例数据</span><br><span class="line">        # cls.data_list 同 self.data_list 都是该类的公共属性</span><br><span class="line"></span><br><span class="line">    def test_user_login_normal(self):</span><br><span class="line">        case_data &#x3D; get_test_data(self.data_list, &#39;test_user_login_normal&#39;)   # 从数据列表中查找到该用例数据</span><br><span class="line">        if not case_data:   # 有可能为None</span><br><span class="line">            print(&quot;用例数据不存在&quot;)</span><br><span class="line">        url &#x3D; case_data.get(&#39;url&#39;)   # 从字典中取数据，excel中的标题也必须是小写url</span><br><span class="line">        data &#x3D; case_data.get(&#39;data&#39;)  # 注意字符串格式，需要用json.loads()转化为字典格式</span><br><span class="line">        expect_res &#x3D; case_data.get(&#39;expect_res&#39;)  # 期望数据</span><br><span class="line"></span><br><span class="line">        res &#x3D; requests.post(url&#x3D;url, data&#x3D;json.loads(data))  # 表单请求，数据转为字典格式</span><br><span class="line">        self.assertEqual(res.text, expect_res)  # 改为assertEqual断言</span><br><span class="line"></span><br><span class="line">if __name__ &#x3D;&#x3D; &#39;__main__&#39;:   # 非必要，用于测试我们的代码</span><br><span class="line">    unittest.main(verbosity&#x3D;2)</span><br></pre></td></tr></table></figure>

<p>test_user_reg.py部分</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">import unittest</span><br><span class="line">import requests</span><br><span class="line">from db import *</span><br><span class="line">from read_excel import *</span><br><span class="line">import json</span><br><span class="line"></span><br><span class="line">class TestUserReg(unittest.TestCase):</span><br><span class="line"></span><br><span class="line">    @classmethod</span><br><span class="line">    def setUpClass(cls):</span><br><span class="line">        cls.data_list &#x3D; excel_to_list(&quot;test_user_data.xlsx&quot;, &quot;TestUserReg&quot;)  # 读取TestUserReg工作簿的所有数据</span><br><span class="line"></span><br><span class="line">    def test_user_reg_normal(self):</span><br><span class="line">        case_data &#x3D; get_test_data(self.data_list, &#39;test_user_reg_normal&#39;)</span><br><span class="line">        if not case_data:</span><br><span class="line">            print(&quot;用例数据不存在&quot;)</span><br><span class="line">        url &#x3D; case_data.get(&#39;url&#39;)</span><br><span class="line">        data &#x3D; json.loads(case_data.get(&#39;data&#39;))  # 转为字典，需要取里面的name进行数据库检查</span><br><span class="line">        expect_res &#x3D; json.loads(case_data.get(&#39;expect_res&#39;))  # 转为字典，断言时直接断言两个字典是否相等</span><br><span class="line">        name &#x3D; data.get(&quot;name&quot;)  # 范冰冰</span><br><span class="line"></span><br><span class="line">        # 环境检查</span><br><span class="line">        if check_user(name):</span><br><span class="line">            del_user(name)</span><br><span class="line">        # 发送请求</span><br><span class="line">        res &#x3D; requests.post(url&#x3D;url, json&#x3D;data)  # 用data&#x3D;data 传字符串也可以</span><br><span class="line">        # 响应断言（整体断言）</span><br><span class="line">        self.assertDictEqual(res.json(), expect_res)</span><br><span class="line">        # 数据库断言</span><br><span class="line">        self.assertTrue(check_user(name))</span><br><span class="line">        # 环境清理（由于注册接口向数据库写入了用户信息）</span><br><span class="line">        del_user(name)</span><br><span class="line"></span><br><span class="line">if __name__ &#x3D;&#x3D; &#39;__main__&#39;:    # 非必要，用于测试我们的代码</span><br><span class="line">    unittest.main(verbosity&#x3D;2)  </span><br></pre></td></tr></table></figure>

<h2 id="增加log功能"><a href="#增加log功能" class="headerlink" title="增加log功能#"></a>增加log功能<a target="_blank" rel="noopener" href="https://www.cnblogs.com/superhin/p/10339002.html#4160105701">#</a></h2><p>新建config.py文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">import logging</span><br><span class="line"></span><br><span class="line">logging.basicConfig(level&#x3D;logging.DEBUG,  # log level</span><br><span class="line">                    format&#x3D;&#39;[%(asctime)s] %(levelname)s [%(funcName)s: %(filename)s, %(lineno)d] %(message)s&#39;,  # log格式</span><br><span class="line">                    datefmt&#x3D;&#39;%Y-%m-%d %H:%M:%S&#39;,  # 日期格式</span><br><span class="line">                    filename&#x3D;&#39;log.txt&#39;,  # 日志输出文件</span><br><span class="line">                    filemode&#x3D;&#39;a&#39;)  # 追加模式</span><br><span class="line"></span><br><span class="line">if __name__ &#x3D;&#x3D; &#39;__main__&#39;:</span><br><span class="line">    logging.info(&quot;hello&quot;)</span><br></pre></td></tr></table></figure>

<p>运行后在当前目录下生成<code>log.txt</code>，内容如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[2018-09-11 18:08:17] INFO [&lt;module&gt;: config.py, 38] hello</span><br></pre></td></tr></table></figure>

<p><strong>Log Level:</strong></p>
<ul>
<li>CRITICAL: 用于输出严重错误信息</li>
<li>ERROR: 用于输出错误信息</li>
<li>WARNING: 用于输出警示信息</li>
<li>INFO: 用于输出一些提升信息</li>
<li>DEBUG: 用于输出一些调试信息</li>
</ul>
<p>优先级 CRITICAL &gt; ERROR &gt; WARNING &gt; INFO &gt; DEBUG<br>指定<code>level = logging.DEBUG</code>所有等级大于等于DEBUG的信息都会输出<br>若指定<code>level = logging.ERROR</code> WARNING,INFO,DEBUG小于设置级别的信息不会输出</p>
<p><strong>日志格式:</strong></p>
<ul>
<li>%(levelno)s: 打印日志级别的数值</li>
<li>%(levelname)s: 打印日志级别名称</li>
<li>%(pathname)s: 打印当前执行程序的路径，其实就是sys.argv[0]</li>
<li>%(filename)s: 打印当前执行程序名</li>
<li>%(funcName)s: 打印日志的当前函数</li>
<li>%(lineno)d: 打印日志的当前行号</li>
<li>%(asctime)s: 打印日志的时间</li>
<li>%(thread)d: 打印线程ID</li>
<li>%(threadName)s: 打印线程名称</li>
<li>%(process)d: 打印进程ID</li>
<li>%(message)s: 打印日志信息</li>
</ul>
<p><strong>项目使用log</strong><br>将所有print改为log，如<code>db.py</code> 部分</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">import pymysql</span><br><span class="line">from config import *</span><br><span class="line"></span><br><span class="line"># 封装数据库查询操作</span><br><span class="line">def query_db(sql):</span><br><span class="line">    conn &#x3D; get_db_conn()</span><br><span class="line">    cur &#x3D; conn.cursor()  </span><br><span class="line">    logging.debug(sql)    # 输出执行的sql</span><br><span class="line">    cur.execute(sql)</span><br><span class="line">    conn.commit()</span><br><span class="line">    result &#x3D; cur.fetchall() </span><br><span class="line">    logging.debug(result)  # 输出查询结果</span><br><span class="line">    cur.close() </span><br><span class="line">    conn.close() </span><br><span class="line">    return result </span><br><span class="line"></span><br><span class="line"># 封装更改数据库操作</span><br><span class="line">def change_db(sql):</span><br><span class="line">    conn &#x3D; get_db_conn() </span><br><span class="line">    cur &#x3D; conn.cursor()</span><br><span class="line">    logging.debug(sql)  # 输出执行的sql</span><br><span class="line">    try:</span><br><span class="line">        cur.execute(sql) </span><br><span class="line">        conn.commit() </span><br><span class="line">    except Exception as e:</span><br><span class="line">        conn.rollback() </span><br><span class="line">        logging.error(str(e))  # 输出错误信息</span><br><span class="line">    finally:</span><br><span class="line">        cur.close() </span><br><span class="line">        conn.close()</span><br></pre></td></tr></table></figure>

<p>用例中使用</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">import unittest</span><br><span class="line">import requests</span><br><span class="line">from read_excel import *  # 导入read_excel中的方法</span><br><span class="line">import json  # 用来转化excel中的json字符串为字典</span><br><span class="line">from config import *</span><br><span class="line"></span><br><span class="line">class TestUserLogin(unittest.TestCase):</span><br><span class="line">    @classmethod</span><br><span class="line">    def setUpClass(cls):   # 整个测试类只执行一次</span><br><span class="line">        cls.data_list &#x3D; excel_to_list(&quot;test_user_data.xlsx&quot;, &quot;TestUserLogin&quot;)  # 读取该测试类所有用例数据</span><br><span class="line">        # cls.data_list 同 self.data_list 都是该类的公共属性</span><br><span class="line"></span><br><span class="line">    def test_user_login_normal(self):</span><br><span class="line">        case_data &#x3D; get_test_data(self.data_list, &#39;test_user_login_normal&#39;)   # 从数据列表中查找到该用例数据</span><br><span class="line">        if not case_data:   # 有可能为None</span><br><span class="line">            logging.error(&quot;用例数据不存在&quot;)</span><br><span class="line">        url &#x3D; case_data.get(&#39;url&#39;)   # excel中的标题也必须是小写url</span><br><span class="line">        data &#x3D; case_data.get(&#39;data&#39;)  # 注意字符串格式，需要用json.loads()转化为字典格式</span><br><span class="line">        expect_res &#x3D; case_data.get(&#39;expect_res&#39;)  # 期望数据</span><br><span class="line"></span><br><span class="line">        res &#x3D; requests.post(url&#x3D;url, data&#x3D;json.loads(data))  # 表单请求，数据转为字典格式</span><br><span class="line">        logging.info(&quot;测试用例：&#123;&#125;&quot;.format(&#39;test_user_login_normal&#39;))</span><br><span class="line">        logging.info(&quot;url：&#123;&#125;&quot;.format(url))</span><br><span class="line">        logging.info(&quot;请求参数：&#123;&#125;&quot;.format(data))</span><br><span class="line">        logging.info(&quot;期望结果：&#123;&#125;&quot;.format(expect_res))</span><br><span class="line">        logging.info(&quot;实际结果：&#123;&#125;&quot;.format(res.text)</span><br><span class="line">        self.assertEqual(res.text, expect_res)  # 断言</span><br><span class="line"></span><br><span class="line">if __name__ &#x3D;&#x3D; &#39;__main__&#39;:</span><br><span class="line">    unittest.main(verbosity&#x3D;2)</span><br></pre></td></tr></table></figure>

<p>项目下<code>log.txt</code>输出结果：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[2018-09-13 10:34:49] INFO [log_case_info: case_log.py, 8] 测试用例：test_user_login_normal</span><br><span class="line">[2018-09-13 10:34:49] INFO [log_case_info: case_log.py, 9] url：http:&#x2F;&#x2F;115.28.108.130:5000&#x2F;api&#x2F;user&#x2F;login&#x2F;</span><br><span class="line">[2018-09-13 10:34:49] INFO [log_case_info: case_log.py, 10] 请求参数：&#123;&quot;name&quot;: &quot;张三&quot;,&quot;password&quot;:&quot;123456&quot;&#125;</span><br><span class="line">[2018-09-13 10:34:49] INFO [log_case_info: case_log.py, 11] 期望结果：&lt;h1&gt;登录成功&lt;&#x2F;h1&gt;</span><br><span class="line">[2018-09-13 10:34:49] INFO [log_case_info: case_log.py, 12] 实际结果：&lt;h1&gt;登录成功&lt;&#x2F;h1&gt;</span><br></pre></td></tr></table></figure>

<p>因为每个用例都要输出很多log信息，我们封装一个<code>case_log</code>的函数</p>
<p>项目下新建<code>case_log.py</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">from config import *</span><br><span class="line">import json</span><br><span class="line"></span><br><span class="line">def log_case_info(case_name, url, data, expect_res, res_text): </span><br><span class="line">    if isinstance(data,dict):</span><br><span class="line">        data &#x3D; json.dumps(data, ensure_ascii&#x3D;False)  # 如果data是字典格式，转化为字符串</span><br><span class="line">    logging.info(&quot;测试用例：&#123;&#125;&quot;.format(case_name))</span><br><span class="line">    logging.info(&quot;url：&#123;&#125;&quot;.format(url))</span><br><span class="line">    logging.info(&quot;请求参数：&#123;&#125;&quot;.format(data))</span><br><span class="line">    logging.info(&quot;期望结果：&#123;&#125;&quot;.format(expect_res))</span><br><span class="line">    logging.info(&quot;实际结果：&#123;&#125;&quot;.format(res_text)</span><br></pre></td></tr></table></figure>

<p>简化后的用例log输出</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">import unittest</span><br><span class="line">import requests</span><br><span class="line">from read_excel import *  </span><br><span class="line">import json</span><br><span class="line">from config import *</span><br><span class="line">from case_log import log_case_info  # 导入方法</span><br><span class="line"></span><br><span class="line">class TestUserLogin(unittest.TestCase):</span><br><span class="line">    @classmethod</span><br><span class="line">    def setUpClass(cls):  </span><br><span class="line">        cls.data_list &#x3D; excel_to_list(&quot;test_user_data.xlsx&quot;, &quot;TestUserLogin&quot;) </span><br><span class="line"></span><br><span class="line">    def test_user_login_normal(self):</span><br><span class="line">        case_data &#x3D; get_test_data(self.data_list, &#39;test_user_login_normal&#39;) </span><br><span class="line">        if not case_data: </span><br><span class="line">            logging.error(&quot;用例数据不存在&quot;)</span><br><span class="line">        url &#x3D; case_data.get(&#39;url&#39;)  </span><br><span class="line">        data &#x3D; case_data.get(&#39;data&#39;) </span><br><span class="line">        expect_res &#x3D; case_data.get(&#39;expect_res&#39;)</span><br><span class="line"></span><br><span class="line">        res &#x3D; requests.post(url&#x3D;url, data&#x3D;json.loads(data))</span><br><span class="line">        log_case_info(&#39;test_user_login_normal&#39;, url, data, expect_res, res_text)  # 输出用例log信息</span><br><span class="line">        self.assertEqual(res.text, expect_res)  </span><br><span class="line"></span><br><span class="line">if __name__ &#x3D;&#x3D; &#39;__main__&#39;:</span><br><span class="line">    unittest.main(verbosity&#x3D;2)</span><br></pre></td></tr></table></figure>

<h2 id="发送邮件"><a href="#发送邮件" class="headerlink" title="发送邮件#"></a>发送邮件<a target="_blank" rel="noopener" href="https://www.cnblogs.com/superhin/p/10339002.html#1442106125">#</a></h2><p>在生成报告后我们希望框架能自动把报告发送到我们的邮箱中。和outlook，foxmail等邮件客户端一样，Python中发送邮件需要通过Email的smtp服务发送。</p>
<blockquote>
<p>首先需要确认用来发送邮件的邮箱是否启用了smtp服务</p>
</blockquote>
<p>发送邮件分3步</p>
<ol>
<li>编写邮件内容（Email邮件需要专门的MIME格式）</li>
<li>组装Email头（发件人，收件人，主题）</li>
<li>连接smtp服务器并发送邮件</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">import smtplib  # 用于建立smtp连接</span><br><span class="line">from email.mime.text import MIMEText  # 邮件需要专门的MIME格式</span><br><span class="line"></span><br><span class="line"># 1. 编写邮件内容（Email邮件需要专门的MIME格式）</span><br><span class="line">msg &#x3D; MIMEText(&#39;this is a test email&#39;, &#39;plain&#39;, &#39;utf-8&#39;)  # plain指普通文本格式邮件内容</span><br><span class="line"></span><br><span class="line"># 2. 组装Email头（发件人，收件人，主题）</span><br><span class="line">msg[&#39;From&#39;] &#x3D; &#39;test_results@sina.com&#39;  # 发件人</span><br><span class="line">msg[&#39;To&#39;] &#x3D; &#39;2375247815@qq.com&#39;  # 收件人</span><br><span class="line">msg[&#39;Subject&#39;] &#x3D; &#39;Api Test Report&#39;  # 邮件主题</span><br><span class="line"></span><br><span class="line"># 3. 连接smtp服务器并发送邮件</span><br><span class="line">smtp &#x3D; smtplib.SMTP_SSL(&#39;smtp.sina.com&#39;)  # smtp服务器地址 使用SSL模式</span><br><span class="line">smtp.login(&#39;自己的邮箱地址&#39;, &#39;自己的邮箱密码&#39;)  # 用户名和密码</span><br><span class="line">smtp.sendmail(&quot;接收邮件地址1&quot;, &quot;接收邮件地址2&quot;, msg.as_string())</span><br><span class="line">smtp.quit()</span><br></pre></td></tr></table></figure>

<p><strong>中文邮件主题、HTML邮件内容，及附件</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">import smtplib</span><br><span class="line">from email.mime.text import MIMEText</span><br><span class="line">from email.mime.multipart import MIMEMultipart  # 混合MIME格式，支持上传附件</span><br><span class="line">from email.header import Header  # 用于使用中文邮件主题</span><br><span class="line"></span><br><span class="line"># 1.  编写邮件内容</span><br><span class="line">with open(&#39;report.html&#39;, encoding&#x3D;&#39;utf-8&#39;) as f:  # 打开html报告</span><br><span class="line">    email_body &#x3D; f.read()  # 读取报告内容</span><br><span class="line"></span><br><span class="line">msg &#x3D; MIMEMultipart()  # 混合MIME格式</span><br><span class="line">msg.attach(MIMEText(email_body, &#39;html&#39;, &#39;utf-8&#39;))  # 添加html格式邮件正文（会丢失css格式）</span><br><span class="line"></span><br><span class="line"># 2. 组装Email头（发件人，收件人，主题）</span><br><span class="line">msg[&#39;From&#39;] &#x3D; &#39;test_results@sina.com&#39;  # 发件人</span><br><span class="line">msg[&#39;To&#39;] &#x3D; &#39;2375247815@qq.com&#39;  # 收件人</span><br><span class="line">msg[&#39;Subject&#39;] &#x3D; Header(&#39;接口测试报告&#39;, &#39;utf-8&#39;)  # 中文邮件主题，指定utf-8编码</span><br><span class="line"></span><br><span class="line"># 3. 构造附件1，传送当前目录下的 test.txt 文件</span><br><span class="line">att1 &#x3D; MIMEText(open(&#39;report.html&#39;, &#39;rb&#39;).read(), &#39;base64&#39;, &#39;utf-8&#39;)  # 二进制格式打开</span><br><span class="line">att1[&quot;Content-Type&quot;] &#x3D; &#39;application&#x2F;octet-stream&#39;</span><br><span class="line">att1[&quot;Content-Disposition&quot;] &#x3D; &#39;attachment; filename&#x3D;&quot;report.html&quot;&#39;  # filename为邮件中附件显示的名字</span><br><span class="line">msg.attach(att1)</span><br><span class="line"></span><br><span class="line"># 4. 连接smtp服务器并发送邮件</span><br><span class="line">smtp &#x3D; smtplib.SMTP_SSL(&#39;smtp.sina.com&#39;)  # smtp服务器地址 使用SSL模式</span><br><span class="line">smtp.login(&#39;test_results@sina.com&#39;, &#39;hanzhichao123&#39;)  # 用户名和密码</span><br><span class="line">smtp.sendmail(&quot;test_results@sina.com&quot;, &quot;2375247815@qq.com&quot;, msg.as_string())</span><br><span class="line">smtp.sendmail(&quot;test_results@sina.com&quot;, &quot;superhin@126.com&quot;, msg.as_string())  # 发送给另一个邮箱</span><br><span class="line">smtp.quit()</span><br></pre></td></tr></table></figure>

<p>封装发送邮件方法</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">import smtplib</span><br><span class="line">from email.mime.text import MIMEText</span><br><span class="line">from email.mime.multipart import MIMEMultipart  # 混合MIME格式，支持上传附件</span><br><span class="line">from email.header import Header  # 用于使用中文邮件主题</span><br><span class="line">from config import *</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def send_email(report_file):</span><br><span class="line">    msg &#x3D; MIMEMultipart()  # 混合MIME格式</span><br><span class="line">    msg.attach(MIMEText(open(report_file, encoding&#x3D;&#39;utf-8&#39;).read(), &#39;html&#39;, &#39;utf-8&#39;))  # 添加html格式邮件正文（会丢失css格式）</span><br><span class="line"></span><br><span class="line">    msg[&#39;From&#39;] &#x3D; &#39;test_results@sina.com&#39;  # 发件人</span><br><span class="line">    msg[&#39;To&#39;] &#x3D; &#39;2375247815@qq.com&#39;  # 收件人</span><br><span class="line">    msg[&#39;Subject&#39;] &#x3D; Header(&#39;接口测试报告&#39;, &#39;utf-8&#39;)  # 中文邮件主题，指定utf-8编码</span><br><span class="line"></span><br><span class="line">    att1 &#x3D; MIMEText(open(report_file, &#39;rb&#39;).read(), &#39;base64&#39;, &#39;utf-8&#39;)  # 二进制格式打开</span><br><span class="line">    att1[&quot;Content-Type&quot;] &#x3D; &#39;application&#x2F;octet-stream&#39;</span><br><span class="line">    att1[&quot;Content-Disposition&quot;] &#x3D; &#39;attachment; filename&#x3D;&quot;report.html&quot;&#39;  # filename为邮件中附件显示的名字</span><br><span class="line">    msg.attach(att1)</span><br><span class="line"></span><br><span class="line">    try:</span><br><span class="line">        smtp &#x3D; smtplib.SMTP_SSL(&#39;smtp.sina.com&#39;)  # smtp服务器地址 使用SSL模式</span><br><span class="line">        smtp.login(&#39;test_results@sina.com&#39;, &#39;hanzhichao123&#39;)  # 用户名和密码</span><br><span class="line">        smtp.sendmail(&quot;test_results@sina.com&quot;, &quot;2375247815@qq.com&quot;, msg.as_string())</span><br><span class="line">        smtp.sendmail(&quot;test_results@sina.com&quot;, &quot;superhin@126.com&quot;, msg.as_string())  # 发送给另一个邮箱</span><br><span class="line">        logging.info(&quot;邮件发送完成！&quot;)</span><br><span class="line">    except Exception as e:</span><br><span class="line">        logging.error(str(e))</span><br><span class="line">    finally:</span><br><span class="line">        smtp.quit()</span><br></pre></td></tr></table></figure>

<p>run_all.py中结束后发送邮件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">import unittest</span><br><span class="line">from HTMLTestReportCN import HTMLTestRunner</span><br><span class="line">from config import *</span><br><span class="line">from send_email import send_email</span><br><span class="line"></span><br><span class="line">logging.info(&quot;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D; 测试开始 &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&quot;)</span><br><span class="line">suite &#x3D; unittest.defaultTestLoader.discover(&quot;.&#x2F;&quot;)</span><br><span class="line"></span><br><span class="line">with open(&quot;report.html&quot;, &#39;wb&#39;) as f:  # 改为with open 格式</span><br><span class="line">    HTMLTestRunner(stream&#x3D;f, title&#x3D;&quot;Api Test&quot;, description&#x3D;&quot;测试描述&quot;, tester&#x3D;&quot;卡卡&quot;).run(suite)</span><br><span class="line"></span><br><span class="line">send_email(&#39;report.html&#39;)  # 发送邮件</span><br><span class="line">logging.info(&quot;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D; 测试结束 &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&quot;)</span><br></pre></td></tr></table></figure>

<p><a target="_blank" rel="noopener" href="https://upload-images.jianshu.io/upload_images/7575721-5aa3ede57e3ca5b6.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">![测试邮件](Python Restful.assets/7575721-5aa3ede57e3ca5b6.png)</a></p>
<h2 id="使用配置文件"><a href="#使用配置文件" class="headerlink" title="使用配置文件#"></a>使用配置文件<a target="_blank" rel="noopener" href="https://www.cnblogs.com/superhin/p/10339002.html#2688840351">#</a></h2><p>和项目的log配置一样，数据库服务器地址，邮件服务地址我们一般放到配置文件<code>config.py</code>中</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">import logging</span><br><span class="line">import os</span><br><span class="line"></span><br><span class="line"># 项目路径</span><br><span class="line">prj_path &#x3D; os.path.dirname(os.path.abspath(__file__))  # 当前文件的绝对路径的上一级，__file__指当前文件</span><br><span class="line"></span><br><span class="line">data_path &#x3D; prj_path  # 数据目录，暂时在项目目录下</span><br><span class="line">test_path &#x3D; prj_path  # 用例目录，暂时在项目目录下</span><br><span class="line"></span><br><span class="line">log_file &#x3D; os.path.join(prj_path, &#39;log.txt&#39;)  # 也可以每天生成新的日志文件</span><br><span class="line">report_file &#x3D; os.path.join(prj_path, &#39;report.html&#39;)  # 也可以每次生成新的报告</span><br><span class="line"></span><br><span class="line"># log配置</span><br><span class="line">logging.basicConfig(level&#x3D;logging.DEBUG,  # log level</span><br><span class="line">                    format&#x3D;&#39;[%(asctime)s] %(levelname)s [%(funcName)s: %(filename)s, %(lineno)d] %(message)s&#39;,  # log格式</span><br><span class="line">                    datefmt&#x3D;&#39;%Y-%m-%d %H:%M:%S&#39;,  # 日期格式</span><br><span class="line">                    filename&#x3D;log_file,  # 日志输出文件</span><br><span class="line">                    filemode&#x3D;&#39;a&#39;)  # 追加模式</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 数据库配置</span><br><span class="line">db_host &#x3D; &#39;127.0.0.1&#39;   # 自己的服务器地址</span><br><span class="line">db_port &#x3D; 3306</span><br><span class="line">db_user &#x3D; &#39;test&#39;</span><br><span class="line">db_passwd &#x3D; &#39;123456&#39;</span><br><span class="line">db &#x3D; &#39;api_test&#39;</span><br><span class="line"></span><br><span class="line"># 邮件配置</span><br><span class="line">smtp_server &#x3D; &#39;smtp.sina.com&#39;</span><br><span class="line">smtp_user &#x3D; &#39;test_results@sina.com&#39;</span><br><span class="line">smtp_password &#x3D; &#39;hanzhichao123&#39;</span><br><span class="line"></span><br><span class="line">sender &#x3D; smtp_user  # 发件人</span><br><span class="line">receiver &#x3D; &#39;2375247815@qq.com&#39;  # 收件人</span><br><span class="line">subject &#x3D; &#39;接口测试报告&#39;  # 邮件主题</span><br></pre></td></tr></table></figure>

<p>修改<code>db.py</code>,<code>send_email.py</code>，<code>run_all.py</code>等对配置文件的引用<br><code>db.py</code>部分</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line">import pymysql</span><br><span class="line">from config import *</span><br><span class="line"></span><br><span class="line"># 获取连接方法</span><br><span class="line">def get_db_conn():</span><br><span class="line">    conn &#x3D; pymysql.connect(host&#x3D;db_host,   # 从配置文件中读取</span><br><span class="line">                           port&#x3D;db_port,</span><br><span class="line">                           user&#x3D;db_user,</span><br><span class="line">                           passwd&#x3D;db_passwd,  # passwd 不是 password</span><br><span class="line">                           db&#x3D;db,</span><br><span class="line">                           charset&#x3D;&#39;utf8&#39;)  # 如果查询有中文，需要指定测试集编码</span><br><span class="line">send_email.py</span><br><span class="line">import smtplib</span><br><span class="line">from email.mime.text import MIMEText</span><br><span class="line">from email.mime.multipart import MIMEMultipart</span><br><span class="line">from email.header import Header </span><br><span class="line">from config import *</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def send_email(report_file):</span><br><span class="line">    msg &#x3D; MIMEMultipart()</span><br><span class="line">    msg.attach(MIMEText(open(report_file, encoding&#x3D;&#39;utf-8&#39;).read(), &#39;html&#39;, &#39;utf-8&#39;))</span><br><span class="line"></span><br><span class="line">    msg[&#39;From&#39;] &#x3D; &#39;test_results@sina.com&#39;</span><br><span class="line">    msg[&#39;To&#39;] &#x3D; &#39;2375247815@qq.com&#39;</span><br><span class="line">    msg[&#39;Subject&#39;] &#x3D; Header(subject, &#39;utf-8&#39;)  # 从配置文件中读取</span><br><span class="line"></span><br><span class="line">    att1 &#x3D; MIMEText(open(report_file, &#39;rb&#39;).read(), &#39;base64&#39;, &#39;utf-8&#39;)  # 从配置文件中读取</span><br><span class="line">    att1[&quot;Content-Type&quot;] &#x3D; &#39;application&#x2F;octet-stream&#39;</span><br><span class="line">    att1[&quot;Content-Disposition&quot;] &#x3D; &#39;attachment; filename&#x3D;&quot;&#123;&#125;&quot;&#39;.format(report_file)  # 参数化一下report_file</span><br><span class="line">    msg.attach(att1)</span><br><span class="line"></span><br><span class="line">    try:</span><br><span class="line">        smtp &#x3D; smtplib.SMTP_SSL(smtp_server)  # 从配置文件中读取</span><br><span class="line">        smtp.login(smtp_user, smtp_password)  # 从配置文件中读取</span><br><span class="line">        smtp.sendmail(sender, receiver, msg.as_string())</span><br><span class="line">        logging.info(&quot;邮件发送完成！&quot;)</span><br><span class="line">    except Exception as e:</span><br><span class="line">        logging.error(str(e))</span><br><span class="line">    finally:</span><br><span class="line">        smtp.quit()</span><br><span class="line">run_all.py</span><br><span class="line">import unittest</span><br><span class="line">from HTMLTestReportCN import HTMLTestRunner</span><br><span class="line">from config import *</span><br><span class="line">from send_email import send_email</span><br><span class="line"></span><br><span class="line">logging.info(&quot;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D; 测试开始 &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&quot;)</span><br><span class="line">suite &#x3D; unittest.defaultTestLoader.discover(test_path)  # 从配置文件中读取用例路径</span><br><span class="line"></span><br><span class="line">with open(report_file, &#39;wb&#39;) as f:  # 从配置文件中读取</span><br><span class="line">    HTMLTestRunner(stream&#x3D;f, title&#x3D;&quot;Api Test&quot;, description&#x3D;&quot;测试描述&quot;).run(suite)</span><br><span class="line"></span><br><span class="line">send_email(report_file)  # 从配置文件中读取</span><br><span class="line">logging.info(&quot;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D; 测试结束 &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&quot;)</span><br></pre></td></tr></table></figure>

<h2 id="框架整理"><a href="#框架整理" class="headerlink" title="框架整理#"></a>框架整理<a target="_blank" rel="noopener" href="https://www.cnblogs.com/superhin/p/10339002.html#3388322326">#</a></h2><p><a target="_blank" rel="noopener" href="https://upload-images.jianshu.io/upload_images/7575721-ba8100e5e07cf85f.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">![所有文件都在项目根目录](Python Restful.assets/7575721-ba8100e5e07cf85f.png)</a><br>当前所有文件（配置文件，公共方法，测试用例，数据，报告，log）都在项目根目录下，随着用例的增加和功能的补充，文件会越来越多，不便于维护和管理，因此我们要建立不同的文件夹，对文件进行分类组织</p>
<p>1.在项目中新建以下文件夹：</p>
<ul>
<li>config: 存放项目配置文件</li>
<li>data: 存放用例数据文件</li>
<li>lib: 公共方法库</li>
<li>log: 存放日志文件</li>
<li>report: 存放报告文件</li>
<li>test: 存放测试用例<ul>
<li>user: 存放user模块用例 （模块下要有<code>__init__.py</code>，这样里面的用例才能读取到）</li>
</ul>
</li>
</ul>
<p>2.将配置文件<code>config.py</code>移动到config目录下，将数据文件<code>test_user_data.xlsx</code>移动到data目录下，将公共方法<code>db.py</code> <code>send_email.py</code> <code>case_log.py</code> <code>read_excel.py</code> <code>HTMLTestReportCN.py</code>移动到lib目录下，将测试用例<code>test_user_login.py</code> <code>test_user_reg.py</code>移动到test/user目录下，保留<code>run_all.py</code>在项目根目录下，如图：<br><a target="_blank" rel="noopener" href="https://upload-images.jianshu.io/upload_images/7575721-93e5bfd50f13eaac.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">![整理后的项目结构](Python Restful.assets/7575721-93e5bfd50f13eaac.png)</a></p>
<p>3.修改配置文件<br><code>config/config.py</code>部分</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">import logging</span><br><span class="line">import os</span><br><span class="line"></span><br><span class="line"># 项目路径</span><br><span class="line">prj_path &#x3D; os.path.dirname(os.path.dirname(os.path.abspath(__file__)))  # 当前文件的上一级的上一级目录（增加一级）</span><br><span class="line"></span><br><span class="line">data_path &#x3D; os.path.join(prj_path, &#39;data&#39;)  # 数据目录</span><br><span class="line">test_path &#x3D; os.path.join(prj_path, &#39;test&#39;)   # 用例目录</span><br><span class="line"></span><br><span class="line">log_file &#x3D; os.path.join(prj_path, &#39;log&#39;, &#39;log.txt&#39;)  # 更改路径到log目录下</span><br><span class="line">report_file &#x3D; os.path.join(prj_path, &#39;report&#39;, &#39;report.html&#39;)  # 更改路径到report目录下</span><br></pre></td></tr></table></figure>

<p>4.修改对配置文件及公共方法的引用</p>
<blockquote>
<p>为避免相对路径导包出错的问题，我们统一把导包搜索路径（sys.path）提升到项目根目录下，如<code>lib/db.py</code></p>
</blockquote>
<p><code>lib/db.py</code> 部分</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">import pymysql</span><br><span class="line">import sys</span><br><span class="line">sys.path.append(&#39;..&#39;)  # 提升一级到项目更目录下</span><br><span class="line">from config.config import *  # 从项目根目录下导入</span><br></pre></td></tr></table></figure>

<p>测试用例<code>test_user_login.py</code>部分</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">import unittest</span><br><span class="line">import requests</span><br><span class="line">import json</span><br><span class="line">import os  # 增加了一个os，需要用来组装路径</span><br><span class="line">import sys</span><br><span class="line">sys.path.append(&quot;..&#x2F;..&quot;)  # 提升2级到项目根目录下</span><br><span class="line">from config.config import *  # 从项目路径下导入</span><br><span class="line">from lib.read_excel import *  # 从项目路径下导入</span><br><span class="line">from lib.case_log import log_case_info  # 从项目路径下导入</span><br><span class="line"></span><br><span class="line">class TestUserLogin(unittest.TestCase):</span><br><span class="line">    @classmethod</span><br><span class="line">    def setUpClass(cls):   # 整个测试类只执行一次</span><br><span class="line">        cls.data_list &#x3D; excel_to_list(os.path.join(data_path, &quot;test_user_data.xlsx&quot;),&quot;TestUserLogin&quot;)  # 增加data路径</span><br><span class="line">run_all.py</span><br><span class="line">import unittest</span><br><span class="line">from lib.HTMLTestReportCN import HTMLTestRunner  # 修改导入路径</span><br><span class="line">from config.config import *  # 修改导入路径</span><br><span class="line">from lib.send_email import send_email  # 修改导入路径</span><br><span class="line"></span><br><span class="line">logging.info(&quot;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D; 测试开始 &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&quot;)</span><br><span class="line">suite &#x3D; unittest.defaultTestLoader.discover(test_path)  # 从配置文件中读取</span><br><span class="line"></span><br><span class="line">with open(report_file, &#39;wb&#39;) as f:  # 从配置文件中读取</span><br><span class="line">    HTMLTestRunner(stream&#x3D;f, title&#x3D;&quot;Api Test&quot;, description&#x3D;&quot;测试描述&quot;).run(suite)</span><br><span class="line"></span><br><span class="line">send_email(report_file)  # 从配置文件中读取</span><br><span class="line">logging.info(&quot;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D; 测试结束 &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&quot;)</span><br></pre></td></tr></table></figure>

<blockquote>
<ol>
<li>如果同一文件夹下的方法相互引用（如<code>lib/read_excel.py</code>假如需要引用<code>lib/db.py</code>），也需要采用这种从项目路径下导入的方式</li>
<li><code>run_all.py</code>直接在项目路径下，不需要提升sys.path，无需相对导入我们自己的包时，如<code>read_excel.py</code>，不需要提升</li>
</ol>
</blockquote>
<p>5.运行<code>run_all.py</code>，根据log和报告调试代码，直至所有用例全部通过</p>
<blockquote>
<p>源码下载链接：<a target="_blank" rel="noopener" href="https://pan.baidu.com/s/1RzwAlUMHwG4FQmeS-yB9rw">https://pan.baidu.com/s/1RzwAlUMHwG4FQmeS-yB9rw</a> 密码：rvq1</p>
</blockquote>
<h1 id="Python接口测试实战4（下）-框架完善：用例基类，用例标签，重新运行上次失败用例"><a href="#Python接口测试实战4（下）-框架完善：用例基类，用例标签，重新运行上次失败用例" class="headerlink" title="Python接口测试实战4（下） - 框架完善：用例基类，用例标签，重新运行上次失败用例"></a><a target="_blank" rel="noopener" href="https://www.cnblogs.com/superhin/p/10339009.html">Python接口测试实战4（下） - 框架完善：用例基类，用例标签，重新运行上次失败用例</a></h1><h2 id="本节内容-4"><a href="#本节内容-4" class="headerlink" title="本节内容"></a>本节内容</h2><ul>
<li>使用用例基类</li>
<li>自定义TestSuite</li>
<li>collect-only的实现</li>
<li>testlist的实现</li>
<li>用例tags的实现</li>
<li>rerun-fails的实现</li>
<li>命令行参数的使用</li>
</ul>
<h2 id="更简单的用例编写"><a href="#更简单的用例编写" class="headerlink" title="更简单的用例编写#"></a>更简单的用例编写<a target="_blank" rel="noopener" href="https://www.cnblogs.com/superhin/p/10339009.html#2905654308">#</a></h2><h3 id="使用用例基类"><a href="#使用用例基类" class="headerlink" title="使用用例基类#"></a>使用用例基类<a target="_blank" rel="noopener" href="https://www.cnblogs.com/superhin/p/10339009.html#3904518046">#</a></h3><p>因为每条用例都需要从excel中读取数据，解析数据，发送请求，断言响应结果，我们可以封装一个<code>BaseCase</code>的用例基础类，对一些方法进行封装，来简化用例编写</p>
<blockquote>
<p>重新规划了test目录，在test下建立case文件夹存放用例，建立suite文件夹存放自定义的<code>TestSuite</code><br><code>test_user_data.xlsx</code>中增加了一列<code>data_type</code>，<code>FORM</code>指表单格式请求，<code>JSON</code>指JSON格式请求</p>
</blockquote>
<p>项目test/case文件夹下新建basecase.py</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">import unittest</span><br><span class="line">import requests</span><br><span class="line">import json</span><br><span class="line">import sys</span><br><span class="line">sys.path.append(&quot;..&#x2F;..&quot;)   # 统一将包的搜索路径提升到项目根目录下</span><br><span class="line"></span><br><span class="line">from lib.read_excel import *  </span><br><span class="line">from lib.case_log import log_case_info </span><br><span class="line"></span><br><span class="line">class BaseCase(unittest.TestCase):   # 继承unittest.TestCase</span><br><span class="line">    @classmethod</span><br><span class="line">    def setUpClass(cls):</span><br><span class="line">        if cls.__name__ !&#x3D; &#39;BaseCase&#39;:</span><br><span class="line">            cls.data_list &#x3D; excel_to_list(data_file, cls.__name__)</span><br><span class="line"></span><br><span class="line">    def get_case_data(self, case_name):</span><br><span class="line">        return get_test_data(self.data_list, case_name)</span><br><span class="line"></span><br><span class="line">    def send_request(self, case_data):</span><br><span class="line">        case_name &#x3D; case_data.get(&#39;case_name&#39;)</span><br><span class="line">        url &#x3D; case_data.get(&#39;url&#39;)</span><br><span class="line">        args &#x3D; case_data.get(&#39;args&#39;)</span><br><span class="line">        headers &#x3D; case_data.get(&#39;headers&#39;)</span><br><span class="line">        expect_res &#x3D; case_data.get(&#39;expect_res&#39;)</span><br><span class="line">        method &#x3D; case_data.get(&#39;method&#39;)</span><br><span class="line">        data_type &#x3D; case_data.get(&#39;data_type&#39;)</span><br><span class="line"></span><br><span class="line">        if method.upper() &#x3D;&#x3D; &#39;GET&#39;:   # GET类型请求</span><br><span class="line">            res &#x3D; requests.get(url&#x3D;url, params&#x3D;json.loads(args))</span><br><span class="line"></span><br><span class="line">        elif data_type.upper() &#x3D;&#x3D; &#39;FORM&#39;:   # 表单格式请求</span><br><span class="line">            res &#x3D; requests.post(url&#x3D;url, data&#x3D;json.loads(args), headers&#x3D;json.loads(headers))</span><br><span class="line">            log_case_info(case_name, url, args, expect_res, res.text)</span><br><span class="line">            self.assertEqual(res.text, expect_res)</span><br><span class="line">        else:</span><br><span class="line">            res &#x3D; requests.post(url&#x3D;url, json&#x3D;json.loads(args), headers&#x3D;json.loads(headers))   # JSON格式请求</span><br><span class="line">            log_case_info(case_name, url, args, json.dumps(json.loads(expect_res), sort_keys&#x3D;True),</span><br><span class="line">                          json.dumps(res.json(), ensure_ascii&#x3D;False, sort_keys&#x3D;True))</span><br><span class="line">            self.assertDictEqual(res.json(), json.loads(expect_res))</span><br></pre></td></tr></table></figure>

<p>简化后的用例：<br><code>test/case/user/test_user_login.py</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">from test.case.basecase import BaseCase</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">class TestUserLogin(BaseCase):   # 这里直接继承BaseCase</span><br><span class="line">    def test_user_login_normal(self):</span><br><span class="line">        &quot;&quot;&quot;level1:正常登录&quot;&quot;&quot;</span><br><span class="line">        case_data &#x3D; self.get_case_data(&quot;test_user_login_normal&quot;)</span><br><span class="line">        self.send_request(case_data)</span><br><span class="line"></span><br><span class="line">    def test_user_login_password_wrong(self):</span><br><span class="line">        &quot;&quot;&quot;密码错误登录&quot;&quot;&quot;</span><br><span class="line">        case_data &#x3D; self.get_case_data(&quot;test_user_login_password_wrong&quot;)</span><br><span class="line">        self.send_request(case_data)</span><br><span class="line">test&#x2F;case&#x2F;user&#x2F;test_user_reg.py</span><br><span class="line">from test.case.basecase import BaseCase</span><br><span class="line">from lib.db import *</span><br><span class="line">import json</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">class TestUserReg(BaseCase):</span><br><span class="line"></span><br><span class="line">    def test_user_reg_normal(self):</span><br><span class="line">        case_data &#x3D; self.get_case_data(&quot;test_user_reg_normal&quot;)</span><br><span class="line"></span><br><span class="line">        # 环境检查</span><br><span class="line">        name &#x3D; json.loads(case_data.get(&quot;args&quot;)).get(&#39;name&#39;)  # 范冰冰</span><br><span class="line">        if check_user(name):</span><br><span class="line">            del_user(name)</span><br><span class="line">        # 发送请求</span><br><span class="line">        self.send_request(case_data)</span><br><span class="line">        # 数据库断言</span><br><span class="line">        self.assertTrue(check_user(name))</span><br><span class="line">        # 环境清理</span><br><span class="line">        del_user(name)</span><br><span class="line"></span><br><span class="line">    def test_user_reg_exist(self):</span><br><span class="line">        case_data &#x3D; self.get_case_data(&quot;test_user_reg_exist&quot;)</span><br><span class="line"></span><br><span class="line">        name &#x3D; json.loads(case_data.get(&quot;args&quot;)).get(&#39;name&#39;)</span><br><span class="line">        # 环境检查</span><br><span class="line">        if not check_user(name):</span><br><span class="line">            add_user(name, &#39;123456&#39;)</span><br><span class="line"></span><br><span class="line">        # 发送请求</span><br><span class="line">        self.send_request(case_data)</span><br></pre></td></tr></table></figure>

<h2 id="更灵活的运行方式"><a href="#更灵活的运行方式" class="headerlink" title="更灵活的运行方式#"></a>更灵活的运行方式<a target="_blank" rel="noopener" href="https://www.cnblogs.com/superhin/p/10339009.html#1504490329">#</a></h2><p>之前我们的<code>run_all.py</code>只有运行所有用例一种选择，我们通过增加一些功能，提供更灵活的运行策略</p>
<h3 id="运行自定义TestSuite"><a href="#运行自定义TestSuite" class="headerlink" title="运行自定义TestSuite#"></a>运行自定义<code>TestSuite</code><a target="_blank" rel="noopener" href="https://www.cnblogs.com/superhin/p/10339009.html#521826087">#</a></h3><p>项目test/suite文件夹下新建<code>test_suites.py</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">import unittest</span><br><span class="line">import sys</span><br><span class="line">sys.path.append(&quot;..&#x2F;..&quot;)</span><br><span class="line">from test.case.user.test_user_login import TestUserLogin</span><br><span class="line">from test.case.user.test_user_reg import TestUserReg</span><br><span class="line"></span><br><span class="line">smoke_suite &#x3D; unittest.TestSuite()  # 自定义的TestSuite</span><br><span class="line">smoke_suite.addTests([TestUserLogin(&#39;test_user_login_normal&#39;), TestUserReg(&#39;test_user_reg_normal&#39;)])</span><br><span class="line"></span><br><span class="line">def get_suite(suite_name):    # 获取TestSuite方法</span><br><span class="line">    return globals().get(suite_name)</span><br></pre></td></tr></table></figure>

<p>修改<code>run_all.py</code>为<code>run.py</code>，添加<code>run_suite()</code>方法</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">import unittest</span><br><span class="line">from lib.HTMLTestReportCN import HTMLTestRunner</span><br><span class="line">from config.config import *</span><br><span class="line">from lib.send_email import send_email</span><br><span class="line">from test.suite.test_suites import *</span><br><span class="line"></span><br><span class="line">def discover():</span><br><span class="line">    return unittest.defaultTestLoader.discover(test_case_path)</span><br><span class="line"></span><br><span class="line">def run(suite):</span><br><span class="line">    logging.info(&quot;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D; 测试开始 &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&quot;)</span><br><span class="line">    with open(report_file, &#39;wb&#39;) as f: </span><br><span class="line">         HTMLTestRunner(stream&#x3D;f, title&#x3D;&quot;Api Test&quot;, description&#x3D;&quot;测试描述&quot;, tester&#x3D;&quot;卡卡&quot;).run(suite)</span><br><span class="line">   </span><br><span class="line">    # send_email(report_file)  </span><br><span class="line">    logging.info(&quot;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D; 测试结束 &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&quot;)</span><br><span class="line"></span><br><span class="line">def run_all():  # 运行所用用例</span><br><span class="line">    run(discover())</span><br><span class="line"></span><br><span class="line">def run_suite(suite_name):  # 运行&#96;test&#x2F;suite&#x2F;test_suites.py&#96;文件中自定义的TestSuite</span><br><span class="line">    suite &#x3D; get_suite(suite_name)</span><br><span class="line">    if suite:</span><br><span class="line">        run(suite)</span><br><span class="line">    else:</span><br><span class="line">        print(&quot;TestSuite不存在&quot;)</span><br></pre></td></tr></table></figure>

<h3 id="只列出所有用例（并不执行）"><a href="#只列出所有用例（并不执行）" class="headerlink" title="只列出所有用例（并不执行）#"></a>只列出所有用例（并不执行）<a target="_blank" rel="noopener" href="https://www.cnblogs.com/superhin/p/10339009.html#3456280865">#</a></h3><p><code>run.py</code>中添加</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">def collect():   # 由于使用discover() 组装的TestSuite是按文件夹目录多级嵌套的，我们把所有用例取出，放到一个无嵌套的TestSuite中，方便之后操作</span><br><span class="line">    suite &#x3D; unittest.TestSuite()</span><br><span class="line"></span><br><span class="line">    def _collect(tests):   # 递归，如果下级元素还是TestSuite则继续往下找</span><br><span class="line">        if isinstance(tests, unittest.TestSuite):</span><br><span class="line">            if tests.countTestCases() !&#x3D; 0:</span><br><span class="line">                for i in tests:</span><br><span class="line">                    _collect(i)</span><br><span class="line">        else:</span><br><span class="line">            suite.addTest(tests)  # 如果下级元素是TestCase，则添加到TestSuite中</span><br><span class="line"></span><br><span class="line">    _collect(discover())</span><br><span class="line">    return suite</span><br><span class="line"></span><br><span class="line">def collect_only():   # 仅列出所用用例</span><br><span class="line">    t0 &#x3D; time.time()</span><br><span class="line">    i &#x3D; 0</span><br><span class="line">    for case in collect():</span><br><span class="line">        i +&#x3D; 1</span><br><span class="line">        print(&quot;&#123;&#125;.&#123;&#125;&quot;.format(str(i), case.id()))</span><br><span class="line">    print(&quot;----------------------------------------------------------------------&quot;)</span><br><span class="line">    print(&quot;Collect &#123;&#125; tests is &#123;:.3f&#125;s&quot;.format(str(i),time.time()-t0))</span><br></pre></td></tr></table></figure>

<h3 id="按testlist用例列表运行"><a href="#按testlist用例列表运行" class="headerlink" title="按testlist用例列表运行#"></a>按testlist用例列表运行<a target="_blank" rel="noopener" href="https://www.cnblogs.com/superhin/p/10339009.html#503909404">#</a></h3><p>test文件夹下新建<code>testlist.txt</code>，内容如下</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">test_user_login_normal</span><br><span class="line">test_user_reg_normal</span><br><span class="line"># test_user_reg_exist   # 注释后不执行</span><br></pre></td></tr></table></figure>

<p><code>run.py</code>中添加</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">def makesuite_by_testlist(testlist_file):  # test_list_file配置在config&#x2F;config.py中</span><br><span class="line">    with open(testlist_file) as f:</span><br><span class="line">        testlist &#x3D; f.readlines()</span><br><span class="line"></span><br><span class="line">    testlist &#x3D; [i.strip() for i in testlist if not i.startswith(&quot;#&quot;)]   # 去掉每行结尾的&quot;&#x2F;n&quot;和 #号开头的行</span><br><span class="line"></span><br><span class="line">    suite &#x3D; unittest.TestSuite() </span><br><span class="line">    all_cases &#x3D; collect()  # 所有用例</span><br><span class="line">    for case in all_cases:  # 从所有用例中匹配用例方法名</span><br><span class="line">        if case._testMethodName in testlist:</span><br><span class="line">            suite.addTest(case)</span><br><span class="line">    return suite</span><br></pre></td></tr></table></figure>

<h3 id="按用例标签运行"><a href="#按用例标签运行" class="headerlink" title="按用例标签运行#"></a>按用例标签运行<a target="_blank" rel="noopener" href="https://www.cnblogs.com/superhin/p/10339009.html#1593782271">#</a></h3><p>由于TestSuite我们必须提前组装好，而为每个用例方法添加上标签，然后运行指定标签的用例能更加灵活<br>遗憾的是，unittest并没有tag相关功能，一种实现方案是:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">def tag(tag):</span><br><span class="line">    if tag&#x3D;&#x3D;OptionParser.options.tag:   # 运行的命令行参数</span><br><span class="line">        return lambda func: func    # 如果用例的tag&#x3D;&#x3D;命令行指定的tag参数，返回用例本身</span><br><span class="line">    return unittest.skip(&quot;跳过不包含该tag的用例&quot;)    #  否则跳过用例</span><br></pre></td></tr></table></figure>

<p>用例标记方法</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">@tag(&quot;level1&quot;)</span><br><span class="line">def test_a(self):</span><br><span class="line">    pass</span><br></pre></td></tr></table></figure>

<p>这种方法在最后的报告中会出现很多<code>skipped</code>的用例，可能会干扰到因其他（如环境）原因需要跳过的用例<br>我这里的实现方法是通过判断用例方法中的docstring中加入特定的标签来重新组织TestSuite的方式<br><code>run.py</code>中添加</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">def makesuite_by_tag(tag):</span><br><span class="line">    suite &#x3D; unittest.TestSuite()</span><br><span class="line">    for case in collect():</span><br><span class="line">        if case._testMethodDoc and tag in case._testMethodDoc:  # 如果用例方法存在docstring,并且docstring中包含本标签</span><br><span class="line">            suite.addTest(case)</span><br><span class="line">    return suite</span><br></pre></td></tr></table></figure>

<p>用例标记方法</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">class TestUserLogin(BaseCase):</span><br><span class="line">    def test_user_login_normal(self):</span><br><span class="line">        &quot;&quot;&quot;level1:正常登录&quot;&quot;&quot;    # level1及是一个标签，放到docstring哪里都可以</span><br><span class="line">        case_data &#x3D; self.get_case_data(&quot;test_user_login_normal&quot;)</span><br><span class="line">        self.send_request(case_data)</span><br></pre></td></tr></table></figure>

<h3 id="重新运行上次失败用例"><a href="#重新运行上次失败用例" class="headerlink" title="重新运行上次失败用例#"></a>重新运行上次失败用例<a target="_blank" rel="noopener" href="https://www.cnblogs.com/superhin/p/10339009.html#2021679957">#</a></h3><p>我们在每次执行后，通过执行结果result.failures获取到失败的用例，组装成TestSuite并序列化到指定文件中，rerun-fails时，反序列化得到上次执行失败的TestSuite， 然后运行<br>在<code>run.py</code>中添加</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">import pickle</span><br><span class="line">import sys</span><br><span class="line"></span><br><span class="line">def save_failures(result, file):   # file为序列化保存的文件名，配置在config&#x2F;config.py中</span><br><span class="line">    suite &#x3D; unittest.TestSuite()</span><br><span class="line">    for case_result in result.failures:   # 组装TestSuite</span><br><span class="line">        suite.addTest(case_result[0])   # case_result是个元祖，第一个元素是用例对象，后面是失败原因等等</span><br><span class="line"></span><br><span class="line">    with open(file, &#39;wb&#39;) as f:</span><br><span class="line">        pickle.dump(suite, f)    # 序列化到指定文件</span><br><span class="line"></span><br><span class="line">def rerun_fails():  # 失败用例重跑方法</span><br><span class="line">    sys.path.append(test_case_path)   # 需要将用例路径添加到包搜索路径中，不然反序列化TestSuite会找不到用例</span><br><span class="line">    with open(last_fails_file, &#39;rb&#39;) as f:</span><br><span class="line">        suite &#x3D; pickle.load(f)    # 反序列化得到TestSuite</span><br><span class="line">    run(suite)</span><br></pre></td></tr></table></figure>

<p>修改<code>run.py</code>中的run()方法，运行后保存失败用例序列化文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">def run(suite):</span><br><span class="line">    logging.info(&quot;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D; 测试开始 &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&quot;)</span><br><span class="line"></span><br><span class="line">    with open(report_file, &#39;wb&#39;) as f: </span><br><span class="line">        # 结果赋予result变量</span><br><span class="line">        result &#x3D; HTMLTestRunner(stream&#x3D;f, title&#x3D;&quot;Api Test&quot;, description&#x3D;&quot;测试描述&quot;, tester&#x3D;&quot;卡卡&quot;).run(suite)  </span><br><span class="line"></span><br><span class="line">    if result.failures:   # 保存失败用例序列化文件</span><br><span class="line">        save_failures(result, last_fails_file)</span><br><span class="line"></span><br><span class="line">    # send_email(report_file)  # 从配置文件中读取</span><br><span class="line">    logging.info(&quot;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D; 测试结束 &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&quot;)</span><br></pre></td></tr></table></figure>

<h3 id="使用命令行参数"><a href="#使用命令行参数" class="headerlink" title="使用命令行参数#"></a>使用命令行参数<a target="_blank" rel="noopener" href="https://www.cnblogs.com/superhin/p/10339009.html#2350009999">#</a></h3><p>命令行参数是我们通过命令行调用<code>run.py</code>(执行入口文件)传递的一些参数，通过不同的参数，执行不同的运行策略，如<code>python run.py --collect-only</code></p>
<p>我们通过optparser实现命令行参数：<br>在<code>config/config.py</code>中添加</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"># 命令行选项</span><br><span class="line">parser &#x3D; OptionParser()</span><br><span class="line"></span><br><span class="line">parser.add_option(&#39;--collect-only&#39;, action&#x3D;&#39;store_true&#39;, dest&#x3D;&#39;collect_only&#39;, help&#x3D;&#39;仅列出所有用例&#39;)</span><br><span class="line">parser.add_option(&#39;--rerun-fails&#39;, action&#x3D;&#39;store_true&#39;, dest&#x3D;&#39;rerun_fails&#39;, help&#x3D;&#39;运行上次失败的用例&#39;)</span><br><span class="line">parser.add_option(&#39;--testlist&#39;, action&#x3D;&#39;store_true&#39;, dest&#x3D;&#39;testlist&#39;, help&#x3D;&#39;运行test&#x2F;testlist.txt列表指定用例&#39;)</span><br><span class="line"></span><br><span class="line">parser.add_option(&#39;--testsuite&#39;, action&#x3D;&#39;store&#39;, dest&#x3D;&#39;testsuite&#39;, help&#x3D;&#39;运行指定的TestSuite&#39;)</span><br><span class="line">parser.add_option(&#39;--tag&#39;, action&#x3D;&#39;store&#39;, dest&#x3D;&#39;tag&#39;, help&#x3D;&#39;运行指定tag的用例&#39;)</span><br><span class="line"></span><br><span class="line">(options, args) &#x3D; parser.parse_args()  # 应用选项（使生效）</span><br></pre></td></tr></table></figure>

<ul>
<li>‘–conllect-only’是参数名，dest=’collect-only’指存储到 options.collect_only变量中，’store_true’指，如果有该参数，options.collect_only=True</li>
<li>‘store’指将–testsuite=’smoke_suite’，参数的值’smoke_suite’存到options.testsuite变量中</li>
</ul>
<p>命令行选项使用方法：<br><code>run.py</code>中添加：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">from config.config import *</span><br><span class="line"></span><br><span class="line">def main():</span><br><span class="line">    if options.collect_only:    # 如果指定了--collect-only参数</span><br><span class="line">        collect_only()</span><br><span class="line">    elif options.rerun_fails:    # 如果指定了--rerun-fails参数</span><br><span class="line">        rerun_fails()</span><br><span class="line">    elif options.testlist:    # 如果指定了--testlist参数</span><br><span class="line">        run(makesuite_by_testlist(testlist_file))</span><br><span class="line">    elif options.testsuite:  # 如果指定了--testsuite&#x3D;***</span><br><span class="line">        run_suite(options.testsuite)</span><br><span class="line">    elif options.tag:  # 如果指定了--tag&#x3D;***</span><br><span class="line">        run(makesuite_by_tag(options.tag))</span><br><span class="line">    else:   # 否则，运行所有用例</span><br><span class="line">        run_all()</span><br><span class="line"></span><br><span class="line">if __name__ &#x3D;&#x3D; &#39;__main__&#39;:</span><br><span class="line">    main()   # 调用main()</span><br></pre></td></tr></table></figure>

<p>运行结果：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">C:\Users\hanzhichao\PycharmProjects\api_test_framework_finish&gt;python run.py --collect-only</span><br><span class="line">1.user.test_user_login.TestUserLogin.test_user_login_normal</span><br><span class="line">2.user.test_user_login.TestUserLogin.test_user_login_password_wrong</span><br><span class="line">3.user.test_user_reg.TestUserReg.test_user_reg_exist</span><br><span class="line">4.user.test_user_reg.TestUserReg.test_user_reg_normal</span><br><span class="line">----------------------------------------------------------------------</span><br><span class="line">Collect 4 tests is 0.006s</span><br><span class="line">C:\Users\hanzhichao\PycharmProjects\api_test_framework_finish&gt;python run.py --rerun-fails</span><br><span class="line">.</span><br><span class="line">Time Elapsed: 0:00:00.081812</span><br><span class="line">C:\Users\hanzhichao\PycharmProjects\api_test_framework_finish&gt;python run.py --testlist</span><br><span class="line">..</span><br><span class="line">Time Elapsed: 0:00:00.454654</span><br><span class="line">C:\Users\hanzhichao\PycharmProjects\api_test_framework_finish&gt;python run.py --testsuite&#x3D;smoke_suite</span><br><span class="line">..</span><br><span class="line">Time Elapsed: 0:00:00.471255</span><br><span class="line">C:\Users\hanzhichao\PycharmProjects\api_test_framework_finish&gt;python run.py --tag&#x3D;level1</span><br><span class="line">.</span><br><span class="line">Time Elapsed: 0:00:00.062273</span><br><span class="line">C:\Users\hanzhichao\PycharmProjects\api_test_framework_finish&gt;python run.py </span><br><span class="line">....</span><br><span class="line">Time Elapsed: 0:00:00.663564</span><br></pre></td></tr></table></figure>

<h2 id="其他优化"><a href="#其他优化" class="headerlink" title="其他优化#"></a>其他优化<a target="_blank" rel="noopener" href="https://www.cnblogs.com/superhin/p/10339009.html#1733200949">#</a></h2><p>1.按天生成log，每次执行生成新的报告</p>
<p>修改<code>config/config.py</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">import time</span><br><span class="line"></span><br><span class="line">today &#x3D; time.strftime(&#39;%Y%m%d&#39;, time.localtime())</span><br><span class="line">now &#x3D; time.strftime(&#39;%Y%m%d_%H%M%S&#39;, time.localtime())</span><br><span class="line"></span><br><span class="line">log_file &#x3D; os.path.join(prj_path, &#39;log&#39;, &#39;log_&#123;&#125;.txt&#39;.format(today))  # 更改路径到log目录下</span><br><span class="line">report_file &#x3D; os.path.join(prj_path, &#39;report&#39;, &#39;report_&#123;&#125;.html&#39;.format(now))  # 更改路径到report目录下</span><br></pre></td></tr></table></figure>

<p>2.增加send_email()开关<br><code>config/config.py</code>增加</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">send_email_after_run &#x3D; False</span><br></pre></td></tr></table></figure>

<p>修改<code>run.py</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">from config.config import *</span><br><span class="line"></span><br><span class="line">def run(suite):</span><br><span class="line">    logging.info(&quot;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D; 测试开始 &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&quot;)</span><br><span class="line"></span><br><span class="line">    with open(report_file, &#39;wb&#39;) as f:  # 从配置文件中读取</span><br><span class="line">        result &#x3D; HTMLTestRunner(stream&#x3D;f, title&#x3D;&quot;Api Test&quot;, description&#x3D;&quot;测试描述&quot;, tester&#x3D;&quot;卡卡&quot;).run(suite)</span><br><span class="line"></span><br><span class="line">    if result.failures:</span><br><span class="line">        save_failures(result, last_fails_file)</span><br><span class="line"></span><br><span class="line">    if send_email_after_run:  # 是否发送邮件</span><br><span class="line">        send_email(report_file)  </span><br><span class="line">    logging.info(&quot;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D; 测试结束 &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&quot;)</span><br></pre></td></tr></table></figure>

<blockquote>
<p>发送最新报告的问题稍后解决<br>源码地址： 链接：<a target="_blank" rel="noopener" href="https://pan.baidu.com/s/1DLNSKN0KKuvSgo7gbGbMeg">https://pan.baidu.com/s/1DLNSKN0KKuvSgo7gbGbMeg</a> 密码：994e</p>
</blockquote>
<h1 id="Python接口测试实战5（上）-Git及Jenkins持续集成"><a href="#Python接口测试实战5（上）-Git及Jenkins持续集成" class="headerlink" title="Python接口测试实战5（上） - Git及Jenkins持续集成"></a><a target="_blank" rel="noopener" href="https://www.cnblogs.com/superhin/p/10339016.html">Python接口测试实战5（上） - Git及Jenkins持续集成</a></h1><h2 id="本节内容-5"><a href="#本节内容-5" class="headerlink" title="本节内容#"></a>本节内容<a target="_blank" rel="noopener" href="https://www.cnblogs.com/superhin/p/10339016.html#170929810">#</a></h2><blockquote>
<p>接上节内容：在框架搭建好的基础上</p>
</blockquote>
<ul>
<li>注册Github并新建仓库</li>
<li>使用Git上传项目</li>
<li>Jenkins的安装</li>
<li>Jenkins接口测试项目的配置</li>
</ul>
<h2 id="注册Github并新建仓库"><a href="#注册Github并新建仓库" class="headerlink" title="注册Github并新建仓库#"></a>注册Github并新建仓库<a target="_blank" rel="noopener" href="https://www.cnblogs.com/superhin/p/10339016.html#308984784">#</a></h2><p><strong>Git简介</strong><br>Git(读音为/gɪt/。)是一个开源的分布式版本控制系统</p>
<ul>
<li>版本控制： 对项目及代码记录每次提交和修改，并可以版本回退</li>
<li>分布式：每个开发者大部分操作（新建分支，修改，提交）都只需要在各自本地操作即可，一般只有release（提测/发布）时才需要推到远程服务器去</li>
</ul>
<p><strong>Github简介</strong><br>Github是一个基于Git的代码/项目的托管平台。平常在Github上积累自己的练习代码和一些成果，可以为求职加分。</p>
<ol>
<li>注册Github<br>打开 <a target="_blank" rel="noopener" href="https://github.com/">https://github.com/</a> 并使用自己的邮箱注册，然后登录</li>
</ol>
<p><a target="_blank" rel="noopener" href="https://upload-images.jianshu.io/upload_images/7575721-b23adbc20b533a4d.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">![Github主页](Python Restful.assets/7575721-b23adbc20b533a4d.png)</a></p>
<ol>
<li>新建仓库（Repository）</li>
</ol>
<blockquote>
<p>仓库即一个项目，用来保存项目代码</p>
</blockquote>
<p><a target="_blank" rel="noopener" href="https://upload-images.jianshu.io/upload_images/7575721-2d664351c459e5f5.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">![新建仓库](Python Restful.assets/7575721-2d664351c459e5f5.png)</a><br><a target="_blank" rel="noopener" href="https://upload-images.jianshu.io/upload_images/7575721-79d96705a7375fc6.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">![输入仓库名及描述点击New Repository](Python Restful.assets/7575721-79d96705a7375fc6.png)</a></p>
<p><a target="_blank" rel="noopener" href="https://upload-images.jianshu.io/upload_images/7575721-1cab68cbbf42cbf9.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">![仓库建立完成](Python Restful.assets/7575721-1cab68cbbf42cbf9.png)</a></p>
<h2 id="使用Git上传项目"><a href="#使用Git上传项目" class="headerlink" title="使用Git上传项目#"></a>使用Git上传项目<a target="_blank" rel="noopener" href="https://www.cnblogs.com/superhin/p/10339016.html#2529060692">#</a></h2><p>1.下载并按照Git客户端<br>打开<a target="_blank" rel="noopener" href="https://gitforwindows.org/%E7%82%B9%E5%87%BBDownload%EF%BC%8C%E5%8F%8C%E5%87%BB%E4%B8%8B%E8%BD%BD%E7%9A%84%E6%96%87%E4%BB%B6%E4%B8%80%E8%B7%AFNext%E5%8D%B3%E5%8F%AF">https://gitforwindows.org/点击Download，双击下载的文件一路Next即可</a><br><a target="_blank" rel="noopener" href="https://upload-images.jianshu.io/upload_images/7575721-fc3988adc4c17145.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">![Git客户端安装](Python Restful.assets/7575721-fc3988adc4c17145.png)</a></p>
<p>2.在搭建好的框架根目录打开命令行，使用PyCharm也可以<br><a target="_blank" rel="noopener" href="https://upload-images.jianshu.io/upload_images/7575721-7c46763eff308e2e.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">![在Pycharm中使用命令行](Python Restful.assets/7575721-7c46763eff308e2e.png)</a></p>
<p>3.按照Github仓库提示（略有不同）上传项目</p>
<p>在PyCharm命令行处执行以下命令：</p>
<ul>
<li>git init：初始化git项目</li>
<li>git add . : 添加所有文件到 变更列表（注意有个点）</li>
<li>git commit -m “首次提交”： 本地提交， 引号中书写change log，变更备注</li>
<li>git remote add origin <a target="_blank" rel="noopener" href="https://github.com/superhin001/api_test.git%EF%BC%9A%E9%A6%96%E6%AC%A1%E6%8F%90%E4%BA%A4%E9%9C%80%E8%A6%81%E5%85%B3%E8%81%94%E8%BF%9C%E7%A8%8B%E4%BB%93%E5%BA%93">https://github.com/superhin001/api_test.git：首次提交需要关联远程仓库</a></li>
<li>git push -u origin master：推送到远端（origin）master分支（此时需要输入用户名和密码）</li>
</ul>
<p><a target="_blank" rel="noopener" href="https://upload-images.jianshu.io/upload_images/7575721-ba9933bc1b425e64.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">![初始化，添加，提交](Python Restful.assets/7575721-ba9933bc1b425e64.png)</a></p>
<p><a target="_blank" rel="noopener" href="https://upload-images.jianshu.io/upload_images/7575721-2d9644deeb2f0ee9.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">![关联远端仓库，上传](Python Restful.assets/7575721-2d9644deeb2f0ee9.png)</a></p>
<p>刷新Github该仓库页面<br><a target="_blank" rel="noopener" href="https://upload-images.jianshu.io/upload_images/7575721-1dfc92dd6b3ae22a.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">![Github该仓库页面](Python Restful.assets/7575721-1dfc92dd6b3ae22a.png)</a></p>
<h2 id="Jenkins的安装"><a href="#Jenkins的安装" class="headerlink" title="Jenkins的安装#"></a>Jenkins的安装<a target="_blank" rel="noopener" href="https://www.cnblogs.com/superhin/p/10339016.html#2732083897">#</a></h2><blockquote>
<p>安装Jenkins需要先安装jdk，Jenkins 2.<em>版本需要jdk 1.8.</em><br>jdk下载地址：<a target="_blank" rel="noopener" href="https://www.oracle.com/technetwork/java/javase/downloads/jdk8-downloads-2133151.html">https://www.oracle.com/technetwork/java/javase/downloads/jdk8-downloads-2133151.html</a><br>jdk安装及环境变量配置请自行百度</p>
</blockquote>
<p>1.Jenkins下载地址： <a target="_blank" rel="noopener" href="https://jenkins.io/download/%EF%BC%8C%E4%B8%8B%E8%BD%BDWindows%E5%AE%89%E8%A3%85%E5%8C%85%E6%88%96jenkins.war%E5%8C%85%E9%83%BD%E5%8F%AF%E4%BB%A5%EF%BC%8C%E8%BF%99%E9%87%8C%E6%8C%89jenkins.war%E5%8C%85%E8%AE%B2%E8%A7%A3">https://jenkins.io/download/，下载Windows安装包或jenkins.war包都可以，这里按jenkins.war包讲解</a><br><a target="_blank" rel="noopener" href="https://upload-images.jianshu.io/upload_images/7575721-d190ecc2332d8411.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">![下载Jenkins](Python Restful.assets/7575721-d190ecc2332d8411.png)</a></p>
<p>2.在jenkins.war包所在文件夹下，按住shift点击鼠标右键，在此处打开命令行窗口，运行<code>java -jar jenkins.war</code>（不要关闭命令行窗口）</p>
<blockquote>
<p>如果8080端口被占用，可使用<code>java -jar jenkins.war --httpPort=9999</code> 来修改端口号</p>
</blockquote>
<p><a target="_blank" rel="noopener" href="https://upload-images.jianshu.io/upload_images/7575721-8b27282937f9ccdf.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">![启动Jenkins](Python Restful.assets/7575721-8b27282937f9ccdf.png)</a></p>
<p>3.打开浏览器访问：<a target="_blank" rel="noopener" href="http://localhost:8080/">http://localhost:8080</a><br><a target="_blank" rel="noopener" href="https://upload-images.jianshu.io/upload_images/7575721-aacebacc2045eaf0.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">![初次访问Jenkins需要解锁](Python Restful.assets/7575721-aacebacc2045eaf0.png)</a></p>
<p>4.解锁Jenkins: 拖动路径到浏览器标签页，复制密码，填入并点击解锁<br><a target="_blank" rel="noopener" href="https://upload-images.jianshu.io/upload_images/7575721-88a6e460e8388907.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">![复制密码](Python Restful.assets/7575721-88a6e460e8388907.png)</a></p>
<p><a target="_blank" rel="noopener" href="https://upload-images.jianshu.io/upload_images/7575721-06430365399033cf.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">![填入密码点击解锁](Python Restful.assets/7575721-06430365399033cf.png)</a></p>
<p>5.安装推荐插件， 等待安装完成<br><a target="_blank" rel="noopener" href="https://upload-images.jianshu.io/upload_images/7575721-90dc7b62d17caa70.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">![安装推荐插件](Python Restful.assets/7575721-90dc7b62d17caa70.png)</a></p>
<p>6.新建管理用户</p>
<p><a target="_blank" rel="noopener" href="https://upload-images.jianshu.io/upload_images/7575721-91d755a7dbe27202.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">![新建管理用户](Python Restful.assets/7575721-91d755a7dbe27202.png)</a></p>
<p>7.配置服务器运行端口<br><a target="_blank" rel="noopener" href="https://upload-images.jianshu.io/upload_images/7575721-5c9efd2b55a0e08a.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">![配置服务器运行端口](Python Restful.assets/7575721-5c9efd2b55a0e08a.png)</a></p>
<p><a target="_blank" rel="noopener" href="https://upload-images.jianshu.io/upload_images/7575721-8fbd2c0e8903f6e7.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">![安装完成](Python Restful.assets/7575721-8fbd2c0e8903f6e7.png)</a></p>
<h2 id="Jenkins接口测试项目的配置"><a href="#Jenkins接口测试项目的配置" class="headerlink" title="Jenkins接口测试项目的配置#"></a>Jenkins接口测试项目的配置<a target="_blank" rel="noopener" href="https://www.cnblogs.com/superhin/p/10339016.html#649221334">#</a></h2><p>工作流：<br>从Github拉取最新代码 -&gt; 构建（运行测试）-&gt; 发布报告 -&gt; 发送邮件通知</p>
<p>1.新建一个自由风格的项目<br><a target="_blank" rel="noopener" href="https://upload-images.jianshu.io/upload_images/7575721-503707416aea065b.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">![新建一个自由风格的项目](Python Restful.assets/7575721-503707416aea065b.png)</a><br><a target="_blank" rel="noopener" href="https://upload-images.jianshu.io/upload_images/7575721-8f19b8a2c4029db3.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">![项目配置](Python Restful.assets/7575721-8f19b8a2c4029db3.png)</a></p>
<p>2.源码管理<br>源码管理选择Git， 填写仓库地址<br><a target="_blank" rel="noopener" href="https://upload-images.jianshu.io/upload_images/7575721-21569d79f5e82d4b.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">![源码管理选择Git](Python Restful.assets/7575721-21569d79f5e82d4b.png)</a></p>
<p><a target="_blank" rel="noopener" href="https://upload-images.jianshu.io/upload_images/7575721-e0eb909f7f916786.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">![复制仓库地址](Python Restful.assets/7575721-e0eb909f7f916786.png)</a></p>
<p>信息身份认证，填入github用户名和密码保存</p>
<blockquote>
<p>如上，github上的开放仓库(可以公开clone)<br>不需要添加身份认证信息</p>
</blockquote>
<p><a target="_blank" rel="noopener" href="https://upload-images.jianshu.io/upload_images/7575721-7cdeb80940bc5a06.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">![新建身份认证](Python Restful.assets/7575721-7cdeb80940bc5a06.png)</a></p>
<p>选择刚建立的身份认证<br><a target="_blank" rel="noopener" href="https://upload-images.jianshu.io/upload_images/7575721-69c8f250378d21c1.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">![选择身份认证](Python Restful.assets/7575721-69c8f250378d21c1.png)</a></p>
<p>3.构建（执行测试）<br>增加构建步骤-选择执行Windows批处理命令<br><a target="_blank" rel="noopener" href="https://upload-images.jianshu.io/upload_images/7575721-6442e0e72577dd95.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">![增加构建步骤-选择执行Windows批处理命令](Python Restful.assets/7575721-6442e0e72577dd95.png)</a></p>
<p><a target="_blank" rel="noopener" href="https://upload-images.jianshu.io/upload_images/7575721-e58513be9e691d66.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">![填入脚本执行命令](Python Restful.assets/7575721-e58513be9e691d66.png)</a></p>
<p>4.构建后操作（稍后补充）</p>
<p>5.执行测试<br>点击立即构建-执行测试，可以在下边看到执行状态，红球为失败，蓝球为成功<br><a target="_blank" rel="noopener" href="https://upload-images.jianshu.io/upload_images/7575721-0dca6cfbdb326667.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">![点击立即构建-执行测试](Python Restful.assets/7575721-0dca6cfbdb326667.png)</a></p>
<p>点击执行记录的圆球可以查看执行log<br><a target="_blank" rel="noopener" href="https://upload-images.jianshu.io/upload_images/7575721-d1c51f9af3b12b50.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">![查看构建log](Python Restful.assets/7575721-d1c51f9af3b12b50.png)</a></p>
<p>#<a target="_blank" rel="noopener" href="https://www.cnblogs.com/superhin/p/10339004.html#618584635">Python接口测试实战5（下） - RESTful、Web Service及Mock Server本节内容</a></p>
<ul>
<li>REST及RESTful API</li>
<li>Web Service</li>
<li>XML解析</li>
<li>Mock Server</li>
</ul>
<h2 id="REST及RESTful-API"><a href="#REST及RESTful-API" class="headerlink" title="REST及RESTful API#"></a>REST及RESTful API<a target="_blank" rel="noopener" href="https://www.cnblogs.com/superhin/p/10339004.html#3525418215">#</a></h2><blockquote>
<p>参考链接： <a target="_blank" rel="noopener" href="https://blog.csdn.net/lch2848508/article/details/72729658">https://blog.csdn.net/lch2848508/article/details/72729658</a></p>
</blockquote>
<p>REST：表述性状态转移或表现层状态转移，“表现”及每个接口地址(URI)都表现为（视为）一个资源对象（文本资源、图片资源、服务资源），状态转移指通过POST/PUT方法发送完整的新状态信息来更改资源对象的状态<br>如某<a target="_blank" rel="noopener" href="https://api.***.com/user%E8%B5%84%E6%BA%90%E7%8A%B6%E6%80%81%E4%B8%BA%60%7B&quot;name&quot;">https://api.***.com/user资源状态为`{&quot;name&quot;</a>: “Kaka”, “age”: 30}<code>，我们通过POST/PUT请求发送新状态</code>{“name”: “Kaka”, “age”: 18}`来更新对象信息，完成状态转移</p>
<blockquote>
<p>URI 与URL的区别：URL值包含协议的链接，如<code>https://www.baidu.com</code>， 还有一种相对链接叫URN，如<code>/doc/1.html</code>，这两种都能唯一定位一个资源，URI（统一资源定位符）包含URL和URN</p>
</blockquote>
<p>RESTful API是一种接口设计风格或规范，主要有以下特点：</p>
<ul>
<li>统一使用https协议</li>
<li>接口使用专用的api域名 <code>https://api.example.com/</code></li>
<li>接口分版本管理 <code>https://api.example.com/v1/</code></li>
<li>路径又称”终点”（endpoint），表示API的具体网址，路径中只能包含名词(代表资源对象)，可以使用复数来代表多个一个资源集合<code>https://api.example.com/v1/zoos</code></li>
<li>同一个接口提供多种请求方法，GET获取资源信息，POST新建或更新资源，PUT/PATCH更新资源，DELETE删除资源</li>
<li>可以通过url参数过滤信息 <code>https://api.example.com/v1/zoos?limit=10 # 获取前10个</code></li>
<li>尽量使用JSON, 避免使用XML</li>
<li>身份认证推荐使用OAuth2.0，或Basic Auth，token等，避免使用Cookie和Session（RESTful强调无状态的设计）</li>
</ul>
<p><strong>示例：</strong></p>
<p><a target="_blank" rel="noopener" href="https://api.github.com/">https://api.github.com</a><br>授权 Basic Auth (superhin001, ***) 或 Oauth 2.0 Access Token: <code>1c4f679300f29ee4e7041028d49e504b9da145b1</code></p>
<p>GET <a target="_blank" rel="noopener" href="https://api.github.com/user">https://api.github.com/user</a> 获取用户信息<br><a target="_blank" rel="noopener" href="https://upload-images.jianshu.io/upload_images/7575721-6d1d02add4a0bc86.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">![GET https://api.github.com/user](Python Restful.assets/7575721-6d1d02add4a0bc86.png)</a></p>
<p>POST/PATCH <a target="_blank" rel="noopener" href="https://api.github.com/user">https://api.github.com/user</a> 修改用户信息<br><a target="_blank" rel="noopener" href="https://upload-images.jianshu.io/upload_images/7575721-8edea2c065463516.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">![POST https://api.github.com/user](Python Restful.assets/7575721-8edea2c065463516.png)</a><br>POST/PATCH 数据</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    &quot;login&quot;: &quot;superhin001&quot;,</span><br><span class="line">    &quot;id&quot;: 21163682,</span><br><span class="line">    &quot;node_id&quot;: &quot;MDQ6VXNlcjIxMTYzNjgy&quot;,</span><br><span class="line">    &quot;avatar_url&quot;: &quot;https:&#x2F;&#x2F;avatars3.githubusercontent.com&#x2F;u&#x2F;21163682?v&#x3D;4&quot;,</span><br><span class="line">    &quot;gravatar_id&quot;: &quot;&quot;,</span><br><span class="line">    &quot;url&quot;: &quot;https:&#x2F;&#x2F;api.github.com&#x2F;users&#x2F;superhin001&quot;,</span><br><span class="line">    &quot;html_url&quot;: &quot;https:&#x2F;&#x2F;github.com&#x2F;superhin001&quot;,</span><br><span class="line">    &quot;followers_url&quot;: &quot;https:&#x2F;&#x2F;api.github.com&#x2F;users&#x2F;superhin001&#x2F;followers&quot;,</span><br><span class="line">    &quot;following_url&quot;: &quot;https:&#x2F;&#x2F;api.github.com&#x2F;users&#x2F;superhin001&#x2F;following&#123;&#x2F;other_user&#125;&quot;,</span><br><span class="line">    &quot;gists_url&quot;: &quot;https:&#x2F;&#x2F;api.github.com&#x2F;users&#x2F;superhin001&#x2F;gists&#123;&#x2F;gist_id&#125;&quot;,</span><br><span class="line">    &quot;starred_url&quot;: &quot;https:&#x2F;&#x2F;api.github.com&#x2F;users&#x2F;superhin001&#x2F;starred&#123;&#x2F;owner&#125;&#123;&#x2F;repo&#125;&quot;,</span><br><span class="line">    &quot;subscriptions_url&quot;: &quot;https:&#x2F;&#x2F;api.github.com&#x2F;users&#x2F;superhin001&#x2F;subscriptions&quot;,</span><br><span class="line">    &quot;organizations_url&quot;: &quot;https:&#x2F;&#x2F;api.github.com&#x2F;users&#x2F;superhin001&#x2F;orgs&quot;,</span><br><span class="line">    &quot;repos_url&quot;: &quot;https:&#x2F;&#x2F;api.github.com&#x2F;users&#x2F;superhin001&#x2F;repos&quot;,</span><br><span class="line">    &quot;events_url&quot;: &quot;https:&#x2F;&#x2F;api.github.com&#x2F;users&#x2F;superhin001&#x2F;events&#123;&#x2F;privacy&#125;&quot;,</span><br><span class="line">    &quot;received_events_url&quot;: &quot;https:&#x2F;&#x2F;api.github.com&#x2F;users&#x2F;superhin001&#x2F;received_events&quot;,</span><br><span class="line">    &quot;type&quot;: &quot;User&quot;,</span><br><span class="line">    &quot;site_admin&quot;: false,</span><br><span class="line">    &quot;name&quot;: &quot;我是韩老师&quot;,</span><br><span class="line">    &quot;company&quot;: null,</span><br><span class="line">    &quot;blog&quot;: &quot;&quot;,</span><br><span class="line">    &quot;location&quot;: null,</span><br><span class="line">    &quot;email&quot;: &quot;superhin@126.com&quot;,</span><br><span class="line">    &quot;hireable&quot;: null,</span><br><span class="line">    &quot;bio&quot;: null,</span><br><span class="line">    &quot;public_repos&quot;: 3,</span><br><span class="line">    &quot;public_gists&quot;: 0,</span><br><span class="line">    &quot;followers&quot;: 0,</span><br><span class="line">    &quot;following&quot;: 0,</span><br><span class="line">    &quot;created_at&quot;: &quot;2016-08-22T01:12:32Z&quot;,</span><br><span class="line">    &quot;updated_at&quot;: &quot;2018-09-14T02:33:43Z&quot;,</span><br><span class="line">    &quot;private_gists&quot;: 0,</span><br><span class="line">    &quot;total_private_repos&quot;: 0,</span><br><span class="line">    &quot;owned_private_repos&quot;: 0,</span><br><span class="line">    &quot;disk_usage&quot;: 45430,</span><br><span class="line">    &quot;collaborators&quot;: 0,</span><br><span class="line">    &quot;two_factor_authentication&quot;: false,</span><br><span class="line">    &quot;plan&quot;: &#123;</span><br><span class="line">        &quot;name&quot;: &quot;free&quot;,</span><br><span class="line">        &quot;space&quot;: 976562499,</span><br><span class="line">        &quot;collaborators&quot;: 0,</span><br><span class="line">        &quot;private_repos&quot;: 0</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>GET <a target="_blank" rel="noopener" href="https://api.github.com/user/keys">https://api.github.com/user/keys</a> 获取用户所有SSH-Key信息<br><a target="_blank" rel="noopener" href="https://upload-images.jianshu.io/upload_images/7575721-525f29e629dcc9a5.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">![GET https://api.github.com/user/keys](Python Restful.assets/7575721-525f29e629dcc9a5.png)</a></p>
<p>POST <a target="_blank" rel="noopener" href="https://api.github.com/user/keys">https://api.github.com/user/keys</a> 新建Key<br><a target="_blank" rel="noopener" href="https://upload-images.jianshu.io/upload_images/7575721-1e90d13be79922f4.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">![POST https://api.github.com/user/keys](Python Restful.assets/7575721-1e90d13be79922f4.png)</a></p>
<p>POST 数据</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">        &quot;id&quot;: 30742411,</span><br><span class="line">        &quot;key&quot;: &quot;ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQDfsTJs7mNWstJ+tO6O1jQHKdDdnldqlqkO0gAune9EH7oqICD1hP7c1duNZwvNnvyGa7SyqamIpNXmSYv303FEVAXzPsb9MzCChG16gzevQtbIX4Qt7vFOsHNSCikSCD&#x2F;s6DMa0Koryiu7Yju5mW9UUnjVM+a1P80SOiK7p2UBQPFVKRrUtr0htV3U6a2rdP51Vzm2UCjChTUa4q7L3m4C7oB9aSvUsNTk+PmuJlAer4oOd7FsNPqD1Or3lRKAmgxbTX4xTaOkwibK0t2eYkh&#x2F;VTUPMQ9wDwpa4hZLiEq9qSew3McCwsl70k4H0H4F&#x2F;VwV2sSCXqZu274YmNDT5Hl3 hanzhichao@hanzhichao01&quot;,</span><br><span class="line">        &quot;title&quot;: &quot;test3&quot;,</span><br><span class="line">        &quot;verified&quot;: true,</span><br><span class="line">        &quot;created_at&quot;: &quot;2018-09-14T09:54:51Z&quot;,</span><br><span class="line">        &quot;read_only&quot;: false</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Web-Service"><a href="#Web-Service" class="headerlink" title="Web Service#"></a>Web Service<a target="_blank" rel="noopener" href="https://www.cnblogs.com/superhin/p/10339004.html#3455083572">#</a></h2><p>Web Service 是一种跨平台（Java对象，Python也可以调用）RPC（远程方法调用）解决方案。<br>基于SOAP协议，使用XML这种跨平台语言传输对远程方法的调用信息及返回结果，并提供WSDL接口描述服务</p>
<ul>
<li>SOAP：简单面向对象协议， 基于XML语言，使用HTTP协议传输</li>
<li>XML: 可扩展标记语言，同JSON一样是一种跨平台语言</li>
<li>WSDL: Web Service服务描述语言，提供远程对象的调用描述信息（类似于接口文档，XML格式）</li>
</ul>
<h3 id="SOAP格式"><a href="#SOAP格式" class="headerlink" title="SOAP格式#"></a>SOAP格式<a target="_blank" rel="noopener" href="https://www.cnblogs.com/superhin/p/10339004.html#230667815">#</a></h3><p>SOAP协议基于XML语言， SOAP消息体首先必须有个信封（Enelope），信封中可以有信息头（Header）和信息体（Body），其中Body中还可以包含错误信息（Fault）<br>基本格式如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- 信封固定格式 指定命名空间为soapenv --&gt;</span><br><span class="line">&lt;soapenv:Envelope xmlns:soapenv&#x3D;&quot;http:&#x2F;&#x2F;www.w3.org&#x2F;2001&#x2F;12&#x2F;soap-envelope&quot; soapenv:encodingStyle&#x3D;&quot;http:&#x2F;&#x2F;www.w3.org&#x2F;2001&#x2F;12&#x2F;soap-encoding&quot;&gt;   </span><br><span class="line">    &lt;soapenv:Header&gt;  &lt;!--信息头 可选，可写成但标签--&gt;</span><br><span class="line">        ......</span><br><span class="line">    &lt;&#x2F;soapenv:Header&gt;</span><br><span class="line">    &lt;soapenv:Body&gt;   &lt;!--信息体 实际调用内容--&gt;</span><br><span class="line">        ......</span><br><span class="line">    &lt;&#x2F;soapenv:Body&gt;</span><br><span class="line">&lt;&#x2F;soap:Envelope&gt;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>SOAP详细教程：<a target="_blank" rel="noopener" href="http://www.runoob.com/soap/soap-header.html">http://www.runoob.com/soap/soap-header.html</a></p>
</blockquote>
<p><strong>使用SoupUI</strong><br>示例接口： <code>http://115.28.108.130:4000/?wsdl</code><br>由于Postman等不具备将wsdl接口信息解析成对象描述的功能，我们使用另一个SOAP接口专用的测试工具SoupUI</p>
<blockquote>
<p>SoupUI下载地址： <a target="_blank" rel="noopener" href="http://www.wmzhe.com/soft-32815.html">http://www.wmzhe.com/soft-32815.html</a></p>
</blockquote>
<p>1.新建项目<br><a target="_blank" rel="noopener" href="https://upload-images.jianshu.io/upload_images/7575721-8796202ddafc5265.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">![File -&gt; 新建SOAP项目](Python Restful.assets/7575721-8796202ddafc5265.png)</a></p>
<p><a target="_blank" rel="noopener" href="https://upload-images.jianshu.io/upload_images/7575721-2c77922b58ae65ae.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">![填入项目名，WSDL地址，点击OK](Python Restful.assets/7575721-2c77922b58ae65ae.png)</a></p>
<p><a target="_blank" rel="noopener" href="https://upload-images.jianshu.io/upload_images/7575721-6520349eaafe016b.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">![保存后自动解析出所有方法（接口）信息](Python Restful.assets/7575721-6520349eaafe016b.png)</a></p>
<p>2.发送接口</p>
<p><a target="_blank" rel="noopener" href="https://upload-images.jianshu.io/upload_images/7575721-13e67193a52e820c.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">![填写参数处](Python Restful.assets/7575721-13e67193a52e820c.png)</a></p>
<p><a target="_blank" rel="noopener" href="https://upload-images.jianshu.io/upload_images/7575721-13312304bb2af2de.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">![填写完参数，点击发送按钮，查看响应结果](Python Restful.assets/7575721-13312304bb2af2de.png)</a></p>
<p>使用Fiddler抓包，查看raw格式：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">POST http:&#x2F;&#x2F;115.28.108.130:4000&#x2F; HTTP&#x2F;1.1</span><br><span class="line">Accept-Encoding: gzip,deflate</span><br><span class="line">Content-Type: text&#x2F;xml;charset&#x3D;UTF-8</span><br><span class="line">SOAPAction: &quot;addUser&quot;</span><br><span class="line">Content-Length: 370</span><br><span class="line">Host: 115.28.108.130:4000</span><br><span class="line">Connection: Keep-Alive</span><br><span class="line">User-Agent: Apache-HttpClient&#x2F;4.1.1 (java 1.5)</span><br><span class="line"></span><br><span class="line">&lt;soapenv:Envelope xmlns:soapenv&#x3D;&quot;http:&#x2F;&#x2F;schemas.xmlsoap.org&#x2F;soap&#x2F;envelope&#x2F;&quot; xmlns:user&#x3D;&quot;UserService&quot;&gt;</span><br><span class="line">   &lt;soapenv:Header&#x2F;&gt;</span><br><span class="line">   &lt;soapenv:Body&gt;</span><br><span class="line">      &lt;user:addUser&gt;</span><br><span class="line">         &lt;!--Optional:--&gt;</span><br><span class="line">         &lt;user:name&gt;范冰冰&lt;&#x2F;user:name&gt;</span><br><span class="line">         &lt;!--Optional:--&gt;</span><br><span class="line">         &lt;user:password&gt;123456&lt;&#x2F;user:password&gt;</span><br><span class="line">      &lt;&#x2F;user:addUser&gt;</span><br><span class="line">   &lt;&#x2F;soapenv:Body&gt;</span><br><span class="line">&lt;&#x2F;soapenv:Envelope&gt;</span><br></pre></td></tr></table></figure>

<p><strong>使用Postman发送SOAP接口</strong><br><a target="_blank" rel="noopener" href="https://upload-images.jianshu.io/upload_images/7575721-1065e817320b7669.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">![Postman发送SOAP接口](Python Restful.assets/7575721-1065e817320b7669.png)</a></p>
<blockquote>
<p><strong>text/xml 和 application/xml的区别</strong>： 当你&lt;?xml version=’1.0’ encoding=’UTF-8’&gt;指定编码的时候，使用application/xml会安装xml指定的编码传输，而使用text/html会默认使用us-ascii编码编码传输数据</p>
</blockquote>
<p><strong>使用Python操作Web service接口</strong></p>
<blockquote>
<p>pip install suds-jurko</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">from suds.client import Client</span><br><span class="line"></span><br><span class="line">service &#x3D; Client(&quot;http:&#x2F;&#x2F;115.28.108.130:4000&#x2F;?wsdl&quot;).service  # 获取远端服务对象</span><br><span class="line">result &#x3D; service.addUser(&quot;范冰冰&quot;, &quot;123456&quot;)  # 向本地方法一样调用</span><br><span class="line">print(result)  # 输出 用户已存在</span><br></pre></td></tr></table></figure>

<p><strong>使用requests库发送</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">import requests</span><br><span class="line"></span><br><span class="line">url &#x3D; &#39;http:&#x2F;&#x2F;115.28.108.130:4000&#x2F;&#39;</span><br><span class="line"></span><br><span class="line">data &#x3D; &#39;&#39;&#39;&lt;soapenv:Envelope xmlns:soapenv&#x3D;&quot;http:&#x2F;&#x2F;schemas.xmlsoap.org&#x2F;soap&#x2F;envelope&#x2F;&quot; xmlns:user&#x3D;&quot;UserService&quot;&gt;</span><br><span class="line">   &lt;soapenv:Header&#x2F;&gt;</span><br><span class="line">   &lt;soapenv:Body&gt;</span><br><span class="line">      &lt;user:addUser&gt;</span><br><span class="line">         &lt;!--Optional:--&gt;</span><br><span class="line">         &lt;user:name&gt;张三&lt;&#x2F;user:name&gt;</span><br><span class="line">         &lt;!--Optional:--&gt;</span><br><span class="line">         &lt;user:password&gt;123456&lt;&#x2F;user:password&gt;</span><br><span class="line">      &lt;&#x2F;user:addUser&gt;</span><br><span class="line">   &lt;&#x2F;soapenv:Body&gt;</span><br><span class="line">&lt;&#x2F;soapenv:Envelope&gt;</span><br><span class="line">&#39;&#39;&#39;.encode(&#39;utf-8&#39;)</span><br><span class="line"></span><br><span class="line">res &#x3D; requests.post(url&#x3D;url,data&#x3D;data)</span><br><span class="line">print(res.text)</span><br></pre></td></tr></table></figure>

<p>结果：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version&#x3D;&#39;1.0&#39; encoding&#x3D;&#39;UTF-8&#39;?&gt;</span><br><span class="line">&lt;soap11env:Envelope xmlns:soap11env&#x3D;&quot;http:&#x2F;&#x2F;schemas.xmlsoap.org&#x2F;soap&#x2F;envelope&#x2F;&quot; xmlns:tns&#x3D;&quot;UserService&quot;&gt;&lt;soap11env:Body&gt;&lt;tns:addUserResponse&gt;&lt;tns:addUserResult&gt;用户已存在&lt;&#x2F;tns:addUserResult&gt;&lt;&#x2F;tns:addUserResponse&gt;&lt;&#x2F;soap11env:Body&gt;&lt;&#x2F;soap11env:Envelope&gt;</span><br></pre></td></tr></table></figure>

<h2 id="XML解析"><a href="#XML解析" class="headerlink" title="XML解析#"></a>XML解析<a target="_blank" rel="noopener" href="https://www.cnblogs.com/superhin/p/10339004.html#2811262441">#</a></h2><p>XML: 可扩展标记语言，使用标签，多级树状结构，多用来存储和传输数据，如：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">&lt;bookstore&gt;</span><br><span class="line">	&lt;book category&#x3D;&quot;COOKING&quot;&gt;</span><br><span class="line">		&lt;title lang&#x3D;&quot;en&quot;&gt;Everyday Italian&lt;&#x2F;title&gt;</span><br><span class="line">		&lt;author&gt;Giada De Laurentiis&lt;&#x2F;author&gt;</span><br><span class="line">		&lt;year&gt;2005&lt;&#x2F;year&gt;</span><br><span class="line">		&lt;price&gt;30.00&lt;&#x2F;price&gt;</span><br><span class="line">	&lt;&#x2F;book&gt;</span><br><span class="line">	&lt;book category&#x3D;&quot;CHILDREN&quot;&gt;</span><br><span class="line">		&lt;title lang&#x3D;&quot;en&quot;&gt;Harry Potter&lt;&#x2F;title&gt;</span><br><span class="line">		&lt;author&gt;J K. Rowling&lt;&#x2F;author&gt;</span><br><span class="line">		&lt;year&gt;2005&lt;&#x2F;year&gt;</span><br><span class="line">		&lt;price&gt;29.99&lt;&#x2F;price&gt;</span><br><span class="line">	&lt;&#x2F;book&gt;</span><br><span class="line">	&lt;book category&#x3D;&quot;WEB&quot;&gt;</span><br><span class="line">		&lt;title lang&#x3D;&quot;en&quot;&gt;Learning XML&lt;&#x2F;title&gt;</span><br><span class="line">		&lt;author&gt;Erik T. Ray&lt;&#x2F;author&gt;</span><br><span class="line">		&lt;year&gt;2003&lt;&#x2F;year&gt;</span><br><span class="line">		&lt;price&gt;39.95&lt;&#x2F;price&gt;</span><br><span class="line">	&lt;&#x2F;book&gt;</span><br><span class="line">&lt;&#x2F;bookstore&gt;</span><br></pre></td></tr></table></figure>

<ul>
<li>根元素（根节点），父元素，子元素，同级元素：bookstore为根元素，book是title的父元素，title是book的子元素，title和author是同级元素</li>
<li>标签，属性，文本：bookstore boot title等为标签（元素节点），boot中category=”COOKING” category为属性，COOKING为属性值，之间的Everyday Italian为文本</li>
</ul>
<p><strong>Python解析XML</strong></p>
<ol>
<li>加载元素树（ElementTree）得到根节点</li>
<li>从根节点使用xpath查找其他节点</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">from xml.etree import ElementTree</span><br><span class="line">d &#x3D; &#39;&#39;&#39;&lt;bookstore&gt;</span><br><span class="line">	&lt;book category&#x3D;&quot;COOKING&quot;&gt;</span><br><span class="line">		&lt;title lang&#x3D;&quot;en&quot;&gt;Everyday Italian&lt;&#x2F;title&gt;</span><br><span class="line">		&lt;author&gt;Giada De Laurentiis&lt;&#x2F;author&gt;</span><br><span class="line">		&lt;year&gt;2005&lt;&#x2F;year&gt;</span><br><span class="line">		&lt;price&gt;30.00&lt;&#x2F;price&gt;</span><br><span class="line">	&lt;&#x2F;book&gt;</span><br><span class="line">	&lt;book category&#x3D;&quot;CHILDREN&quot;&gt;</span><br><span class="line">		&lt;title lang&#x3D;&quot;en&quot;&gt;Harry Potter&lt;&#x2F;title&gt;</span><br><span class="line">		&lt;author&gt;J K. Rowling&lt;&#x2F;author&gt;</span><br><span class="line">		&lt;year&gt;2005&lt;&#x2F;year&gt;</span><br><span class="line">		&lt;price&gt;29.99&lt;&#x2F;price&gt;</span><br><span class="line">	&lt;&#x2F;book&gt;</span><br><span class="line">	&lt;book category&#x3D;&quot;WEB&quot;&gt;</span><br><span class="line">		&lt;title lang&#x3D;&quot;en&quot;&gt;Learning XML&lt;&#x2F;title&gt;</span><br><span class="line">		&lt;author&gt;Erik T. Ray&lt;&#x2F;author&gt;</span><br><span class="line">		&lt;year&gt;2003&lt;&#x2F;year&gt;</span><br><span class="line">		&lt;price&gt;39.95&lt;&#x2F;price&gt;</span><br><span class="line">	&lt;&#x2F;book&gt;</span><br><span class="line">&lt;&#x2F;bookstore&gt;</span><br><span class="line">&#39;&#39;&#39;</span><br><span class="line">root &#x3D; ElementTree.fromstring(d) # 加载元素树（ElementTree）得到根节点</span><br><span class="line"></span><br><span class="line">print(root.find(&quot;.&quot;))  # 选择当前节点</span><br><span class="line">print(root.find(&quot;book&quot;))  # 选择标签为book的子节点</span><br><span class="line">print(root.find(&quot;book[2]&quot;))  # 选择标签为book的第三个子节点</span><br><span class="line">print(root.find(&quot;book[@category&#x3D;&#39;COOKING&#39;]&quot;))  # 选择标签为book切标签属性为category&#x3D;&quot;COOKING&quot;</span><br><span class="line">print(root.find(&quot;.&#x2F;book&#x2F;[title&#x3D;&#39;Harry Potter&#39;]&quot;))  # 选择标签为book的节点中包含子标签title 切title的文本内容为Harry Potter</span><br></pre></td></tr></table></figure>

<p>结果：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;Element &#39;bookstore&#39; at 0x000002406B666688&gt;</span><br><span class="line">&lt;Element &#39;book&#39; at 0x000002406B6666D8&gt;</span><br><span class="line">&lt;Element &#39;book&#39; at 0x000002406B8600E8&gt;</span><br><span class="line">&lt;Element &#39;book&#39; at 0x000002406B6666D8&gt;</span><br><span class="line">&lt;Element &#39;book&#39; at 0x000002406B8600E8&gt;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>find()返回的是节点对象，可以通过.tag获取标签名，.attrib获取属性字典，.text获取文本</p>
</blockquote>
<p><strong>XPath选择器</strong></p>
<ul>
<li>路径： 按路径选择</li>
<li>标签名： 选定所有该名的标签</li>
<li>*： 选定所有元素</li>
<li>. : 选择当前节点</li>
<li>..: 选择上级节点</li>
<li>//: 选择当前元素下所有级别的元素</li>
<li>[@属性名]：选择所有具有当前属性的元素</li>
<li>[@属性名=属性值]： 选择属性=属性值的元素</li>
<li>[子标签名]：选择具有当前子标签的元素</li>
<li>[子标签名=’文本’]： 选择子标签文本的元素</li>
</ul>
<p><strong>常用的三种定位元素方法</strong></p>
<ol>
<li>从根节点按路径选择： root.find(“./book[3]/title”)</li>
<li>按属性并结合相对路径选择： root.find(book[@category=’WEB’]/title)</li>
<li>按所包含的独特子标签选择： root.find(book[title=’Harry Potter’]/title)</li>
</ol>
<h2 id="Mock-Server"><a href="#Mock-Server" class="headerlink" title="Mock Server#"></a>Mock Server<a target="_blank" rel="noopener" href="https://www.cnblogs.com/superhin/p/10339004.html#2602042448">#</a></h2><p><strong>Mock</strong> 即模拟，就是在测试过程中，对于某些不容易构造或者不容易获取的对象，用一个虚拟的对象来创建以便测试的测试方法，其最大的优势就是降级前后端耦合度，使前端工程师可以不依赖后端返回数据，先开发前端样式以及逻辑处理<br><strong>简单来说： Mock是用了解决依赖问题的，将复杂的/不稳定的/还未建立的依赖对象用一个简单的假对象来代替</strong></p>
<p><strong>Mock Server</strong> 即Mock接口服务器，可以通过配置快速Mock出新的接口<br><strong>Mock Server的使用范围</strong></p>
<ul>
<li>前后端分离项目</li>
<li>所测接口依赖第三方系统（还未具备）</li>
<li>所测接口依赖复杂或依赖的接口不稳定，并不作为主要验证对象</li>
</ul>
<p>同时在接口还未开发好时，提供Mock接口（假接口）会比只有接口文档更直观，并能有效减少沟通成本和一些文档理解bug</p>
<p><strong>Postman的Mock Server功能</strong><br><a target="_blank" rel="noopener" href="https://upload-images.jianshu.io/upload_images/7575721-b6cc5a38731b8cee.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">![New -&gt; Mock Server](Python Restful.assets/7575721-b6cc5a38731b8cee.png)</a></p>
<p><a target="_blank" rel="noopener" href="https://upload-images.jianshu.io/upload_images/7575721-48c10a4e37391001.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">![添加接口及返回值](Python Restful.assets/7575721-48c10a4e37391001.png)</a></p>
<p><a target="_blank" rel="noopener" href="https://upload-images.jianshu.io/upload_images/7575721-f2e91d6bde5f3e47.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">![新建Mock环境](Python Restful.assets/7575721-f2e91d6bde5f3e47.png)</a></p>
<p><a target="_blank" rel="noopener" href="https://upload-images.jianshu.io/upload_images/7575721-c9868dd331e43fdd.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">![测试Mock接口](Python Restful.assets/7575721-c9868dd331e43fdd.png)</a></p>
<blockquote>
<p>Postman还可以基于Collection建立Mock Server，这里不再详述</p>
</blockquote>
<p><strong>Python+Flask自己搭建Mock接口</strong><br>使用Flask包我们可以快速搭建Mock接口</p>
<blockquote>
<p>pip install flask</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">from flask import Flask, request, jsonify, abort</span><br><span class="line">import random</span><br><span class="line"></span><br><span class="line">app &#x3D; Flask(__name__) # 实例化一个Flask对象</span><br><span class="line"></span><br><span class="line">@app.route(&quot;&#x2F;api&#x2F;user&#x2F;reg&#x2F;&quot;, methods&#x3D;[&quot;POST&quot;])</span><br><span class="line">def reg():</span><br><span class="line">    if not request.json or not &#39;name&#39; in request.json or not &#39;password&#39; in request.json:</span><br><span class="line">        abort(404) </span><br><span class="line">    res &#x3D; [</span><br><span class="line">              &#123;</span><br><span class="line">                &quot;code&quot;: &quot;100000&quot;,</span><br><span class="line">                &quot;msg&quot;: &quot;成功&quot;,</span><br><span class="line">                &quot;data&quot;: &#123;</span><br><span class="line">                  &quot;name&quot;: &quot;李六&quot;,</span><br><span class="line">                  &quot;password&quot;: &quot;e10adc3949ba59abbe56e057f20f883e&quot;</span><br><span class="line">                &#125;</span><br><span class="line">              &#125;,</span><br><span class="line">              &#123;</span><br><span class="line">                &quot;code&quot;: &quot;100001&quot;,</span><br><span class="line">                &quot;msg&quot;: &quot;失败，用户已存在&quot;,</span><br><span class="line">                &quot;data&quot;: &#123;</span><br><span class="line">                  &quot;name&quot;: &quot;李六&quot;,</span><br><span class="line">                  &quot;password&quot;: &quot;e10adc3949ba59abbe56e057f20f883e&quot;</span><br><span class="line">                &#125;</span><br><span class="line">              &#125;,</span><br><span class="line">              &#123;</span><br><span class="line">                &quot;code&quot;: &quot;100002&quot;,</span><br><span class="line">                &quot;msg&quot;: &quot;失败，添加用户失败&quot;,</span><br><span class="line">                &quot;data&quot;: &#123;</span><br><span class="line">                  &quot;name&quot;: &quot;李六&quot;,</span><br><span class="line">                  &quot;password&quot;: &quot;e10adc3949ba59abbe56e057f20f883e&quot;</span><br><span class="line">                &#125;</span><br><span class="line">              &#125;</span><br><span class="line">          ]</span><br><span class="line"></span><br><span class="line">    return jsonify(random.choice(res))</span><br><span class="line"></span><br><span class="line">if __name__ &#x3D;&#x3D; &#39;__main__&#39;:</span><br><span class="line">    app.run()</span><br></pre></td></tr></table></figure>

<p><a target="_blank" rel="noopener" href="https://upload-images.jianshu.io/upload_images/7575721-9e6a37b928ac5e39.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">![使用Mock接口](Python Restful.assets/7575721-9e6a37b928ac5e39.png)</a></p>

</article>

    <div class="pagenator post-pagenator">
    
    
        <a class="extend prev post-prev" href="/2021/03/24/JAVA%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86%E7%AC%94%E8%AE%B0/">prev</a>
    

    
    <p>last update time 2021-03-24</p>
    
    
        <a class="extend next post-next" href="/2021/03/24/%E5%BE%AE%E4%BF%A1%E5%85%AC%E4%BC%97%E5%8F%B7%E7%AC%94%E8%AE%B0/">next</a>
    
    </div>

    </div>
    <div class="footer">
        <div class="container">
    <div class="social">
	<ul class="social-list">
		
			
				
				
				<li>
					<a href="mailto:1178752402@qq.com" title="email" target="_blank">
					<i class="fa fa-email"></i>
					</a>
				</li>
			
		
			
		
			
		
			
		
			
		
			
		
			
				
				<li>
					<a href="https://github.com/CaiChenghan" title="github" target="_self">
					<i class="fa fa-github"></i>
					</a>
				</li>
			
		
			
		
			
		
			
		
			
				
				<li>
					<a href="https://www.jianshu.com/u/565c8e790605" title="jianshu" target="_self">
					<i class="fa fa-jianshu"></i>
					</a>
				</li>
			
		
			
		
			
		
			
		
	</ul>
</div>
    <div class="copyright">
        <span>
            
            
            
                © xbo 2017 - 2021
            
        </span>
    </div>
    <div class="power">
        <span>
            Powered by <a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a> & <a target="_blank" rel="noopener" href="https://github.com/CaiChenghan/iLiKE">iLiKE Theme</a>
        </span>
    </div>
    <script src="https://cdn.bootcss.com/jquery/3.3.1/jquery.js"></script>
    <!--page counter part-->
<script>
function addCount (Counter) {
    url=$('.article-date').attr('href').trim();
    title = $('.article-title').text().trim();
    var query = new AV.Query(Counter);
    //use url as unique idnetfication
    query.equalTo("url",url);
    query.find({
        success: function(results) {
            if (results.length>0) {
                var counter=results[0];
                counter.fetchWhenSave(true); //get recent result
                counter.increment("time");
                counter.save();
            } else {
                var newcounter=new Counter();
                newcounter.set("title",title);
                newcounter.set("url",url);
                newcounter.set("time",1);
                newcounter.save(null,{
                    success: function(newcounter) {
                        //alert('New object created');
                    }, error: function(newcounter,error) {
                        alert('Failed to create');
                    }
                })
            }
        },
        error: function(error) {
            //find null is not a error
            alert('Error:'+error.code+" "+error.message);
        }
    });
}
$(function() {
    var Counter=AV.Object.extend("Counter");
    //only increse visit counting when intering a page
    if ($('.article-title').length == 1) {
       addCount(Counter);
    }
    var query=new AV.Query(Counter);
    query.descending("time");
    // the sum of popular posts
    query.limit(10); 
    query.find({
        success: function(results) {
                for(var i=0;i<results.length;i++) {
                    var counter=results[i];
                    title=counter.get("title");
                    url=counter.get("url");
                    time=counter.get("time");
                    // add to the popularlist widget
                    showcontent=title+" ("+time+")";
                    //notice the "" in href
                    $('.popularlist').append('<li><a href="'+url+'">'+showcontent+'</a></li>');
                }
            },
        error: function(error) {
            alert("Error:"+error.code+" "+error.message);
        }
    });
});
</script>
</div>
    </div>
</body>
</html>
